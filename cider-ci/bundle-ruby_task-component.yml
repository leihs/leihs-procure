traits:
  asdf-ruby: true
  Bash: true

scripts:
  procure-bundle-rspec-ruby:
    exclusive_executor_resource: asdf-ruby
    timeout: 20 Minutes
    start_when:
      uberjar done: # bundle may alter the Gemfile.lock
        script_key: build-procure-uberjar
        states: [passed]
    body: |
      #!/usr/bin/env bash
      set -eux
      cd ${LEIHS_PROCURE_SPEC_DIR}
      asdf install ruby
      bundle install

  test:
    start_when:
      gems are bundled:
        script_key: procure-bundle-rspec-ruby
        states: [passed]
