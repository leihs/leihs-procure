error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {}, :remote-addr 127.0.0.1, :start-time 414760903123791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4e9d8ca3 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:cookies {}, :remote-addr 127.0.0.1, :start-time 414760903123791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4e9d8ca3 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:34:38.299Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:34:38.361Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"a2063402-4e77-4e78-93b1-51103cc24621\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "a2063402-4e77-4e78-93b1-51103cc24621", :http-only false, :path "/", :secure false}}}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}}, :remote-addr 127.0.0.1, :start-time 414761072139791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3561649 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b nil
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}}, :remote-addr 127.0.0.1, :start-time 414761090150125, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5fbc2897 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}}, :remote-addr 127.0.0.1, :start-time 414761090150125, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5fbc2897 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:34:38.449Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:34:38.457Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"a2063402-4e77-4e78-93b1-51103cc24621\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}}, :remote-addr 127.0.0.1, :start-time 414761203180166, :params {:user jimmie@goyette.com, :password nil, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7e511269 HikariProxyConnection@2119242345 wrapping org.postgresql.jdbc.PgConnection@211bde52], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x694a987c /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7ca7e74b HikariProxyConnection@2091378507 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x6cb14ab3 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x45867246 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}}, :remote-addr 127.0.0.1, :start-time 414761203180166, :params {:user jimmie@goyette.com, :password nil, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7e511269 HikariProxyConnection@2119242345 wrapping org.postgresql.jdbc.PgConnection@211bde52], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x694a987c /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7ca7e74b HikariProxyConnection@2091378507 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x6cb14ab3 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x45867246 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7ca7e74b HikariProxyConnection@2091378507 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x6cb14ab3 {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:34:38.580Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:34:38.594Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"jimmie@goyette.com\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"a2063402-4e77-4e78-93b1-51103cc24621\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}}, :remote-addr 127.0.0.1, :start-time 414761316343708, :params {:user jimmie@goyette.com, :password password, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2258249e HikariProxyConnection@576201886 wrapping org.postgresql.jdbc.PgConnection@211bde52], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x567e4ef3 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xdaeab9b HikariProxyConnection@229551003 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x4aea8803 {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x29f53914 BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}}, :remote-addr 127.0.0.1, :start-time 414761316343708, :params {:user jimmie@goyette.com, :password password, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2258249e HikariProxyConnection@576201886 wrapping org.postgresql.jdbc.PgConnection@211bde52], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x567e4ef3 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xdaeab9b HikariProxyConnection@229551003 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x4aea8803 {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token a2063402-4e77-4e78-93b1-51103cc24621}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x29f53914 BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xdaeab9b HikariProxyConnection@229551003 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x4aea8803 {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:34:38.678Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:34:38.756Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "49e3c02c-7115-45f4-bf49-b8cd26ea737e", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}, leihs-user-session {:value 49e3c02c-7115-45f4-bf49-b8cd26ea737e}}, :remote-addr 127.0.0.1, :start-time 414761421332541, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621; leihs-user-session=49e3c02c-7115-45f4-bf49-b8cd26ea737e, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5aec140e /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}, leihs-user-session {:value 49e3c02c-7115-45f4-bf49-b8cd26ea737e}}, :remote-addr 127.0.0.1, :start-time 414761421332541, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621; leihs-user-session=49e3c02c-7115-45f4-bf49-b8cd26ea737e, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5aec140e /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :procurement
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:34:38.803Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

2023-11-23T16:34:38.807Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:34:38.810Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 23 Nov 2023 14:08:11 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x330f81 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
error-handler
error-handler
error-handler
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}, leihs-user-session {:value 49e3c02c-7115-45f4-bf49-b8cd26ea737e}}, :remote-addr 127.0.0.1, :start-time 414761664796750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621; leihs-user-session=49e3c02c-7115-45f4-bf49-b8cd26ea737e, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a0a0d8 /127.0.0.1:3230<->/127.0.0.1:55294], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}, leihs-user-session {:value 49e3c02c-7115-45f4-bf49-b8cd26ea737e}}, :remote-addr 127.0.0.1, :start-time 414761664796750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621; leihs-user-session=49e3c02c-7115-45f4-bf49-b8cd26ea737e, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a0a0d8 /127.0.0.1:3230<->/127.0.0.1:55294], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :not-found
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:34:39.028Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

2023-11-23T16:34:39.030Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:34:39.032Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 23 Nov 2023 14:08:11 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x12cb89c8 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}, leihs-user-session {:value 49e3c02c-7115-45f4-bf49-b8cd26ea737e}}, :remote-addr 127.0.0.1, :start-time 414761670793166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621; leihs-user-session=49e3c02c-7115-45f4-bf49-b8cd26ea737e, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token a2063402-4e77-4e78-93b1-51103cc24621, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5f19a561 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7dadcf35 leihs.procurement.graphql$handler@7dadcf35], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a2063402-4e77-4e78-93b1-51103cc24621}, leihs-user-session {:value 49e3c02c-7115-45f4-bf49-b8cd26ea737e}}, :remote-addr 127.0.0.1, :start-time 414761670793166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a2063402-4e77-4e78-93b1-51103cc24621; leihs-user-session=49e3c02c-7115-45f4-bf49-b8cd26ea737e, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token a2063402-4e77-4e78-93b1-51103cc24621, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5f19a561 /127.0.0.1:3230<->/127.0.0.1:55287], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7dadcf35 leihs.procurement.graphql$handler@7dadcf35], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :graphql
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:34:38.711743Z", :id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :user_session_id #uuid "b5b3fc95-4cee-4ba9-814c-f03c32708321", :scope_system_admin_read false, :access-rights (), :user_id #uuid "acd044a0-4bf1-4450-aa59-04690099808a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:34:39.071Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "acd044a0-4bf1-4450-aa59-04690099808a"]

2023-11-23T16:34:39.073Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:34:39.086Z NX-41294 DEBUG [leihs.procurement.graphql:41] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
2023-11-23T16:34:39.101Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap
2023-11-23T16:34:39.103Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap
 :via
 [{:type clojure.lang.ArityException
   :message Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap
   :at [clojure.lang.AFn throwArity AFn.java 429]}]
 :trace
 [[clojure.lang.AFn throwArity AFn.java 429]
  [clojure.lang.AFn invoke AFn.java 28]
  [leihs.procurement.resources.user$get_user_by_id invokeStatic user.clj 31]
  [leihs.procurement.resources.user$get_user_by_id invoke user.clj 29]
  [leihs.procurement.resources.current_user$get_current_user invokeStatic current_user.clj 13]
  [leihs.procurement.resources.current_user$get_current_user invoke current_user.clj 7]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44363 invoke resolver.clj 12]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.core.protocols$fn__8181 invokeStatic protocols.clj 168]
  [clojure.core.protocols$fn__8181 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-11-23T16:34:39.114Z NX-41294 DEBUG [leihs.procurement.graphql:57] - result => {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "ArityException"}})}
2023-11-23T16:34:39.117Z NX-41294 DEBUG [leihs.procurement.graphql:58] - {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "ArityException"}})}
2023-11-23T16:34:39.117Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "ArityException"}})}, :graphql-error true}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {}, :remote-addr 127.0.0.1, :start-time 414877901943083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2fee2c68 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:cookies {}, :remote-addr 127.0.0.1, :start-time 414877901943083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2fee2c68 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:36:35.260Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:36:35.288Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"dd8c2daa-b866-41d7-b632-cb483137a690\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "dd8c2daa-b866-41d7-b632-cb483137a690", :http-only false, :path "/", :secure false}}}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}}, :remote-addr 127.0.0.1, :start-time 414877992010291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x15089c5d /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b nil
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}}, :remote-addr 127.0.0.1, :start-time 414878015654875, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8cf6eed /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}}, :remote-addr 127.0.0.1, :start-time 414878015654875, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8cf6eed /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:36:35.365Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:36:35.372Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"dd8c2daa-b866-41d7-b632-cb483137a690\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}}, :remote-addr 127.0.0.1, :start-time 414878147908791, :params {:user jimmie@goyette.com, :password nil, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x60cd5afc HikariProxyConnection@1624070908 wrapping org.postgresql.jdbc.PgConnection@211bde52], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x46d33662 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x4e7f4ccb HikariProxyConnection@1316965579 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x35bff727 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x3faf41d6 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}}, :remote-addr 127.0.0.1, :start-time 414878147908791, :params {:user jimmie@goyette.com, :password nil, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x60cd5afc HikariProxyConnection@1624070908 wrapping org.postgresql.jdbc.PgConnection@211bde52], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x46d33662 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x4e7f4ccb HikariProxyConnection@1316965579 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x35bff727 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x3faf41d6 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x4e7f4ccb HikariProxyConnection@1316965579 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x35bff727 {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:36:35.508Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:36:35.520Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"jimmie@goyette.com\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"dd8c2daa-b866-41d7-b632-cb483137a690\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}}, :remote-addr 127.0.0.1, :start-time 414878254862833, :params {:user jimmie@goyette.com, :password password, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7cc10e14 HikariProxyConnection@2093026836 wrapping org.postgresql.jdbc.PgConnection@211bde52], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x50d7b7e3 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e504349 HikariProxyConnection@1582318409 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x7e8ea8a {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x732de5cd BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}}, :remote-addr 127.0.0.1, :start-time 414878254862833, :params {:user jimmie@goyette.com, :password password, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7cc10e14 HikariProxyConnection@2093026836 wrapping org.postgresql.jdbc.PgConnection@211bde52], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x50d7b7e3 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e504349 HikariProxyConnection@1582318409 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x7e8ea8a {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token dd8c2daa-b866-41d7-b632-cb483137a690}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x732de5cd BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3cd95c7c compojure.core$routes$fn__27950@3cd95c7c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e504349 HikariProxyConnection@1582318409 wrapping org.postgresql.jdbc.PgConnection@5529b7be], :level 1, :rollback #object[clojure.lang.Atom 0x7e8ea8a {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:36:35.614Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:36:35.654Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "ae718d25-be6e-44af-a736-f328bc0349d9", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}, leihs-user-session {:value ae718d25-be6e-44af-a736-f328bc0349d9}}, :remote-addr 127.0.0.1, :start-time 414878321573791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690; leihs-user-session=ae718d25-be6e-44af-a736-f328bc0349d9, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x38a71eb4 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}, leihs-user-session {:value ae718d25-be6e-44af-a736-f328bc0349d9}}, :remote-addr 127.0.0.1, :start-time 414878321573791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690; leihs-user-session=ae718d25-be6e-44af-a736-f328bc0349d9, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x38a71eb4 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :procurement
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:36:35.688Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

2023-11-23T16:36:35.693Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:36:35.695Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 23 Nov 2023 14:08:11 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x51a9f698 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
error-handler
error-handler
error-handler
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}, leihs-user-session {:value ae718d25-be6e-44af-a736-f328bc0349d9}}, :remote-addr 127.0.0.1, :start-time 414878567075208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690; leihs-user-session=ae718d25-be6e-44af-a736-f328bc0349d9, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3596744b /127.0.0.1:3230<->/127.0.0.1:55335], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}, leihs-user-session {:value ae718d25-be6e-44af-a736-f328bc0349d9}}, :remote-addr 127.0.0.1, :start-time 414878567075208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690; leihs-user-session=ae718d25-be6e-44af-a736-f328bc0349d9, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3596744b /127.0.0.1:3230<->/127.0.0.1:55335], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x16c97c07 leihs.procurement.backend.html$not_found_handler@16c97c07], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :not-found
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x28ecf034 leihs.procurement.authorization$wrap_authorize$fn__39139@28ecf034]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}, leihs-user-session {:value ae718d25-be6e-44af-a736-f328bc0349d9}}, :remote-addr 127.0.0.1, :start-time 414878573657416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable >myprint>  admin true#object[
com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690; leihs-user-session=ae718d25-be6e-44af-a736-f328bc0349d9, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token dd8c2daa-b866-41d7-b632-cb483137a690, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2edf4f92 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7dadcf35 leihs.procurement.graphql$handler@7dadcf35], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44243 0x42d4eaa6 leihs.core.locale$wrap$fn__44243@42d4eaa6]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dd8c2daa-b866-41d7-b632-cb483137a690}, leihs-user-session {:value ae718d25-be6e-44af-a736-f328bc0349d9}}, :remote-addr 127.0.0.1, :start-time 414878573657416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x573e28fc HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3fc3f93b next.jdbc.result_set$as_unqualified_lower_maps@3fc3f93b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=dd8c2daa-b866-41d7-b632-cb483137a690; leihs-user-session=ae718d25-be6e-44af-a736-f328bc0349d9, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token dd8c2daa-b866-41d7-b632-cb483137a690, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2edf4f92 /127.0.0.1:3230<->/127.0.0.1:55328], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7dadcf35 leihs.procurement.graphql$handler@7dadcf35], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>myprint>
>>1 (:handler-key request) :graphqlinspector
 >myprint>  authEnt? false
{:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:36:35.635878Z", :id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :user_session_id #uuid "8ebe33e2-7839-4b5a-8e36-f37aaa7feadc", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x7fb48671 HikariDataSource (db-pool)]}

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

>myprint>  viewer false
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

>myprint>  requester false
>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

2023-11-23T16:36:35.938Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>myprint>  viewer false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

>myprint>  requester false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

2023-11-23T16:36:35.939Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-23T16:36:35.941Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

wrap
2023-11-23T16:36:35.942Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 23 Nov 2023 14:08:11 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x49b7bef2 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "d61a3ce9-ba03-4ad6-8acf-cba00aee9ed6"]

2023-11-23T16:36:35.945Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:36:35.952Z NX-41294 DEBUG [leihs.procurement.graphql:41] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
2023-11-23T16:36:35.961Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap
2023-11-23T16:36:35.961Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap
 :via
 [{:type clojure.lang.ArityException
   :message Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap
   :at [clojure.lang.AFn throwArity AFn.java 429]}]
 :trace
 [[clojure.lang.AFn throwArity AFn.java 429]
  [clojure.lang.AFn invoke AFn.java 28]
  [leihs.procurement.resources.user$get_user_by_id invokeStatic user.clj 31]
  [leihs.procurement.resources.user$get_user_by_id invoke user.clj 29]
  [leihs.procurement.resources.current_user$get_current_user invokeStatic current_user.clj 13]
  [leihs.procurement.resources.current_user$get_current_user invoke current_user.clj 7]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44363 invoke resolver.clj 12]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.core.protocols$fn__8181 invokeStatic protocols.clj 168]
  [clojure.core.protocols$fn__8181 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-11-23T16:36:35.967Z NX-41294 DEBUG [leihs.procurement.graphql:57] - result => {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "ArityException"}})}
2023-11-23T16:36:35.967Z NX-41294 DEBUG [leihs.procurement.graphql:58] - {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "ArityException"}})}
2023-11-23T16:36:35.968Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "Wrong number of args (0) passed to: clojure.lang.PersistentArrayMap", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "ArityException"}})}, :graphql-error true}
2023-11-23T16:47:35.972Z NX-41294 INFO [leihs.core.http-server:84] - stopping running http-server
2023-11-23T16:47:36.209Z NX-41294 INFO [leihs.core.http-server:88] - stopped http-server
➜  procure runbet
>> Running: ./bin/dev-run-backend --db-port 5415 --db-name leihs_test
# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
Syntax error (ClassNotFoundException) compiling at (leihs/procurement/resources/user.clj:1:1).
honey.sql.helpers

Full report at:
/var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/clojure-3200547045955496048.edn
➜  procure git:(0d7cb0b) ✗ runbet
>> Running: ./bin/dev-run-backend --db-port 5415 --db-name leihs_test
# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-11-23T16:48:21.331Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value
2023-11-23T16:48:21.908Z NX-41294 INFO [leihs.core.logging:27] - initializing logging  {:min-level [[#{"leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-11-23T16:48:21.914Z NX-41294 INFO [leihs.core.logging:29] - initialized logging  {:min-level [[#{"leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x17d20f20 "taoensso.timbre$default_output_fn@17d20f20"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x25bdbdea "taoensso.timbre.appenders.core$println_appender$fn__3459@25bdbdea"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-11-23T16:48:21.917Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-11-23T16:48:21.930Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 60218, :repl-port-file ".nrepl-port"}
2023-11-23T16:48:21.932Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  60218 localhost
2023-11-23T16:48:21.960Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server
2023-11-23T16:48:21.965Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 60218, :repl-port-file .nrepl-port}
2023-11-23T16:48:21.965Z NX-41294 INFO [leihs.core.shutdown:20] - PID 24046
2023-11-23T16:48:21.991Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-11-23T16:48:22.044Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-11-23T16:48:22.046Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-23T16:48:22.052Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-11-23T16:48:22.126Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@2db55d4b
2023-11-23T16:48:22.131Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-11-23T16:48:22.131Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 "HikariDataSource (db-pool)"]}
2023-11-23T16:48:22.132Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-23T16:48:22.146Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-11-23T16:48:22.165Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@432bc43a
2023-11-23T16:48:22.166Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-11-23T16:48:22.171Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 "next.jdbc.result_set$as_unqualified_lower_maps@60298de1"]}}
2023-11-23T16:48:22.178Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x6d34e65f "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x4ac31c12 "java.util.concurrent.ThreadPoolExecutor@4ac31c12[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-11-23T16:48:22.188Z NX-41294 INFO [leihs.core.http-server:104] - started http-server
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x6d2642b4 leihs.procurement.authorization$wrap_authorize$fn__39139@6d2642b4]
>>wrap-authenticate::request {:cookies {}, :remote-addr 127.0.0.1, :start-time 415649613015666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x21973651 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7246099 compojure.core$routes$fn__27950@7246099], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x64ef3ba7 leihs.core.locale$wrap$fn__44250@64ef3ba7]

>>1 request {:cookies {}, :remote-addr 127.0.0.1, :start-time 415649613015666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x21973651 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7246099 compojure.core$routes$fn__27950@7246099], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:49:27.049Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:49:27.113Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"92ca63b3-a3db-40e8-97c3-9821b27c236c\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "92ca63b3-a3db-40e8-97c3-9821b27c236c", :http-only false, :path "/", :secure false}}}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x6d2642b4 leihs.procurement.authorization$wrap_authorize$fn__39139@6d2642b4]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}}, :remote-addr 127.0.0.1, :start-time 415649784378625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3cd5a4c4 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x7e967a1f leihs.procurement.backend.html$not_found_handler@7e967a1f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b nil
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x6d2642b4 leihs.procurement.authorization$wrap_authorize$fn__39139@6d2642b4]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}}, :remote-addr 127.0.0.1, :start-time 415649809212000, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5a05d549 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7246099 compojure.core$routes$fn__27950@7246099], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x64ef3ba7 leihs.core.locale$wrap$fn__44250@64ef3ba7]

>>1 request {:cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}}, :remote-addr 127.0.0.1, :start-time 415649809212000, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5a05d549 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7246099 compojure.core$routes$fn__27950@7246099], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:49:27.196Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:49:27.205Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"92ca63b3-a3db-40e8-97c3-9821b27c236c\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x6d2642b4 leihs.procurement.authorization$wrap_authorize$fn__39139@6d2642b4]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}}, :remote-addr 127.0.0.1, :start-time 415649931556750, :params {:user jimmie@goyette.com, :password nil, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x637f1839 HikariProxyConnection@1669273657 wrapping org.postgresql.jdbc.PgConnection@432bc43a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x51361892 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x534ed73b HikariProxyConnection@1397675835 wrapping org.postgresql.jdbc.PgConnection@2db55d4b], :level 1, :rollback #object[clojure.lang.Atom 0x2b42c167 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x2479a6fa BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7246099 compojure.core$routes$fn__27950@7246099], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x64ef3ba7 leihs.core.locale$wrap$fn__44250@64ef3ba7]

>>1 request {:cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}}, :remote-addr 127.0.0.1, :start-time 415649931556750, :params {:user jimmie@goyette.com, :password nil, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x637f1839 HikariProxyConnection@1669273657 wrapping org.postgresql.jdbc.PgConnection@432bc43a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x51361892 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x534ed73b HikariProxyConnection@1397675835 wrapping org.postgresql.jdbc.PgConnection@2db55d4b], :level 1, :rollback #object[clojure.lang.Atom 0x2b42c167 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x2479a6fa BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7246099 compojure.core$routes$fn__27950@7246099], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x534ed73b HikariProxyConnection@1397675835 wrapping org.postgresql.jdbc.PgConnection@2db55d4b], :level 1, :rollback #object[clojure.lang.Atom 0x2b42c167 {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:49:27.333Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:49:27.349Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"jimmie@goyette.com\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"92ca63b3-a3db-40e8-97c3-9821b27c236c\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x6d2642b4 leihs.procurement.authorization$wrap_authorize$fn__39139@6d2642b4]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}}, :remote-addr 127.0.0.1, :start-time 415650053214333, :params {:user jimmie@goyette.com, :password password, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x54886a6f HikariProxyConnection@1418226287 wrapping org.postgresql.jdbc.PgConnection@432bc43a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2e5c12f7 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x68244fc9 HikariProxyConnection@1747210185 wrapping org.postgresql.jdbc.PgConnection@2db55d4b], :level 1, :rollback #object[clojure.lang.Atom 0x5efb2e99 {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x4937fc3b BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7246099 compojure.core$routes$fn__27950@7246099], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x64ef3ba7 leihs.core.locale$wrap$fn__44250@64ef3ba7]

>>1 request {:cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}}, :remote-addr 127.0.0.1, :start-time 415650053214333, :params {:user jimmie@goyette.com, :password password, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x54886a6f HikariProxyConnection@1418226287 wrapping org.postgresql.jdbc.PgConnection@432bc43a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2e5c12f7 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x68244fc9 HikariProxyConnection@1747210185 wrapping org.postgresql.jdbc.PgConnection@2db55d4b], :level 1, :rollback #object[clojure.lang.Atom 0x5efb2e99 {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x4937fc3b BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7246099 compojure.core$routes$fn__27950@7246099], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x68244fc9 HikariProxyConnection@1747210185 wrapping org.postgresql.jdbc.PgConnection@2db55d4b], :level 1, :rollback #object[clojure.lang.Atom 0x5efb2e99 {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:49:27.439Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:49:27.518Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "d0928240-cf12-432d-90d4-4b610e5708c5", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x6d2642b4 leihs.procurement.authorization$wrap_authorize$fn__39139@6d2642b4]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}, leihs-user-session {:value d0928240-cf12-432d-90d4-4b610e5708c5}}, :remote-addr 127.0.0.1, :start-time 415650166685375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c; leihs-user-session=d0928240-cf12-432d-90d4-4b610e5708c5, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7510bf36 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x7e967a1f leihs.procurement.backend.html$not_found_handler@7e967a1f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x64ef3ba7 leihs.core.locale$wrap$fn__44250@64ef3ba7]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}, leihs-user-session {:value d0928240-cf12-432d-90d4-4b610e5708c5}}, :remote-addr 127.0.0.1, :start-time 415650166685375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c; leihs-user-session=d0928240-cf12-432d-90d4-4b610e5708c5, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7510bf36 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x7e967a1f leihs.procurement.backend.html$not_found_handler@7e967a1f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :procurement
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:49:27.566Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

2023-11-23T16:49:27.572Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:49:27.574Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 23 Nov 2023 14:08:11 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x3de64269 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
error-handler
error-handler
error-handler
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x6d2642b4 leihs.procurement.authorization$wrap_authorize$fn__39139@6d2642b4]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}, leihs-user-session {:value d0928240-cf12-432d-90d4-4b610e5708c5}}, :remote-addr 127.0.0.1, :start-time 415650399140750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c; leihs-user-session=d0928240-cf12-432d-90d4-4b610e5708c5, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a83b8a4 /127.0.0.1:3230<->/127.0.0.1:55421], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x7e967a1f leihs.procurement.backend.html$not_found_handler@7e967a1f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x64ef3ba7 leihs.core.locale$wrap$fn__44250@64ef3ba7]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}, leihs-user-session {:value d0928240-cf12-432d-90d4-4b610e5708c5}}, :remote-addr 127.0.0.1, :start-time 415650399140750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c; leihs-user-session=d0928240-cf12-432d-90d4-4b610e5708c5, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a83b8a4 /127.0.0.1:3230<->/127.0.0.1:55421], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x7e967a1f leihs.procurement.backend.html$not_found_handler@7e967a1f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :not-found
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:49:27.792Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

2023-11-23T16:49:27.794Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:49:27.795Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 23 Nov 2023 14:08:11 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x5ebd4dbd "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x6d2642b4 leihs.procurement.authorization$wrap_authorize$fn__39139@6d2642b4]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}, leihs-user-session {:value d0928240-cf12-432d-90d4-4b610e5708c5}}, :remote-addr 127.0.0.1, :start-time 415650404360625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c; leihs-user-session=d0928240-cf12-432d-90d4-4b610e5708c5, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x48691843 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x12ae4998 leihs.procurement.graphql$handler@12ae4998], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x64ef3ba7 leihs.core.locale$wrap$fn__44250@64ef3ba7]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 92ca63b3-a3db-40e8-97c3-9821b27c236c}, leihs-user-session {:value d0928240-cf12-432d-90d4-4b610e5708c5}}, :remote-addr 127.0.0.1, :start-time 415650404360625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x7d94c39b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x60298de1 next.jdbc.result_set$as_unqualified_lower_maps@60298de1]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=92ca63b3-a3db-40e8-97c3-9821b27c236c; leihs-user-session=d0928240-cf12-432d-90d4-4b610e5708c5, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 92ca63b3-a3db-40e8-97c3-9821b27c236c, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x48691843 /127.0.0.1:3230<->/127.0.0.1:55414], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x12ae4998 leihs.procurement.graphql$handler@12ae4998], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :graphql
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:49:27.472233Z", :id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :user_session_id #uuid "9a919194-85a6-4933-a9fc-9ed9084f6c02", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x17d8e757 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:49:27.832Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"]

2023-11-23T16:49:27.834Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:49:27.838Z NX-41294 DEBUG [leihs.procurement.graphql:41] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
2023-11-23T16:49:27.848Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "bc150279-c86e-41a3-9b85-7a2a5d7a215b"
2023-11-23T16:49:27.855Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - ERROR: column "uuid" does not exist
  Hinweis: Perhaps you meant to reference the column "users.id".
  Position: 78
2023-11-23T16:49:27.856Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause ERROR: column "uuid" does not exist
  Hinweis: Perhaps you meant to reference the column "users.id".
  Position: 78
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: column "uuid" does not exist
  Hinweis: Perhaps you meant to reference the column "users.id".
  Position: 78
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11846 invoke result_set.clj 927]
  [next.jdbc.protocols$eval10723$fn__10724$G__10712__10733 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11022 invoke default_options.clj 28]
  [next.jdbc.protocols$eval10723$fn__10724$G__10712__10733 invoke protocols.clj 34]
  [next.jdbc$execute_one_BANG_ invokeStatic jdbc.clj 270]
  [next.jdbc$execute_one_BANG_ invoke jdbc.clj 257]
  [leihs.procurement.resources.user$get_user_by_id invokeStatic user.clj 76]
  [leihs.procurement.resources.user$get_user_by_id invoke user.clj 73]
  [leihs.procurement.resources.current_user$get_current_user invokeStatic current_user.clj 13]
  [leihs.procurement.resources.current_user$get_current_user invoke current_user.clj 7]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44370 invoke resolver.clj 12]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.core.protocols$fn__8181 invokeStatic protocols.clj 168]
  [clojure.core.protocols$fn__8181 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-11-23T16:49:27.871Z NX-41294 DEBUG [leihs.procurement.graphql:57] - result => {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "ERROR: column \"uuid\" does not exist\n  Hinweis: Perhaps you meant to reference the column \"users.id\".\n  Position: 78", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "PSQLException"}})}
2023-11-23T16:49:27.875Z NX-41294 DEBUG [leihs.procurement.graphql:58] - {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "ERROR: column \"uuid\" does not exist\n  Hinweis: Perhaps you meant to reference the column \"users.id\".\n  Position: 78", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "PSQLException"}})}
2023-11-23T16:49:27.875Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "ERROR: column \"uuid\" does not exist\n  Hinweis: Perhaps you meant to reference the column \"users.id\".\n  Position: 78", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "PSQLException"}})}, :graphql-error true}
2023-11-23T16:50:41.274Z NX-41294 INFO [leihs.core.http-server:84] - stopping running http-server
2023-11-23T16:50:41.485Z NX-41294 INFO [leihs.core.http-server:88] - stopped http-server
➜  procure
➜  procure runbet
>> Running: ./bin/dev-run-backend --db-port 5415 --db-name leihs_test
# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-11-23T16:50:53.406Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value
2023-11-23T16:50:53.986Z NX-41294 INFO [leihs.core.logging:27] - initializing logging  {:min-level [[#{"leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-11-23T16:50:53.995Z NX-41294 INFO [leihs.core.logging:29] - initialized logging  {:min-level [[#{"leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x23faf03c "taoensso.timbre$default_output_fn@23faf03c"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x1e9264d3 "taoensso.timbre.appenders.core$println_appender$fn__3459@1e9264d3"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-11-23T16:50:53.997Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-11-23T16:50:54.010Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 34927, :repl-port-file ".nrepl-port"}
2023-11-23T16:50:54.013Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  34927 localhost
2023-11-23T16:50:54.041Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server
2023-11-23T16:50:54.047Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 34927, :repl-port-file .nrepl-port}
2023-11-23T16:50:54.048Z NX-41294 INFO [leihs.core.shutdown:20] - PID 31354
2023-11-23T16:50:54.072Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-11-23T16:50:54.122Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-11-23T16:50:54.124Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-23T16:50:54.130Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-11-23T16:50:54.201Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@4e76fa72
2023-11-23T16:50:54.206Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-11-23T16:50:54.207Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 "HikariDataSource (db-pool)"]}
2023-11-23T16:50:54.208Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-23T16:50:54.221Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-11-23T16:50:54.231Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3c22a55e
2023-11-23T16:50:54.232Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-11-23T16:50:54.237Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 "next.jdbc.result_set$as_unqualified_lower_maps@b71da18"]}}
2023-11-23T16:50:54.244Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x2fcfae28 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x13e686bf "java.util.concurrent.ThreadPoolExecutor@13e686bf[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-11-23T16:50:54.255Z NX-41294 INFO [leihs.core.http-server:104] - started http-server
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0xc9f90c0 leihs.procurement.authorization$wrap_authorize$fn__39139@c9f90c0]
>>wrap-authenticate::request {:cookies {}, :remote-addr 127.0.0.1, :start-time 415773756026666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5484278a /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x629bc24f compojure.core$routes$fn__27950@629bc24f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x5c6638d7 leihs.core.locale$wrap$fn__44250@5c6638d7]

>>1 request {:cookies {}, :remote-addr 127.0.0.1, :start-time 415773756026666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5484278a /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x629bc24f compojure.core$routes$fn__27950@629bc24f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:51:31.179Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:51:31.252Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"c0253f5d-0cd8-4067-b123-d6f406706e6e\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "c0253f5d-0cd8-4067-b123-d6f406706e6e", :http-only false, :path "/", :secure false}}}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0xc9f90c0 leihs.procurement.authorization$wrap_authorize$fn__39139@c9f90c0]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}}, :remote-addr 127.0.0.1, :start-time 415773924491875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5450a9e5 /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x361613ea leihs.procurement.backend.html$not_found_handler@361613ea], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b nil
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0xc9f90c0 leihs.procurement.authorization$wrap_authorize$fn__39139@c9f90c0]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}}, :remote-addr 127.0.0.1, :start-time 415773947515208, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3de64269 /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x629bc24f compojure.core$routes$fn__27950@629bc24f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x5c6638d7 leihs.core.locale$wrap$fn__44250@5c6638d7]

>>1 request {:cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}}, :remote-addr 127.0.0.1, :start-time 415773947515208, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3de64269 /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x629bc24f compojure.core$routes$fn__27950@629bc24f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:51:31.334Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:51:31.342Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"c0253f5d-0cd8-4067-b123-d6f406706e6e\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0xc9f90c0 leihs.procurement.authorization$wrap_authorize$fn__39139@c9f90c0]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}}, :remote-addr 127.0.0.1, :start-time 415774075369291, :params {:user jimmie@goyette.com, :password nil, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x56d721c4 HikariProxyConnection@1456939460 wrapping org.postgresql.jdbc.PgConnection@3c22a55e], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5c2385e /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x42482a9d HikariProxyConnection@1112025757 wrapping org.postgresql.jdbc.PgConnection@4e76fa72], :level 1, :rollback #object[clojure.lang.Atom 0x2a0377f2 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x7e700c87 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x629bc24f compojure.core$routes$fn__27950@629bc24f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x5c6638d7 leihs.core.locale$wrap$fn__44250@5c6638d7]

>>1 request {:cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}}, :remote-addr 127.0.0.1, :start-time 415774075369291, :params {:user jimmie@goyette.com, :password nil, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x56d721c4 HikariProxyConnection@1456939460 wrapping org.postgresql.jdbc.PgConnection@3c22a55e], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5c2385e /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x42482a9d HikariProxyConnection@1112025757 wrapping org.postgresql.jdbc.PgConnection@4e76fa72], :level 1, :rollback #object[clojure.lang.Atom 0x2a0377f2 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x7e700c87 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x629bc24f compojure.core$routes$fn__27950@629bc24f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x42482a9d HikariProxyConnection@1112025757 wrapping org.postgresql.jdbc.PgConnection@4e76fa72], :level 1, :rollback #object[clojure.lang.Atom 0x2a0377f2 {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:51:31.477Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:51:31.489Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"jimmie@goyette.com\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"c0253f5d-0cd8-4067-b123-d6f406706e6e\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0xc9f90c0 leihs.procurement.authorization$wrap_authorize$fn__39139@c9f90c0]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}}, :remote-addr 127.0.0.1, :start-time 415774188408166, :params {:user jimmie@goyette.com, :password password, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6710a802 HikariProxyConnection@1729144834 wrapping org.postgresql.jdbc.PgConnection@3c22a55e], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x33b99459 /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5ab59ebc HikariProxyConnection@1521852092 wrapping org.postgresql.jdbc.PgConnection@4e76fa72], :level 1, :rollback #object[clojure.lang.Atom 0x672abe7e {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x5985a21 BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x629bc24f compojure.core$routes$fn__27950@629bc24f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x5c6638d7 leihs.core.locale$wrap$fn__44250@5c6638d7]

>>1 request {:cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}}, :remote-addr 127.0.0.1, :start-time 415774188408166, :params {:user jimmie@goyette.com, :password password, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6710a802 HikariProxyConnection@1729144834 wrapping org.postgresql.jdbc.PgConnection@3c22a55e], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x33b99459 /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5ab59ebc HikariProxyConnection@1521852092 wrapping org.postgresql.jdbc.PgConnection@4e76fa72], :level 1, :rollback #object[clojure.lang.Atom 0x672abe7e {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x5985a21 BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x629bc24f compojure.core$routes$fn__27950@629bc24f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5ab59ebc HikariProxyConnection@1521852092 wrapping org.postgresql.jdbc.PgConnection@4e76fa72], :level 1, :rollback #object[clojure.lang.Atom 0x672abe7e {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:51:31.575Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
locale-wrap
wrap
2023-11-23T16:51:31.648Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0xc9f90c0 leihs.procurement.authorization$wrap_authorize$fn__39139@c9f90c0]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}, leihs-user-session {:value 8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e}}, :remote-addr 127.0.0.1, :start-time 415774287181208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e; leihs-user-session=8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5611d1be /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x361613ea leihs.procurement.backend.html$not_found_handler@361613ea], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x5c6638d7 leihs.core.locale$wrap$fn__44250@5c6638d7]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}, leihs-user-session {:value 8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e}}, :remote-addr 127.0.0.1, :start-time 415774287181208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e; leihs-user-session=8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5611d1be /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x361613ea leihs.procurement.backend.html$not_found_handler@361613ea], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :procurement
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:51:31.694Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

2023-11-23T16:51:31.700Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:51:31.703Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 23 Nov 2023 14:08:11 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x54baf5fa "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
error-handler
error-handler
error-handler
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0xc9f90c0 leihs.procurement.authorization$wrap_authorize$fn__39139@c9f90c0]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}, leihs-user-session {:value 8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e}}, :remote-addr 127.0.0.1, :start-time 415774530069833, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e; leihs-user-session=8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x678a2f22 /127.0.0.1:3230<->/127.0.0.1:55460], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x361613ea leihs.procurement.backend.html$not_found_handler@361613ea], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
error-handler

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x5c6638d7 leihs.core.locale$wrap$fn__44250@5c6638d7]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}, leihs-user-session {:value 8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e}}, :remote-addr 127.0.0.1, :start-time 415774530069833, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e; leihs-user-session=8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x678a2f22 /127.0.0.1:3230<->/127.0.0.1:55460], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x361613ea leihs.procurement.backend.html$not_found_handler@361613ea], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :not-found
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:51:31.919Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

2023-11-23T16:51:31.921Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:51:31.924Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 23 Nov 2023 14:08:11 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x70cb6a3b "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0xc9f90c0 leihs.procurement.authorization$wrap_authorize$fn__39139@c9f90c0]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}, leihs-user-session {:value 8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e}}, :remote-addr 127.0.0.1, :start-time 415774541567458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e; leihs-user-session=8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a973270 /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x308b81d7 leihs.procurement.graphql$handler@308b81d7], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44250 0x5c6638d7 leihs.core.locale$wrap$fn__44250@5c6638d7]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value c0253f5d-0cd8-4067-b123-d6f406706e6e}, leihs-user-session {:value 8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e}}, :remote-addr 127.0.0.1, :start-time 415774541567458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xb71da18 next.jdbc.result_set$as_unqualified_lower_maps@b71da18]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=c0253f5d-0cd8-4067-b123-d6f406706e6e; leihs-user-session=8bc4433f-1b7b-4e0d-9c64-9bca8497ec1e, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token c0253f5d-0cd8-4067-b123-d6f406706e6e, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a973270 /127.0.0.1:3230<->/127.0.0.1:55455], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x308b81d7 leihs.procurement.graphql$handler@308b81d7], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :graphql
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T16:51:31.602228Z", :id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :user_session_id #uuid "fb2414d7-0bcc-4be5-93c3-0aaf274a6ffd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x16552193 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T16:51:31.966Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"]

2023-11-23T16:51:31.968Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
locale-wrap
wrap
2023-11-23T16:51:31.972Z NX-41294 DEBUG [leihs.procurement.graphql:41] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
2023-11-23T16:51:31.982Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "6266d34b-ab95-4c68-9c22-347d8f43d388"
2023-11-23T16:51:31.990Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - NullPointerException
2023-11-23T16:51:31.992Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause nil
 :via
 [{:type java.lang.NullPointerException
   :message nil
   :at [leihs.procurement.resources.saved_filters$get_saved_filters_by_user_id invokeStatic saved_filters.clj 31]}]
 :trace
 [[leihs.procurement.resources.saved_filters$get_saved_filters_by_user_id invokeStatic saved_filters.clj 31]
  [leihs.procurement.resources.saved_filters$get_saved_filters_by_user_id invoke saved_filters.clj 29]
  [leihs.procurement.resources.current_user$get_current_user invokeStatic current_user.clj 14]
  [leihs.procurement.resources.current_user$get_current_user invoke current_user.clj 7]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44370 invoke resolver.clj 12]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.core.protocols$fn__8181 invokeStatic protocols.clj 168]
  [clojure.core.protocols$fn__8181 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-11-23T16:51:32.004Z NX-41294 DEBUG [leihs.procurement.graphql:57] - result => {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "NullPointerException"}})}
2023-11-23T16:51:32.008Z NX-41294 DEBUG [leihs.procurement.graphql:58] - {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "NullPointerException"}})}
2023-11-23T16:51:32.008Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user nil] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])]), :errors ({:message "", :locations [{:line 2, :column 3}], :path [:current_user], :extensions {:exception "NullPointerException"}})}, :graphql-error true}


