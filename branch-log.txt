➜  procure runbet
>> Running: ./bin/dev-run-backend --db-port 5415 --db-name leihs_test
# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
Syntax error compiling at (leihs/procurement/resources/requests.clj:122:17).
No such var: sql/format

Full report at:
/var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/clojure-12085240254968048118.edn
➜  procure git:(mr/next-dev) ✗ runbet
>> Running: ./bin/dev-run-backend --db-port 5415 --db-name leihs_test
# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-11-24T17:22:57.957Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value
2023-11-24T17:22:58.503Z NX-41294 INFO [leihs.core.logging:35] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.permissions.*" "leihs.procurement.authorization"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-11-24T17:22:58.511Z NX-41294 INFO [leihs.core.logging:37] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.permissions.*" "leihs.procurement.authorization"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x67cc0d65 "taoensso.timbre$default_output_fn@67cc0d65"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x6b739fd0 "taoensso.timbre.appenders.core$println_appender$fn__3459@6b739fd0"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-11-24T17:22:58.513Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-11-24T17:22:58.527Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 58265, :repl-port-file ".nrepl-port"}
2023-11-24T17:22:58.530Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  58265 localhost
2023-11-24T17:22:58.555Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server
2023-11-24T17:22:58.559Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 58265, :repl-port-file .nrepl-port}
2023-11-24T17:22:58.560Z NX-41294 INFO [leihs.core.shutdown:20] - PID 20324
2023-11-24T17:22:58.573Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-11-24T17:22:58.637Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-11-24T17:22:58.640Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-24T17:22:58.646Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-11-24T17:22:58.720Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@1bedeb7e
2023-11-24T17:22:58.726Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-11-24T17:22:58.726Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 "HikariDataSource (db-pool)"]}
2023-11-24T17:22:58.727Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-24T17:22:58.744Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-11-24T17:22:58.771Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@46c7e144
2023-11-24T17:22:58.772Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-11-24T17:22:58.777Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f "next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f"]}}
2023-11-24T17:22:58.785Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x39ef302d "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x62c06356 "java.util.concurrent.ThreadPoolExecutor@62c06356[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-11-24T17:22:58.796Z NX-41294 INFO [leihs.core.http-server:104] - started http-server
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 501416593817833, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4331222a /127.0.0.1:3230<->/127.0.0.1:49812], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1310c1f3 compojure.core$routes$fn__27950@1310c1f3], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
2023-11-24T17:23:46.504Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-11-24T17:23:46.578Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"2c01c2fe-5159-4ffd-abfe-4446c3e5be1d\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "2c01c2fe-5159-4ffd-abfe-4446c3e5be1d", :http-only false, :path "/", :secure false}}}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}}, :remote-addr 127.0.0.1, :start-time 501416776077708, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x53aa4507 /127.0.0.1:3230<->/127.0.0.1:49812], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1310c1f3 compojure.core$routes$fn__27950@1310c1f3], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
2023-11-24T17:23:46.657Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-11-24T17:23:46.666Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"2c01c2fe-5159-4ffd-abfe-4446c3e5be1d\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}}, :remote-addr 127.0.0.1, :start-time 501416895078375, :params {:user jimmie@goyette.com, :password nil, :csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6bd3935e HikariProxyConnection@1809027934 wrapping org.postgresql.jdbc.PgConnection@46c7e144], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0xf44f39a /127.0.0.1:3230<->/127.0.0.1:49812], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6d386137 HikariProxyConnection@1832411447 wrapping org.postgresql.jdbc.PgConnection@1bedeb7e], :level 1, :rollback #object[clojure.lang.Atom 0x26796e8e {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x5d3220da BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1310c1f3 compojure.core$routes$fn__27950@1310c1f3], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
2023-11-24T17:23:46.783Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-11-24T17:23:46.798Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"jimmie@goyette.com\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"2c01c2fe-5159-4ffd-abfe-4446c3e5be1d\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}}, :remote-addr 127.0.0.1, :start-time 501416994267291, :params {:user jimmie@goyette.com, :password password, :csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x51b0a512 HikariProxyConnection@1370531090 wrapping org.postgresql.jdbc.PgConnection@46c7e144], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3acad992 /127.0.0.1:3230<->/127.0.0.1:49812], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x59b7faea HikariProxyConnection@1505229546 wrapping org.postgresql.jdbc.PgConnection@1bedeb7e], :level 1, :rollback #object[clojure.lang.Atom 0x67245ece {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x3368ff0d BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1310c1f3 compojure.core$routes$fn__27950@1310c1f3], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
2023-11-24T17:23:46.875Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-11-24T17:23:46.970Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "fb2646b6-20cf-47c9-896e-b179f33c54b1", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, leihs-user-session {:value fb2646b6-20cf-47c9-896e-b179f33c54b1}}, :remote-addr 127.0.0.1, :start-time 501417109759958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d; leihs-user-session=fb2646b6-20cf-47c9-896e-b179f33c54b1, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6a5eca64 /127.0.0.1:3230<->/127.0.0.1:49812], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x61f3ca7b leihs.procurement.backend.html$not_found_handler@61f3ca7b], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
2023-11-24T17:23:47.016Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-24T17:23:47.019Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.023Z NX-41294 DEBUG [leihs.procurement.permissions.user:60] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.025Z NX-41294 DEBUG [leihs.procurement.permissions.user:82] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.027Z NX-41294 DEBUG [leihs.procurement.permissions.user:90] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.029Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39153#] (p1__39153# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
2023-11-24T17:23:47.032Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Fri, 24 Nov 2023 11:34:31 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x3d6597fe "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, leihs-user-session {:value fb2646b6-20cf-47c9-896e-b179f33c54b1}}, :remote-addr 127.0.0.1, :start-time 501417367299000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d; leihs-user-session=fb2646b6-20cf-47c9-896e-b179f33c54b1, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4467eaf0 /127.0.0.1:3230<->/127.0.0.1:49819], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x61f3ca7b leihs.procurement.backend.html$not_found_handler@61f3ca7b], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
2023-11-24T17:23:47.249Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-24T17:23:47.251Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.252Z NX-41294 DEBUG [leihs.procurement.permissions.user:60] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.253Z NX-41294 DEBUG [leihs.procurement.permissions.user:82] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.253Z NX-41294 DEBUG [leihs.procurement.permissions.user:90] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.255Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39153#] (p1__39153# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
2023-11-24T17:23:47.258Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Fri, 24 Nov 2023 11:34:31 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x5e1bb99f "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, leihs-user-session {:value fb2646b6-20cf-47c9-896e-b179f33c54b1}}, :remote-addr 127.0.0.1, :start-time 501417371321041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d; leihs-user-session=fb2646b6-20cf-47c9-896e-b179f33c54b1, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1f3ea0d0 /127.0.0.1:3230<->/127.0.0.1:49812], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x5c431f44 leihs.procurement.graphql$handler@5c431f44], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-11-24T17:23:47.290Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-24T17:23:47.291Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.292Z NX-41294 DEBUG [leihs.procurement.permissions.user:60] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.292Z NX-41294 DEBUG [leihs.procurement.permissions.user:82] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.293Z NX-41294 DEBUG [leihs.procurement.permissions.user:90] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.293Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39153#] (p1__39153# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
>>>1 #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"
>>>2 {:id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :firstname Procurement, :lastname Admin}
>>oida>> #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"
>>>3 nil
2023-11-24T17:23:47.421Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.422Z NX-41294 DEBUG [leihs.procurement.permissions.user:90] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]

>>>pure-handler {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"2c01c2fe-5159-4ffd-abfe-4446c3e5be1d","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"4aeb4702-398b-460b-8a46-1b5b9a76cdac","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 4aeb4702-398b-460b-8a46-1b5b9a76cdac] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])])}
2023-11-24T17:23:47.488Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"2c01c2fe-5159-4ffd-abfe-4446c3e5be1d\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"4aeb4702-398b-460b-8a46-1b5b9a76cdac\",\"firstname\":\"Procurement\",\"lastname\":\"Admin\",\"login\":null,\"email\":\"jimmie@goyette.com\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "4aeb4702-398b-460b-8a46-1b5b9a76cdac"] [:firstname "Procurement"] [:lastname "Admin"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, leihs-user-session {:value fb2646b6-20cf-47c9-896e-b179f33c54b1}}, :remote-addr 127.0.0.1, :start-time 501417745855458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d; leihs-user-session=fb2646b6-20cf-47c9-896e-b179f33c54b1, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x12681593 /127.0.0.1:3230<->/127.0.0.1:49820], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x5c431f44 leihs.procurement.graphql$handler@5c431f44], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-11-24T17:23:47.650Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-24T17:23:47.650Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.651Z NX-41294 DEBUG [leihs.procurement.permissions.user:60] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.654Z NX-41294 DEBUG [leihs.procurement.permissions.user:82] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.655Z NX-41294 DEBUG [leihs.procurement.permissions.user:90] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.655Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39153#] (p1__39153# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, leihs-user-session {:value fb2646b6-20cf-47c9-896e-b179f33c54b1}}, :remote-addr 127.0.0.1, :start-time 501417734358166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d; leihs-user-session=fb2646b6-20cf-47c9-896e-b179f33c54b1, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x31debec /127.0.0.1:3230<->/127.0.0.1:49819], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x5c431f44 leihs.procurement.graphql$handler@5c431f44], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>>exec-query::variables
>> authorize::handler-key >>  :graphql
{}
2023-11-24T17:23:47.675Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-24T17:23:47.675Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44330 0x3c400fe0 leihs.core.locale$wrap$fn__44330@3c400fe0]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T17:23:46.907899Z", :id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :user_session_id #uuid "8653f710-b7de-4eba-b479-d7f2fc039145", :scope_system_admin_read false, :access-rights (), :user_id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d}, leihs-user-session {:value fb2646b6-20cf-47c9-896e-b179f33c54b1}}, :remote-addr 127.0.0.1, :start-time 501417744907500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x58d6b6b3 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x72d0bf6f next.jdbc.result_set$as_unqualified_lower_maps@72d0bf6f]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=2c01c2fe-5159-4ffd-abfe-4446c3e5be1d; leihs-user-session=fb2646b6-20cf-47c9-896e-b179f33c54b1, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 2c01c2fe-5159-4ffd-abfe-4446c3e5be1d, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5a5e0ae /127.0.0.1:3230<->/127.0.0.1:49812], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaf22c91 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x5c431f44 leihs.procurement.graphql$handler@5c431f44], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-11-24T17:23:47.677Z NX-41294 DEBUG [leihs.procurement.permissions.user:60] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]

>> authorize::handler-key >> >>>1:graphql
 #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"
2023-11-24T17:23:47.682Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-24T17:23:47.683Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
>>>2 {:id #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac", :firstname Procurement, :lastname Admin}
>>oida>> #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"
>>>3 nil
2023-11-24T17:23:47.686Z NX-41294 DEBUG [leihs.procurement.permissions.user:60] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.687Z NX-41294 DEBUG [leihs.procurement.permissions.user:82] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.687Z NX-41294 DEBUG [leihs.procurement.permissions.user:82] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ?" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.687Z NX-41294 DEBUG [leihs.procurement.permissions.user:90] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.688Z NX-41294 DEBUG [leihs.procurement.permissions.user:90] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.688Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39153#] (p1__39153# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
2023-11-24T17:23:47.690Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39153#] (p1__39153# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
2023-11-24T17:23:47.698Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]
2023-11-24T17:23:47.699Z NX-41294 DEBUG [leihs.procurement.permissions.user:90] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "4aeb4702-398b-460b-8a46-1b5b9a76cdac"]

>>>exec-query::variables {}

>>>pure-handler {
>>>exec-query::variables :data #ordered/map {}
([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"2c01c2fe-5159-4ffd-abfe-4446c3e5be1d","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"4aeb4702-398b-460b-8a46-1b5b9a76cdac","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 4aeb4702-398b-460b-8a46-1b5b9a76cdac] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])])}
2023-11-24T17:23:47.706Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"2c01c2fe-5159-4ffd-abfe-4446c3e5be1d\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"4aeb4702-398b-460b-8a46-1b5b9a76cdac\",\"firstname\":\"Procurement\",\"lastname\":\"Admin\",\"login\":null,\"email\":\"jimmie@goyette.com\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "4aeb4702-398b-460b-8a46-1b5b9a76cdac"] [:firstname "Procurement"] [:lastname "Admin"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url nil] [:__typename :ProcurementSettings])])}}
>>>get-dashboard
>get-requests>> ???
2023-11-24T17:23:47.744Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - These SQL clauses are unknown or have nil values: :request, :com.walmartlabs.lacinia.constants/parsed-query, :com.walmartlabs.lacinia.tracing/validation, :com.walmartlabs.lacinia.constants/schema, :com.walmartlabs.lacinia/container-type-name, :com.walmartlabs.lacinia/selection

>>>pure-handler {:data #ordered/map ([:dashboard nil]), :errors ({:message These SQL clauses are unknown or have nil values: :request, :com.walmartlabs.lacinia.constants/parsed-query, :com.walmartlabs.lacinia.tracing/validation, :com.walmartlabs.lacinia.constants/schema, :com.walmartlabs.lacinia/container-type-name, :com.walmartlabs.lacinia/selection, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception ExceptionInfo, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-11-24T17:23:47.746Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard nil]), :errors ({:message "These SQL clauses are unknown or have nil values: :request, :com.walmartlabs.lacinia.constants/parsed-query, :com.walmartlabs.lacinia.tracing/validation, :com.walmartlabs.lacinia.constants/schema, :com.walmartlabs.lacinia/container-type-name, :com.walmartlabs.lacinia/selection", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "ExceptionInfo", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}, :graphql-error true}

>>>pure-handler {:data #ordered/map ([:budget_periods [nil]] [:main_categories [nil]] [:organizations [nil]]), :errors ({:message Non-nullable field was null., :locations [{:line 3, :column 5}], :path [:budget_periods 0 :id]} {:message Non-nullable field was null., :locations [{:line 4, :column 5}], :path [:budget_periods 0 :name]} {:message Non-nullable field was null., :locations [{:line 5, :column 5}], :path [:budget_periods 0 :inspection_start_date]} {:message Non-nullable field was null., :locations [{:line 6, :column 5}], :path [:budget_periods 0 :end_date]} {:message Non-nullable field was null., :locations [{:line 10, :column 5}], :path [:main_categories 0 :id]} {:message Non-nullable field was null., :locations [{:line 11, :column 5}], :path [:main_categories 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 1 :name]})}
2023-11-24T17:23:47.756Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [nil]] [:main_categories [nil]] [:organizations [nil]]), :errors ({:message "Non-nullable field was null.", :locations [{:line 3, :column 5}], :path [:budget_periods 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 4, :column 5}], :path [:budget_periods 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 5, :column 5}], :path [:budget_periods 0 :inspection_start_date]} {:message "Non-nullable field was null.", :locations [{:line 6, :column 5}], :path [:budget_periods 0 :end_date]} {:message "Non-nullable field was null.", :locations [{:line 10, :column 5}], :path [:main_categories 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 11, :column 5}], :path [:main_categories 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 1 :name]})}, :graphql-error true}


