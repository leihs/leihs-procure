>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x5e7ae9b6 leihs.procurement.authorization$wrap_authorize$fn__39139@5e7ae9b6]
>>wrap-authenticate::request {:cookies {}, :remote-addr 127.0.0.1, :start-time 409642514734291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x74116e5e /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7cbc6618 compojure.core$routes$fn__27950@7cbc6618], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x78a395ce leihs.core.locale$wrap$fn__44238@78a395ce]

>>1 request {:cookies {}, :remote-addr 127.0.0.1, :start-time 409642514734291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x74116e5e /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7cbc6618 compojure.core$routes$fn__27950@7cbc6618], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:09:20.024Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x5e7ae9b6 leihs.procurement.authorization$wrap_authorize$fn__39139@5e7ae9b6]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}}, :remote-addr 127.0.0.1, :start-time 409642742253291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5b9b7010 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x30344429 leihs.procurement.backend.html$not_found_handler@30344429], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b nil
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x5e7ae9b6 leihs.procurement.authorization$wrap_authorize$fn__39139@5e7ae9b6]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}}, :remote-addr 127.0.0.1, :start-time 409642763340916, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x51644bd0 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7cbc6618 compojure.core$routes$fn__27950@7cbc6618], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x78a395ce leihs.core.locale$wrap$fn__44238@78a395ce]

>>1 request {:cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}}, :remote-addr 127.0.0.1, :start-time 409642763340916, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x51644bd0 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7cbc6618 compojure.core$routes$fn__27950@7cbc6618], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:09:20.258Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x5e7ae9b6 leihs.procurement.authorization$wrap_authorize$fn__39139@5e7ae9b6]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}}, :remote-addr 127.0.0.1, :start-time 409643230222291, :params {:user jimmie@goyette.com, :password nil, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x33e5669c HikariProxyConnection@870672028 wrapping org.postgresql.jdbc.PgConnection@2c68985a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x59106b03 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1f645679 HikariProxyConnection@526669433 wrapping org.postgresql.jdbc.PgConnection@22bbde8c], :level 1, :rollback #object[clojure.lang.Atom 0x74a8b8be {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x6ce1e131 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7cbc6618 compojure.core$routes$fn__27950@7cbc6618], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x78a395ce leihs.core.locale$wrap$fn__44238@78a395ce]

>>1 request {:cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}}, :remote-addr 127.0.0.1, :start-time 409643230222291, :params {:user jimmie@goyette.com, :password nil, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x33e5669c HikariProxyConnection@870672028 wrapping org.postgresql.jdbc.PgConnection@2c68985a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x59106b03 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1f645679 HikariProxyConnection@526669433 wrapping org.postgresql.jdbc.PgConnection@22bbde8c], :level 1, :rollback #object[clojure.lang.Atom 0x74a8b8be {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x6ce1e131 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7cbc6618 compojure.core$routes$fn__27950@7cbc6618], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1f645679 HikariProxyConnection@526669433 wrapping org.postgresql.jdbc.PgConnection@22bbde8c], :level 1, :rollback #object[clojure.lang.Atom 0x74a8b8be {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:09:20.733Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x5e7ae9b6 leihs.procurement.authorization$wrap_authorize$fn__39139@5e7ae9b6]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}}, :remote-addr 127.0.0.1, :start-time 409643667834666, :params {:user jimmie@goyette.com, :password password, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6046a260 HikariProxyConnection@1615241824 wrapping org.postgresql.jdbc.PgConnection@2c68985a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x417e2a73 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x65b07b5b HikariProxyConnection@1706064731 wrapping org.postgresql.jdbc.PgConnection@22bbde8c], :level 1, :rollback #object[clojure.lang.Atom 0x598c5a2a {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0xc8ca6d9 BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7cbc6618 compojure.core$routes$fn__27950@7cbc6618], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x78a395ce leihs.core.locale$wrap$fn__44238@78a395ce]

>>1 request {:cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}}, :remote-addr 127.0.0.1, :start-time 409643667834666, :params {:user jimmie@goyette.com, :password password, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6046a260 HikariProxyConnection@1615241824 wrapping org.postgresql.jdbc.PgConnection@2c68985a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x417e2a73 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x65b07b5b HikariProxyConnection@1706064731 wrapping org.postgresql.jdbc.PgConnection@22bbde8c], :level 1, :rollback #object[clojure.lang.Atom 0x598c5a2a {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 07ea5d35-d003-4410-8dd6-811587f85448}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0xc8ca6d9 BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x7cbc6618 compojure.core$routes$fn__27950@7cbc6618], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x65b07b5b HikariProxyConnection@1706064731 wrapping org.postgresql.jdbc.PgConnection@22bbde8c], :level 1, :rollback #object[clojure.lang.Atom 0x598c5a2a {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:09:21.167Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x5e7ae9b6 leihs.procurement.authorization$wrap_authorize$fn__39139@5e7ae9b6]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}, leihs-user-session {:value f530417e-55c4-4cd6-93b2-fb8670287fd3}}, :remote-addr 127.0.0.1, :start-time 409643748163291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448; leihs-user-session=f530417e-55c4-4cd6-93b2-fb8670287fd3, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4c578af6 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x30344429 leihs.procurement.backend.html$not_found_handler@30344429], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x78a395ce leihs.core.locale$wrap$fn__44238@78a395ce]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}, leihs-user-session {:value f530417e-55c4-4cd6-93b2-fb8670287fd3}}, :remote-addr 127.0.0.1, :start-time 409643748163291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448; leihs-user-session=f530417e-55c4-4cd6-93b2-fb8670287fd3, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4c578af6 /127.0.0.1:3230<->/127.0.0.1:54521], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x30344429 leihs.procurement.backend.html$not_found_handler@30344429], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :procurement
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:09:21.258Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

2023-11-23T15:09:21.262Z NX-41294 DEBUG [leihs.procurement.authorization:133] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x5e7ae9b6 leihs.procurement.authorization$wrap_authorize$fn__39139@5e7ae9b6]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}, leihs-user-session {:value f530417e-55c4-4cd6-93b2-fb8670287fd3}}, :remote-addr 127.0.0.1, :start-time 409644222510791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448; leihs-user-session=f530417e-55c4-4cd6-93b2-fb8670287fd3, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 07ea5d35-d003-4410-8dd6-811587f85448, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1687908f /127.0.0.1:3230<->/127.0.0.1:54530], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x2b568d17 leihs.procurement.graphql$handler@2b568d17], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x78a395ce leihs.core.locale$wrap$fn__44238@78a395ce]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}, leihs-user-session {:value f530417e-55c4-4cd6-93b2-fb8670287fd3}}, :remote-addr 127.0.0.1, :start-time 409644222510791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448; leihs-user-session=f530417e-55c4-4cd6-93b2-fb8670287fd3, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 07ea5d35-d003-4410-8dd6-811587f85448, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1687908f /127.0.0.1:3230<->/127.0.0.1:54530], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x2b568d17 leihs.procurement.graphql$handler@2b568d17], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :graphql
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:09:21.734Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

2023-11-23T15:09:21.735Z NX-41294 DEBUG [leihs.procurement.authorization:133] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
>>>graphql
2023-11-23T15:09:21.737Z NX-41294 DEBUG [leihs.procurement.graphql:85] - mutation? => false
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x5e7ae9b6 leihs.procurement.authorization$wrap_authorize$fn__39139@5e7ae9b6]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}, leihs-user-session {:value f530417e-55c4-4cd6-93b2-fb8670287fd3}}, :remote-addr 127.0.0.1, :start-time 409644255066875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448; leihs-user-session=f530417e-55c4-4cd6-93b2-fb8670287fd3, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x438e2560 /127.0.0.1:3230<->/127.0.0.1:54530], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x30344429 leihs.procurement.backend.html$not_found_handler@30344429], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x78a395ce leihs.core.locale$wrap$fn__44238@78a395ce]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 07ea5d35-d003-4410-8dd6-811587f85448}, leihs-user-session {:value f530417e-55c4-4cd6-93b2-fb8670287fd3}}, :remote-addr 127.0.0.1, :start-time 409644255066875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3fc3f93b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x40d076c0 next.jdbc.result_set$as_unqualified_lower_maps@40d076c0]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=07ea5d35-d003-4410-8dd6-811587f85448; leihs-user-session=f530417e-55c4-4cd6-93b2-fb8670287fd3, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x438e2560 /127.0.0.1:3230<->/127.0.0.1:54530], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x30344429 leihs.procurement.backend.html$not_found_handler@30344429], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :not-found
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:09:21.191409Z", :id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :user_session_id #uuid "860853d9-8120-487d-bebb-5c9b51c84a72", :scope_system_admin_read false, :access-rights (), :user_id #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x424ec583 HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:09:21.757Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "0de72b1f-fe04-42d2-b2ea-26c2313d549c"]

2023-11-23T15:09:21.758Z NX-41294 DEBUG [leihs.procurement.authorization:133] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
2023-11-23T15:16:39.853Z NX-41294 INFO [leihs.core.http-server:84] - stopping running http-server
2023-11-23T15:16:40.082Z NX-41294 INFO [leihs.core.http-server:88] - stopped http-server
➜  procure runbet
>> Running: ./bin/dev-run-backend --db-port 5415 --db-name leihs_test
# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-11-23T15:16:52.625Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value
2023-11-23T15:16:53.169Z NX-41294 INFO [leihs.core.logging:27] - initializing logging  {:min-level [[#{"leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-11-23T15:16:53.176Z NX-41294 INFO [leihs.core.logging:29] - initialized logging  {:min-level [[#{"leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x28382154 "taoensso.timbre$default_output_fn@28382154"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x70e64cb0 "taoensso.timbre.appenders.core$println_appender$fn__3459@70e64cb0"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-11-23T15:16:53.178Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-11-23T15:16:53.189Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 57569, :repl-port-file ".nrepl-port"}
2023-11-23T15:16:53.192Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  57569 localhost
2023-11-23T15:16:53.212Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server
2023-11-23T15:16:53.215Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 57569, :repl-port-file .nrepl-port}
2023-11-23T15:16:53.216Z NX-41294 INFO [leihs.core.shutdown:20] - PID 4933
2023-11-23T15:16:53.241Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-11-23T15:16:53.292Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-11-23T15:16:53.294Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-23T15:16:53.300Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-11-23T15:16:53.373Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@5f950e11
2023-11-23T15:16:53.379Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-11-23T15:16:53.379Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f "HikariDataSource (db-pool)"]}
2023-11-23T15:16:53.380Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-23T15:16:53.393Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-11-23T15:16:53.403Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5dda0497
2023-11-23T15:16:53.403Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-11-23T15:16:53.410Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 "next.jdbc.result_set$as_unqualified_lower_maps@218bdce7"]}}
2023-11-23T15:16:53.416Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0xe173a9d "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x19b06274 "java.util.concurrent.ThreadPoolExecutor@19b06274[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-11-23T15:16:53.428Z NX-41294 INFO [leihs.core.http-server:104] - started http-server
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x3f92ecd4 leihs.procurement.authorization$wrap_authorize$fn__39139@3f92ecd4]
>>wrap-authenticate::request {:cookies {}, :remote-addr 127.0.0.1, :start-time 410149259077416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x159e5299 /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6f13e67f compojure.core$routes$fn__27950@6f13e67f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x6912965e leihs.core.locale$wrap$fn__44238@6912965e]

>>1 request {:cookies {}, :remote-addr 127.0.0.1, :start-time 410149259077416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x159e5299 /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6f13e67f compojure.core$routes$fn__27950@6f13e67f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:17:46.766Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x3f92ecd4 leihs.procurement.authorization$wrap_authorize$fn__39139@3f92ecd4]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}}, :remote-addr 127.0.0.1, :start-time 410149419408541, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x268b135a /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x5bbeb766 leihs.procurement.backend.html$not_found_handler@5bbeb766], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b nil
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x3f92ecd4 leihs.procurement.authorization$wrap_authorize$fn__39139@3f92ecd4]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}}, :remote-addr 127.0.0.1, :start-time 410149445780125, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x44afe29a /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6f13e67f compojure.core$routes$fn__27950@6f13e67f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x6912965e leihs.core.locale$wrap$fn__44238@6912965e]

>>1 request {:cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}}, :remote-addr 127.0.0.1, :start-time 410149445780125, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x44afe29a /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6f13e67f compojure.core$routes$fn__27950@6f13e67f], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:17:46.917Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x3f92ecd4 leihs.procurement.authorization$wrap_authorize$fn__39139@3f92ecd4]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}}, :remote-addr 127.0.0.1, :start-time 410149557723166, :params {:user jimmie@goyette.com, :password nil, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2e0c51da HikariProxyConnection@772559322 wrapping org.postgresql.jdbc.PgConnection@5dda0497], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x13887cb0 /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e2a8486 HikariProxyConnection@1579844742 wrapping org.postgresql.jdbc.PgConnection@5f950e11], :level 1, :rollback #object[clojure.lang.Atom 0x5eb5458d {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x41d1296d BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6f13e67f compojure.core$routes$fn__27950@6f13e67f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x6912965e leihs.core.locale$wrap$fn__44238@6912965e]

>>1 request {:cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}}, :remote-addr 127.0.0.1, :start-time 410149557723166, :params {:user jimmie@goyette.com, :password nil, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2e0c51da HikariProxyConnection@772559322 wrapping org.postgresql.jdbc.PgConnection@5dda0497], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x13887cb0 /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e2a8486 HikariProxyConnection@1579844742 wrapping org.postgresql.jdbc.PgConnection@5f950e11], :level 1, :rollback #object[clojure.lang.Atom 0x5eb5458d {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x41d1296d BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6f13e67f compojure.core$routes$fn__27950@6f13e67f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e2a8486 HikariProxyConnection@1579844742 wrapping org.postgresql.jdbc.PgConnection@5f950e11], :level 1, :rollback #object[clojure.lang.Atom 0x5eb5458d {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:17:47.040Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x3f92ecd4 leihs.procurement.authorization$wrap_authorize$fn__39139@3f92ecd4]
>>wrap-authenticate::request {:cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}}, :remote-addr 127.0.0.1, :start-time 410149656394458, :params {:user jimmie@goyette.com, :password password, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x38cc3e72 HikariProxyConnection@952909426 wrapping org.postgresql.jdbc.PgConnection@5dda0497], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x77726587 /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x56105dcc HikariProxyConnection@1443913164 wrapping org.postgresql.jdbc.PgConnection@5f950e11], :level 1, :rollback #object[clojure.lang.Atom 0x676251d6 {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x3e04dce6 BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6f13e67f compojure.core$routes$fn__27950@6f13e67f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a true
>>>b nil

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x6912965e leihs.core.locale$wrap$fn__44238@6912965e]

>>1 request {:cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}}, :remote-addr 127.0.0.1, :start-time 410149656394458, :params {:user jimmie@goyette.com, :password password, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x38cc3e72 HikariProxyConnection@952909426 wrapping org.postgresql.jdbc.PgConnection@5dda0497], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x77726587 /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x56105dcc HikariProxyConnection@1443913164 wrapping org.postgresql.jdbc.PgConnection@5f950e11], :level 1, :rollback #object[clojure.lang.Atom 0x676251d6 {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 57f4805b-c145-4284-a294-f7f879353849}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x3e04dce6 BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6f13e67f compojure.core$routes$fn__27950@6f13e67f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x56105dcc HikariProxyConnection@1443913164 wrapping org.postgresql.jdbc.PgConnection@5f950e11], :level 1, :rollback #object[clojure.lang.Atom 0x676251d6 {:status :ready, :val false}]}
>myprint>  admin false

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id IS NULL]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:17:47.132Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x3f92ecd4 leihs.procurement.authorization$wrap_authorize$fn__39139@3f92ecd4]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}, leihs-user-session {:value 7f77273a-5fee-4e81-9306-ce35b47173ae}}, :remote-addr 127.0.0.1, :start-time 410149769781875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849; leihs-user-session=7f77273a-5fee-4e81-9306-ce35b47173ae, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0xcee4fc1 /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x5bbeb766 leihs.procurement.backend.html$not_found_handler@5bbeb766], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x6912965e leihs.core.locale$wrap$fn__44238@6912965e]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}, leihs-user-session {:value 7f77273a-5fee-4e81-9306-ce35b47173ae}}, :remote-addr 127.0.0.1, :start-time 410149769781875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849; leihs-user-session=7f77273a-5fee-4e81-9306-ce35b47173ae, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0xcee4fc1 /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x5bbeb766 leihs.procurement.backend.html$not_found_handler@5bbeb766], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :procurement
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:17:47.270Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

2023-11-23T15:17:47.277Z NX-41294 DEBUG [leihs.procurement.authorization:133] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x3f92ecd4 leihs.procurement.authorization$wrap_authorize$fn__39139@3f92ecd4]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}, leihs-user-session {:value 7f77273a-5fee-4e81-9306-ce35b47173ae}}, :remote-addr 127.0.0.1, :start-time 410150021296625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849; leihs-user-session=7f77273a-5fee-4e81-9306-ce35b47173ae, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x40d13652 /127.0.0.1:3230<->/127.0.0.1:54595], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x5bbeb766 leihs.procurement.backend.html$not_found_handler@5bbeb766], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x6912965e leihs.core.locale$wrap$fn__44238@6912965e]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}, leihs-user-session {:value 7f77273a-5fee-4e81-9306-ce35b47173ae}}, :remote-addr 127.0.0.1, :start-time 410150021296625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849; leihs-user-session=7f77273a-5fee-4e81-9306-ce35b47173ae, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x40d13652 /127.0.0.1:3230<->/127.0.0.1:54595], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x5bbeb766 leihs.procurement.backend.html$not_found_handler@5bbeb766], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :not-found
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:17:47.498Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

2023-11-23T15:17:47.501Z NX-41294 DEBUG [leihs.procurement.authorization:133] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
>>wrap-authenticate::handler #object[leihs.procurement.authorization$wrap_authorize$fn__39139 0x3f92ecd4 leihs.procurement.authorization$wrap_authorize$fn__39139@3f92ecd4]
>>wrap-authenticate::request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}, leihs-user-session {:value 7f77273a-5fee-4e81-9306-ce35b47173ae}}, :remote-addr 127.0.0.1, :start-time 410150026651166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849; leihs-user-session=7f77273a-5fee-4e81-9306-ce35b47173ae, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 57f4805b-c145-4284-a294-f7f879353849, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2eec81f /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x17db8deb leihs.procurement.graphql$handler@17db8deb], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>>>a nil
>>>b {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>>1 authorize

>>1 handler #object[leihs.core.locale$wrap$fn__44238 0x6912965e leihs.core.locale$wrap$fn__44238@6912965e]

>>1 request {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 57f4805b-c145-4284-a294-f7f879353849}, leihs-user-session {:value 7f77273a-5fee-4e81-9306-ce35b47173ae}}, :remote-addr 127.0.0.1, :start-time 410150026651166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x79622efe HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x218bdce7 next.jdbc.result_set$as_unqualified_lower_maps@218bdce7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=57f4805b-c145-4284-a294-f7f879353849; leihs-user-session=7f77273a-5fee-4e81-9306-ce35b47173ae, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 57f4805b-c145-4284-a294-f7f879353849, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2eec81f /127.0.0.1:3230<->/127.0.0.1:54587], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x17db8deb leihs.procurement.graphql$handler@17db8deb], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>1 (:handler-key request) :graphql
>myprint>  authEnt? {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-23T15:17:47.166299Z", :id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :user_session_id #uuid "d4cc8e23-59a2-471d-9398-ec5c1884102b", :scope_system_admin_read false, :access-rights (), :user_id #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x66db639f HikariDataSource (db-pool)]}
>myprint>  admin true

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

>myprint>  inspector false

>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

>myprint>  viewer false
>myprint>  requester false
2023-11-23T15:17:47.538Z NX-41294 DEBUG [leihs.procurement.authorization:132] - (skip? (:handler-key request)) => nil

>2> [SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]


>2> [SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id = ? #uuid "dec3fb8c-dde6-4366-864a-9a49577b68b6"]

2023-11-23T15:17:47.539Z NX-41294 DEBUG [leihs.procurement.authorization:133] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39120#] (p1__39120# (:tx-next request) (:authenticated-entity request)))) (some true?)) => true
>>>graphql
2023-11-23T15:17:47.543Z NX-41294 DEBUG [leihs.procurement.graphql:85] - mutation? => false


