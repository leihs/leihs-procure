# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
2023-12-04T09:25:28.993Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-04T09:25:29.565Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-04T09:25:29.572Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x7cf7a1d6 "taoensso.timbre$default_output_fn@7cf7a1d6"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x11abc93b "taoensso.timbre.appenders.core$println_appender$fn__3459@11abc93b"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-04T09:25:29.574Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-12-04T09:25:29.585Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 48823, :repl-port-file ".nrepl-port"}
2023-12-04T09:25:29.588Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  48823 localhost
2023-12-04T09:25:29.604Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-04T09:25:29.608Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 48823, :repl-port-file .nrepl-port}
2023-12-04T09:25:29.609Z NX-41294 INFO [leihs.core.shutdown:20] - PID 24703
2023-12-04T09:25:29.635Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-04T09:25:29.697Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-04T09:25:29.699Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-04T09:25:29.704Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-04T09:25:29.782Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@167bb050
2023-12-04T09:25:29.788Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-04T09:25:29.788Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 "HikariDataSource (db-pool)"]}
2023-12-04T09:25:29.789Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-04T09:25:29.804Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-04T09:25:29.812Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6db7fba2
2023-12-04T09:25:29.812Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-04T09:25:29.818Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 "next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182"]}}
2023-12-04T09:25:29.827Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x468a89e6 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x676d1984 "java.util.concurrent.ThreadPoolExecutor@676d1984[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-04T09:25:29.843Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x401be560 leihs.core.locale$wrap$fn__44359@401be560]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5831918833416, :params {:return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {:return-to /procure}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x745d2595 /127.0.0.1:3230<->/127.0.0.1:58178], :server-port 3230, :params-raw {:return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x3f5e2af0 compojure.core$routes$fn__27950@3f5e2af0], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}
2023-12-04T09:25:30.602Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:30.606Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
>myprint>  admin false
2023-12-04T09:25:30.609Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-04T09:25:30.612Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-04T09:25:30.615Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
>myprint>  requester true

> 1 anti-csrf-token >  6fff328d-c865-4ea3-96a0-b9140ba6317f

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x401be560 leihs.core.locale$wrap$fn__44359@401be560]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832048663041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6bac9ea7 /127.0.0.1:3230<->/127.0.0.1:58178], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x2eae0db6 leihs.procurement.backend.html$not_found_handler@2eae0db6], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}
2023-12-04T09:25:30.650Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:30.651Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
>myprint>  admin false
2023-12-04T09:25:30.651Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-04T09:25:30.652Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-04T09:25:30.653Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
>myprint>  requester true
2023-12-04T09:25:30.654Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:30.655Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:30.656Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:30.661Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:30.662Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]

> 1 anti-csrf-token >  6fff328d-c865-4ea3-96a0-b9140ba6317f

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x401be560 leihs.core.locale$wrap$fn__44359@401be560]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832269825416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, pragma no-cache, x-csrf-token 6fff328d-c865-4ea3-96a0-b9140ba6317f, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5a7de396 /127.0.0.1:3230<->/127.0.0.1:58178], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6064b60e leihs.procurement.graphql$handler@6064b60e], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}
2023-12-04T09:25:30.904Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:30.905Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
>myprint>  admin false
2023-12-04T09:25:30.906Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-04T09:25:30.906Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-04T09:25:30.907Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
>myprint>  requester true
2023-12-04T09:25:30.908Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:30.908Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:30.913Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:30.913Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:30.914Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]

> 1 anti-csrf-token >  6fff328d-c865-4ea3-96a0-b9140ba6317f

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-04T09:25:30.918Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"
2023-12-04T09:25:30.928Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"
>>>2 {:id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :firstname Dawna, :lastname Kemmer}
>>oida>> #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"
2023-12-04T09:25:30.932Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
>>>3 nil
2023-12-04T09:25:30.957Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:30.958Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:30.959Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832269825416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, pragma no-cache, x-csrf-token 6fff328d-c865-4ea3-96a0-b9140ba6317f, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5a7de396 /127.0.0.1:3230<->/127.0.0.1:58178], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6064b60e leihs.procurement.graphql$handler@6064b60e], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-04T09:23:13.117364Z","id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","user_session_id":"d77c8109-0dcc-4858-b200-c8cc781c46f5","scope_system_admin_read":false,"access-rights":[],"user_id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"6fff328d-c865-4ea3-96a0-b9140ba6317f"},"leihs-user-session":{"value":"3975bdc4-ace9-457f-a804-ac3de3209f2b"}},"remote-addr":"127.0.0.1","start-time":5832269825416,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b","content-length":"502","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"6fff328d-c865-4ea3-96a0-b9140ba6317f","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"6fff328d-c865-4ea3-96a0-b9140ba6317f","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","firstname":"Dawna","lastname":"Kemmer","login":null,"email":"amelia@rosenbaum.name"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id ec6bf72e-afab-47e9-9839-ba15d9eb8f8a] [:firstname Dawna] [:lastname Kemmer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id 0abfea4f-d8eb-4bd0-a9e3-1c6db0bf6431] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-04T09:25:30.972Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"6fff328d-c865-4ea3-96a0-b9140ba6317f\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "0abfea4f-d8eb-4bd0-a9e3-1c6db0bf6431"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x401be560 leihs.core.locale$wrap$fn__44359@401be560]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832411975708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6fff328d-c865-4ea3-96a0-b9140ba6317f, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6dae2e80 /127.0.0.1:3230<->/127.0.0.1:58189], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6064b60e leihs.procurement.graphql$handler@6064b60e], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}
2023-12-04T09:25:31.018Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:31.019Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
>myprint>  admin false
2023-12-04T09:25:31.020Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-04T09:25:31.021Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-04T09:25:31.022Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
>myprint>  requester true
2023-12-04T09:25:31.023Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:31.023Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:31.024Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:31.026Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:31.027Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]

> 1 anti-csrf-token >  6fff328d-c865-4ea3-96a0-b9140ba6317f

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-04T09:25:31.035Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"
2023-12-04T09:25:31.037Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"
>>>2 {:id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :firstname Dawna, :lastname Kemmer}
>>oida>> #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity 2023-12-04T09:25:31.038Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
{:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x401be560 leihs.core.locale$wrap$fn__44359@401be560]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832410806333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6fff328d-c865-4ea3-96a0-b9140ba6317f, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel >>>3 nil
#object[org.httpkit.server.AsyncChannel 0x6069c641 /127.0.0.1:3230<->/127.0.0.1:58179], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6064b60e leihs.procurement.graphql$handler@6064b60e], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}
2023-12-04T09:25:31.039Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x401be560 leihs.core.locale$wrap$fn__44359@401be560]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832410659708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, content-length 3972, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6fff328d-c865-4ea3-96a0-b9140ba6317f, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x26a8df77 /127.0.0.1:3230<->/127.0.0.1:58178], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 3972, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [5656e676-663c-5402-9809-91f3f72ff4ad], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6064b60e leihs.procurement.graphql$handler@6064b60e], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}
2023-12-04T09:25:31.041Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:31.041Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  admin false
2023-12-04T09:25:31.042Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:31.042Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
>myprint>  admin false
>myprint>  inspector false
2023-12-04T09:25:31.043Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:31.043Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
>myprint>  viewer false
2023-12-04T09:25:31.045Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:31.045Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
>myprint>  viewer false
2023-12-04T09:25:31.045Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
>myprint>  requester true
2023-12-04T09:25:31.046Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  requester true
2023-12-04T09:25:31.046Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:31.047Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:31.047Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:31.048Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:31.048Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:31.048Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:31.050Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
2023-12-04T09:25:31.050Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:31.053Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
2023-12-04T09:25:31.053Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

> 1 anti-csrf-token >  6fff328d-c865-4ea3-96a0-b9140ba6317f

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil

> 1 anti-csrf-token >  6fff328d-c865-4ea3-96a0-b9140ba6317f

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-04T09:25:31.055Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:31.056Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
pure-handler >> 2
2023-12-04T09:25:31.058Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832411975708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6fff328d-c865-4ea3-96a0-b9140ba6317f, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6dae2e80 /127.0.0.1:3230<->/127.0.0.1:58189], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6064b60e leihs.procurement.graphql$handler@6064b60e], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-04T09:23:13.117364Z","id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","user_session_id":"d77c8109-0dcc-4858-b200-c8cc781c46f5","scope_system_admin_read":false,"access-rights":[],"user_id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"6fff328d-c865-4ea3-96a0-b9140ba6317f"},"leihs-user-session":{"value":"3975bdc4-ace9-457f-a804-ac3de3209f2b"}},"remote-addr":"127.0.0.1","start-time":5832411975708,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b","content-length":"502","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"6fff328d-c865-4ea3-96a0-b9140ba6317f","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"6fff328d-c865-4ea3-96a0-b9140ba6317f","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","firstname":"Dawna","lastname":"Kemmer","login":null,"email":"amelia@rosenbaum.name"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id ec6bf72e-afab-47e9-9839-ba15d9eb8f8a] [:firstname Dawna] [:lastname Kemmer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id 0abfea4f-d8eb-4bd0-a9e3-1c6db0bf6431] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-04T09:25:31.062Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"6fff328d-c865-4ea3-96a0-b9140ba6317f\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "0abfea4f-d8eb-4bd0-a9e3-1c6db0bf6431"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
pure-handler >> 2
2023-12-04T09:25:31.068Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MANDATORY" "MEDIUM"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search "", :organizations ["5656e676-663c-5402-9809-91f3f72ff4ad"], :categories [], :priority ["NORMAL" "HIGH"], :budgetPeriods ["1173b482-b9e6-46b4-a5e3-0b021c860e9b"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MANDATORY MEDIUM] {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [5656e676-663c-5402-9809-91f3f72ff4ad], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832410806333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6fff328d-c865-4ea3-96a0-b9140ba6317f, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6069c641 /127.0.0.1:3230<->/127.0.0.1:58179], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6064b60e leihs.procurement.graphql$handler@6064b60e], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-04T09:23:13.117364Z","id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","user_session_id":"d77c8109-0dcc-4858-b200-c8cc781c46f5","scope_system_admin_read":false,"access-rights":[],"user_id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"6fff328d-c865-4ea3-96a0-b9140ba6317f"},"leihs-user-session":{"value":"3975bdc4-ace9-457f-a804-ac3de3209f2b"}},"remote-addr":"127.0.0.1","start-time":5832410806333,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b","content-length":"534","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"6fff328d-c865-4ea3-96a0-b9140ba6317f","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":534,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestFilters","variables":{},"query":"query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id d3cde81d-47f9-4cbc-8d16-b52ec16253b8] [:name BP-in-inspection-phase] [:inspection_start_date 2023-12-03 00:00:00.0] [:end_date 2024-01-04 00:00:00.0] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id 46ca25c7-7e4c-4af8-b644-8633e569ea4a] [:name Geisha] [:categories [#ordered/map ([:id 0abfea4f-d8eb-4bd0-a9e3-1c6db0bf6431] [:name Ennarea] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id 30990347-e0e4-42bb-8df2-46ca4bbdc7a4] [:name Books & Baby] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id c23fb07f-ce21-4603-aa90-0cac35480c1c] [:name Sports, Electronics & Health] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id ae9b6064-bd97-4ed0-bb35-401ec9cdd9d0] [:name Garden, Industrial & Clothing] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 523f0f2b-1469-4e91-b7ba-7526fbe2b771] [:name Movies] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 10858232-fc96-432c-9735-030864c35adb] [:name Health, Grocery & Beauty] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 60a3b7b1-f127-4c80-afd2-9d142e2c3b8a] [:name Kids, Electronics & Music] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 40eb7b5c-505c-4ceb-a75b-eeee61b528cd] [:name Jewelry] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 4cfc75e6-24b0-423c-b78a-f81c672d8ab4] [:name Music & Automotive] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 3209c767-68d8-408d-8c51-88f6989ca60e] [:name Outdoors & Home] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id c219499b-9b34-468a-9066-587ddbc5f289] [:name Electronics & Home] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 079ff5c7-ea9b-4aaa-88a5-16f68fbcae1c] [:name Tools, Baby & Kids] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 270c69e1-9a4c-4e85-b591-e06a8b4d5d43] [:name Grocery, Electronics & Industrial] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-04T09:25:31.075Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "d3cde81d-47f9-4cbc-8d16-b52ec16253b8"] [:name "BP-in-inspection-phase"] [:inspection_start_date "2023-12-03 00:00:00.0"] [:end_date "2024-01-04 00:00:00.0"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "46ca25c7-7e4c-4af8-b644-8633e569ea4a"] [:name "Geisha"] [:categories [#ordered/map ([:id "0abfea4f-d8eb-4bd0-a9e3-1c6db0bf6431"] [:name "Ennarea"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "30990347-e0e4-42bb-8df2-46ca4bbdc7a4"] [:name "Books & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "c23fb07f-ce21-4603-aa90-0cac35480c1c"] [:name "Sports, Electronics & Health"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "ae9b6064-bd97-4ed0-bb35-401ec9cdd9d0"] [:name "Garden, Industrial & Clothing"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "523f0f2b-1469-4e91-b7ba-7526fbe2b771"] [:name "Movies"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "10858232-fc96-432c-9735-030864c35adb"] [:name "Health, Grocery & Beauty"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "60a3b7b1-f127-4c80-afd2-9d142e2c3b8a"] [:name "Kids, Electronics & Music"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "40eb7b5c-505c-4ceb-a75b-eeee61b528cd"] [:name "Jewelry"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "4cfc75e6-24b0-423c-b78a-f81c672d8ab4"] [:name "Music & Automotive"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "3209c767-68d8-408d-8c51-88f6989ca60e"] [:name "Outdoors & Home"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "c219499b-9b34-468a-9066-587ddbc5f289"] [:name "Electronics & Home"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "079ff5c7-ea9b-4aaa-88a5-16f68fbcae1c"] [:name "Tools, Baby & Kids"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "270c69e1-9a4c-4e85-b591-e06a8b4d5d43"] [:name "Grocery, Electronics & Industrial"] [:shortname nil] [:__typename :Organization])]])]])}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MANDATORY :MEDIUM], :organization_id [5656e676-663c-5402-9809-91f3f72ff4ad], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search , :priority [:NORMAL :HIGH], :budget_period_id [1173b482-b9e6-46b4-a5e3-0b021c860e9b], :category_id []}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats [{:id #uuid "46ca25c7-7e4c-4af8-b644-8633e569ea4a", :name Geisha}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
>>ToCheck dashboard:::procurement_budget_periods.id []
>>resultA1-2 []
>>requestsB2-triggerError {:inspector_priority [:LOW :MANDATORY :MEDIUM], :organization_id [5656e676-663c-5402-9809-91f3f72ff4ad], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search , :priority [:NORMAL :HIGH], :budget_period_id [1173b482-b9e6-46b4-a5e3-0b021c860e9b], :category_id []} nil
>o> helper1
>o> helper2 [] [1173b482-b9e6-46b4-a5e3-0b021c860e9b] [5656e676-663c-5402-9809-91f3f72ff4ad]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>oo> >>1 :NORMAL
>oo> >>1 :HIGH
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>oo> >>1 :LOW
>oo> >>1 :MANDATORY
>oo> >>1 :MEDIUM
low mandatory medium)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>oo> >>1 :NOT_PROCESSED
>oo> >>1 :IN_PROGRESS
>oo> >>1 :PROCURED
>oo> >>1 :ALTERNATIVE_PROCURED
>oo> >>1 :NOT_PROCURED
not_processed in_progress procured alternative_procured not_procured)
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
2023-12-04T09:25:31.087Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:31.088Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:31.089Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:31.089Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:31.090Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - (->> [viewer? inspector? admin?] (map (fn* [p1__39304#] (p1__39304# tx auth-entity))) (some true?)) => nil
>o> helper7 nil
>o> requests-base-query-with-state
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-04T09:25:31.093Z NX-41294 DEBUG [leihs.procurement.resources.request:171] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low mandatory medium) (normal high)
>oo> enum (not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"
2023-12-04T09:25:31.097Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:31.099Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:31.100Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:31.101Z NX-41294 DEBUG [leihs.procurement.permissions.requests:26] - (-> sqlmap (sql/left-join :procurement_category_viewers [:= :procurement_category_viewers.category_id :procurement_requests.category_id]) (sql/where [:or [:= :procurement_category_viewers.user_id user-id] [:= :procurement_requests.user_id user-id]])) => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category"]] [[[:row_to_json :models]] :model] [[:raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization"]] [[[:row_to_json :procurement_templates]] :template] [[:raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room"]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id] :procurement_category_viewers [:= :procurement_category_viewers.category_id :procurement_requests.category_id]], :order-by [[[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:and [:= true false] [:in :procurement_requests.budget_period_id ([:cast "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid])] [:in :procurement_requests.organization_id ([:cast "5656e676-663c-5402-9809-91f3f72ff4ad" :uuid])] [:in :procurement_requests.priority ("normal" "high")] [:in :procurement_requests.inspector_priority ("low" "mandatory" "medium")] [:or [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]] [:in :procurement_requests.order_status ([[:cast "not_processed" :order_status_enum]] [[:cast "in_progress" :order_status_enum]] [[:cast "procured" :order_status_enum]] [[:cast "alternative_procured" :order_status_enum]] [[:cast "not_procured" :order_status_enum]])] [:or ["~~*" :buildings.name "%%"] ["~~*" :procurement_requests.short_id "%%"] ["~~*" :procurement_requests.article_name "%%"] ["~~*" :procurement_requests.article_number "%%"] ["~~*" :procurement_requests.inspection_comment "%%"] ["~~*" :procurement_requests.order_comment "%%"] ["~~*" :procurement_requests.motivation "%%"] ["~~*" :procurement_requests.receiver "%%"] ["~~*" :procurement_requests.supplier_name "%%"] ["~~*" :rooms.name "%%"] ["~~*" :models.product "%%"] ["~~*" :models.version "%%"] ["~~*" :users.firstname "%%"] ["~~*" :users.lastname "%%"]] [:or [:= :procurement_category_viewers.user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"] [:= :procurement_requests.user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]]]}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) AND ((procurement_category_viewers.user_id = ?) OR (procurement_requests.user_id = ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 1173b482-b9e6-46b4-a5e3-0b021c860e9b 5656e676-663c-5402-9809-91f3f72ff4ad normal high low mandatory medium 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
>o> query-requests, auth-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) AND ((procurement_category_viewers.user_id = ?) OR (procurement_requests.user_id = ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 1173b482-b9e6-46b4-a5e3-0b021c860e9b 5656e676-663c-5402-9809-91f3f72ff4ad normal high low mandatory medium 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a" #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a"]
2023-12-04T09:25:31.105Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T09:25:31.106Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T09:25:31.107Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-04T09:25:31.109Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T09:25:31.109Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - (->> [viewer? inspector? admin?] (map (fn* [p1__39304#] (p1__39304# tx auth-entity))) (some true?)) => nil
>e> #error {
 :cause ERROR: argument of OR must be type boolean, not type record
  Position: 4044
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: argument of OR must be type boolean, not type record
  Position: 4044
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11849 invoke result_set.clj 944]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 254]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 462]
  [leihs.procurement.resources.request$query_requests invoke request.clj 456]
  [leihs.procurement.resources.requests$get_requests invokeStatic requests.clj 236]
  [leihs.procurement.resources.requests$get_requests invoke requests.clj 224]
  [leihs.procurement.dashboard$get_dashboard invokeStatic dashboard.clj 219]
  [leihs.procurement.dashboard$get_dashboard invoke dashboard.clj 176]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44479 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-12-04T09:25:31.121Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - ERROR: argument of OR must be type boolean, not type record
  Position: 4044
2023-12-04T09:25:31.122Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause ERROR: argument of OR must be type boolean, not type record
  Position: 4044
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: argument of OR must be type boolean, not type record
  Position: 4044
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11849 invoke result_set.clj 944]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 254]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 462]
  [leihs.procurement.resources.request$query_requests invoke request.clj 456]
  [leihs.procurement.resources.requests$get_requests invokeStatic requests.clj 236]
  [leihs.procurement.resources.requests$get_requests invoke requests.clj 224]
  [leihs.procurement.dashboard$get_dashboard invokeStatic dashboard.clj 219]
  [leihs.procurement.dashboard$get_dashboard invoke dashboard.clj 176]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44479 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T09:23:13.117364Z", :id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :user_session_id #uuid "d77c8109-0dcc-4858-b200-c8cc781c46f5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "ec6bf72e-afab-47e9-9839-ba15d9eb8f8a", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 6fff328d-c865-4ea3-96a0-b9140ba6317f}, leihs-user-session {:value 3975bdc4-ace9-457f-a804-ac3de3209f2b}}, :remote-addr 127.0.0.1, :start-time 5832410659708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b, content-length 3972, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6fff328d-c865-4ea3-96a0-b9140ba6317f, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x26a8df77 /127.0.0.1:3230<->/127.0.0.1:58178], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 3972, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [5656e676-663c-5402-9809-91f3f72ff4ad], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6064b60e leihs.procurement.graphql$handler@6064b60e], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-04T09:23:13.117364Z","id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","user_session_id":"d77c8109-0dcc-4858-b200-c8cc781c46f5","scope_system_admin_read":false,"access-rights":[],"user_id":"ec6bf72e-afab-47e9-9839-ba15d9eb8f8a","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"6fff328d-c865-4ea3-96a0-b9140ba6317f"},"leihs-user-session":{"value":"3975bdc4-ace9-457f-a804-ac3de3209f2b"}},"remote-addr":"127.0.0.1","start-time":5832410659708,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=6fff328d-c865-4ea3-96a0-b9140ba6317f; leihs-user-session=3975bdc4-ace9-457f-a804-ac3de3209f2b","content-length":"3972","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"6fff328d-c865-4ea3-96a0-b9140ba6317f","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":3972,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"inspector_priority":["LOW","MANDATORY","MEDIUM"],"onlyOwnRequests":false,"state":["NEW","APPROVED","PARTIALLY_APPROVED","DENIED"],"order_status":["NOT_PROCESSED","IN_PROGRESS","PROCURED","ALTERNATIVE_PROCURED","NOT_PROCURED"],"search":"","organizations":["5656e676-663c-5402-9809-91f3f72ff4ad"],"categories":[],"priority":["NORMAL","HIGH"],"budgetPeriods":["1173b482-b9e6-46b4-a5e3-0b021c860e9b"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard nil]), :errors ({:message ERROR: argument of OR must be type boolean, not type record
  Position: 4044, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception PSQLException, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-04T09:25:31.126Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:dashboard nil]), :errors ({:message "ERROR: argument of OR must be type boolean, not type record\n  Position: 4044", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "PSQLException", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-04T09:25:31.126Z NX-41294 DEBUG [leihs.procurement.graphql:86] - {:data #ordered/map ([:dashboard nil]), :errors ({:message "ERROR: argument of OR must be type boolean, not type record\n  Position: 4044", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "PSQLException", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}

>o> ERROR 4pure-handler, result=> {:data #ordered/map ([:dashboard nil]), :errors ({:message ERROR: argument of OR must be type boolean, not type record
  Position: 4044, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception PSQLException, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
