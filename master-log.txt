      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x386f4ee1 leihs.procurement.graphql$handler@386f4ee1], :multipart-params {}, :scheme :http, :request-method :post, :accept
>>>exec-query::variables {:mime :json, :charset nil, :encoding nil, :language nil}}{
:search nil, :budgetPeriods
>> authorize::handler-key >> :graphql
[d5e762ef-6c1d-436e-b07c-9aec448dafbe], :categories [3198432f-d843-4cef-9859-efc48ebc0820], :organizations [572e3160-1450-4baf-923f-fa939f1bfde6], :onlyOwnRequests false, :priority [NORMAL HIGH], :inspector_priority [LOW MEDIUM HIGH MANDATORY], :state [NEW APPROVED PARTIALLY_APPROVED DENIED]}

>>>get-dashboard
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 3198432f-d843-4cef-9859-efc48ebc0820 d5e762ef-6c1d-436e-b07c-9aec448dafbe 572e3160-1450-4baf-923f-fa939f1bfde6 normal high low medium high mandatory 0 0]

>>>exec-query::variables {:id [e483c1ff-f97a-455a-8772-379bafdcc4c7]}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (procurement_requests.id in (?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED e483c1ff-f97a-455a-8772-379bafdcc4c7]

>>>pure-handler {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -1687072604] [:budget_periods [#ordered/map ([:cacheKey -1687072604_d5e762ef-6c1d-436e-b07c-9aec448dafbe] [:total_price_cents 0] [:main_categories [#ordered/map ([:cacheKey -1687072604_d5e762ef-6c1d-436e-b07c-9aec448dafbe_c619b65e-e7fd-4bd8-aea3-e76f5529798d] [:total_price_cents 0] [:categories [#ordered/map ([:cacheKey -1687072604_d5e762ef-6c1d-436e-b07c-9aec448dafbe_c619b65e-e7fd-4bd8-aea3-e76f5529798d_3198432f-d843-4cef-9859-efc48ebc0820] [:total_price_cents 0] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}

>>>pure-handler {:data #ordered/map ([:requests [#ordered/map ([:id e483c1ff-f97a-455a-8772-379bafdcc4c7] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id 98dabda9-079f-419d-83af-709ad47ca8dd] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id 3198432f-d843-4cef-9859-efc48ebc0820] [:name Category C1] [:main_category #ordered/map ([:id c619b65e-e7fd-4bd8-aea3-e76f5529798d] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id d5e762ef-6c1d-436e-b07c-9aec448dafbe] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 572e3160-1450-4baf-923f-fa939f1bfde6] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id eceec7a6-8a47-45d0-9438-788cd1efed90] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write false] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write false] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write false] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 7194ed8b-67e0-429e-92c2-8367a2f547a7] [:name reception room] [:building #ordered/map ([:id 4a3afcbf-1171-4741-9709-5ea935fed82f] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write false] [:required true])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write false] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:order_status #ordered/map ([:value :PROCURED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value Wurde bestellt und geliefert!] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write false] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete false] [:edit true] [:moveBudgetPeriod false] [:moveCategory false] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id c619b65e-e7fd-4bd8-aea3-e76f5529798d] [:name Main Category MC1] [:categories [#ordered/map ([:id 3198432f-d843-4cef-9859-efc48ebc0820] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods []] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T15:56:34.642372Z", :id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :user_session_id #uuid "260b78f2-af2c-4648-8708-0d3c648e45e6", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x310f5c52 leihs.core.locale$wrap$fn__44318@310f5c52]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T15:56:34.642372Z", :id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :user_session_id #uuid "260b78f2-af2c-4648-8708-0d3c648e45e6", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 815e752a-0858-42a2-bfe5-ef408aace154}, leihs-user-session {:value 866a0b26-7bfb-4668-9a7d-9c3dde333395}}, :remote-addr 127.0.0.1, :start-time 496187223304041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=815e752a-0858-42a2-bfe5-ef408aace154; leihs-user-session=866a0b26-7bfb-4668-9a7d-9c3dde333395, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 815e752a-0858-42a2-bfe5-ef408aace154, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6f733db9 /127.0.0.1:3230<->/127.0.0.1:65168], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x386f4ee1 leihs.procurement.graphql$handler@386f4ee1], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T15:56:34.642372Z", :id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :user_session_id #uuid "260b78f2-af2c-4648-8708-0d3c648e45e6", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x310f5c52 leihs.core.locale$wrap$fn__44318@310f5c52]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T15:56:34.642372Z", :id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :user_session_id #uuid "260b78f2-af2c-4648-8708-0d3c648e45e6", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 815e752a-0858-42a2-bfe5-ef408aace154}, leihs-user-session {:value 866a0b26-7bfb-4668-9a7d-9c3dde333395}}, :remote-addr 127.0.0.1, :start-time 496187231164166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=815e752a-0858-42a2-bfe5-ef408aace154; leihs-user-session=866a0b26-7bfb-4668-9a7d-9c3dde333395, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 815e752a-0858-42a2-bfe5-ef408aace154, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3629b094 /127.0.0.1:3230<->/127.0.0.1:65169], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [e483c1ff-f97a-455a-8772-379bafdcc4c7]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x386f4ee1 leihs.procurement.graphql$handler@386f4ee1], :multipart-params {}, :scheme :http, :request-method :post, :accept
>>>exec-query::variables{ :mime :json, :charset {nil}, :encoding nil, :language nil}
}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {:id [e483c1ff-f97a-455a-8772-379bafdcc4c7]}

>>>pure-handler {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"815e752a-0858-42a2-bfe5-ef408aace154","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8d95ee85-dd9c-474d-9501-debe1827893b","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8d95ee85-dd9c-474d-9501-debe1827893b] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (procurement_requests.id in (?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED e483c1ff-f97a-455a-8772-379bafdcc4c7]

>>>pure-handler {:data #ordered/map ([:requests [#ordered/map ([:id e483c1ff-f97a-455a-8772-379bafdcc4c7] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id 98dabda9-079f-419d-83af-709ad47ca8dd] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id 3198432f-d843-4cef-9859-efc48ebc0820] [:name Category C1] [:main_category #ordered/map ([:id c619b65e-e7fd-4bd8-aea3-e76f5529798d] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id d5e762ef-6c1d-436e-b07c-9aec448dafbe] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 572e3160-1450-4baf-923f-fa939f1bfde6] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id eceec7a6-8a47-45d0-9438-788cd1efed90] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write false] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write false] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write false] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 7194ed8b-67e0-429e-92c2-8367a2f547a7] [:name reception room] [:building #ordered/map ([:id 4a3afcbf-1171-4741-9709-5ea935fed82f] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write false] [:required true])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write false] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:order_status #ordered/map ([:value :PROCURED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value Wurde bestellt und geliefert!] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write false] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete false] [:edit true] [:moveBudgetPeriod false] [:moveCategory false] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id c619b65e-e7fd-4bd8-aea3-e76f5529798d] [:name Main Category MC1] [:categories [#ordered/map ([:id 3198432f-d843-4cef-9859-efc48ebc0820] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods []] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T15:56:34.642372Z", :id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :user_session_id #uuid "260b78f2-af2c-4648-8708-0d3c648e45e6", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x310f5c52 leihs.core.locale$wrap$fn__44318@310f5c52]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T15:56:34.642372Z", :id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :user_session_id #uuid "260b78f2-af2c-4648-8708-0d3c648e45e6", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8d95ee85-dd9c-474d-9501-debe1827893b", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 815e752a-0858-42a2-bfe5-ef408aace154}, leihs-user-session {:value 866a0b26-7bfb-4668-9a7d-9c3dde333395}}, :remote-addr 127.0.0.1, :start-time 496187337814125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=815e752a-0858-42a2-bfe5-ef408aace154; leihs-user-session=866a0b26-7bfb-4668-9a7d-9c3dde333395, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 815e752a-0858-42a2-bfe5-ef408aace154, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x42eda529 /127.0.0.1:3230<->/127.0.0.1:65168], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x386f4ee1 leihs.procurement.graphql$handler@386f4ee1], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {}

>>>pure-handler {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"815e752a-0858-42a2-bfe5-ef408aace154","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8d95ee85-dd9c-474d-9501-debe1827893b","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8d95ee85-dd9c-474d-9501-debe1827893b] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-11-24T16:01:13.613Z NX-41294 INFO [leihs.core.http-server:84] - stopping running http-server
2023-11-24T16:01:13.848Z NX-41294 INFO [leihs.core.http-server:88] - stopped http-server
➜  procure runbet
>> Running: ./bin/dev-run-backend --db-port 5415 --db-name leihs_test
# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-11-24T16:01:25.648Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value
2023-11-24T16:01:26.189Z NX-41294 INFO [leihs.core.logging:32] - initializing logging  {:min-level [[#{"leihs.procurement"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-11-24T16:01:26.195Z NX-41294 INFO [leihs.core.logging:34] - initialized logging  {:min-level [[#{"leihs.procurement"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x23ab1522 "taoensso.timbre$default_output_fn@23ab1522"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x44c531af "taoensso.timbre.appenders.core$println_appender$fn__3459@44c531af"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-11-24T16:01:26.197Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-11-24T16:01:26.209Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 43911, :repl-port-file ".nrepl-port"}
2023-11-24T16:01:26.211Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  43911 localhost
2023-11-24T16:01:26.236Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server
2023-11-24T16:01:26.241Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 43911, :repl-port-file .nrepl-port}
2023-11-24T16:01:26.242Z NX-41294 INFO [leihs.core.shutdown:20] - PID 5309
2023-11-24T16:01:26.271Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-11-24T16:01:26.319Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-11-24T16:01:26.320Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-24T16:01:26.329Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-11-24T16:01:26.402Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@3067efcb
2023-11-24T16:01:26.408Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-11-24T16:01:26.408Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 "HikariDataSource (db-pool)"]}
2023-11-24T16:01:26.409Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-24T16:01:26.423Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-11-24T16:01:26.436Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@3cb1d6df
2023-11-24T16:01:26.436Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-11-24T16:01:26.442Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e "next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e"]}}
2023-11-24T16:01:26.450Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x7799133d "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x432bc43a "java.util.concurrent.ThreadPoolExecutor@432bc43a[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-11-24T16:01:26.461Z NX-41294 INFO [leihs.core.http-server:104] - started http-server
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 496518127579916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x34b1dca1 /127.0.0.1:3230<->/127.0.0.1:65228], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54b9b632 compojure.core$routes$fn__27950@54b9b632], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}}, :remote-addr 127.0.0.1, :start-time 496518302971708, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x37a9e7ab /127.0.0.1:3230<->/127.0.0.1:65228], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54b9b632 compojure.core$routes$fn__27950@54b9b632], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}}, :remote-addr 127.0.0.1, :start-time 496518421810666, :params {:user jimmie@goyette.com, :password nil, :csrf-token efffb909-992d-40be-b97f-420b52aa20a7}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x26ff174e HikariProxyConnection@654251854 wrapping org.postgresql.jdbc.PgConnection@3cb1d6df], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7, content-length 83, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x37f283a0 /127.0.0.1:3230<->/127.0.0.1:65228], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password , :csrf-token efffb909-992d-40be-b97f-420b52aa20a7}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7c1c0058 HikariProxyConnection@2082209880 wrapping org.postgresql.jdbc.PgConnection@3067efcb], :level 1, :rollback #object[clojure.lang.Atom 0x2c85d142 {:status :ready, :val false}]}, :content-length 83, :form-params {:user jimmie@goyette.com, :password nil, :csrf-token efffb909-992d-40be-b97f-420b52aa20a7}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password , :csrf-token efffb909-992d-40be-b97f-420b52aa20a7}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x761b2449 BytesInputStream[len=83]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54b9b632 compojure.core$routes$fn__27950@54b9b632], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}}, :remote-addr 127.0.0.1, :start-time 496518512610000, :params {:user jimmie@goyette.com, :password password, :csrf-token efffb909-992d-40be-b97f-420b52aa20a7}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7b418f3b HikariProxyConnection@2067894075 wrapping org.postgresql.jdbc.PgConnection@3cb1d6df], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7, content-length 91, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x50aa905c /127.0.0.1:3230<->/127.0.0.1:65228], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token efffb909-992d-40be-b97f-420b52aa20a7}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6f092c14 HikariProxyConnection@1862872084 wrapping org.postgresql.jdbc.PgConnection@3067efcb], :level 1, :rollback #object[clojure.lang.Atom 0x34fc901c {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token efffb909-992d-40be-b97f-420b52aa20a7}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token efffb909-992d-40be-b97f-420b52aa20a7}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x43b3e9ef BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54b9b632 compojure.core$routes$fn__27950@54b9b632], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496518611678333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4c118bd7 /127.0.0.1:3230<->/127.0.0.1:65228], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x3d475865 leihs.procurement.backend.html$not_found_handler@3d475865], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496518849047208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7de3d3bf /127.0.0.1:3230<->/127.0.0.1:65234], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x3d475865 leihs.procurement.backend.html$not_found_handler@3d475865], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496518852042916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1f181e5c /127.0.0.1:3230<->/127.0.0.1:65228], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {}

>>>pure-handler {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"efffb909-992d-40be-b97f-420b52aa20a7","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"bce190ac-a4bd-4205-ac07-2db8a2f0063d","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id bce190ac-a4bd-4205-ac07-2db8a2f0063d] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496519059490666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x363ccd5e /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496519058422250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1f415ea4 /127.0.0.1:3230<->/127.0.0.1:65234], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>>> authenticate::skip=
>> authorize::handler-key >>nil  :graphql handler-key=
:graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496519059082250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x41f1400e /127.0.0.1:3230<->/127.0.0.1:65228], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>>pure-handler
>> authorize::handler-key >> :graphql
{:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"efffb909-992d-40be-b97f-420b52aa20a7","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"bce190ac-a4bd-4205-ac07-2db8a2f0063d","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id bce190ac-a4bd-4205-ac07-2db8a2f0063d] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}

>>>exec-query::variables {}

>>>exec-query::variables {}

>>>get-dashboard

>>>pure-handler {:data #ordered/map ([:budget_periods [#ordered/map ([:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:name Budget-Period-Past] [:inspection_start_date 2023-08-23T22:00:00Z] [:end_date 2023-11-22T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:categories [#ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:__typename :Organization])]])]])}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED]

>>>pure-handler {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -15128758] [:total_count 1] [:budget_periods [#ordered/map ([:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:cacheKey -15128758_50e22785-06e0-47ac-b6f5-e12a36c678c8] [:name Budget-Period-Past] [:inspection_start_date 2023-08-23T22:00:00Z] [:end_date 2023-11-22T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:cacheKey -15128758_50e22785-06e0-47ac-b6f5-e12a36c678c8_488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:cacheKey -15128758_50e22785-06e0-47ac-b6f5-e12a36c678c8_488c6edf-7a58-415d-9120-da39b922e4f7_f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:total_price_cents 0] [:requests [#ordered/map ([:id ea8213af-eca6-4cab-b019-47c64696e8ff] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id e5241cdf-12ce-46c1-af82-004997b256a4] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:main_category #ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:building #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents 0] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496519232842125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 4019, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x63d2a300 /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 4019, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [b6d94827-fa05-400f-8a29-b8a7d5acdf8f], :categories [f80f1e7b-1da0-4f81-955e-bf6d2daf38b5], :priority [NORMAL HIGH], :budgetPeriods [50e22785-06e0-47ac-b6f5-e12a36c678c8]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [b6d94827-fa05-400f-8a29-b8a7d5acdf8f], :categories [f80f1e7b-1da0-4f81-955e-bf6d2daf38b5], :priority [NORMAL HIGH], :budgetPeriods [50e22785-06e0-47ac-b6f5-e12a36c678c8]}

>>>get-dashboard
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED f80f1e7b-1da0-4f81-955e-bf6d2daf38b5 50e22785-06e0-47ac-b6f5-e12a36c678c8 b6d94827-fa05-400f-8a29-b8a7d5acdf8f normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured]

>>>pure-handler {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -140300074] [:total_count 1] [:budget_periods [#ordered/map ([:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:cacheKey -140300074_50e22785-06e0-47ac-b6f5-e12a36c678c8] [:name Budget-Period-Past] [:inspection_start_date 2023-08-23T22:00:00Z] [:end_date 2023-11-22T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:cacheKey -140300074_50e22785-06e0-47ac-b6f5-e12a36c678c8_488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:cacheKey -140300074_50e22785-06e0-47ac-b6f5-e12a36c678c8_488c6edf-7a58-415d-9120-da39b922e4f7_f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:total_price_cents 0] [:requests [#ordered/map ([:id ea8213af-eca6-4cab-b019-47c64696e8ff] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id e5241cdf-12ce-46c1-af82-004997b256a4] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:main_category #ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:building #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents 0] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496519976454666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0xf2b6240 /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (procurement_requests.id in (?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED ea8213af-eca6-4cab-b019-47c64696e8ff]

>>>pure-handler {:data #ordered/map ([:requests [#ordered/map ([:id ea8213af-eca6-4cab-b019-47c64696e8ff] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id e5241cdf-12ce-46c1-af82-004997b256a4] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:main_category #ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write false] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write false] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write false] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:building #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write false] [:required true])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write false] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write false] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete false] [:edit true] [:moveBudgetPeriod false] [:moveCategory false] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:categories [#ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods []] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496520142080541, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 137, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x61ae039c /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>>> authenticate::skip=
>> authorize::handler-key >> nil :graphql
 handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496520142163208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x57a8ffcc /127.0.0.1:3230<->/127.0.0.1:65228], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId 27d4a135-0778-4988-a36f-029af6838bee}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>>exec-query::variables
>> authorize::handler-key >>  :graphql
{}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496520159339458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource
>>>exec-query::variables {:buildingId 27d4a135-0778-4988-a36f-029af6838bee}
0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3680d48c /127.0.0.1:3230<->/127.0.0.1:65240], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>pure-handler {:data #ordered/map ([:rooms [#ordered/map ([:id eadfd42e-ea00-4597-9432-9f953d64d854] [:name general room] [:description nil] [:__typename :Room]) #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:description nil] [:__typename :Room])]])}

>>>pure-handler {:data #ordered/map ([:buildings [#ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building]) #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])]])}

>>>exec-query::variables {}

>>>pure-handler {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"efffb909-992d-40be-b97f-420b52aa20a7","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"bce190ac-a4bd-4205-ac07-2db8a2f0063d","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id bce190ac-a4bd-4205-ac07-2db8a2f0063d] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496520230106666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x434e7402 /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (procurement_requests.id in (?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED ea8213af-eca6-4cab-b019-47c64696e8ff]

>>>pure-handler {:data #ordered/map ([:requests [#ordered/map ([:id ea8213af-eca6-4cab-b019-47c64696e8ff] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id e5241cdf-12ce-46c1-af82-004997b256a4] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:main_category #ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write false] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write false] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write false] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:building #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write false] [:required true])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write false] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write false] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete false] [:edit true] [:moveBudgetPeriod false] [:moveCategory false] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:categories [#ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods []] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496520811457791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x28e7df04 HikariProxyConnection@686284548 wrapping org.postgresql.jdbc.PgConnection@6a2a3b62], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 5402, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6af9826a /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x4c515535 HikariProxyConnection@1280398645 wrapping org.postgresql.jdbc.PgConnection@5ad8bc44], :level 1, :rollback #object[clojure.lang.Atom 0x61127d56 {:status :ready, :val false}]}, :content-length 5402, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName updateRequest, :variables {:requestData {:id ea8213af-eca6-4cab-b019-47c64696e8ff, :order_status PROCURED, :order_comment Wurde bestellt und geliefert!}}, :query mutation updateRequest($requestData: RequestInput) {
  request(input_data: $requestData) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {:requestData {:id ea8213af-eca6-4cab-b019-47c64696e8ff, :order_status PROCURED, :order_comment Wurde bestellt und geliefert!}}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]

>>>pure-handler {:data #ordered/map ([:request #ordered/map ([:id ea8213af-eca6-4cab-b019-47c64696e8ff] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id e5241cdf-12ce-46c1-af82-004997b256a4] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:main_category #ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write false] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write false] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write false] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:building #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write false] [:required true])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write false] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:order_status #ordered/map ([:value :PROCURED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value Wurde bestellt und geliefert!] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write false] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496520941919916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 1214, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x27acf154 /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 1214, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:search nil, :budgetPeriods [50e22785-06e0-47ac-b6f5-e12a36c678c8], :categories [f80f1e7b-1da0-4f81-955e-bf6d2daf38b5], :organizations [b6d94827-fa05-400f-8a29-b8a7d5acdf8f], :onlyOwnRequests false, :priority [NORMAL HIGH], :inspector_priority [LOW MEDIUM HIGH MANDATORY], :state [NEW APPROVED PARTIALLY_APPROVED DENIED]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    budget_periods {
      cacheKey
      total_price_cents
      main_categories {
        cacheKey
        total_price_cents
        categories {
          cacheKey
          total_price_cents
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>>> authenticate::skip= nil
>> authorize::handler-key >> handler-key=  :graphql:graphql

>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496520946065291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7a4fadcf /127.0.0.1:3230<->/127.0.0.1:65240], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept
>>>exec-query::variables {:mime {:search nil, :budgetPeriods :json, :charset [nil, :encoding nil, :language nil}}50e22785-06e0-47ac-b6f5-e12a36c678c8], :categories [
f80f1e7b-1da0-4f81-955e-bf6d2daf38b5], :organizations [b6d94827-fa05-400f-8a29-b8a7d5acdf8f], :onlyOwnRequests false, :priority [NORMAL HIGH], :inspector_priority [
>> authorize::handler-key >>LOW MEDIUM  HIGH MANDATORY], :state:graphql
[NEW APPROVED PARTIALLY_APPROVED DENIED]}

>>>get-dashboard
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED f80f1e7b-1da0-4f81-955e-bf6d2daf38b5 50e22785-06e0-47ac-b6f5-e12a36c678c8 b6d94827-fa05-400f-8a29-b8a7d5acdf8f normal high low medium high mandatory 0 0]

>>>exec-query::variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (procurement_requests.id in (?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED ea8213af-eca6-4cab-b019-47c64696e8ff]

>>>pure-handler {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -376003998] [:budget_periods [#ordered/map ([:cacheKey -376003998_50e22785-06e0-47ac-b6f5-e12a36c678c8] [:total_price_cents 0] [:main_categories [#ordered/map ([:cacheKey -376003998_50e22785-06e0-47ac-b6f5-e12a36c678c8_488c6edf-7a58-415d-9120-da39b922e4f7] [:total_price_cents 0] [:categories [#ordered/map ([:cacheKey -376003998_50e22785-06e0-47ac-b6f5-e12a36c678c8_488c6edf-7a58-415d-9120-da39b922e4f7_f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:total_price_cents 0] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}

>>>pure-handler {:data #ordered/map ([:requests [#ordered/map ([:id ea8213af-eca6-4cab-b019-47c64696e8ff] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id e5241cdf-12ce-46c1-af82-004997b256a4] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:main_category #ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write false] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write false] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write false] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:building #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write false] [:required true])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write false] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:order_status #ordered/map ([:value :PROCURED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value Wurde bestellt und geliefert!] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write false] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete false] [:edit true] [:moveBudgetPeriod false] [:moveCategory false] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:categories [#ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods []] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496521074287875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x371389b7 /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (procurement_requests.id in (?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED ea8213af-eca6-4cab-b019-47c64696e8ff]

>>>pure-handler {:data #ordered/map ([:requests [#ordered/map ([:id ea8213af-eca6-4cab-b019-47c64696e8ff] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id e5241cdf-12ce-46c1-af82-004997b256a4] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:main_category #ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write false] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write false] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write false] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:building #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write false] [:required true])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write false] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:order_status #ordered/map ([:value :PROCURED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value Wurde bestellt und geliefert!] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write false] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete false] [:edit true] [:moveBudgetPeriod false] [:moveCategory false] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:categories [#ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods []] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496521175581166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x34e1c3ca /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {}

>>>pure-handler {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"efffb909-992d-40be-b97f-420b52aa20a7","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"bce190ac-a4bd-4205-ac07-2db8a2f0063d","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id bce190ac-a4bd-4205-ac07-2db8a2f0063d] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44318 0x62278e1e leihs.core.locale$wrap$fn__44318@62278e1e]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-24T16:02:08.554469Z", :id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :user_session_id #uuid "d1e49d05-15d1-4138-adf5-74cce3973010", :scope_system_admin_read false, :access-rights (), :user_id #uuid "bce190ac-a4bd-4205-ac07-2db8a2f0063d", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value efffb909-992d-40be-b97f-420b52aa20a7}, leihs-user-session {:value b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5}}, :remote-addr 127.0.0.1, :start-time 496521214938750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x54ae6f17 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2e18c1e next.jdbc.result_set$as_unqualified_lower_maps@2e18c1e]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=efffb909-992d-40be-b97f-420b52aa20a7; leihs-user-session=b8762a5c-ecfb-44f8-8c2d-18bfb61a2fe5, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token efffb909-992d-40be-b97f-420b52aa20a7, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1b72d86 /127.0.0.1:3230<->/127.0.0.1:65237], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4f830a49 HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x3d7e569b leihs.procurement.graphql$handler@3d7e569b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql

>>>exec-query::variables {:id [ea8213af-eca6-4cab-b019-47c64696e8ff]}
>>a  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>>b  #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (procurement_requests.id in (?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED ea8213af-eca6-4cab-b019-47c64696e8ff]

>>>pure-handler {:data #ordered/map ([:requests [#ordered/map ([:id ea8213af-eca6-4cab-b019-47c64696e8ff] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id e5241cdf-12ce-46c1-af82-004997b256a4] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:main_category #ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 50e22785-06e0-47ac-b6f5-e12a36c678c8] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id b6d94827-fa05-400f-8a29-b8a7d5acdf8f] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id 8f9d84d5-bb74-46fe-95c2-7169f742be78] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write false] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write false] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write false] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 59eaf8d6-6fb3-44fd-bac3-538f50d0f3f4] [:name reception room] [:building #ordered/map ([:id 27d4a135-0778-4988-a36f-029af6838bee] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write false] [:required true])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write false] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:order_status #ordered/map ([:value :PROCURED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value Wurde bestellt und geliefert!] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write false] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete false] [:edit true] [:moveBudgetPeriod false] [:moveCategory false] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id 488c6edf-7a58-415d-9120-da39b922e4f7] [:name Main Category MC1] [:categories [#ordered/map ([:id f80f1e7b-1da0-4f81-955e-bf6d2daf38b5] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods []] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}


