


buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(NULL AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((procurement_requests.approved_quantity IS NULL) OR (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) OR ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) OR (procurement_requests.approved_quantity = ?)) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1173b482-b9e6-46b4-a5e3-0b021c860e9b normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd%]
>o> query-requests, auth-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(NULL AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((procurement_requests.approved_quantity IS NULL) OR (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) OR ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) OR (procurement_requests.approved_quantity = ?)) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1173b482-b9e6-46b4-a5e3-0b021c860e9b normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd% ~~* %dfdafdasd%]