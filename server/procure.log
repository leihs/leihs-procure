# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-12-19T00:09:18.215Z NX-41294 DEBUG [leihs.procurement.permissions.user:175] - (defn requester? [tx auth-entity] (let [query (-> (sql/select [[:exists (-> (sql/select [true :exists]) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id [:cast (:user_id auth-entity) :uuid]]))]]) sql-format) p (println ">o> requester??" query) result (jdbc/execute-one! tx (spy query)) p (println ">o> requester??" (spy result))] (spy (:exists result)))) => #'leihs.procurement.permissions.user/requester?
>oo >tocheck users3 sql-order-users, sqlmap= {:select [:users.id :users.firstname :users.lastname], :from [:users]}
>oo >tocheck users3 sql-order-users, sqlmap= {:select [:users.*], :from [:users], :where [:in :users.id {:select [:procurement_admins.user_id], :from [:procurement_admins]}]}
2023-12-19T00:09:18.783Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/update-budget-periods!
2023-12-19T00:09:18.785Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/update-budget-periods!
2023-12-19T00:09:18.786Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/insert-test-period-budget
2023-12-19T00:09:18.786Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/insert-test-period-budget
2023-12-19T00:09:18.786Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/get-budget-periods
2023-12-19T00:09:18.786Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/get-budget-periods
2023-12-19T00:09:18.787Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/delete-budget-periods-not-in!
2023-12-19T00:09:18.787Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/delete-budget-periods-not-in!
2023-12-19T00:09:18.787Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/parse-utc-string
2023-12-19T00:09:18.787Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/parse-utc-string
2023-12-19T00:09:18.787Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/parse-and-format-offset-date-time
2023-12-19T00:09:18.788Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/parse-and-format-offset-date-time
2023-12-19T00:09:18.788Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/budget-periods-query
2023-12-19T00:09:18.788Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/budget-periods-query
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
2023-12-19T00:09:19.021Z NX-41294 DEBUG [leihs.procurement.resources.request:213] - (-> (sql/select [[:raw (str "DISTINCT ON (procurement_requests.id, " conc ") procurement_requests.*")]]) (sql/from :procurement_requests) (sql/left-join :models [:= :models.id :procurement_requests.model_id]) (sql/order-by :procurement_requests.id [[:raw conc]])) => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [:procurement_requests.id [[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]]}
>oo> templates::templates-base-query ERROR?
2023-12-19T00:09:19.059Z NX-41294 DEBUG [leihs.procurement.resources.templates:29] - (-> (sql/select :procurement_templates.*) (sql/from :procurement_templates) (sql/left-join :models [:= :models.id :procurement_templates.model_id]) (sql/order-by [[:concat (->> [:procurement_templates.article_name :models.product :models.version] (map (fn* [p1__45644#] (->> [:lower [:coalesce p1__45644# ""]]))))]])) => {:select [:procurement_templates.*], :from [:procurement_templates], :left-join [:models [:= :models.id :procurement_templates.model_id]], :order-by [[[:concat ([:lower [:coalesce :procurement_templates.article_name ""]] [:lower [:coalesce :models.product ""]] [:lower [:coalesce :models.version ""]])]]]}
2023-12-19T00:09:19.206Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:43] - arg => {:rooms #object[leihs.procurement.resources.rooms$get_rooms 0x240502b9 "leihs.procurement.resources.rooms$get_rooms@240502b9"], :category #object[leihs.procurement.resources.category$get_category 0xa6e77c9 "leihs.procurement.resources.category$get_category@a6e77c9"], :total-price-cents-new-requests #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x59476de4 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@59476de4"], :change-request-budget-period #object[leihs.procurement.resources.request$change_budget_period_BANG_ 0x2239225f "leihs.procurement.resources.request$change_budget_period_BANG_@2239225f"], :supplier #object[leihs.procurement.resources.supplier$get_supplier 0x2e25ec6b "leihs.procurement.resources.supplier$get_supplier@2e25ec6b"], :department #object[leihs.procurement.resources.organization$get_department_of_organization 0x578c1659 "leihs.procurement.resources.organization$get_department_of_organization@578c1659"], :create-request #object[leihs.procurement.resources.request$create_request_BANG_ 0x35c66901 "leihs.procurement.resources.request$create_request_BANG_@35c66901"], :update-templates #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x5e868e3c "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@5e868e3c"], :update-requesters-organizations #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x5f416733 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@5f416733"], :permissions #object[leihs.procurement.permissions.user$get_permissions 0x68c88c5c "leihs.procurement.permissions.user$get_permissions@68c88c5c"], :delete-request #object[leihs.procurement.resources.request$delete_request_BANG_ 0x6ec07e25 "leihs.procurement.resources.request$delete_request_BANG_@6ec07e25"], :building #object[leihs.procurement.resources.building$get_building 0x4ddeaaf "leihs.procurement.resources.building$get_building@4ddeaaf"], :update-budget-periods #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x50f17df8 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@50f17df8"], :current-user #object[leihs.procurement.resources.current_user$get_current_user 0x7cf7a1d6 "leihs.procurement.resources.current_user$get_current_user@7cf7a1d6"], :viewers #object[leihs.procurement.graphql.queries$fn__46095 0x11abc93b "leihs.procurement.graphql.queries$fn__46095@11abc93b"], :suppliers #object[leihs.procurement.resources.suppliers$get_suppliers 0x7a48d133 "leihs.procurement.resources.suppliers$get_suppliers@7a48d133"], :can-delete-budget-period? #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x210d7d3f "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@210d7d3f"], :buildings #object[leihs.procurement.resources.buildings$get_buildings 0x603591d9 "leihs.procurement.resources.buildings$get_buildings@603591d9"], :admins #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x2f987ef5 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@2f987ef5"], :update-admins #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x1365e37c "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@1365e37c"], :main-categories #object[leihs.procurement.resources.main_categories$get_main_categories 0x59cb90aa "leihs.procurement.resources.main_categories$get_main_categories@59cb90aa"], :update-main-categories #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x153c6913 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@153c6913"], :requests #object[leihs.procurement.resources.requests$get_requests 0x793fc297 "leihs.procurement.resources.requests$get_requests@793fc297"], :attachments #object[leihs.procurement.resources.attachments$get_attachments 0x45fda0cf "leihs.procurement.resources.attachments$get_attachments@45fda0cf"], :inspectors #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x4036261a "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@4036261a"], :settings #object[leihs.procurement.resources.settings$get_settings 0x3634bbfe "leihs.procurement.resources.settings$get_settings@3634bbfe"], :dashboard #object[leihs.procurement.dashboard$get_dashboard 0x3118fcd5 "leihs.procurement.dashboard$get_dashboard@3118fcd5"], :update-settings #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x194bc9e1 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@194bc9e1"], :total-price-cents-inspected-requests #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x683c3a24 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@683c3a24"], :template #object[leihs.procurement.resources.template$get_template 0x7bc49796 "leihs.procurement.resources.template$get_template@7bc49796"], :department-of-requester-organization #object[leihs.procurement.resources.organization$get_department_of_requester_organization 0xd4c326f "leihs.procurement.resources.organization$get_department_of_requester_organization@d4c326f"], :organization #object[leihs.procurement.resources.organization$get_organization 0x4a0ff6e6 "leihs.procurement.resources.organization$get_organization@4a0ff6e6"], :organizations #object[leihs.procurement.resources.organizations$get_organizations 0x436b0899 "leihs.procurement.resources.organizations$get_organizations@436b0899"], :main-category #object[leihs.procurement.resources.main_category$get_main_category 0x1c4c4f45 "leihs.procurement.resources.main_category$get_main_category@1c4c4f45"], :total-price-cents-approved-quantities #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x70ffc9e9 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@70ffc9e9"], :models #object[leihs.procurement.resources.models$get_models 0x4572a9d6 "leihs.procurement.resources.models$get_models@4572a9d6"], :categories #object[leihs.procurement.resources.categories$get_categories 0x5ec65e21 "leihs.procurement.resources.categories$get_categories@5ec65e21"], :total-price-cents-requested-quantities #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x200e04db "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@200e04db"], :budget-period #object[leihs.procurement.resources.budget_period$get_budget_period 0x2eb021b2 "leihs.procurement.resources.budget_period$get_budget_period@2eb021b2"], :update-categories-viewers #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x7edc11ab "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@7edc11ab"], :total-price-cents-order-quantities #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x12876f07 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@12876f07"], :can-delete-main-category? #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x427f8950 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@427f8950"], :can-delete-category? #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x6ded8d1c "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@6ded8d1c"], :budget-limits #object[leihs.procurement.resources.budget_limits$get_budget_limits 0x73a29843 "leihs.procurement.resources.budget_limits$get_budget_limits@73a29843"], :update-request #object[leihs.procurement.resources.request$update_request_BANG_ 0x5af43e67 "leihs.procurement.resources.request$update_request_BANG_@5af43e67"], :room #object[leihs.procurement.resources.room$get_room 0x647f1960 "leihs.procurement.resources.room$get_room@647f1960"], :templates #object[leihs.procurement.resources.templates$get_templates 0x65fbfd9e "leihs.procurement.resources.templates$get_templates@65fbfd9e"], :requests-count #object[leihs.procurement.resources.template$requests_count 0x2fc11e2 "leihs.procurement.resources.template$requests_count@2fc11e2"], :user #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x798010dc "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@798010dc"], :requesters-organizations #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x65a8b295 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@65a8b295"], :change-request-category #object[leihs.procurement.resources.request$change_category_BANG_ 0x5f05b4b3 "leihs.procurement.resources.request$change_category_BANG_@5f05b4b3"], :users #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x3d94cdb0 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@3d94cdb0"], :new-request #object[leihs.procurement.resources.request$get_new 0x44eb2c2e "leihs.procurement.resources.request$get_new@44eb2c2e"], :budget-periods #object[clojure.lang.AFunction$1 0x6477123c "clojure.lang.AFunction$1@6477123c"], :model #object[leihs.procurement.resources.model$get_model 0x16a5922d "leihs.procurement.resources.model$get_model@16a5922d"]}
2023-12-19T00:09:19.346Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-19T00:09:19.851Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-19T00:09:19.854Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x10b88c8a "taoensso.timbre$default_output_fn@10b88c8a"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x20ce4909 "taoensso.timbre.appenders.core$println_appender$fn__3459@20ce4909"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-19T00:09:19.855Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-19T00:09:19.867Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 52776, :repl-port-file ".nrepl-port"}
2023-12-19T00:09:19.868Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  52776 localhost
2023-12-19T00:09:19.888Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-19T00:09:19.895Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 52776, :repl-port-file .nrepl-port}
2023-12-19T00:09:19.896Z NX-41294 INFO [leihs.core.shutdown:20] - PID 99456
2023-12-19T00:09:19.907Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-19T00:09:19.973Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-19T00:09:19.975Z NX-41294 INFO [leihs.core.db:222] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-19T00:09:19.980Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-19T00:09:20.052Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@56089ff9
2023-12-19T00:09:20.059Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-19T00:09:20.059Z NX-41294 INFO [leihs.core.db:224] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x19a7dce6 "HikariDataSource (db-pool)"]}
2023-12-19T00:09:20.060Z NX-41294 INFO [leihs.core.db:225] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
>o> init-ds-next
2023-12-19T00:09:20.074Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-19T00:09:20.090Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1b94c8b3
2023-12-19T00:09:20.091Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-19T00:09:20.096Z NX-41294 INFO [leihs.core.db:227] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3737396b "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x626d3973 "next.jdbc.result_set$as_unqualified_lower_maps@626d3973"]}}
>o> wrap-tx
2023-12-19T00:09:20.104Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x69d7c457 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x373b2f60 "java.util.concurrent.ThreadPoolExecutor@373b2f60[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-19T00:09:20.115Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>oo> authenticate
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__45936 0x795d02aa leihs.core.locale$wrap$fn__45936@795d02aa]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 24657569903750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3737396b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x626d3973 next.jdbc.result_set$as_unqualified_lower_maps@626d3973]}}, :query-params-raw {}, :route-params nil, :headers {accept */*, accept-encoding gzip;q=1.0,deflate;q=0.6,identity;q=0.3, host localhost:3230, user-agent Faraday v2.7.1}, :async-channel #object[org.httpkit.server.AsyncChannel 0xf3d62ec /127.0.0.1:3230<->/127.0.0.1:51540], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x19a7dce6 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6c3cc9b1 compojure.core$routes$fn__27950@6c3cc9b1], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x3737396b HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x626d3973 next.jdbc.result_set$as_unqualified_lower_maps@626d3973]}}
>oo> tx next.jdbc.default_options.DefaultOptions
>oo> auth-entity nil
2023-12-19T00:09:37.163Z NX-41294 DEBUG [leihs.procurement.permissions.user:?] - (sql-format (sql/select [[:exists (-> (sql/select [true :exists]) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id [:cast (:user_id auth-entity) :uuid]]))]])) => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-19T00:09:37.163Z NX-41294 DEBUG [leihs.procurement.permissions.user:40] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
2023-12-19T00:09:37.165Z NX-41294 DEBUG [leihs.procurement.permissions.user:41] - result => {:exists false}
>o> admin? {:exists false}
2023-12-19T00:09:37.166Z NX-41294 DEBUG [leihs.procurement.permissions.user:44] - (:exists result) => false
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-19T00:09:37.167Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
2023-12-19T00:09:37.185Z NX-41294 DEBUG [leihs.procurement.permissions.user:84] - result => {:result false}
>o> inspector? {:result false}
2023-12-19T00:09:37.186Z NX-41294 DEBUG [leihs.procurement.permissions.user:87] - (:result result) => false
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-19T00:09:37.188Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
2023-12-19T00:09:37.192Z NX-41294 DEBUG [leihs.procurement.permissions.user:107] - result => {:result false}
>o> viewer? {:result false}
2023-12-19T00:09:37.192Z NX-41294 DEBUG [leihs.procurement.permissions.user:110] - (:result result) => false
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-19T00:09:37.193Z NX-41294 DEBUG [leihs.procurement.permissions.user:190] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
2023-12-19T00:09:37.204Z NX-41294 DEBUG [leihs.procurement.permissions.user:191] - result => {:exists false}
>o> requester?? {:exists false}
2023-12-19T00:09:37.204Z NX-41294 DEBUG [leihs.procurement.permissions.user:194] - (:exists result) => false
>myprint>  requester false
>oo> authenticate
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__45936 0x795d02aa leihs.core.locale$wrap$fn__45936@795d02aa]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value a8b1eff0-2981-413d-86d0-c84b2fc90e1b}}, :remote-addr 127.0.0.1, :start-time 24657813171166, :params {:password password, :user burton_trantow@greenfelder.info}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x3c6d186c HikariProxyConnection@1013782636 wrapping org.postgresql.jdbc.PgConnection@1b94c8b3], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x626d3973 next.jdbc.result_set$as_unqualified_lower_maps@626d3973]}}, :query-params-raw {}, :route-params nil, :headers {accept */*, accept-encoding gzip;q=1.0,deflate;q=0.6,identity;q=0.3, content-length 56, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=a8b1eff0-2981-413d-86d0-c84b2fc90e1b, host localhost:3230, user-agent Faraday v2.7.1, x-csrf-token a8b1eff0-2981-413d-86d0-c84b2fc90e1b}, :async-channel #object[org.httpkit.server.AsyncChannel 0x103228db /127.0.0.1:3230<->/127.0.0.1:51542], :server-port 3230, :params-raw {:password password, :user burton_trantow@greenfelder.info}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x19a7dce6 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x574cacc2 HikariProxyConnection@1464642754 wrapping org.postgresql.jdbc.PgConnection@56089ff9], :level 1, :rollback #object[clojure.lang.Atom 0x723fcc7a {:status :ready, :val false}]}, :content-length 56, :form-params {:password password, :user burton_trantow@greenfelder.info}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:password password, :user burton_trantow@greenfelder.info}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x53294c82 BytesInputStream[len=56]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x6c3cc9b1 compojure.core$routes$fn__27950@6c3cc9b1], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x3c6d186c HikariProxyConnection@1013782636 wrapping org.postgresql.jdbc.PgConnection@1b94c8b3], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x626d3973 next.jdbc.result_set$as_unqualified_lower_maps@626d3973]}}
>oo> tx next.jdbc.default_options.DefaultOptions
>oo> auth-entity nil
2023-12-19T00:09:37.348Z NX-41294 DEBUG [leihs.procurement.permissions.user:?] - (sql-format (sql/select [[:exists (-> (sql/select [true :exists]) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id [:cast (:user_id auth-entity) :uuid]]))]])) => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-19T00:09:37.348Z NX-41294 DEBUG [leihs.procurement.permissions.user:40] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
2023-12-19T00:09:37.349Z NX-41294 DEBUG [leihs.procurement.permissions.user:41] - result => {:exists false}
>o> admin? {:exists false}
2023-12-19T00:09:37.349Z NX-41294 DEBUG [leihs.procurement.permissions.user:44] - (:exists result) => false
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-19T00:09:37.349Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
2023-12-19T00:09:37.350Z NX-41294 DEBUG [leihs.procurement.permissions.user:84] - result => {:result false}
>o> inspector? {:result false}
2023-12-19T00:09:37.350Z NX-41294 DEBUG [leihs.procurement.permissions.user:87] - (:result result) => false
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-19T00:09:37.350Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
2023-12-19T00:09:37.351Z NX-41294 DEBUG [leihs.procurement.permissions.user:107] - result => {:result false}
>o> viewer? {:result false}
2023-12-19T00:09:37.351Z NX-41294 DEBUG [leihs.procurement.permissions.user:110] - (:result result) => false
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-19T00:09:37.351Z NX-41294 DEBUG [leihs.procurement.permissions.user:190] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
2023-12-19T00:09:37.351Z NX-41294 DEBUG [leihs.procurement.permissions.user:191] - result => {:exists false}
>o> requester?? {:exists false}
2023-12-19T00:09:37.352Z NX-41294 DEBUG [leihs.procurement.permissions.user:194] - (:exists result) => false
>myprint>  requester false
>o> utils.helpers / my-cast  {:user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :token_hash f18165f4d19c6dafdfd24a8dac93ec833d421808db78fc9bfd4d90d4ee0d540c, :authentication_system_id password, :meta_data {"user_agent":"Faraday v2.7.1","remote_addr":"127.0.0.1"}}
>o> upload::metadata
2023-12-19T00:09:37.376Z NX-41294 DEBUG [leihs.procurement.utils.helpers:153] - data => {:user_id [[:cast #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7" :uuid]], :token_hash "f18165f4d19c6dafdfd24a8dac93ec833d421808db78fc9bfd4d90d4ee0d540c", :authentication_system_id "password", :meta_data [[:cast "{\"user_agent\":\"Faraday v2.7.1\",\"remote_addr\":\"127.0.0.1\"}" :jsonb]]}
>oo> user-session {:id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :token_hash f18165f4d19c6dafdfd24a8dac93ec833d421808db78fc9bfd4d90d4ee0d540c, :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :delegation_id nil, :created_at #inst "2023-12-19T00:09:37.340376000-00:00", :meta_data {:user_agent Faraday v2.7.1, :remote_addr 127.0.0.1}, :authentication_system_id password}
>oo> authenticate
>o> session-token d63b684b-ece6-457a-96c4-a8577e976db6
>o> query [SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT COUNT(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT COUNT(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = (ENCODE((DIGEST(?, ?)), ?))) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND (account_enabled = TRUE) 0 d63b684b-ece6-457a-96c4-a8577e976db6 sha256 hex]
>o> user {:email burton_trantow@greenfelder.info, :contracts_count 0, :lastname Becker, :org_id nil, :is_admin false, :login nil, :firstname Lashandra, :user_session_created_at #inst "2023-12-19T00:09:37.340376000-00:00", :id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :user_session_id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email burton_trantow@greenfelder.info, :contracts_count 0, :lastname Becker, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Lashandra, :scope_admin_write false, :user_session_created_at #inst "2023-12-19T00:09:37.340376000-00:00", :id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :user_session_id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :scope_system_admin_read false, :access-rights nil, :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__45936 0x795d02aa leihs.core.locale$wrap$fn__45936@795d02aa]

>> authorize::request > {:authenticated-entity {:email burton_trantow@greenfelder.info, :contracts_count 0, :lastname Becker, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Lashandra, :scope_admin_write false, :user_session_created_at #inst "2023-12-19T00:09:37.340376000-00:00", :id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :user_session_id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :scope_system_admin_read false, :access-rights nil, :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a8b1eff0-2981-413d-86d0-c84b2fc90e1b}, leihs-user-session {:value d63b684b-ece6-457a-96c4-a8577e976db6}}, :remote-addr 127.0.0.1, :start-time 24657951921333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x16079d5a HikariProxyConnection@369597786 wrapping org.postgresql.jdbc.PgConnection@1b94c8b3], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x626d3973 next.jdbc.result_set$as_unqualified_lower_maps@626d3973]}}, :query-params-raw {}, :route-params nil, :headers {accept application/json, accept-encoding gzip;q=1.0,deflate;q=0.6,identity;q=0.3, content-length 505, content-type application/json, cookie leihs-anti-csrf-token=a8b1eff0-2981-413d-86d0-c84b2fc90e1b; leihs-user-session=d63b684b-ece6-457a-96c4-a8577e976db6, host localhost:3230, user-agent Faraday v2.7.1, x-csrf-token a8b1eff0-2981-413d-86d0-c84b2fc90e1b}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1bdd68cf /127.0.0.1:3230<->/127.0.0.1:51544], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x19a7dce6 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x49c7d177 HikariProxyConnection@1237832055 wrapping org.postgresql.jdbc.PgConnection@56089ff9], :level 1, :rollback #object[clojure.lang.Atom 0x6c079aa6 {:status :ready, :val false}]}, :content-length 505, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:query             mutation createRequst($inputData: CreateRequestInput){
              create_request(input_data: $inputData) {
                id
              }
            }
, :variables {:inputData {:article_name new request, :budget_period a4d26240-b285-4d84-86e6-855e82b2e5c9, :category 0095c070-81b6-41a2-b920-1dde75885da1, :requested_quantity 1, :room 95f47ad7-f0fe-477a-a78e-a3bae372b892, :motivation Natus itaque eos maxime., :user ff39ee4a-35b9-43d7-a9d6-88a1639588d3}}}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x46c02731 leihs.procurement.graphql$handler@46c02731], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email burton_trantow@greenfelder.info, :contracts_count 0, :lastname Becker, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Lashandra, :scope_admin_write false, :user_session_created_at #inst "2023-12-19T00:09:37.340376000-00:00", :id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :user_session_id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :scope_system_admin_read false, :access-rights nil, :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x16079d5a HikariProxyConnection@369597786 wrapping org.postgresql.jdbc.PgConnection@1b94c8b3], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x626d3973 next.jdbc.result_set$as_unqualified_lower_maps@626d3973]}}
>oo> tx next.jdbc.default_options.DefaultOptions
>oo> auth-entity {:email burton_trantow@greenfelder.info, :contracts_count 0, :lastname Becker, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Lashandra, :scope_admin_write false, :user_session_created_at #inst "2023-12-19T00:09:37.340376000-00:00", :id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :user_session_id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :scope_system_admin_read false, :access-rights nil, :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-19T00:09:37.523Z NX-41294 DEBUG [leihs.procurement.permissions.user:?] - (sql-format (sql/select [[:exists (-> (sql/select [true :exists]) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id [:cast (:user_id auth-entity) :uuid]]))]])) => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.524Z NX-41294 DEBUG [leihs.procurement.permissions.user:40] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.524Z NX-41294 DEBUG [leihs.procurement.permissions.user:41] - result => {:exists false}
>o> admin? {:exists false}
2023-12-19T00:09:37.525Z NX-41294 DEBUG [leihs.procurement.permissions.user:44] - (:exists result) => false
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.525Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.526Z NX-41294 DEBUG [leihs.procurement.permissions.user:84] - result => {:result true}
>o> inspector? {:result true}
2023-12-19T00:09:37.526Z NX-41294 DEBUG [leihs.procurement.permissions.user:87] - (:result result) => true
>myprint>  inspector true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.526Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.527Z NX-41294 DEBUG [leihs.procurement.permissions.user:107] - result => {:result false}
>o> viewer? {:result false}
2023-12-19T00:09:37.527Z NX-41294 DEBUG [leihs.procurement.permissions.user:110] - (:result result) => false
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.527Z NX-41294 DEBUG [leihs.procurement.permissions.user:190] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.528Z NX-41294 DEBUG [leihs.procurement.permissions.user:191] - result => {:exists true}
>o> requester?? {:exists true}
2023-12-19T00:09:37.528Z NX-41294 DEBUG [leihs.procurement.permissions.user:194] - (:exists result) => true
>myprint>  requester true
>oo> tx next.jdbc.default_options.DefaultOptions
>oo> auth-entity {:email burton_trantow@greenfelder.info, :contracts_count 0, :lastname Becker, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Lashandra, :scope_admin_write false, :user_session_created_at #inst "2023-12-19T00:09:37.340376000-00:00", :id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :user_session_id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :scope_system_admin_read false, :access-rights nil, :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-19T00:09:37.529Z NX-41294 DEBUG [leihs.procurement.permissions.user:?] - (sql-format (sql/select [[:exists (-> (sql/select [true :exists]) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id [:cast (:user_id auth-entity) :uuid]]))]])) => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.529Z NX-41294 DEBUG [leihs.procurement.permissions.user:40] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.529Z NX-41294 DEBUG [leihs.procurement.permissions.user:41] - result => {:exists false}
>o> admin? {:exists false}
2023-12-19T00:09:37.530Z NX-41294 DEBUG [leihs.procurement.permissions.user:44] - (:exists result) => false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.530Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.530Z NX-41294 DEBUG [leihs.procurement.permissions.user:84] - result => {:result true}
>o> inspector? {:result true}
2023-12-19T00:09:37.530Z NX-41294 DEBUG [leihs.procurement.permissions.user:87] - (:result result) => true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.531Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.531Z NX-41294 DEBUG [leihs.procurement.permissions.user:107] - result => {:result false}
>o> viewer? {:result false}
2023-12-19T00:09:37.531Z NX-41294 DEBUG [leihs.procurement.permissions.user:110] - (:result result) => false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.532Z NX-41294 DEBUG [leihs.procurement.permissions.user:190] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7"]
2023-12-19T00:09:37.532Z NX-41294 DEBUG [leihs.procurement.permissions.user:191] - result => {:exists true}
>o> requester?? {:exists true}
2023-12-19T00:09:37.532Z NX-41294 DEBUG [leihs.procurement.permissions.user:194] - (:exists result) => true
>o> ???? handler a
2023-12-19T00:09:37.536Z NX-41294 DEBUG [leihs.procurement.graphql:90] - (->> query (parse-query-with-exception-handling (core-graphql/schema)) graphql-parser/operations :type (= :mutation)) => true
2023-12-19T00:09:37.537Z NX-41294 DEBUG [leihs.procurement.graphql:95] - mutation? => true
pure-handler >> 1g com.zaxxer.hikari.pool.HikariProxyConnection
pure-handler >> 1g next.jdbc.default_options.DefaultOptions
pure-handler >> 1
>o> ??????  pure-handler 2a             mutation createRequst($inputData: CreateRequestInput){
              create_request(input_data: $inputData) {
                id
              }
            }

>o> ??????  pure-handler 2b {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email burton_trantow@greenfelder.info, :contracts_count 0, :lastname Becker, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Lashandra, :scope_admin_write false, :user_session_created_at #inst "2023-12-19T00:09:37.340376000-00:00", :id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :user_session_id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :scope_system_admin_read false, :access-rights nil, :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a8b1eff0-2981-413d-86d0-c84b2fc90e1b}, leihs-user-session {:value d63b684b-ece6-457a-96c4-a8577e976db6}}, :remote-addr 127.0.0.1, :start-time 24657951921333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x16079d5a HikariProxyConnection@369597786 wrapping org.postgresql.jdbc.PgConnection@1b94c8b3], :query-params-raw {}, :route-params nil, :headers {accept application/json, accept-encoding gzip;q=1.0,deflate;q=0.6,identity;q=0.3, content-length 505, content-type application/json, cookie leihs-anti-csrf-token=a8b1eff0-2981-413d-86d0-c84b2fc90e1b; leihs-user-session=d63b684b-ece6-457a-96c4-a8577e976db6, host localhost:3230, user-agent Faraday v2.7.1, x-csrf-token a8b1eff0-2981-413d-86d0-c84b2fc90e1b}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1bdd68cf /127.0.0.1:3230<->/127.0.0.1:51544], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x19a7dce6 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x49c7d177 HikariProxyConnection@1237832055 wrapping org.postgresql.jdbc.PgConnection@56089ff9], :level 1, :rollback #object[clojure.lang.Atom 0x6c079aa6 {:status :ready, :val false}]}, :content-length 505, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:query             mutation createRequst($inputData: CreateRequestInput){
              create_request(input_data: $inputData) {
                id
              }
            }
, :variables {:inputData {:article_name new request, :budget_period a4d26240-b285-4d84-86e6-855e82b2e5c9, :category 0095c070-81b6-41a2-b920-1dde75885da1, :requested_quantity 1, :room 95f47ad7-f0fe-477a-a78e-a3bae372b892, :motivation Natus itaque eos maxime., :user ff39ee4a-35b9-43d7-a9d6-88a1639588d3}}}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x46c02731 leihs.procurement.graphql$handler@46c02731], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>o> ??????  pure-handler 2c clojure.lang.PersistentHashMap
>o> exec-query 1a
graphql query 1b             mutation createRequst($inputData: CreateRequestInput){
              create_request(input_data: $inputData) {
                id
              }
            }
 with variables {:inputData {:article_name new request, :budget_period a4d26240-b285-4d84-86e6-855e82b2e5c9, :category 0095c070-81b6-41a2-b920-1dde75885da1, :requested_quantity 1, :room 95f47ad7-f0fe-477a-a78e-a3bae372b892, :motivation Natus itaque eos maxime., :user ff39ee4a-35b9-43d7-a9d6-88a1639588d3}}
2023-12-19T00:09:37.538Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string =>             mutation createRequst($inputData: CreateRequestInput){
              create_request(input_data: $inputData) {
                id
              }
            }

2023-12-19T00:09:37.539Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:inputData {:article_name "new request", :budget_period "a4d26240-b285-4d84-86e6-855e82b2e5c9", :category "0095c070-81b6-41a2-b920-1dde75885da1", :requested_quantity 1, :room "95f47ad7-f0fe-477a-a78e-a3bae372b892", :motivation "Natus itaque eos maxime.", :user "ff39ee4a-35b9-43d7-a9d6-88a1639588d3"}}
2023-12-19T00:09:37.539Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "burton_trantow@greenfelder.info", :contracts_count 0, :lastname "Becker", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Lashandra", :scope_admin_write false, :user_session_created_at #inst "2023-12-19T00:09:37.340376000-00:00", :id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :user_session_id #uuid "50bdb581-0b85-4e80-a2e9-94c9c51f6744", :scope_system_admin_read false, :access-rights nil, :user_id #uuid "6fa7972b-8162-495b-9c93-bbd9e707faf7", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "a8b1eff0-2981-413d-86d0-c84b2fc90e1b"}, "leihs-user-session" {:value "d63b684b-ece6-457a-96c4-a8577e976db6"}}, :remote-addr "127.0.0.1", :start-time 24657951921333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x16079d5a "HikariProxyConnection@369597786 wrapping org.postgresql.jdbc.PgConnection@1b94c8b3"], :query-params-raw {}, :route-params nil, :headers {"accept" "application/json", "accept-encoding" "gzip;q=1.0,deflate;q=0.6,identity;q=0.3", "content-length" "505", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=a8b1eff0-2981-413d-86d0-c84b2fc90e1b; leihs-user-session=d63b684b-ece6-457a-96c4-a8577e976db6", "host" "localhost:3230", "user-agent" "Faraday v2.7.1", "x-csrf-token" "a8b1eff0-2981-413d-86d0-c84b2fc90e1b"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1bdd68cf "/127.0.0.1:3230<->/127.0.0.1:51544"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x19a7dce6 "HikariDataSource (db-pool)"], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x49c7d177 "HikariProxyConnection@1237832055 wrapping org.postgresql.jdbc.PgConnection@56089ff9"], :level 1, :rollback #object[clojure.lang.Atom 0x6c079aa6 {:status :ready, :val false}]}, :content-length 505, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:query "            mutation createRequst($inputData: CreateRequestInput){\n              create_request(input_data: $inputData) {\n                id\n              }\n            }\n", :variables {:inputData {:article_name "new request", :budget_period "a4d26240-b285-4d84-86e6-855e82b2e5c9", :category "0095c070-81b6-41a2-b920-1dde75885da1", :requested_quantity 1, :room "95f47ad7-f0fe-477a-a78e-a3bae372b892", :motivation "Natus itaque eos maxime.", :user "ff39ee4a-35b9-43d7-a9d6-88a1639588d3"}}}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x46c02731 "leihs.procurement.graphql$handler@46c02731"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>debug> 35
>o> debug> 35 1
>o> debug> 35 2
>o> debug> 35 3
>o> debug> 35 4
>o> get-organization-of-requester 1 com.zaxxer.hikari.pool.HikariProxyConnection
>o> get-organization-of-requester 1 #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x16079d5a HikariProxyConnection@369597786 wrapping org.postgresql.jdbc.PgConnection@1b94c8b3]
2023-12-19T00:09:37.553Z NX-41294 DEBUG [leihs.procurement.resources.requesters-organizations:40] - user-id => ff39ee4a-35b9-43d7-a9d6-88a1639588d3
2023-12-19T00:09:37.554Z NX-41294 DEBUG [leihs.procurement.resources.requesters-organizations:36] - (-> (sql/select :procurement_organizations.*) (sql/from :procurement_requesters_organizations) (sql/join :procurement_organizations [:= :procurement_requesters_organizations.organization_id :procurement_organizations.id]) (sql/where [:= :procurement_requesters_organizations.user_id [:cast (spy user-id) :uuid]]) sql-format) => ["SELECT procurement_organizations.* FROM procurement_requesters_organizations INNER JOIN procurement_organizations ON procurement_requesters_organizations.organization_id = procurement_organizations.id WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)" "ff39ee4a-35b9-43d7-a9d6-88a1639588d3"]
>o> get-organization-of-requester 2 com.zaxxer.hikari.pool.HikariProxyConnection
2023-12-19T00:59:08.705Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=35m18s360ms).
2023-12-19T00:59:08.688Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=35m18s360ms).
2023-12-19T02:22:50.677Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h23m41s991ms).
2023-12-19T02:22:50.675Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h23m41s969ms).
2023-12-19T03:26:10.405Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h3m19s730ms).
2023-12-19T03:26:10.405Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h3m19s727ms).
2023-12-19T04:01:11.156Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=35m751ms).
2023-12-19T04:01:11.158Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=35m754ms).
2023-12-19T05:15:41.448Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h14m30s290ms).
2023-12-19T05:15:41.448Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h14m30s293ms).
2023-12-19T06:29:10.115Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h13m28s666ms).
2023-12-19T06:29:10.117Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h13m28s669ms).
2023-12-19T07:14:32.589Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=45m22s471ms).
2023-12-19T07:14:32.589Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=45m22s474ms).
2023-12-19T08:53:27.437Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m24s2ms).
2023-12-19T08:53:27.441Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=3m24s).
