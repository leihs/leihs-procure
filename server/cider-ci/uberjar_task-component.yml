scripts:
  build-uberjar:
    exclusive_executor_resource: build-leihs-admin-jar
    body: |
      #!/usr/bin/env bash
      set -eux
      cd server
      export LEIN_SNAPSHOTS_IN_RELEASE=yes
      DIGEST=$(git log -n 1 HEAD --pretty=%T)
      LEIN_UBERJAR_FILE="/tmp/leihs-procurement_${DIGEST}.jar"
      if [ -f "${LEIN_UBERJAR_FILE}" ];then
        echo " ${LEIN_UBERJAR_FILE} exists"
      else
        lein with-profile test uberjar
        mv "target/uberjar/leihs-procurement.jar" "${LEIN_UBERJAR_FILE}"
      fi
      mkdir -p target
      ln -s "$LEIN_UBERJAR_FILE" "target/leihs-procurement.jar"
