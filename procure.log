# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-12-08T14:58:49.188Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-08T14:58:49.853Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-08T14:58:49.860Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x79d25465 "taoensso.timbre$default_output_fn@79d25465"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x2a2c0286 "taoensso.timbre.appenders.core$println_appender$fn__3459@2a2c0286"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-08T14:58:49.862Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-08T14:58:49.873Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 24530, :repl-port-file ".nrepl-port"}
2023-12-08T14:58:49.876Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  24530 localhost
2023-12-08T14:58:49.910Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-08T14:58:49.913Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 24530, :repl-port-file .nrepl-port}
2023-12-08T14:58:49.914Z NX-41294 INFO [leihs.core.shutdown:20] - PID 34135
2023-12-08T14:58:49.944Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-08T14:58:50.003Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-08T14:58:50.005Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-08T14:58:50.010Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-08T14:58:50.095Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@5c9713f1
2023-12-08T14:58:50.101Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-08T14:58:50.101Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaabc638 "HikariDataSource (db-pool)"]}
2023-12-08T14:58:50.102Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-08T14:58:50.116Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-08T14:58:50.126Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@468f547e
2023-12-08T14:58:50.127Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-08T14:58:50.132Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x5b19ebb6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2b9ad46 "next.jdbc.result_set$as_unqualified_lower_maps@2b9ad46"]}}
2023-12-08T14:58:50.139Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x48dc2732 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x45bef69f "java.util.concurrent.ThreadPoolExecutor@45bef69f[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-08T14:58:50.149Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T11:45:34.313878Z", :id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :user_session_id #uuid "b9f84747-f458-427c-abb9-170a3febef96", :scope_system_admin_read false, :access-rights (), :user_id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x38d139c9 leihs.core.locale$wrap$fn__44405@38d139c9]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T11:45:34.313878Z", :id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :user_session_id #uuid "b9f84747-f458-427c-abb9-170a3febef96", :scope_system_admin_read false, :access-rights (), :user_id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 83f8530a-692a-47bb-995b-a81201490d7b}, leihs-user-session {:value 408912e4-58ae-4d10-96f7-830c2f44e596}}, :remote-addr 127.0.0.1, :start-time 178935102151500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x5b19ebb6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2b9ad46 next.jdbc.result_set$as_unqualified_lower_maps@2b9ad46]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=83f8530a-692a-47bb-995b-a81201490d7b; leihs-user-session=408912e4-58ae-4d10-96f7-830c2f44e596, content-length 600, referer http://localhost:3230/procure/templates/edit, connection keep-alive, x-csrf-token 83f8530a-692a-47bb-995b-a81201490d7b, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, postman-token a2ff9381-0ff1-4c9d-9169-914d9510430e}, :async-channel #object[org.httpkit.server.AsyncChannel 0x70737b8d /127.0.0.1:3230<->/127.0.0.1:55162], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaabc638 HikariDataSource (db-pool)]}, :content-length 600, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:query query adminTemplates {
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      templates {
        id
        article_name
        article_number
        model {
          id
          product
          version
          __typename
        }
        requests_count
        is_archived
        price_cents
        price_currency
        supplier_name
        supplier {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}
, :operationName adminTemplates}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x56f140b4 leihs.procurement.graphql$handler@56f140b4], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T11:45:34.313878Z", :id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :user_session_id #uuid "b9f84747-f458-427c-abb9-170a3febef96", :scope_system_admin_read false, :access-rights (), :user_id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaabc638 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector true
>myprint>  viewer false
>myprint>  requester true
2023-12-08T14:59:13.007Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T14:59:13.014Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables nil
2023-12-08T14:59:13.032Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query adminTemplates {
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      templates {
        id
        article_name
        article_number
        model {
          id
          product
          version
          __typename
        }
        requests_count
        is_archived
        price_cents
        price_currency
        supplier_name
        supplier {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

2023-12-08T14:59:13.032Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => nil
2023-12-08T14:59:13.033Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T11:45:34.313878Z", :id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :user_session_id #uuid "b9f84747-f458-427c-abb9-170a3febef96", :scope_system_admin_read false, :access-rights (), :user_id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "83f8530a-692a-47bb-995b-a81201490d7b"}, "leihs-user-session" {:value "408912e4-58ae-4d10-96f7-830c2f44e596"}}, :remote-addr "127.0.0.1", :start-time 178935102151500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x5b19ebb6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2b9ad46 "next.jdbc.result_set$as_unqualified_lower_maps@2b9ad46"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=83f8530a-692a-47bb-995b-a81201490d7b; leihs-user-session=408912e4-58ae-4d10-96f7-830c2f44e596", "content-length" "600", "referer" "http://localhost:3230/procure/templates/edit", "connection" "keep-alive", "x-csrf-token" "83f8530a-692a-47bb-995b-a81201490d7b", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors", "postman-token" "a2ff9381-0ff1-4c9d-9169-914d9510430e"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x70737b8d "/127.0.0.1:3230<->/127.0.0.1:55162"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaabc638 "HikariDataSource (db-pool)"]}, :content-length 600, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:query "query adminTemplates {\n  main_categories {\n    id\n    name\n    image_url\n    categories {\n      id\n      name\n      templates {\n        id\n        article_name\n        article_number\n        model {\n          id\n          product\n          version\n          __typename\n        }\n        requests_count\n        is_archived\n        price_cents\n        price_currency\n        supplier_name\n        supplier {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n", :operationName "adminTemplates"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x56f140b4 "leihs.procurement.graphql$handler@56f140b4"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>debug 2
>debug 3
2023-12-08T14:59:13.048Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format main-categories-base-query) => ["SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC"]
>debug 4
>debug 5 {:id #uuid "ec9d0619-6f98-4cd5-81dc-0a76fe4f8d22", :name Geisha}
>debug 5a id #uuid "ec9d0619-6f98-4cd5-81dc-0a76fe4f8d22"
2023-12-08T14:59:13.055Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format (image/image-query-for-main-category (:id mc))) => ["SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?" #uuid "ec9d0619-6f98-4cd5-81dc-0a76fe4f8d22"]
>debug 5b nil
2023-12-08T14:59:13.058Z NX-41294 DEBUG [leihs.procurement.resources.categories:?] - (sql/format (sql/merge-where categories-base-query [:= :procurement_categories.main_category_id main-cat-id])) => ["SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC" #uuid "ec9d0619-6f98-4cd5-81dc-0a76fe4f8d22"]
>oo> templates::get-templates2 _> HERE value contains :id??) #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d" {:id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d", :name Ennarea, :main_category_id #uuid "ec9d0619-6f98-4cd5-81dc-0a76fe4f8d22", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>oo> templates::get-templates1a ?broken-base-query? {:select (:procurement_templates.*), :from (:procurement_templates), :left-join (:models [:= :models.id :procurement_templates.model_id]), :order-by (#sql/call [:concat (#sql/call [:lower #sql/call [:coalesce :procurement_templates.article_name ]] #sql/call [:lower #sql/call [:coalesce :models.product ]] #sql/call [:lower #sql/call [:coalesce :models.version ]])])}
>oo> templates::get-templates1b ?broken-base-query? [SELECT procurement_templates.* FROM procurement_templates  LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY concat((lower(coalesce(procurement_templates.article_name, ?)), lower(coalesce(models.product, ?)), lower(coalesce(models.version, ?))))   ]
>oo> templates::get-templates1c [SELECT procurement_templates.* FROM procurement_templates  LEFT JOIN models ON models.id = procurement_templates.model_id WHERE procurement_templates.category_id = ? ORDER BY concat((lower(coalesce(procurement_templates.article_name, ?)), lower(coalesce(models.product, ?)), lower(coalesce(models.version, ?)))) #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"   ]
2023-12-08T14:59:13.070Z NX-41294 DEBUG [leihs.procurement.resources.templates:42] - query => {:select (:procurement_templates.*), :from (:procurement_templates), :left-join (:models [:= :models.id :procurement_templates.model_id]), :order-by (#sql/call [:concat (#sql/call [:lower #sql/call [:coalesce :procurement_templates.article_name ""]] #sql/call [:lower #sql/call [:coalesce :models.product ""]] #sql/call [:lower #sql/call [:coalesce :models.version ""]])]), :where [:= :procurement_templates.category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"]}
2023-12-08T14:59:13.071Z NX-41294 DEBUG [leihs.procurement.resources.templates:?] - (sql/format (spy query)) => ["SELECT procurement_templates.* FROM procurement_templates  LEFT JOIN models ON models.id = procurement_templates.model_id WHERE procurement_templates.category_id = ? ORDER BY concat((lower(coalesce(procurement_templates.article_name, ?)), lower(coalesce(models.product, ?)), lower(coalesce(models.version, ?))))" #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d" "" "" ""]
2023-12-08T14:59:13.085Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-08T14:59:13.085Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil
2023-12-08T14:59:13.086Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-08T14:59:13.087Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models  WHERE models.id IS NULL"]
2023-12-08T14:59:13.090Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - value => {:article_number "Mate 9", :price_cents 8, :article_name "Galaxy S1", :is_archived true, :supplier_name "Sony", :model_id nil, :supplier_id nil, :id #uuid "85fc2e2b-4a46-4be4-8089-d0e2aa68e254", :price_currency "USD", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
2023-12-08T14:59:13.090Z NX-41294 DEBUG [leihs.procurement.resources.supplier:41] - value => {:article_number "Mate 9", :price_cents 8, :article_name "Galaxy S1", :is_archived true, :supplier_name "Sony", :model_id nil, :supplier_id nil, :id #uuid "85fc2e2b-4a46-4be4-8089-d0e2aa68e254", :price_currency "USD", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
>o> tocheck suppliers.id= nil
2023-12-08T14:59:13.091Z NX-41294 DEBUG [leihs.procurement.resources.supplier:27] - id => nil
2023-12-08T14:59:13.091Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql/format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers  WHERE suppliers.id = CAST(NULL AS uuid)"]
2023-12-08T14:59:13.094Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-08T14:59:13.094Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil
2023-12-08T14:59:13.094Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-08T14:59:13.094Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models  WHERE models.id IS NULL"]
2023-12-08T14:59:13.097Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - value => {:article_number "OnePlus 5T", :price_cents 83, :article_name "Galaxy S9", :is_archived true, :supplier_name "Panasonic", :model_id nil, :supplier_id nil, :id #uuid "a2859f66-be3c-46cd-85df-5cf294eefab8", :price_currency "PLN", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
2023-12-08T14:59:13.098Z NX-41294 DEBUG [leihs.procurement.resources.supplier:41] - value => {:article_number "OnePlus 5T", :price_cents 83, :article_name "Galaxy S9", :is_archived true, :supplier_name "Panasonic", :model_id nil, :supplier_id nil, :id #uuid "a2859f66-be3c-46cd-85df-5cf294eefab8", :price_currency "PLN", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
>o> tocheck suppliers.id= nil
2023-12-08T14:59:13.098Z NX-41294 DEBUG [leihs.procurement.resources.supplier:27] - id => nil
2023-12-08T14:59:13.098Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql/format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers  WHERE suppliers.id = CAST(NULL AS uuid)"]
2023-12-08T14:59:13.100Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-08T14:59:13.100Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil
2023-12-08T14:59:13.100Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-08T14:59:13.100Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models  WHERE models.id IS NULL"]
2023-12-08T14:59:13.102Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - value => {:article_number "iPhone 5S", :price_cents 53, :article_name "Mi 8", :is_archived true, :supplier_name "Polaroid", :model_id nil, :supplier_id nil, :id #uuid "ae10df63-7f80-4f08-8255-b1d9eb371f33", :price_currency "CAD", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
2023-12-08T14:59:13.102Z NX-41294 DEBUG [leihs.procurement.resources.supplier:41] - value => {:article_number "iPhone 5S", :price_cents 53, :article_name "Mi 8", :is_archived true, :supplier_name "Polaroid", :model_id nil, :supplier_id nil, :id #uuid "ae10df63-7f80-4f08-8255-b1d9eb371f33", :price_currency "CAD", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
>o> tocheck suppliers.id= nil
2023-12-08T14:59:13.102Z NX-41294 DEBUG [leihs.procurement.resources.supplier:27] - id => nil
2023-12-08T14:59:13.103Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql/format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers  WHERE suppliers.id = CAST(NULL AS uuid)"]
2023-12-08T14:59:13.104Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-08T14:59:13.104Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil
2023-12-08T14:59:13.104Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-08T14:59:13.104Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models  WHERE models.id IS NULL"]
2023-12-08T14:59:13.106Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - value => {:article_number "Galaxy S7", :price_cents 80, :article_name "Pocophone F1", :is_archived true, :supplier_name "Benq", :model_id nil, :supplier_id nil, :id #uuid "dcb9f1c5-3ccb-416f-be1d-a0ada6f5e243", :price_currency "INR", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
2023-12-08T14:59:13.106Z NX-41294 DEBUG [leihs.procurement.resources.supplier:41] - value => {:article_number "Galaxy S7", :price_cents 80, :article_name "Pocophone F1", :is_archived true, :supplier_name "Benq", :model_id nil, :supplier_id nil, :id #uuid "dcb9f1c5-3ccb-416f-be1d-a0ada6f5e243", :price_currency "INR", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
>o> tocheck suppliers.id= nil
2023-12-08T14:59:13.106Z NX-41294 DEBUG [leihs.procurement.resources.supplier:27] - id => nil
2023-12-08T14:59:13.106Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql/format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers  WHERE suppliers.id = CAST(NULL AS uuid)"]
2023-12-08T14:59:13.108Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-08T14:59:13.108Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil
2023-12-08T14:59:13.108Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-08T14:59:13.109Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models  WHERE models.id IS NULL"]
2023-12-08T14:59:13.110Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - value => {:article_number "Galaxy S7 Edge", :price_cents 9, :article_name "Redmi Note 6 Pro", :is_archived true, :supplier_name "Leica", :model_id nil, :supplier_id nil, :id #uuid "18d8dd22-d224-4323-aa50-302f76df8732", :price_currency "TJS", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
2023-12-08T14:59:13.110Z NX-41294 DEBUG [leihs.procurement.resources.supplier:41] - value => {:article_number "Galaxy S7 Edge", :price_cents 9, :article_name "Redmi Note 6 Pro", :is_archived true, :supplier_name "Leica", :model_id nil, :supplier_id nil, :id #uuid "18d8dd22-d224-4323-aa50-302f76df8732", :price_currency "TJS", :category_id #uuid "8598b76e-31f0-4924-9174-f8ae7b8e003d"}
>o> tocheck suppliers.id= nil
2023-12-08T14:59:13.110Z NX-41294 DEBUG [leihs.procurement.resources.supplier:27] - id => nil
2023-12-08T14:59:13.111Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql/format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers  WHERE suppliers.id = CAST(NULL AS uuid)"]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T11:45:34.313878Z", :id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :user_session_id #uuid "b9f84747-f458-427c-abb9-170a3febef96", :scope_system_admin_read false, :access-rights (), :user_id #uuid "3c5fe2fd-6a6a-4619-90e3-3eb6336ab663", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 83f8530a-692a-47bb-995b-a81201490d7b}, leihs-user-session {:value 408912e4-58ae-4d10-96f7-830c2f44e596}}, :remote-addr 127.0.0.1, :start-time 178935102151500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x5b19ebb6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2b9ad46 next.jdbc.result_set$as_unqualified_lower_maps@2b9ad46]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=83f8530a-692a-47bb-995b-a81201490d7b; leihs-user-session=408912e4-58ae-4d10-96f7-830c2f44e596, content-length 600, referer http://localhost:3230/procure/templates/edit, connection keep-alive, x-csrf-token 83f8530a-692a-47bb-995b-a81201490d7b, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, postman-token a2ff9381-0ff1-4c9d-9169-914d9510430e}, :async-channel #object[org.httpkit.server.AsyncChannel 0x70737b8d /127.0.0.1:3230<->/127.0.0.1:55162], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xaabc638 HikariDataSource (db-pool)]}, :content-length 600, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:query query adminTemplates {
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      templates {
        id
        article_name
        article_number
        model {
          id
          product
          version
          __typename
        }
        requests_count
        is_archived
        price_cents
        price_currency
        supplier_name
        supplier {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}
, :operationName adminTemplates}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x56f140b4 leihs.procurement.graphql$handler@56f140b4], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-08T11:45:34.313878Z","id":"3c5fe2fd-6a6a-4619-90e3-3eb6336ab663","user_session_id":"b9f84747-f458-427c-abb9-170a3febef96","scope_system_admin_read":false,"access-rights":[],"user_id":"3c5fe2fd-6a6a-4619-90e3-3eb6336ab663","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"83f8530a-692a-47bb-995b-a81201490d7b"},"leihs-user-session":{"value":"408912e4-58ae-4d10-96f7-830c2f44e596"}},"remote-addr":"127.0.0.1","start-time":178935102151500,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=83f8530a-692a-47bb-995b-a81201490d7b; leihs-user-session=408912e4-58ae-4d10-96f7-830c2f44e596","content-length":"600","referer":"http:\/\/localhost:3230\/procure\/templates\/edit","connection":"keep-alive","x-csrf-token":"83f8530a-692a-47bb-995b-a81201490d7b","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","postman-token":"a2ff9381-0ff1-4c9d-9169-914d9510430e"},"server-port":3230,"params-raw":{},"content-length":600,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"query":"query adminTemplates {\n  main_categories {\n    id\n    name\n    image_url\n    categories {\n      id\n      name\n      templates {\n        id\n        article_name\n        article_number\n        model {\n          id\n          product\n          version\n          __typename\n        }\n        requests_count\n        is_archived\n        price_cents\n        price_currency\n        supplier_name\n        supplier {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n","operationName":"adminTemplates"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query adminTemplates {
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      templates {
        id
        article_name
        article_number
        model {
          id
          product
          version
          __typename
        }
        requests_count
        is_archived
        price_cents
        price_currency
        supplier_name
        supplier {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:main_categories [#ordered/map ([:id ec9d0619-6f98-4cd5-81dc-0a76fe4f8d22] [:name Geisha] [:image_url nil] [:categories [#ordered/map ([:id 8598b76e-31f0-4924-9174-f8ae7b8e003d] [:name Ennarea] [:templates [#ordered/map ([:id 85fc2e2b-4a46-4be4-8089-d0e2aa68e254] [:article_name Galaxy S1] [:article_number Mate 9] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 8] [:price_currency USD] [:supplier_name Sony] [:supplier nil] [:__typename :Template]) #ordered/map ([:id a2859f66-be3c-46cd-85df-5cf294eefab8] [:article_name Galaxy S9] [:article_number OnePlus 5T] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 83] [:price_currency PLN] [:supplier_name Panasonic] [:supplier nil] [:__typename :Template]) #ordered/map ([:id ae10df63-7f80-4f08-8255-b1d9eb371f33] [:article_name Mi 8] [:article_number iPhone 5S] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 53] [:price_currency CAD] [:supplier_name Polaroid] [:supplier nil] [:__typename :Template]) #ordered/map ([:id dcb9f1c5-3ccb-416f-be1d-a0ada6f5e243] [:article_name Pocophone F1] [:article_number Galaxy S7] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 80] [:price_currency INR] [:supplier_name Benq] [:supplier nil] [:__typename :Template]) #ordered/map ([:id 18d8dd22-d224-4323-aa50-302f76df8732] [:article_name Redmi Note 6 Pro] [:article_number Galaxy S7 Edge] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 9] [:price_currency TJS] [:supplier_name Leica] [:supplier nil] [:__typename :Template])]] [:__typename :Category])]] [:__typename :MainCategory])]])}
2023-12-08T14:59:13.116Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:main_categories [#ordered/map ([:id "ec9d0619-6f98-4cd5-81dc-0a76fe4f8d22"] [:name "Geisha"] [:image_url nil] [:categories [#ordered/map ([:id "8598b76e-31f0-4924-9174-f8ae7b8e003d"] [:name "Ennarea"] [:templates [#ordered/map ([:id "85fc2e2b-4a46-4be4-8089-d0e2aa68e254"] [:article_name "Galaxy S1"] [:article_number "Mate 9"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 8] [:price_currency "USD"] [:supplier_name "Sony"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "a2859f66-be3c-46cd-85df-5cf294eefab8"] [:article_name "Galaxy S9"] [:article_number "OnePlus 5T"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 83] [:price_currency "PLN"] [:supplier_name "Panasonic"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "ae10df63-7f80-4f08-8255-b1d9eb371f33"] [:article_name "Mi 8"] [:article_number "iPhone 5S"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 53] [:price_currency "CAD"] [:supplier_name "Polaroid"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "dcb9f1c5-3ccb-416f-be1d-a0ada6f5e243"] [:article_name "Pocophone F1"] [:article_number "Galaxy S7"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 80] [:price_currency "INR"] [:supplier_name "Benq"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "18d8dd22-d224-4323-aa50-302f76df8732"] [:article_name "Redmi Note 6 Pro"] [:article_number "Galaxy S7 Edge"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 9] [:price_currency "TJS"] [:supplier_name "Leica"] [:supplier nil] [:__typename :Template])]] [:__typename :Category])]] [:__typename :MainCategory])]])}
2023-12-08T14:59:13.117Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:main_categories [#ordered/map ([:id "ec9d0619-6f98-4cd5-81dc-0a76fe4f8d22"] [:name "Geisha"] [:image_url nil] [:categories [#ordered/map ([:id "8598b76e-31f0-4924-9174-f8ae7b8e003d"] [:name "Ennarea"] [:templates [#ordered/map ([:id "85fc2e2b-4a46-4be4-8089-d0e2aa68e254"] [:article_name "Galaxy S1"] [:article_number "Mate 9"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 8] [:price_currency "USD"] [:supplier_name "Sony"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "a2859f66-be3c-46cd-85df-5cf294eefab8"] [:article_name "Galaxy S9"] [:article_number "OnePlus 5T"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 83] [:price_currency "PLN"] [:supplier_name "Panasonic"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "ae10df63-7f80-4f08-8255-b1d9eb371f33"] [:article_name "Mi 8"] [:article_number "iPhone 5S"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 53] [:price_currency "CAD"] [:supplier_name "Polaroid"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "dcb9f1c5-3ccb-416f-be1d-a0ada6f5e243"] [:article_name "Pocophone F1"] [:article_number "Galaxy S7"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 80] [:price_currency "INR"] [:supplier_name "Benq"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "18d8dd22-d224-4323-aa50-302f76df8732"] [:article_name "Redmi Note 6 Pro"] [:article_number "Galaxy S7 Edge"] [:model nil] [:requests_count 1] [:is_archived true] [:price_cents 9] [:price_currency "TJS"] [:supplier_name "Leica"] [:supplier nil] [:__typename :Template])]] [:__typename :Category])]] [:__typename :MainCategory])]])}}
