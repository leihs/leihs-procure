# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-12-22T10:31:07.452Z NX-41294 DEBUG [leihs.procurement.permissions.user:175] - (defn requester? [tx auth-entity] (let [query (-> (sql/select [[:exists (-> (sql/select [true :exists]) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id [:cast (:user_id auth-entity) :uuid]]))]]) sql-format) p (println ">o> requester??" query) result (jdbc/execute-one! tx (spy query)) p (println ">o> requester??" (spy result))] (spy (:exists result)))) => #'leihs.procurement.permissions.user/requester?
>oo >tocheck users3 sql-order-users, sqlmap= {:select [:users.id :users.firstname :users.lastname], :from [:users]}
>oo >tocheck users3 sql-order-users, sqlmap= {:select [:users.*], :from [:users], :where [:in :users.id {:select [:procurement_admins.user_id], :from [:procurement_admins]}]}
2023-12-22T10:31:08.070Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/update-budget-periods!
2023-12-22T10:31:08.072Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/update-budget-periods!
2023-12-22T10:31:08.073Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/insert-test-period-budget
2023-12-22T10:31:08.073Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/insert-test-period-budget
2023-12-22T10:31:08.073Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/get-budget-periods
2023-12-22T10:31:08.073Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/get-budget-periods
2023-12-22T10:31:08.074Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/delete-budget-periods-not-in!
2023-12-22T10:31:08.074Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/delete-budget-periods-not-in!
2023-12-22T10:31:08.074Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/parse-utc-string
2023-12-22T10:31:08.075Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/parse-utc-string
2023-12-22T10:31:08.075Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/parse-and-format-offset-date-time
2023-12-22T10:31:08.075Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/parse-and-format-offset-date-time
2023-12-22T10:31:08.076Z NX-41294 DEBUG [logbug.debug:326] - wrapping for debugging:  #'leihs.procurement.resources.budget-periods/budget-periods-query
2023-12-22T10:31:08.076Z NX-41294 DEBUG [logbug.debug:326] - wrapping for remember #'leihs.procurement.resources.budget-periods/budget-periods-query
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
2023-12-22T10:31:08.609Z NX-41294 DEBUG [leihs.procurement.resources.request:214] - (-> (sql/select [[:raw (str "DISTINCT ON (procurement_requests.id, " conc ") procurement_requests.*")]]) (sql/from :procurement_requests) (sql/left-join :models [:= :models.id :procurement_requests.model_id]) (sql/order-by [[:raw conc]])) => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]]}
>oo> templates::templates-base-query ERROR?
2023-12-22T10:31:08.698Z NX-41294 DEBUG [leihs.procurement.resources.templates:29] - (-> (sql/select :procurement_templates.*) (sql/from :procurement_templates) (sql/left-join :models [:= :models.id :procurement_templates.model_id]) (sql/order-by [[:concat (->> [:procurement_templates.article_name :models.product :models.version] (map (fn* [p1__45692#] (->> [:lower [:coalesce p1__45692# ""]]))))]])) => {:select [:procurement_templates.*], :from [:procurement_templates], :left-join [:models [:= :models.id :procurement_templates.model_id]], :order-by [[[:concat ([:lower [:coalesce :procurement_templates.article_name ""]] [:lower [:coalesce :models.product ""]] [:lower [:coalesce :models.version ""]])]]]}
2023-12-22T10:31:08.894Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:43] - arg => {:rooms #object[leihs.procurement.resources.rooms$get_rooms 0x319c46a5 "leihs.procurement.resources.rooms$get_rooms@319c46a5"], :category #object[leihs.procurement.resources.category$get_category 0x611f8bfa "leihs.procurement.resources.category$get_category@611f8bfa"], :total-price-cents-new-requests #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x5e724538 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@5e724538"], :change-request-budget-period #object[leihs.procurement.resources.request$change_budget_period_BANG_ 0x59b579cf "leihs.procurement.resources.request$change_budget_period_BANG_@59b579cf"], :supplier #object[leihs.procurement.resources.supplier$get_supplier 0xa4fa532 "leihs.procurement.resources.supplier$get_supplier@a4fa532"], :department #object[leihs.procurement.resources.organization$get_department_of_organization 0x1792afda "leihs.procurement.resources.organization$get_department_of_organization@1792afda"], :create-request #object[leihs.procurement.resources.request$create_request_BANG_ 0x5b057395 "leihs.procurement.resources.request$create_request_BANG_@5b057395"], :update-templates #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x290c123b "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@290c123b"], :update-requesters-organizations #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x5e9d541d "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@5e9d541d"], :permissions #object[leihs.procurement.permissions.user$get_permissions 0x5cf3cc6b "leihs.procurement.permissions.user$get_permissions@5cf3cc6b"], :delete-request #object[leihs.procurement.resources.request$delete_request_BANG_ 0x2c9a95bb "leihs.procurement.resources.request$delete_request_BANG_@2c9a95bb"], :building #object[leihs.procurement.resources.building$get_building 0x65cec7d9 "leihs.procurement.resources.building$get_building@65cec7d9"], :update-budget-periods #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x51475ac1 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@51475ac1"], :current-user #object[leihs.procurement.resources.current_user$get_current_user 0x13955416 "leihs.procurement.resources.current_user$get_current_user@13955416"], :viewers #object[leihs.procurement.graphql.queries$fn__46162 0x6b5a2c92 "leihs.procurement.graphql.queries$fn__46162@6b5a2c92"], :suppliers #object[leihs.procurement.resources.suppliers$get_suppliers 0x7839ce2f "leihs.procurement.resources.suppliers$get_suppliers@7839ce2f"], :can-delete-budget-period? #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x13c302bb "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@13c302bb"], :buildings #object[leihs.procurement.resources.buildings$get_buildings 0x2a4fd131 "leihs.procurement.resources.buildings$get_buildings@2a4fd131"], :admins #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x104b4656 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@104b4656"], :update-admins #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x26b5aac6 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@26b5aac6"], :main-categories #object[leihs.procurement.resources.main_categories$get_main_categories 0x2d68a271 "leihs.procurement.resources.main_categories$get_main_categories@2d68a271"], :update-main-categories #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x797a38b4 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@797a38b4"], :requests #object[leihs.procurement.resources.requests$get_requests 0x33c9a83b "leihs.procurement.resources.requests$get_requests@33c9a83b"], :attachments #object[leihs.procurement.resources.attachments$get_attachments 0x38a1d71e "leihs.procurement.resources.attachments$get_attachments@38a1d71e"], :inspectors #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x50b29151 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@50b29151"], :settings #object[leihs.procurement.resources.settings$get_settings 0x7825ac6b "leihs.procurement.resources.settings$get_settings@7825ac6b"], :dashboard #object[leihs.procurement.dashboard$get_dashboard 0x6d34b24 "leihs.procurement.dashboard$get_dashboard@6d34b24"], :update-settings #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x307c65c7 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@307c65c7"], :total-price-cents-inspected-requests #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x74004280 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@74004280"], :template #object[leihs.procurement.resources.template$get_template 0x2193fe9f "leihs.procurement.resources.template$get_template@2193fe9f"], :department-of-requester-organization #object[leihs.procurement.resources.organization$get_department_of_requester_organization 0x3d050be2 "leihs.procurement.resources.organization$get_department_of_requester_organization@3d050be2"], :organization #object[leihs.procurement.resources.organization$get_organization 0x6e8413d8 "leihs.procurement.resources.organization$get_organization@6e8413d8"], :organizations #object[leihs.procurement.resources.organizations$get_organizations 0x18e648ca "leihs.procurement.resources.organizations$get_organizations@18e648ca"], :main-category #object[leihs.procurement.resources.main_category$get_main_category 0x26bf2a4f "leihs.procurement.resources.main_category$get_main_category@26bf2a4f"], :total-price-cents-approved-quantities #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x33706f61 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@33706f61"], :models #object[leihs.procurement.resources.models$get_models 0x7d24b004 "leihs.procurement.resources.models$get_models@7d24b004"], :categories #object[leihs.procurement.resources.categories$get_categories 0x57ae1772 "leihs.procurement.resources.categories$get_categories@57ae1772"], :total-price-cents-requested-quantities #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x89cb29a "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@89cb29a"], :budget-period #object[leihs.procurement.resources.budget_period$get_budget_period 0x38a7df8f "leihs.procurement.resources.budget_period$get_budget_period@38a7df8f"], :update-categories-viewers #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x60dbec0f "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@60dbec0f"], :total-price-cents-order-quantities #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x476962e1 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@476962e1"], :can-delete-main-category? #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x2a8c00f4 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@2a8c00f4"], :can-delete-category? #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x2cd1e98d "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@2cd1e98d"], :budget-limits #object[leihs.procurement.resources.budget_limits$get_budget_limits 0x1355d38c "leihs.procurement.resources.budget_limits$get_budget_limits@1355d38c"], :update-request #object[leihs.procurement.resources.request$update_request_BANG_ 0x1f27d56d "leihs.procurement.resources.request$update_request_BANG_@1f27d56d"], :room #object[leihs.procurement.resources.room$get_room 0x5566eddd "leihs.procurement.resources.room$get_room@5566eddd"], :templates #object[leihs.procurement.resources.templates$get_templates 0x76d8fb7d "leihs.procurement.resources.templates$get_templates@76d8fb7d"], :requests-count #object[leihs.procurement.resources.template$requests_count 0x4b2c8f99 "leihs.procurement.resources.template$requests_count@4b2c8f99"], :user #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x6a01b72c "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@6a01b72c"], :requesters-organizations #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x86ba7b4 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@86ba7b4"], :change-request-category #object[leihs.procurement.resources.request$change_category_BANG_ 0x39d9a6d7 "leihs.procurement.resources.request$change_category_BANG_@39d9a6d7"], :users #object[leihs.procurement.authorization$wrap_ensure_one_of$fn__39499 0x16a6b632 "leihs.procurement.authorization$wrap_ensure_one_of$fn__39499@16a6b632"], :new-request #object[leihs.procurement.resources.request$get_new 0x71f9db1d "leihs.procurement.resources.request$get_new@71f9db1d"], :budget-periods #object[clojure.lang.AFunction$1 0x247a9491 "clojure.lang.AFunction$1@247a9491"], :model #object[leihs.procurement.resources.model$get_model 0x506161d7 "leihs.procurement.resources.model$get_model@506161d7"]}
2023-12-22T10:31:09.147Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-22T10:31:09.704Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-22T10:31:09.707Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x658aa995 "taoensso.timbre$default_output_fn@658aa995"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x182fcda5 "taoensso.timbre.appenders.core$println_appender$fn__3459@182fcda5"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-22T10:31:09.709Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-22T10:31:09.720Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 58548, :repl-port-file ".nrepl-port"}
2023-12-22T10:31:09.722Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  58548 localhost
2023-12-22T10:31:09.754Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-22T10:31:09.756Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 58548, :repl-port-file .nrepl-port}
2023-12-22T10:31:09.757Z NX-41294 INFO [leihs.core.shutdown:20] - PID 77580
2023-12-22T10:31:09.785Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-22T10:31:09.857Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-22T10:31:09.858Z NX-41294 INFO [leihs.core.db:222] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-22T10:31:09.863Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-22T10:31:09.937Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@240c1f28
2023-12-22T10:31:09.946Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-22T10:31:09.946Z NX-41294 INFO [leihs.core.db:224] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x5e9022b "HikariDataSource (db-pool)"]}
2023-12-22T10:31:09.947Z NX-41294 INFO [leihs.core.db:225] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
>o> init-ds-next
2023-12-22T10:31:09.962Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-22T10:31:09.972Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@74d77608
2023-12-22T10:31:09.973Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-22T10:31:09.978Z NX-41294 INFO [leihs.core.db:227] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x5158e446 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x9349977 "next.jdbc.result_set$as_unqualified_lower_maps@9349977"]}}
>o> wrap-tx
2023-12-22T10:31:09.984Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x79331076 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x1c3a1e35 "java.util.concurrent.ThreadPoolExecutor@1c3a1e35[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-22T10:31:09.994Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
