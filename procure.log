# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-12-08T16:52:22.264Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-08T16:52:22.983Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-08T16:52:22.990Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x18db208f "taoensso.timbre$default_output_fn@18db208f"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x70bad819 "taoensso.timbre.appenders.core$println_appender$fn__3459@70bad819"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-08T16:52:22.992Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-08T16:52:23.004Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 43103, :repl-port-file ".nrepl-port"}
2023-12-08T16:52:23.006Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  43103 localhost
2023-12-08T16:52:23.039Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-08T16:52:23.042Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 43103, :repl-port-file .nrepl-port}
2023-12-08T16:52:23.042Z NX-41294 INFO [leihs.core.shutdown:20] - PID 35199
2023-12-08T16:52:23.076Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-08T16:52:23.134Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-08T16:52:23.140Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-08T16:52:23.146Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-08T16:52:23.222Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@16552193
2023-12-08T16:52:23.228Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-08T16:52:23.228Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}
2023-12-08T16:52:23.229Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-08T16:52:23.244Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-08T16:52:23.257Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@4b7cc6fb
2023-12-08T16:52:23.257Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-08T16:52:23.263Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}
2023-12-08T16:52:23.270Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x34172f11 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x739d3dac "java.util.concurrent.ThreadPoolExecutor@739d3dac[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-08T16:52:23.281Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 185788765189375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5926bd09 /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x2a33a7bc compojure.core$routes$fn__27950@2a33a7bc], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T16:53:26.637Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T16:53:26.736Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", :http-only false, :path "/", :secure false}}}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}}, :remote-addr 127.0.0.1, :start-time 185789046354916, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7aeb5620 /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x2a33a7bc compojure.core$routes$fn__27950@2a33a7bc], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T16:53:26.824Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T16:53:26.834Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}}, :remote-addr 127.0.0.1, :start-time 185789187108083, :params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x3a138700 HikariProxyConnection@974358272 wrapping org.postgresql.jdbc.PgConnection@4b7cc6fb], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca, content-length 98, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0xbc7e098 /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x541c882e HikariProxyConnection@1411156014 wrapping org.postgresql.jdbc.PgConnection@16552193], :level 1, :rollback #object[clojure.lang.Atom 0x6d5a7930 {:status :ready, :val false}]}, :content-length 98, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x7066a9cf BytesInputStream[len=98]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x2a33a7bc compojure.core$routes$fn__27950@2a33a7bc], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x541c882e HikariProxyConnection@1411156014 wrapping org.postgresql.jdbc.PgConnection@16552193], :level 1, :rollback #object[clojure.lang.Atom 0x6d5a7930 {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T16:53:26.975Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T16:53:26.996Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"lynsey_kertzmann@klein-wehner.org\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}}, :remote-addr 127.0.0.1, :start-time 185789294237791, :params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x615d121e HikariProxyConnection@1633489438 wrapping org.postgresql.jdbc.PgConnection@4b7cc6fb], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca, content-length 106, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x28d1740e /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x34d5e2b3 HikariProxyConnection@886432435 wrapping org.postgresql.jdbc.PgConnection@16552193], :level 1, :rollback #object[clojure.lang.Atom 0x369dabff {:status :ready, :val false}]}, :content-length 106, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x3f5992d0 BytesInputStream[len=106]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x2a33a7bc compojure.core$routes$fn__27950@2a33a7bc], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x34d5e2b3 HikariProxyConnection@886432435 wrapping org.postgresql.jdbc.PgConnection@16552193], :level 1, :rollback #object[clojure.lang.Atom 0x369dabff {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T16:53:27.067Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T16:53:27.141Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185789392113500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68959dd /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x2c6e0132 leihs.procurement.backend.html$not_found_handler@2c6e0132], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:27.181Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:27.184Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T16:53:27.186Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 07 Dec 2023 20:08:40 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x76b38e9c "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185789809396416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2b4fb625 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x2c6e0132 leihs.procurement.backend.html$not_found_handler@2c6e0132], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:27.586Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:27.590Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T16:53:27.594Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 07 Dec 2023 20:08:40 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x36899e15 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185789813489750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5b71739 /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:27.630Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:27.632Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T16:53:27.637Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T16:53:27.638Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:27.638Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185789813489750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "502", "referer" "http://localhost:3230/procure", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5b71739 "/127.0.0.1:3230<->/127.0.0.1:53000"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185789813489750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5b71739 /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185789813489750,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"502","referer":"http:\/\/localhost:3230\/procure","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8aa2467a-f1b4-4b2a-bc3b-8177b0267685] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:27.759Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:27.760Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790094304708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6b11320c /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:27.886Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:27.890Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790093648291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2274b79f /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:27.919Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790094051166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7fbd388c /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}
>>>exec-query::variables , {}
:content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables2023-12-08T16:53:27.922Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

 {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  2023-12-08T16:53:27.922Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
2023-12-08T16:53:27.923Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790094304708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "502", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6b11320c "/127.0.0.1:3230<->/127.0.0.1:53010"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
2023-12-08T16:53:27.926Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:27.931Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:27.935Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T16:53:27.939Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}

2023-12-08T16:53:27.939Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:27.940Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790094051166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "534", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7fbd388c "/127.0.0.1:3230<->/127.0.0.1:53000"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestFilters", :variables {}, :query "query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>>>exec-query::variables {}
2023-12-08T16:53:27.944Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T16:53:27.944Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:27.944Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790093648291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "3575", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2274b79f "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790094304708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6b11320c /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790094304708,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8aa2467a-f1b4-4b2a-bc3b-8177b0267685] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:27.950Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:27.950Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>>get-dashboard
>>args {}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>debug 2
>debug 3
2023-12-08T16:53:27.972Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format main-categories-base-query) => ["SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC"]
>debug 4
>debug 5 >>ToCheck mainCats {(:id {:id #uuid "213c3067-e101-40a9-9357-3688accfdfd5"#uuid "213c3067-e101-40a9-9357-3688accfdfd5", , :name Sarchimor})
:name Sarchimor}
>debug 5a id #uuid "213c3067-e101-40a9-9357-3688accfdfd5"
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  ORDER BY end_date DESC]
2023-12-08T16:53:27.981Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format (image/image-query-for-main-category (:id mc))) => ["SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "385fb05e-775b-427c-a16e-135457fb8afe", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T16:53:26.408836Z", :updated_at #time/instant "2023-12-08T16:53:26.408836Z"})
>>resultA1-2 ({:id #uuid "385fb05e-775b-427c-a16e-135457fb8afe", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T16:53:26.408836Z", :updated_at #time/instant "2023-12-08T16:53:26.408836Z"})
>>requestsB2-triggerError {} nil
>debug 5b nil
2023-12-08T16:53:27.987Z NX-41294 DEBUG [leihs.procurement.resources.categories:?] - (sql/format (sql/merge-where categories-base-query [:= :procurement_categories.main_category_id main-cat-id])) => ["SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T16:53:27.995Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T16:53:27.996Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T16:53:27.997Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T16:53:27.998Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T16:53:28.000Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790094051166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7fbd388c /127.0.0.1:3230<->/127.0.0.1:53000], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790094051166,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"534","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":534,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestFilters","variables":{},"query":"query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 385fb05e-775b-427c-a16e-135457fb8afe] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id 213c3067-e101-40a9-9357-3688accfdfd5] [:name Sarchimor] [:categories [#ordered/map ([:id c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:name Colombia] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id f8c92637-ddb2-4b83-8e1e-f19889110dd5] [:name Toys, Kids & Baby] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 1e4b2229-65d6-42f4-bdc6-8ae9e9b16883] [:name Baby, Toys & Computers] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T16:53:28.044Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "f8c92637-ddb2-4b83-8e1e-f19889110dd5"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "1e4b2229-65d6-42f4-bdc6-8ae9e9b16883"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T16:53:28.044Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "f8c92637-ddb2-4b83-8e1e-f19889110dd5"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "1e4b2229-65d6-42f4-bdc6-8ae9e9b16883"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}}
>>requestsB2 ()
>>dashboard-cache-keyB2 {:id -15128758}
2023-12-08T16:53:28.078Z NX-41294 DEBUG [leihs.procurement.resources.categories:?] - (sql/format (sql/merge-where categories-base-query [:= :procurement_categories.main_category_id main-cat-id])) => ["SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]
>debug 5 {:id #uuid "213c3067-e101-40a9-9357-3688accfdfd5", :name Sarchimor, :categories ({:main_category_id #uuid "213c3067-e101-40a9-9357-3688accfdfd5", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "c8e8b53a-f85a-4500-88ee-b7fd16d201d3", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5_c8e8b53a-f85a-4500-88ee-b7fd16d201d3, :cost_center nil}), :total_price_cents 0, :cacheKey -15128758_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5}
>debug 5a id #uuid "213c3067-e101-40a9-9357-3688accfdfd5"
2023-12-08T16:53:28.082Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format (image/image-query-for-main-category (:id mc))) => ["SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]
>debug 5b nil

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790093648291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2274b79f /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790093648291,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"3575","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":3575,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -15128758] [:total_count 0] [:budget_periods [#ordered/map ([:id 385fb05e-775b-427c-a16e-135457fb8afe] [:cacheKey -15128758_385fb05e-775b-427c-a16e-135457fb8afe] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id 213c3067-e101-40a9-9357-3688accfdfd5] [:cacheKey -15128758_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5] [:name Sarchimor] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:cacheKey -15128758_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5_c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:name Colombia] [:total_price_cents 0] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T16:53:28.092Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 0] [:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:cacheKey "-15128758_385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:cacheKey "-15128758_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:cacheKey "-15128758_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5_c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T16:53:28.092Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 0] [:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:cacheKey "-15128758_385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:cacheKey "-15128758_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:cacheKey "-15128758_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5_c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790373391166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a26e23f /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [1e4b2229-65d6-42f4-bdc6-8ae9e9b16883], :categories [c8e8b53a-f85a-4500-88ee-b7fd16d201d3], :priority [NORMAL HIGH], :budgetPeriods [385fb05e-775b-427c-a16e-135457fb8afe]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:28.168Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:28.171Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [1e4b2229-65d6-42f4-bdc6-8ae9e9b16883], :categories [c8e8b53a-f85a-4500-88ee-b7fd16d201d3], :priority [NORMAL HIGH], :budgetPeriods [385fb05e-775b-427c-a16e-135457fb8afe]}
2023-12-08T16:53:28.185Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T16:53:28.186Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["1e4b2229-65d6-42f4-bdc6-8ae9e9b16883"], :categories ["c8e8b53a-f85a-4500-88ee-b7fd16d201d3"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["385fb05e-775b-427c-a16e-135457fb8afe"]}
2023-12-08T16:53:28.186Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790373391166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "4033", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a26e23f "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["1e4b2229-65d6-42f4-bdc6-8ae9e9b16883"], :categories ["c8e8b53a-f85a-4500-88ee-b7fd16d201d3"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["385fb05e-775b-427c-a16e-135457fb8afe"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [1e4b2229-65d6-42f4-bdc6-8ae9e9b16883], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [385fb05e-775b-427c-a16e-135457fb8afe], :category_id [c8e8b53a-f85a-4500-88ee-b7fd16d201d3]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats ({:id #uuid "213c3067-e101-40a9-9357-3688accfdfd5", :name Sarchimor})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC 385fb05e-775b-427c-a16e-135457fb8afe]
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "385fb05e-775b-427c-a16e-135457fb8afe", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T16:53:26.408836Z", :updated_at #time/instant "2023-12-08T16:53:26.408836Z"})
>>resultA1-2 ({:id #uuid "385fb05e-775b-427c-a16e-135457fb8afe", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T16:53:26.408836Z", :updated_at #time/instant "2023-12-08T16:53:26.408836Z"})
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [1e4b2229-65d6-42f4-bdc6-8ae9e9b16883], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [385fb05e-775b-427c-a16e-135457fb8afe], :category_id [c8e8b53a-f85a-4500-88ee-b7fd16d201d3]} nil
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T16:53:28.209Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T16:53:28.209Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T16:53:28.210Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T16:53:28.210Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T16:53:28.210Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>>requestsB2 ()
>>dashboard-cache-keyB2 {:id 1197112931}
2023-12-08T16:53:28.242Z NX-41294 DEBUG [leihs.procurement.resources.categories:?] - (sql/format (sql/merge-where categories-base-query [:= :procurement_categories.main_category_id main-cat-id])) => ["SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]
>debug 5 {:id #uuid "213c3067-e101-40a9-9357-3688accfdfd5", :name Sarchimor, :categories ({:main_category_id #uuid "213c3067-e101-40a9-9357-3688accfdfd5", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "c8e8b53a-f85a-4500-88ee-b7fd16d201d3", :total_price_cents 0, :procurement_account nil, :cacheKey 1197112931_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5_c8e8b53a-f85a-4500-88ee-b7fd16d201d3, :cost_center nil}), :total_price_cents 0, :cacheKey 1197112931_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5}
>debug 5a id #uuid "213c3067-e101-40a9-9357-3688accfdfd5"
2023-12-08T16:53:28.244Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format (image/image-query-for-main-category (:id mc))) => ["SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]
>debug 5b nil

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790373391166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a26e23f /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [1e4b2229-65d6-42f4-bdc6-8ae9e9b16883], :categories [c8e8b53a-f85a-4500-88ee-b7fd16d201d3], :priority [NORMAL HIGH], :budgetPeriods [385fb05e-775b-427c-a16e-135457fb8afe]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790373391166,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"4033","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":4033,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"inspector_priority":["LOW","MEDIUM","HIGH","MANDATORY"],"onlyOwnRequests":false,"state":["NEW","IN_APPROVAL","APPROVED","PARTIALLY_APPROVED","DENIED"],"order_status":["NOT_PROCESSED","IN_PROGRESS","PROCURED","ALTERNATIVE_PROCURED","NOT_PROCURED"],"search":null,"organizations":["1e4b2229-65d6-42f4-bdc6-8ae9e9b16883"],"categories":["c8e8b53a-f85a-4500-88ee-b7fd16d201d3"],"priority":["NORMAL","HIGH"],"budgetPeriods":["385fb05e-775b-427c-a16e-135457fb8afe"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey 1197112931] [:total_count 0] [:budget_periods [#ordered/map ([:id 385fb05e-775b-427c-a16e-135457fb8afe] [:cacheKey 1197112931_385fb05e-775b-427c-a16e-135457fb8afe] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id 213c3067-e101-40a9-9357-3688accfdfd5] [:cacheKey 1197112931_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5] [:name Sarchimor] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:cacheKey 1197112931_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5_c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:name Colombia] [:total_price_cents 0] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T16:53:28.247Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1197112931"] [:total_count 0] [:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:cacheKey "1197112931_385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:cacheKey "1197112931_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:cacheKey "1197112931_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5_c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T16:53:28.247Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1197112931"] [:total_count 0] [:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:cacheKey "1197112931_385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:cacheKey "1197112931_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:cacheKey "1197112931_385fb05e-775b-427c-a16e-135457fb8afe_213c3067-e101-40a9-9357-3688accfdfd5_c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790618649666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x60b91664 /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:28.400Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:28.403Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T16:53:28.405Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T16:53:28.405Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:28.405Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790618649666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "502", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x60b91664 "/127.0.0.1:3230<->/127.0.0.1:53010"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790617337291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 669, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2b265c92 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 669, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestPreselectionQuery, :variables {}, :query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:28.410Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:28.412Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T16:53:28.414Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}

2023-12-08T16:53:28.415Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:28.415Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790617337291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "669", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2b265c92 "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 669, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "newRequestPreselectionQuery", :variables {}, :query "query newRequestPreselectionQuery {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    image_url\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  templates {\n    id\n    category {\n      id\n      __typename\n    }\n    is_archived\n    article_name\n    article_number\n    model {\n      id\n      product\n      version\n      __typename\n    }\n    price_cents\n    price_currency\n    supplier {\n      id\n      __typename\n    }\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>debug 2
>debug 3
2023-12-08T16:53:28.417Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format main-categories-base-query) => ["SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC"]
>debug 4
>debug 5 {:id #uuid "213c3067-e101-40a9-9357-3688accfdfd5", :name Sarchimor}
>debug 5a id #uuid "213c3067-e101-40a9-9357-3688accfdfd5"
2023-12-08T16:53:28.418Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format (image/image-query-for-main-category (:id mc))) => ["SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]
>debug 5b nil
2023-12-08T16:53:28.419Z NX-41294 DEBUG [leihs.procurement.resources.categories:?] - (sql/format (sql/merge-where categories-base-query [:= :procurement_categories.main_category_id main-cat-id])) => ["SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790618649666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x60b91664 /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>oo> templates::get-templates2 _> HERE value contains :id??) nil nil
>oo> templates::get-templates1a ?broken-base-query? {:select (:procurement_templates.*), :from (:procurement_templates), :left-join (:models [:= :models.id :procurement_templates.model_id]), :order-by (
>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790618649666,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8aa2467a-f1b4-4b2a-bc3b-8177b0267685] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
#sql/call [:concat (#sql/call [:lower #sql/call [:coalesce :procurement_templates.article_name ]] #sql/call [:lower #sql/call [:coalesce :models.product ]] #sql/call [:lower #sql/call [:coalesce :models.version ]])])}
2023-12-08T16:53:28.420Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:28.420Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>oo> templates::get-templates1b ?broken-base-query? [SELECT procurement_templates.* FROM procurement_templates  LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY concat((lower(coalesce(procurement_templates.article_name, ?)), lower(coalesce(models.product, ?)), lower(coalesce(models.version, ?))))   ]
>oo> templates::get-templates1c [SELECT procurement_templates.* FROM procurement_templates  LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY concat((lower(coalesce(procurement_templates.article_name, ?)), lower(coalesce(models.product, ?)), lower(coalesce(models.version, ?))))   ]
2023-12-08T16:53:28.422Z NX-41294 DEBUG [leihs.procurement.resources.templates:42] - query => {:select (:procurement_templates.*), :from (:procurement_templates), :left-join (:models [:= :models.id :procurement_templates.model_id]), :order-by (#sql/call [:concat (#sql/call [:lower #sql/call [:coalesce :procurement_templates.article_name ""]] #sql/call [:lower #sql/call [:coalesce :models.product ""]] #sql/call [:lower #sql/call [:coalesce :models.version ""]])])}
2023-12-08T16:53:28.423Z NX-41294 DEBUG [leihs.procurement.resources.templates:?] - (sql/format (spy query)) => ["SELECT procurement_templates.* FROM procurement_templates  LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY concat((lower(coalesce(procurement_templates.article_name, ?)), lower(coalesce(models.product, ?)), lower(coalesce(models.version, ?))))" "" "" ""]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790617337291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 669, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2b265c92 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 669, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestPreselectionQuery, :variables {}, :query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790617337291,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"669","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":669,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"newRequestPreselectionQuery","variables":{},"query":"query newRequestPreselectionQuery {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    image_url\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  templates {\n    id\n    category {\n      id\n      __typename\n    }\n    is_archived\n    article_name\n    article_number\n    model {\n      id\n      product\n      version\n      __typename\n    }\n    price_cents\n    price_currency\n    supplier {\n      id\n      __typename\n    }\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 385fb05e-775b-427c-a16e-135457fb8afe] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id 213c3067-e101-40a9-9357-3688accfdfd5] [:name Sarchimor] [:image_url nil] [:categories [#ordered/map ([:id c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:name Colombia] [:__typename :Category])]] [:__typename :MainCategory])]] [:templates []])}
2023-12-08T16:53:28.427Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:image_url nil] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:templates []])}
2023-12-08T16:53:28.427Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:image_url nil] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:templates []])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790865012625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6da1925f /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:28.644Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:28.647Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T16:53:28.649Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T16:53:28.649Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:28.650Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790865012625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "502", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6da1925f "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790877245125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 5445, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5142ce6 /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 5445, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestQuery, :variables {:budgetPeriod 385fb05e-775b-427c-a16e-135457fb8afe, :category c8e8b53a-f85a-4500-88ee-b7fd16d201d3}, :query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:28.662Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:28.666Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790865012625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6da1925f /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790865012625,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8aa2467a-f1b4-4b2a-bc3b-8177b0267685] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:28.671Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:28.672Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}

>>>exec-query::variables {:budgetPeriod 385fb05e-775b-427c-a16e-135457fb8afe, :category c8e8b53a-f85a-4500-88ee-b7fd16d201d3}
2023-12-08T16:53:28.673Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T16:53:28.673Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:budgetPeriod "385fb05e-775b-427c-a16e-135457fb8afe", :category "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"}
2023-12-08T16:53:28.674Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790877245125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "5445", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5142ce6 "/127.0.0.1:3230<->/127.0.0.1:53010"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 5445, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "newRequestQuery", :variables {:budgetPeriod "385fb05e-775b-427c-a16e-135457fb8afe", :category "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"}, :query "query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {\n  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {\n    ...RequestFieldsForEdit\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>oo> past? budget-period= {:id #uuid "385fb05e-775b-427c-a16e-135457fb8afe", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T16:53:26.408836Z", :updated_at #time/instant "2023-12-08T16:53:26.408836Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
2023-12-08T16:53:28.697Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:369] - (or (and requester own-request) category-viewer inspector admin) => true
2023-12-08T16:53:28.697Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:370] - (and (not template) (not past-phase) (or (and new-request requester (or (and requesting-phase (or own-request inspector)) (and inspection-phase category-inspector) admin)) (and existing-request (or admin category-inspector (and requesting-phase requester own-request))))) => true

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790877245125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 5445, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5142ce6 /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 5445, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestQuery, :variables {:budgetPeriod 385fb05e-775b-427c-a16e-135457fb8afe, :category c8e8b53a-f85a-4500-88ee-b7fd16d201d3}, :query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790877245125,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"5445","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5445,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"newRequestQuery","variables":{"budgetPeriod":"385fb05e-775b-427c-a16e-135457fb8afe","category":"c8e8b53a-f85a-4500-88ee-b7fd16d201d3"},"query":"query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {\n  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {\n    ...RequestFieldsForEdit\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:new_request #ordered/map ([:id nil] [:short_id nil] [:user #ordered/map ([:value #ordered/map ([:id 8aa2467a-f1b4-4b2a-bc3b-8177b0267685] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:name Colombia] [:main_category nil] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id 385fb05e-775b-427c-a16e-135457fb8afe] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization nil] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value nil] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id b8927fd2-014c-48c2-b095-fa1d5620debe] [:name general room] [:building #ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value nil] [:__typename :RequestFieldOrderStatus] [:read false] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
2023-12-08T16:53:28.716Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:new_request #ordered/map ([:id nil] [:short_id nil] [:user #ordered/map ([:value #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:main_category nil] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization nil] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value nil] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:building #ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value nil] [:__typename :RequestFieldOrderStatus] [:read false] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
2023-12-08T16:53:28.716Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:new_request #ordered/map ([:id nil] [:short_id nil] [:user #ordered/map ([:value #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:main_category nil] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization nil] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value nil] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:building #ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value nil] [:__typename :RequestFieldOrderStatus] [:read false] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>>> authenticate::skip=
>> authorize > 
nil
>> authorize::handler >   handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count#object[ leihs.core.locale$wrap$fn__444050 , :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]#time/instant "2023-12-08T16:53:27.065242Z", 
:id
>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id  nil, :scope_read true, :is_admin false, :authentication-method #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685":session, , :login:user_session_id  nil, :scope_system_admin_write#uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13" , false:scope_system_admin_read,  :scope_writefalse , true:access-rights,  :firstname Krysta, :scope_admin_write (false), , :user_session_created_at:user_id  #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
#time/instant "2023-12-08T16:53:27.065242Z"
>> authorize >, 

>> authorize::handler >:id  #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id#object[ leihs.core.locale$wrap$fn__44405 #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin0x6f2633d8  leihs.core.locale$wrap$fn__44405@6f2633d8false], 
:external_sign_out_url 
>> authorize::request >nil , :language_locale nil, {:inventory_pool_roles_count :authenticated-entity0 , :scope_admin_read {false}:email,  lynsey_kertzmann@klein-wehner.org, :cookies:contracts_count  0, :lastname {Pfeffer, :org_id leihs-anti-csrf-tokennil , :scope_read{ true:value,  :is_adminff17a22c-83a7-4e37-ad5b-785fe44b5bca }false, , leihs-user-session:authentication-method  :session{, :value:login  e94f4dcc-8022-457d-b8cf-3fda62903944nil}, }:scope_system_admin_write,  false:remote-addr,  :scope_write 127.0.0.1true, , :start-time:firstname  Krysta185790999510666, , :scope_admin_write :paramsfalse , :user_session_created_at{ }, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs #time/instant "2023-12-08T16:53:27.065242Z", :id 432000, :smtp_default_from_address#uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685" , your.lending.desk@example.com:user_session_id,  :public_image_caching_enabled true#uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", , :sessions_force_secure:scope_system_admin_read  falsefalse, , :deliver_received_order_notifications:access-rights  false, :external_base_url(), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685",  :is_system_adminnil , false:sessions_force_uniqueness,  :external_sign_out_urlfalse , nil:email_signature,  :language_localeCheers, }nil, , :inventory_pool_roles_count:tx-next  0, :scope_admin_read false}, :cookies #next.jdbc.default_options.DefaultOptions{leihs-anti-csrf-token {{:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}:connectable }, :remote-addr 127.0.0.1, :start-time 185791000180750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false#object[, :deliver_received_order_notificationscom.zaxxer.hikari.HikariDataSource  false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next 0x19181c37 #HikariDataSource (HikariPool-1)next.jdbc.default_options.DefaultOptions], {:options :connectable {:builder-fn #object[com.zaxxer.hikari.HikariDataSource#object[ next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}0x19181c37 , HikariDataSource (HikariPool-1)]:query-params-raw,  :options {}, {:route-params:builder-fn  nil, :headers#object[ next.jdbc.result_set$as_unqualified_lower_maps {origin http://localhost:3230, 0x755637cf sec-fetch-sitenext.jdbc.result_set$as_unqualified_lower_maps@755637cf ]same-origin}, }host,  localhost:3230:query-params-raw,  user-agent {Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0}, , content-type:route-params  application/jsonnil, , cookie:headers  leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, {content-length 137origin,  refererhttp://localhost:3230 , http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3sec-fetch-site,  connectionsame-origin , keep-alive, hostx-csrf-token  localhost:3230ff17a22c-83a7-4e37-ad5b-785fe44b5bca, , user-agentaccept  Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0application/json, , content-typeaccept-language  application/jsonde,en-US;q=0.7,en;q=0.3, , cookiesec-fetch-dest  leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944empty, , content-lengthaccept-encoding  257gzip, deflate, br, , referersec-fetch-mode  http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3cors, }connection,  keep-alive:async-channel,  x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[#object[org.httpkit.server.AsyncChannelorg.httpkit.server.AsyncChannel  0x3b875ea9 0x43854803 /127.0.0.1:3230<->/127.0.0.1:53005/127.0.0.1:3230<->/127.0.0.1:53010]], , :server-port:server-port  32303230, , :params-raw:params-raw  {}{}, , :tx:tx  {{:datasource:datasource  #object[com.zaxxer.hikari.HikariDataSource#object[ com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)0x46968315 ]HikariDataSource (db-pool)}], }, :content-length:content-length  137257, , :form-params:form-params  {{}}, , :websocket?:websocket?  falsefalse, , :query-params:query-params  {}{, }, :content-type:content-type  application/jsonapplication/json, , :form-params-raw:form-params-raw  {{}}, , :character-encoding:character-encoding  utf8utf8, , :uri:uri  /procure/graphql/procure/graphql, , :server-name:server-name  localhostlocalhost, , :handler-key:handler-key  :graphql:graphql, , :query-string:query-string  nilnil, , :body:body  {{:operationName:operationName  getBuildingsgetRoomsByBuilding, , :variables:variables  {{}, :buildingId:query  abae04c5-d767-425e-acc2-7ce04df645d1query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}}, , :query :graphql-schemaquery getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
 }, :graphql-schema #CompiledSchema<>#CompiledSchema<>, , :handler:handler  #object[#object[leihs.procurement.graphql$handlerleihs.procurement.graphql$handler  0x583fb4f5 leihs.procurement.graphql$handler@583fb4f50x583fb4f5 ]leihs.procurement.graphql$handler@583fb4f5, ], :multipart-params:multipart-params  {}{, }, :scheme:scheme  :http:http, , :request-method:request-method  :post:post, , :accept:accept  {{:mime:mime  :json:json, , :charset:charset  nilnil, , :encoding:encoding  nilnil, , :language:language  nilnil}}}}


>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, 
>> authorize::handler-key >>:lastname  Pfeffer, :graphql:org_id 
nil>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write,  :scope_readtrue , true:firstname,  :is_adminKrysta , false:scope_admin_write,  :authentication-methodfalse , :session:user_session_created_at,  :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false#time/instant "2023-12-08T16:53:27.065242Z", , :access-rights:id  ()#uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", , :user_id:user_session_id  #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"#uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", , :is_system_admin:scope_system_admin_read  falsefalse, , :external_sign_out_url:access-rights  nil, :language_locale( )nil, , :user_id:inventory_pool_roles_count  0#uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", , :scope_admin_read:is_system_admin  falsefalse}, :external_sign_out_url
 >myprint>  niltxn,  :language_locale nil, :inventory_pool_roles_count{ 0:datasource,  :scope_admin_read false}
#object[com.zaxxer.hikari.HikariDataSource >myprint>  txn {:datasource 0x46968315 #object[HikariDataSource (db-pool)com.zaxxer.hikari.HikariDataSource] }
0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  admin false
>myprint>  inspector false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  viewer false
>myprint>  requester true
>myprint>  requester true
2023-12-08T16:53:28.778Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:28.778Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:28.780Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T16:53:28.781Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}

>>>exec-query::variables {:buildingId abae04c5-d767-425e-acc2-7ce04df645d1}
2023-12-08T16:53:28.782Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getBuildings {
  buildings {
    id
    name
    __typename
  }
}

2023-12-08T16:53:28.782Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}

2023-12-08T16:53:28.783Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:28.783Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:buildingId "abae04c5-d767-425e-acc2-7ce04df645d1"}
2023-12-08T16:53:28.783Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185790999510666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "137", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3b875ea9 "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getBuildings", :variables {}, :query "query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-12-08T16:53:28.783Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185791000180750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "257", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x43854803 "/127.0.0.1:3230<->/127.0.0.1:53010"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getRoomsByBuilding", :variables {:buildingId "abae04c5-d767-425e-acc2-7ce04df645d1"}, :query "query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185790999510666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 137, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3b875ea9 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185790999510666,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"137","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":137,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getBuildings","variables":{},"query":"query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:buildings [#ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building]) #ordered/map ([:id 04779b08-4683-4db3-a8e0-6af47b52f8ae] [:name Building B] [:__typename :Building])]])}
2023-12-08T16:53:28.786Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "04779b08-4683-4db3-a8e0-6af47b52f8ae"] [:name "Building B"] [:__typename :Building])]])}
2023-12-08T16:53:28.786Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "04779b08-4683-4db3-a8e0-6af47b52f8ae"] [:name "Building B"] [:__typename :Building])]])}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185791000180750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 257, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x43854803 /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId abae04c5-d767-425e-acc2-7ce04df645d1}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185791000180750,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"257","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":257,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getRoomsByBuilding","variables":{"buildingId":"abae04c5-d767-425e-acc2-7ce04df645d1"},"query":"query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:rooms [#ordered/map ([:id b8927fd2-014c-48c2-b095-fa1d5620debe] [:name general room] [:description nil] [:__typename :Room])]])}
2023-12-08T16:53:28.789Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:description nil] [:__typename :Room])]])}
2023-12-08T16:53:28.789Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:rooms [#ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:description nil] [:__typename :Room])]])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185791478483958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 257, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6b0f79b1 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId 04779b08-4683-4db3-a8e0-6af47b52f8ae}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:29.257Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:29.260Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:buildingId 04779b08-4683-4db3-a8e0-6af47b52f8ae}
2023-12-08T16:53:29.261Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}

2023-12-08T16:53:29.261Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:buildingId "04779b08-4683-4db3-a8e0-6af47b52f8ae"}
2023-12-08T16:53:29.261Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185791478483958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "257", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6b0f79b1 "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getRoomsByBuilding", :variables {:buildingId "04779b08-4683-4db3-a8e0-6af47b52f8ae"}, :query "query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185791478483958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 257, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6b0f79b1 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId 04779b08-4683-4db3-a8e0-6af47b52f8ae}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185791478483958,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"257","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":257,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getRoomsByBuilding","variables":{"buildingId":"04779b08-4683-4db3-a8e0-6af47b52f8ae"},"query":"query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:rooms [#ordered/map ([:id d9155014-60d3-4f44-94fb-254bf5eab2f6] [:name general room] [:description nil] [:__typename :Room]) #ordered/map ([:id 7af4884b-5dc1-470b-ae6e-f36a8c403115] [:name Room R] [:description nil] [:__typename :Room])]])}
2023-12-08T16:53:29.265Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "d9155014-60d3-4f44-94fb-254bf5eab2f6"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "7af4884b-5dc1-470b-ae6e-f36a8c403115"] [:name "Room R"] [:description nil] [:__typename :Room])]])}
2023-12-08T16:53:29.265Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:rooms [#ordered/map ([:id "d9155014-60d3-4f44-94fb-254bf5eab2f6"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "7af4884b-5dc1-470b-ae6e-f36a8c403115"] [:name "Room R"] [:description nil] [:__typename :Room])]])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185792745460083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xd19e26c HikariProxyConnection@219800172 wrapping org.postgresql.jdbc.PgConnection@4b7cc6fb], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 593, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x307bc121 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xf483a16 HikariProxyConnection@256391702 wrapping org.postgresql.jdbc.PgConnection@16552193], :level 1, :rollback #object[clojure.lang.Atom 0x321e30e4 {:status :ready, :val false}]}, :content-length 593, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName createRequest, :variables {:requestData {:category c8e8b53a-f85a-4500-88ee-b7fd16d201d3, :motivation And why not, :article_number 12345, :price_cents 50000, :budget_period 385fb05e-775b-427c-a16e-135457fb8afe, :article_name Camera, :replacement false, :attachments [], :supplier_name Supplier S, :requested_quantity 10, :priority HIGH, :room 7af4884b-5dc1-470b-ae6e-f36a8c403115, :receiver Hans Heiri}}, :query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xf483a16 HikariProxyConnection@256391702 wrapping org.postgresql.jdbc.PgConnection@16552193], :level 1, :rollback #object[clojure.lang.Atom 0x321e30e4 {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:30.529Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:30.530Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:requestData {:category c8e8b53a-f85a-4500-88ee-b7fd16d201d3, :motivation And why not, :article_number 12345, :price_cents 50000, :budget_period 385fb05e-775b-427c-a16e-135457fb8afe, :article_name Camera, :replacement false, :attachments [], :supplier_name Supplier S, :requested_quantity 10, :priority HIGH, :room 7af4884b-5dc1-470b-ae6e-f36a8c403115, :receiver Hans Heiri}}
2023-12-08T16:53:30.532Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}

2023-12-08T16:53:30.532Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:requestData {:category "c8e8b53a-f85a-4500-88ee-b7fd16d201d3", :motivation "And why not", :article_number "12345", :price_cents 50000, :budget_period "385fb05e-775b-427c-a16e-135457fb8afe", :article_name "Camera", :replacement false, :attachments [], :supplier_name "Supplier S", :requested_quantity "10", :priority "HIGH", :room "7af4884b-5dc1-470b-ae6e-f36a8c403115", :receiver "Hans Heiri"}}
2023-12-08T16:53:30.532Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185792745460083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xd19e26c "HikariProxyConnection@219800172 wrapping org.postgresql.jdbc.PgConnection@4b7cc6fb"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "593", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x307bc121 "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xf483a16 "HikariProxyConnection@256391702 wrapping org.postgresql.jdbc.PgConnection@16552193"], :level 2, :rollback #object[clojure.lang.Atom 0x321e30e4 {:status :ready, :val false}]}, :content-length 593, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "createRequest", :variables {:requestData {:category "c8e8b53a-f85a-4500-88ee-b7fd16d201d3", :motivation "And why not", :article_number "12345", :price_cents 50000, :budget_period "385fb05e-775b-427c-a16e-135457fb8afe", :article_name "Camera", :replacement false, :attachments [], :supplier_name "Supplier S", :requested_quantity "10", :priority "HIGH", :room "7af4884b-5dc1-470b-ae6e-f36a8c403115", :receiver "Hans Heiri"}}, :query "mutation createRequest($requestData: CreateRequestInput) {\n  create_request(input_data: $requestData) {\n    id\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>oo> past? budget-period= {:id #uuid "385fb05e-775b-427c-a16e-135457fb8afe", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T16:53:26.408836Z", :updated_at #time/instant "2023-12-08T16:53:26.408836Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
2023-12-08T16:53:30.546Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:369] - (or (and requester own-request) category-viewer inspector admin) => true
2023-12-08T16:53:30.546Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:370] - (and (not template) (not past-phase) (or (and new-request requester (or (and requesting-phase (or own-request inspector)) (and inspection-phase category-inspector) admin)) (and existing-request (or admin category-inspector (and requesting-phase requester own-request))))) => true
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T16:53:30.616Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> tbl :models
>o> nest-key :model
2023-12-08T16:53:30.617Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T16:53:30.617Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T16:53:30.618Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>o> tbl :users
>o> nest-key :user
2023-12-08T16:53:30.618Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id #uuid "b4b35948-4df2-4099-b809-43957b864807"]}
>oo> past? budget-period= {:id #uuid "385fb05e-775b-427c-a16e-135457fb8afe", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T16:53:26.408836Z", :updated_at #time/instant "2023-12-08T16:53:26.408836Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
2023-12-08T16:53:30.647Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:369] - (or (and requester own-request) category-viewer inspector admin) => true
2023-12-08T16:53:30.648Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:370] - (and (not template) (not past-phase) (or (and new-request requester (or (and requesting-phase (or own-request inspector)) (and inspection-phase category-inspector) admin)) (and existing-request (or admin category-inspector (and requesting-phase requester own-request))))) => true

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185792745460083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xd19e26c HikariProxyConnection@219800172 wrapping org.postgresql.jdbc.PgConnection@4b7cc6fb], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 593, referer http://localhost:3230/procure/requests/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x307bc121 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xf483a16 HikariProxyConnection@256391702 wrapping org.postgresql.jdbc.PgConnection@16552193], :level 2, :rollback #object[clojure.lang.Atom 0x321e30e4 {:status :ready, :val false}]}, :content-length 593, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName createRequest, :variables {:requestData {:category c8e8b53a-f85a-4500-88ee-b7fd16d201d3, :motivation And why not, :article_number 12345, :price_cents 50000, :budget_period 385fb05e-775b-427c-a16e-135457fb8afe, :article_name Camera, :replacement false, :attachments [], :supplier_name Supplier S, :requested_quantity 10, :priority HIGH, :room 7af4884b-5dc1-470b-ae6e-f36a8c403115, :receiver Hans Heiri}}, :query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185792745460083,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"593","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=385fb05e-775b-427c-a16e-135457fb8afe&category=c8e8b53a-f85a-4500-88ee-b7fd16d201d3","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":593,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"createRequest","variables":{"requestData":{"category":"c8e8b53a-f85a-4500-88ee-b7fd16d201d3","motivation":"And why not","article_number":"12345","price_cents":50000,"budget_period":"385fb05e-775b-427c-a16e-135457fb8afe","article_name":"Camera","replacement":false,"attachments":[],"supplier_name":"Supplier S","requested_quantity":"10","priority":"HIGH","room":"7af4884b-5dc1-470b-ae6e-f36a8c403115","receiver":"Hans Heiri"}},"query":"mutation createRequest($requestData: CreateRequestInput) {\n  create_request(input_data: $requestData) {\n    id\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:create_request #ordered/map ([:id b4b35948-4df2-4099-b809-43957b864807] [:__typename :Request])])}
2023-12-08T16:53:30.651Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:create_request #ordered/map ([:id "b4b35948-4df2-4099-b809-43957b864807"] [:__typename :Request])])}
2023-12-08T16:53:30.651Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:create_request #ordered/map ([:id "b4b35948-4df2-4099-b809-43957b864807"] [:__typename :Request])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185792911003541, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a55b928 /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:30.690Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185792910941625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 5678, referer http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x58e2e9b7 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [b4b35948-4df2-4099-b809-43957b864807]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:30.694Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:30.699Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T16:53:30.702Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T16:53:30.703Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T16:53:30.703Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:30.703Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185792911003541, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "502", "referer" "http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a55b928 "/127.0.0.1:3230<->/127.0.0.1:53010"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>>>exec-query::variables {:id [b4b35948-4df2-4099-b809-43957b864807]}
2023-12-08T16:53:30.710Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T16:53:30.710Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:id ["b4b35948-4df2-4099-b809-43957b864807"]}
2023-12-08T16:53:30.710Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185792910941625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "5678", "referer" "http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x58e2e9b7 "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestForEdit", :variables {:id ["b4b35948-4df2-4099-b809-43957b864807"]}, :query "query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T16:53:30.722Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T16:53:30.722Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T16:53:30.722Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id 2023-12-08T16:53:30.723Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session #sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] {:value [e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr #sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] 127.0.0.1, #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category :start-time [185792911003541, :params #sql/call [:row_to_json :models] {}, :model] :settings #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization {[:email_sending_enabled false, :sessions_max_lifetime_secs #sql/call [:row_to_json :procurement_templates] :template] 432000, :smtp_default_from_address your.lending.desk@example.com, #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room :public_image_caching_enabled true, [:sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, #sql/call [:row_to_json :suppliers] :sessions_force_uniqueness false, :supplier]:email_signature )Cheers,}, , :tx-next :from (:procurement_requests), :left-join (:models [#:= :models.id :procurement_requests.model_id] :procurement_templates next.jdbc.default_options.DefaultOptions[:= :procurement_templates.id :procurement_requests.template_id] :suppliers {[:= :suppliers.id :procurement_requests.supplier_id]), :order-by (:connectable #sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
#object[>o> tbl com.zaxxer.hikari.HikariDataSource :users
>o> nest-key :user
0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a55b928 /127.0.0.1:3230<->/127.0.0.1:53010], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-08T16:53:30.723Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185792911003541,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests\/b4b35948-4df2-4099-b809-43957b864807","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8aa2467a-f1b4-4b2a-bc3b-8177b0267685] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:30.723Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:30.723Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>oo> past? budget-period= {:id #uuid "385fb05e-775b-427c-a16e-135457fb8afe", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T16:53:26.408836Z", :updated_at #time/instant "2023-12-08T16:53:26.408836Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
2023-12-08T16:53:30.756Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:369] - (or (and requester own-request) category-viewer inspector admin) => true
2023-12-08T16:53:30.756Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:370] - (and (not template) (not past-phase) (or (and new-request requester (or (and requesting-phase (or own-request inspector)) (and inspection-phase category-inspector) admin)) (and existing-request (or admin category-inspector (and requesting-phase requester own-request))))) => true
>debug 2
>debug 3
2023-12-08T16:53:30.764Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format main-categories-base-query) => ["SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC"]
>debug 4
>debug 5 {:id #uuid "213c3067-e101-40a9-9357-3688accfdfd5", :name Sarchimor}
>debug 5a id #uuid "213c3067-e101-40a9-9357-3688accfdfd5"
2023-12-08T16:53:30.765Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format (image/image-query-for-main-category (:id mc))) => ["SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]
>debug 5b nil
2023-12-08T16:53:30.766Z NX-41294 DEBUG [leihs.procurement.resources.categories:?] - (sql/format (sql/merge-where categories-base-query [:= :procurement_categories.main_category_id main-cat-id])) => ["SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC" #uuid "213c3067-e101-40a9-9357-3688accfdfd5"]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185792910941625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 5678, referer http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x58e2e9b7 /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [b4b35948-4df2-4099-b809-43957b864807]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185792910941625,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"5678","referer":"http:\/\/localhost:3230\/procure\/requests\/b4b35948-4df2-4099-b809-43957b864807","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5678,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestForEdit","variables":{"id":["b4b35948-4df2-4099-b809-43957b864807"]},"query":"query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:requests [#ordered/map ([:id b4b35948-4df2-4099-b809-43957b864807] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 8aa2467a-f1b4-4b2a-bc3b-8177b0267685] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:name Colombia] [:main_category #ordered/map ([:id 213c3067-e101-40a9-9357-3688accfdfd5] [:name Sarchimor] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id 385fb05e-775b-427c-a16e-135457fb8afe] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value Hans Heiri] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 1e4b2229-65d6-42f4-bdc6-8ae9e9b16883] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id f8c92637-ddb2-4b83-8e1e-f19889110dd5] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value 12345] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value Supplier S] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 7af4884b-5dc1-470b-ae6e-f36a8c403115] [:name Room R] [:building #ordered/map ([:id 04779b08-4683-4db3-a8e0-6af47b52f8ae] [:name Building B] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value And why not] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id 213c3067-e101-40a9-9357-3688accfdfd5] [:name Sarchimor] [:categories [#ordered/map ([:id c8e8b53a-f85a-4500-88ee-b7fd16d201d3] [:name Colombia] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id 385fb05e-775b-427c-a16e-135457fb8afe] [:name Budget-Period-BP] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:30.773Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "b4b35948-4df2-4099-b809-43957b864807"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:main_category #ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "1e4b2229-65d6-42f4-bdc6-8ae9e9b16883"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f8c92637-ddb2-4b83-8e1e-f19889110dd5"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "7af4884b-5dc1-470b-ae6e-f36a8c403115"] [:name "Room R"] [:building #ordered/map ([:id "04779b08-4683-4db3-a8e0-6af47b52f8ae"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:30.773Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:requests [#ordered/map ([:id "b4b35948-4df2-4099-b809-43957b864807"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:main_category #ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "1e4b2229-65d6-42f4-bdc6-8ae9e9b16883"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f8c92637-ddb2-4b83-8e1e-f19889110dd5"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "7af4884b-5dc1-470b-ae6e-f36a8c403115"] [:name "Room R"] [:building #ordered/map ([:id "04779b08-4683-4db3-a8e0-6af47b52f8ae"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "213c3067-e101-40a9-9357-3688accfdfd5"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "c8e8b53a-f85a-4500-88ee-b7fd16d201d3"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "385fb05e-775b-427c-a16e-135457fb8afe"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44405 0x6f2633d8 leihs.core.locale$wrap$fn__44405@6f2633d8]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185793062194166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x687ed4ba /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T16:53:30.844Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T16:53:30.846Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T16:53:30.848Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T16:53:30.848Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T16:53:30.848Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "ff17a22c-83a7-4e37-ad5b-785fe44b5bca"}, "leihs-user-session" {:value "e94f4dcc-8022-457d-b8cf-3fda62903944"}}, :remote-addr "127.0.0.1", :start-time 185793062194166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf "next.jdbc.result_set$as_unqualified_lower_maps@755637cf"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944", "content-length" "502", "referer" "http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807", "connection" "keep-alive", "x-csrf-token" "ff17a22c-83a7-4e37-ad5b-785fe44b5bca", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x687ed4ba "/127.0.0.1:3230<->/127.0.0.1:53005"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 "leihs.procurement.graphql$handler@583fb4f5"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T16:53:27.065242Z", :id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :user_session_id #uuid "7e50d193-d8bc-4762-ac6b-d00954edbc13", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8aa2467a-f1b4-4b2a-bc3b-8177b0267685", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value ff17a22c-83a7-4e37-ad5b-785fe44b5bca}, leihs-user-session {:value e94f4dcc-8022-457d-b8cf-3fda62903944}}, :remote-addr 127.0.0.1, :start-time 185793062194166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x19181c37 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x755637cf next.jdbc.result_set$as_unqualified_lower_maps@755637cf]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944, content-length 502, referer http://localhost:3230/procure/requests/b4b35948-4df2-4099-b809-43957b864807, connection keep-alive, x-csrf-token ff17a22c-83a7-4e37-ad5b-785fe44b5bca, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x687ed4ba /127.0.0.1:3230<->/127.0.0.1:53005], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x46968315 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x583fb4f5 leihs.procurement.graphql$handler@583fb4f5], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T16:53:27.065242Z","id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","user_session_id":"7e50d193-d8bc-4762-ac6b-d00954edbc13","scope_system_admin_read":false,"access-rights":[],"user_id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca"},"leihs-user-session":{"value":"e94f4dcc-8022-457d-b8cf-3fda62903944"}},"remote-addr":"127.0.0.1","start-time":185793062194166,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=ff17a22c-83a7-4e37-ad5b-785fe44b5bca; leihs-user-session=e94f4dcc-8022-457d-b8cf-3fda62903944","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests\/b4b35948-4df2-4099-b809-43957b864807","connection":"keep-alive","x-csrf-token":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"ff17a22c-83a7-4e37-ad5b-785fe44b5bca","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8aa2467a-f1b4-4b2a-bc3b-8177b0267685","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8aa2467a-f1b4-4b2a-bc3b-8177b0267685] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:30.863Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T16:53:30.863Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"ff17a22c-83a7-4e37-ad5b-785fe44b5bca\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8aa2467a-f1b4-4b2a-bc3b-8177b0267685\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8aa2467a-f1b4-4b2a-bc3b-8177b0267685"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
