# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
2023-12-04T11:53:38.998Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-04T11:53:39.568Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-04T11:53:39.575Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x7cf7a1d6 "taoensso.timbre$default_output_fn@7cf7a1d6"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x11abc93b "taoensso.timbre.appenders.core$println_appender$fn__3459@11abc93b"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-04T11:53:39.577Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-04T11:53:39.588Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 62993, :repl-port-file ".nrepl-port"}
2023-12-04T11:53:39.591Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  62993 localhost
2023-12-04T11:53:39.611Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-04T11:53:39.615Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 62993, :repl-port-file .nrepl-port}
2023-12-04T11:53:39.615Z NX-41294 INFO [leihs.core.shutdown:20] - PID 40982
2023-12-04T11:53:39.638Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-04T11:53:39.700Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-04T11:53:39.702Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-04T11:53:39.710Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-04T11:53:39.781Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@167bb050
2023-12-04T11:53:39.787Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-04T11:53:39.787Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 "HikariDataSource (db-pool)"]}
2023-12-04T11:53:39.788Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-04T11:53:39.802Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-04T11:53:39.813Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6db7fba2
2023-12-04T11:53:39.813Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-04T11:53:39.819Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 "next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182"]}}
2023-12-04T11:53:39.826Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x468a89e6 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x676d1984 "java.util.concurrent.ThreadPoolExecutor@676d1984[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-04T11:53:39.837Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x4293af84 leihs.core.locale$wrap$fn__44359@4293af84]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 14727956635083, :params {:return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {:return-to /procure}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0xb66bf87 /127.0.0.1:3230<->/127.0.0.1:63215], :server-port 3230, :params-raw {:return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1b02e752 compojure.core$routes$fn__27950@1b02e752], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}
2023-12-04T11:53:46.631Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => nil
2023-12-04T11:53:46.636Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
>myprint>  admin false
2023-12-04T11:53:46.641Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-04T11:53:46.645Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-04T11:53:46.648Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(NULL AS UUID)"]
>myprint>  requester false

> 1 anti-csrf-token >  nil

> 1 anti-csrf-token class >  nil

> 2 anti-csrf-token-new >  f4bcaf77-f217-4222-b2c2-9c534b228e3e
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x4293af84 leihs.core.locale$wrap$fn__44359@4293af84]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value f4bcaf77-f217-4222-b2c2-9c534b228e3e}}, :remote-addr 127.0.0.1, :start-time 14733431653083, :params {:user beat.rohrer@zhdk.ch, :password password, :csrf-token f4bcaf77-f217-4222-b2c2-9c534b228e3e, :return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5a40749c HikariProxyConnection@1514173596 wrapping org.postgresql.jdbc.PgConnection@6db7fba2], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=f4bcaf77-f217-4222-b2c2-9c534b228e3e, content-length 113, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3890d02e /127.0.0.1:3230<->/127.0.0.1:63215], :server-port 3230, :params-raw {:user beat.rohrer@zhdk.ch, :password password, :csrf-token f4bcaf77-f217-4222-b2c2-9c534b228e3e, :return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6bb5caa5 HikariProxyConnection@1807076005 wrapping org.postgresql.jdbc.PgConnection@167bb050], :level 1, :rollback #object[clojure.lang.Atom 0x32963cfe {:status :ready, :val false}]}, :content-length 113, :form-params {:user beat.rohrer@zhdk.ch, :password password, :csrf-token f4bcaf77-f217-4222-b2c2-9c534b228e3e, :return-to /procure}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user beat.rohrer@zhdk.ch, :password password, :csrf-token f4bcaf77-f217-4222-b2c2-9c534b228e3e, :return-to /procure}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0xa1b1b20 BytesInputStream[len=113]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1b02e752 compojure.core$routes$fn__27950@1b02e752], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6bb5caa5 HikariProxyConnection@1807076005 wrapping org.postgresql.jdbc.PgConnection@167bb050], :level 1, :rollback #object[clojure.lang.Atom 0x32963cfe {:status :ready, :val false}]}
2023-12-04T11:53:52.088Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => nil
2023-12-04T11:53:52.091Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
>myprint>  admin false
2023-12-04T11:53:52.092Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-04T11:53:52.093Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-04T11:53:52.094Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(NULL AS UUID)"]
>myprint>  requester false

> 1 anti-csrf-token >  f4bcaf77-f217-4222-b2c2-9c534b228e3e

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email beat.rohrer@zhdk.ch, :contracts_count 23, :lastname Rohrer, :org_id 186835, :scope_read true, :is_admin false, :authentication-method :session, :login brohrer, :scope_system_admin_write false, :scope_write true, :firstname Beat, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T11:53:52.178741Z", :id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :user_session_id #uuid "4d3058e2-e191-46c4-b470-f53188f57203", :scope_system_admin_read false, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "4a1ba40c-467e-5efe-8cf1-e8d3dbb59f04"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role customer, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :is_system_admin false, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x4293af84 leihs.core.locale$wrap$fn__44359@4293af84]

>> authorize::request > {:authenticated-entity {:email beat.rohrer@zhdk.ch, :contracts_count 23, :lastname Rohrer, :org_id 186835, :scope_read true, :is_admin false, :authentication-method :session, :login brohrer, :scope_system_admin_write false, :scope_write true, :firstname Beat, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T11:53:52.178741Z", :id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :user_session_id #uuid "4d3058e2-e191-46c4-b470-f53188f57203", :scope_system_admin_read false, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "4a1ba40c-467e-5efe-8cf1-e8d3dbb59f04"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role customer, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :is_system_admin false, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value f4bcaf77-f217-4222-b2c2-9c534b228e3e}, leihs-user-session {:value 25d92cce-dd0e-41bb-8eb7-709b0aea69c2}}, :remote-addr 127.0.0.1, :start-time 14733583373000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x406008f1 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4ae5c182 next.jdbc.result_set$as_unqualified_lower_maps@4ae5c182]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=f4bcaf77-f217-4222-b2c2-9c534b228e3e; leihs-user-session=25d92cce-dd0e-41bb-8eb7-709b0aea69c2, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4ae6784 /127.0.0.1:3230<->/127.0.0.1:63215], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x41acf975 leihs.procurement.backend.html$not_found_handler@41acf975], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email beat.rohrer@zhdk.ch, :contracts_count 23, :lastname Rohrer, :org_id 186835, :scope_read true, :is_admin false, :authentication-method :session, :login brohrer, :scope_system_admin_write false, :scope_write true, :firstname Beat, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T11:53:52.178741Z", :id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :user_session_id #uuid "4d3058e2-e191-46c4-b470-f53188f57203", :scope_system_admin_read false, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "4a1ba40c-467e-5efe-8cf1-e8d3dbb59f04"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role customer, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :is_system_admin false, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x4bf9c584 HikariDataSource (db-pool)]}
2023-12-04T11:53:52.256Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "beat.rohrer@zhdk.ch", :contracts_count 23, :lastname "Rohrer", :org_id "186835", :scope_read true, :is_admin false, :authentication-method :session, :login "brohrer", :scope_system_admin_write false, :scope_write true, :firstname "Beat", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T11:53:52.178741Z", :id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :user_session_id #uuid "4d3058e2-e191-46c4-b470-f53188f57203", :scope_system_admin_read false, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "4a1ba40c-467e-5efe-8cf1-e8d3dbb59f04"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "customer", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :is_system_admin false, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 9, :scope_admin_read false}
2023-12-04T11:53:52.258Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
>myprint>  admin false
2023-12-04T11:53:52.259Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-04T11:53:52.260Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-04T11:53:52.260Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b"]
>myprint>  requester false
2023-12-04T11:53:52.261Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "beat.rohrer@zhdk.ch", :contracts_count 23, :lastname "Rohrer", :org_id "186835", :scope_read true, :is_admin false, :authentication-method :session, :login "brohrer", :scope_system_admin_write false, :scope_write true, :firstname "Beat", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-04T11:53:52.178741Z", :id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :user_session_id #uuid "4d3058e2-e191-46c4-b470-f53188f57203", :scope_system_admin_read false, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "4a1ba40c-467e-5efe-8cf1-e8d3dbb59f04"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "customer", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b", :is_system_admin false, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 9, :scope_admin_read false}
2023-12-04T11:53:52.263Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => nil
2023-12-04T11:53:52.263Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-04T11:53:52.264Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-04T11:53:52.266Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "b363936a-fd9c-567a-82a4-f0b523dbb26b"]
