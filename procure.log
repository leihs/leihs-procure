# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
>o> templates::templates-base-query ERROR?
2023-12-08T08:43:30.435Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-08T08:43:30.998Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-08T08:43:31.005Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x635bd5c5 "taoensso.timbre$default_output_fn@635bd5c5"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x65b6c1dc "taoensso.timbre.appenders.core$println_appender$fn__3459@65b6c1dc"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-08T08:43:31.007Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-08T08:43:31.019Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 42972, :repl-port-file ".nrepl-port"}
2023-12-08T08:43:31.021Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  42972 localhost
2023-12-08T08:43:31.040Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-08T08:43:31.043Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 42972, :repl-port-file .nrepl-port}
2023-12-08T08:43:31.044Z NX-41294 INFO [leihs.core.shutdown:20] - PID 1476
2023-12-08T08:43:31.071Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-08T08:43:31.132Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-08T08:43:31.133Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-08T08:43:31.141Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-08T08:43:31.212Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@38ca26f5
2023-12-08T08:43:31.218Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-08T08:43:31.219Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd "HikariDataSource (db-pool)"]}
2023-12-08T08:43:31.220Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-08T08:43:31.233Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-08T08:43:31.244Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@15a94830
2023-12-08T08:43:31.245Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-08T08:43:31.250Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 "next.jdbc.result_set$as_unqualified_lower_maps@73775793"]}}
2023-12-08T08:43:31.256Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x7718b69d "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x60a4886f "java.util.concurrent.ThreadPoolExecutor@60a4886f[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-08T08:43:31.268Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 156980619978833, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x15a5dd09 /127.0.0.1:3230<->/127.0.0.1:56859], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:43:47.958Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:43:47.961Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:43:47.965Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:43:47.967Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  nil

> 1 anti-csrf-token class >  nil

> 2 anti-csrf-token-new >  716aff6d-4b80-4f0a-9eaf-108fc5664c09
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}}, :remote-addr 127.0.0.1, :start-time 156980916112166, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x726b1202 /127.0.0.1:3230<->/127.0.0.1:56859], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:43:48.191Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:43:48.192Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:43:48.192Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:43:48.193Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}}, :remote-addr 127.0.0.1, :start-time 156981034622750, :params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2192daa4 HikariProxyConnection@563272356 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09, content-length 98, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2b41e5b0 /127.0.0.1:3230<->/127.0.0.1:56859], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x4cb3dfde HikariProxyConnection@1286856670 wrapping org.postgresql.jdbc.PgConnection@38ca26f5], :level 1, :rollback #object[clojure.lang.Atom 0x395472e3 {:status :ready, :val false}]}, :content-length 98, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0xa0a531 BytesInputStream[len=98]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2192daa4 HikariProxyConnection@563272356 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:43:48.316Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:43:48.318Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:43:48.319Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:43:48.319Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}}, :remote-addr 127.0.0.1, :start-time 156981145250625, :params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7e1312b1 HikariProxyConnection@2115179185 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09, content-length 106, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5b3856ed /127.0.0.1:3230<->/127.0.0.1:56859], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x115b87b2 HikariProxyConnection@291211186 wrapping org.postgresql.jdbc.PgConnection@38ca26f5], :level 1, :rollback #object[clojure.lang.Atom 0x2f60f5c4 {:status :ready, :val false}]}, :content-length 106, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x4980ec03 BytesInputStream[len=106]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7e1312b1 HikariProxyConnection@2115179185 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:43:48.416Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:43:48.417Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:43:48.418Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:43:48.419Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, leihs-user-session {:value 1f8d30fd-53cd-4d56-87d1-280a37fdd67d}}, :remote-addr 127.0.0.1, :start-time 156981235249500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09; leihs-user-session=1f8d30fd-53cd-4d56-87d1-280a37fdd67d, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1d682bca /127.0.0.1:3230<->/127.0.0.1:56859], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x54dd01df leihs.procurement.backend.html$not_found_handler@54dd01df], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.527Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.528Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.529Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.530Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.531Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.532Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.533Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.533Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, leihs-user-session {:value 1f8d30fd-53cd-4d56-87d1-280a37fdd67d}}, :remote-addr 127.0.0.1, :start-time 156981461709416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09; leihs-user-session=1f8d30fd-53cd-4d56-87d1-280a37fdd67d, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x77f8f03c /127.0.0.1:3230<->/127.0.0.1:56868], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x54dd01df leihs.procurement.backend.html$not_found_handler@54dd01df], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.740Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.741Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.742Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.743Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.744Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.744Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.745Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.746Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, leihs-user-session {:value 1f8d30fd-53cd-4d56-87d1-280a37fdd67d}}, :remote-addr 127.0.0.1, :start-time 156981472900375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09; leihs-user-session=1f8d30fd-53cd-4d56-87d1-280a37fdd67d, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x43df1fc9 /127.0.0.1:3230<->/127.0.0.1:56859], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.783Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.784Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.785Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.786Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.787Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.788Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.788Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.789Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:43:48.793Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"
2023-12-08T08:43:48.803Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"
>>>2 {:id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :firstname Krysta, :lastname Pfeffer}
>>oida>> #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"
2023-12-08T08:43:48.806Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.828Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:48.829Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
2023-12-08T08:43:48.885Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"716aff6d-4b80-4f0a-9eaf-108fc5664c09\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"9b451a2d-33b1-4a8b-8ec5-e10542581ce0\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, leihs-user-session {:value 1f8d30fd-53cd-4d56-87d1-280a37fdd67d}}, :remote-addr 127.0.0.1, :start-time 156981718151416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09; leihs-user-session=1f8d30fd-53cd-4d56-87d1-280a37fdd67d, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x725bce48 /127.0.0.1:3230<->/127.0.0.1:56869], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.000Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.002Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.003Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.004Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.004Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.005Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.005Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.006Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:43:49.012Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"
2023-12-08T08:43:49.014Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"
>>>2 {:id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :firstname Krysta, :lastname Pfeffer}
>>oida>> #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"
2023-12-08T08:43:49.015Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>>>3 nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, leihs-user-session {:value 1f8d30fd-53cd-4d56-87d1-280a37fdd67d}}, :remote-addr 127.0.0.1, :start-time 156981717774125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09; leihs-user-session=1f8d30fd-53cd-4d56-87d1-280a37fdd67d, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x699c9511 /127.0.0.1:3230<->/127.0.0.1:56868], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.021Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.023Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) >o> inspector? #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
{:result false}
>myprint>  inspector false
2023-12-08T08:43:49.024Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.024Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.025Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
2023-12-08T08:43:49.025Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.026Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.027Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
2023-12-08T08:43:49.027Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"716aff6d-4b80-4f0a-9eaf-108fc5664c09\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"9b451a2d-33b1-4a8b-8ec5-e10542581ce0\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.027Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.028Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:43:49.041Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, leihs-user-session {:value 1f8d30fd-53cd-4d56-87d1-280a37fdd67d}}, :remote-addr 127.0.0.1, :start-time 156981717866000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09; leihs-user-session=1f8d30fd-53cd-4d56-87d1-280a37fdd67d, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x51cca318 /127.0.0.1:3230<->/127.0.0.1:56859], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.047Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.048Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.049Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.049Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.050Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.050Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.054Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.055Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>>get-dashboard
>>args {}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
pure-handler >> 2
2023-12-08T08:43:49.058Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>ToCheck mainCats [{:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Sarchimor}]
>>queryA1 [SELECT * FROM procurement_budget_periods ORDER BY end_date DESC]
>>ToCheck dashboard:::procurement_budget_periods.id [{:id #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:43:47.804579000-00:00", :updated_at #inst "2023-12-08T08:43:47.804579000-00:00"}]
>>resultA1-2 [{:id #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:43:47.804579000-00:00", :updated_at #inst "2023-12-08T08:43:47.804579000-00:00"}]
>>requestsB2-triggerError {} nil
>o> helper1 id= nil
>o> helper2 nil nil nil
>oo> helper3a priority nil
>oo> helper3b priority nil
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority nil
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.078Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.078Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:43:49.081Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 nil nil nil
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) nil
>o> apply-scope #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.084Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.084Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.087Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.088Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.090Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
2023-12-08T08:43:49.099Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "81963e8d-03d4-4c17-b2a5-6045a4a15bd8"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "974a6905-a7c5-4b1c-bed7-ddc64355d26a"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "1e5c626a-2595-4c18-9bb0-776dc94c39d3"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "1a786098-c0db-46d1-b9d3-9a1d1b1b59d6"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "bad2c1dc-773c-4706-a79d-188b79d2b9ab"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
>o> >o> HERE :row-fn ()
>o>dashboard-cache-keyB2 {:id -15128758}
2023-12-08T08:43:49.118Z NX-41294 DEBUG [leihs.procurement.dashboard:228] - (count requests) => 0
2023-12-08T08:43:49.119Z NX-41294 DEBUG [leihs.procurement.dashboard:229] - (cache-key dashboard-cache-key) => -15128758
>o> bp {:id #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:43:47.804579000-00:00", :updated_at #inst "2023-12-08T08:43:47.804579000-00:00"}
>oo> 1sum-total-price :total_price_cents (>o> mc {:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Sarchimor}
>o> filter-and-assoc-cats ()
>oo> 1sum-total-price :total_price_cents (>o> c {:id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :name Colombia, :main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> c {:id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :name Colombia, :main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> 2 requests* ()
>oo> 1sum-total-price :total_price_cents ()
>oo> 2sum-total-price :total_price_cents ()
>>1 0

>o> result 1a {:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3, :cost_center nil} 

{:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3, :cost_center nil})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0

>>ToCheck dashboard::determine-budget-periods {:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Sarchimor, :categories ({:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3, :cost_center nil}), :total_price_cents 0, :cacheKey -15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a} 

{:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Sarchimor, :categories ({:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3, :cost_center nil}), :total_price_cents 0, :cacheKey -15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0
2023-12-08T08:43:49.119Z NX-41294 DEBUG [leihs.procurement.dashboard:230] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ({:main_categories ({:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name "Sarchimor", :categories ({:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name "Colombia", :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey "-15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3", :cost_center nil}), :total_price_cents 0, :cacheKey "-15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a"}), :name "Budget-Period-BP", :updated_at #inst "2023-12-08T08:43:47.804579000-00:00", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :id #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :total_price_cents 0, :cacheKey "-15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :created_at #inst "2023-12-08T08:43:47.804579000-00:00"})
2023-12-08T08:43:49.123Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 0] [:budget_periods [#ordered/map ([:id "81963e8d-03d4-4c17-b2a5-6045a4a15bd8"] [:cacheKey "-15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "974a6905-a7c5-4b1c-bed7-ddc64355d26a"] [:cacheKey "-15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "1e5c626a-2595-4c18-9bb0-776dc94c39d3"] [:cacheKey "-15128758_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 716aff6d-4b80-4f0a-9eaf-108fc5664c09}, leihs-user-session {:value 1f8d30fd-53cd-4d56-87d1-280a37fdd67d}}, :remote-addr 127.0.0.1, :start-time 156981917883791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=716aff6d-4b80-4f0a-9eaf-108fc5664c09; leihs-user-session=1f8d30fd-53cd-4d56-87d1-280a37fdd67d, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 716aff6d-4b80-4f0a-9eaf-108fc5664c09, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x646f2ed4 /127.0.0.1:3230<->/127.0.0.1:56868], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [bad2c1dc-773c-4706-a79d-188b79d2b9ab], :categories [1e5c626a-2595-4c18-9bb0-776dc94c39d3], :priority [NORMAL HIGH], :budgetPeriods [81963e8d-03d4-4c17-b2a5-6045a4a15bd8]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.204Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.205Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.206Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.206Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.207Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.208Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.208Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.209Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  716aff6d-4b80-4f0a-9eaf-108fc5664c09

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:43:49.224Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["bad2c1dc-773c-4706-a79d-188b79d2b9ab"], :categories ["1e5c626a-2595-4c18-9bb0-776dc94c39d3"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["81963e8d-03d4-4c17-b2a5-6045a4a15bd8"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MEDIUM HIGH MANDATORY] {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [bad2c1dc-773c-4706-a79d-188b79d2b9ab], :categories [1e5c626a-2595-4c18-9bb0-776dc94c39d3], :priority [NORMAL HIGH], :budgetPeriods [81963e8d-03d4-4c17-b2a5-6045a4a15bd8]}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [bad2c1dc-773c-4706-a79d-188b79d2b9ab], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [81963e8d-03d4-4c17-b2a5-6045a4a15bd8], :category_id [1e5c626a-2595-4c18-9bb0-776dc94c39d3]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats [{:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Sarchimor}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8"]
>>ToCheck dashboard:::procurement_budget_periods.id [{:id #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:43:47.804579000-00:00", :updated_at #inst "2023-12-08T08:43:47.804579000-00:00"}]
>>resultA1-2 [{:id #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:43:47.804579000-00:00", :updated_at #inst "2023-12-08T08:43:47.804579000-00:00"}]
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [bad2c1dc-773c-4706-a79d-188b79d2b9ab], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [81963e8d-03d4-4c17-b2a5-6045a4a15bd8], :category_id [1e5c626a-2595-4c18-9bb0-776dc94c39d3]} nil
>o> helper1 id= nil
>o> helper2 [1e5c626a-2595-4c18-9bb0-776dc94c39d3] [81963e8d-03d4-4c17-b2a5-6045a4a15bd8] [bad2c1dc-773c-4706-a79d-188b79d2b9ab]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>debug> 1a
>debug> 1a
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
low medium high mandatory)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
not_processed in_progress procured alternative_procured not_procured)
>oo> helper5c :order_status java.lang.String
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.241Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.241Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.242Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:43:49.243Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low medium high mandatory) (normal high)
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) nil
>debug> 2
>oo> >here> to-name-and-lower-case-enums (not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.245Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.246Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN (CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM))) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 1e5c626a-2595-4c18-9bb0-776dc94c39d3 81963e8d-03d4-4c17-b2a5-6045a4a15bd8 bad2c1dc-773c-4706-a79d-188b79d2b9ab normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:43:48.446942Z", :id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :user_session_id #uuid "f17202f3-b7cc-47d8-be83-df822814f2dd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN (CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM))) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 1e5c626a-2595-4c18-9bb0-776dc94c39d3 81963e8d-03d4-4c17-b2a5-6045a4a15bd8 bad2c1dc-773c-4706-a79d-188b79d2b9ab normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.249Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.250Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
2023-12-08T08:43:49.250Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "9b451a2d-33b1-4a8b-8ec5-e10542581ce0"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn ()
>o>dashboard-cache-keyB2 {:id -2003871230}
2023-12-08T08:43:49.256Z NX-41294 DEBUG [leihs.procurement.dashboard:228] - (count requests) => 0
2023-12-08T08:43:49.256Z NX-41294 DEBUG [leihs.procurement.dashboard:229] - (cache-key dashboard-cache-key) => -2003871230
>o> bp {:id #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:43:47.804579000-00:00", :updated_at #inst "2023-12-08T08:43:47.804579000-00:00"}
>oo> 1sum-total-price :total_price_cents (>o> mc {:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Sarchimor}
>o> filter-and-assoc-cats ()
>oo> 1sum-total-price :total_price_cents (>o> c {:id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :name Colombia, :main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> c {:id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :name Colombia, :main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> 2 requests* ()
>oo> 1sum-total-price :total_price_cents ()
>oo> 2sum-total-price :total_price_cents ()
>>1 0

>o> result 1a {:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey -2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3, :cost_center nil} 

{:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey -2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3, :cost_center nil})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0

>>ToCheck dashboard::determine-budget-periods {:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Sarchimor, :categories ({:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey -2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3, :cost_center nil}), :total_price_cents 0, :cacheKey -2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a} 

{:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Sarchimor, :categories ({:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name Colombia, :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey -2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3, :cost_center nil}), :total_price_cents 0, :cacheKey -2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0
2023-12-08T08:43:49.256Z NX-41294 DEBUG [leihs.procurement.dashboard:230] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ({:main_categories ({:id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name "Sarchimor", :categories ({:main_category_id #uuid "974a6905-a7c5-4b1c-bed7-ddc64355d26a", :name "Colombia", :requests (), :general_ledger_account nil, :id #uuid "1e5c626a-2595-4c18-9bb0-776dc94c39d3", :total_price_cents 0, :procurement_account nil, :cacheKey "-2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3", :cost_center nil}), :total_price_cents 0, :cacheKey "-2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a"}), :name "Budget-Period-BP", :updated_at #inst "2023-12-08T08:43:47.804579000-00:00", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :id #uuid "81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :total_price_cents 0, :cacheKey "-2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8", :created_at #inst "2023-12-08T08:43:47.804579000-00:00"})
2023-12-08T08:43:49.258Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-2003871230"] [:total_count 0] [:budget_periods [#ordered/map ([:id "81963e8d-03d4-4c17-b2a5-6045a4a15bd8"] [:cacheKey "-2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "974a6905-a7c5-4b1c-bed7-ddc64355d26a"] [:cacheKey "-2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "1e5c626a-2595-4c18-9bb0-776dc94c39d3"] [:cacheKey "-2003871230_81963e8d-03d4-4c17-b2a5-6045a4a15bd8_974a6905-a7c5-4b1c-bed7-ddc64355d26a_1e5c626a-2595-4c18-9bb0-776dc94c39d3"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 157000895579041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6da57331 /127.0.0.1:3230<->/127.0.0.1:56965], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:08.178Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:08.179Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:08.183Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:08.184Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  nil

> 1 anti-csrf-token class >  nil

> 2 anti-csrf-token-new >  be2c64df-1af5-4533-bccd-a02fd55d6dcc
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}}, :remote-addr 127.0.0.1, :start-time 157001025092083, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6af9be5f /127.0.0.1:3230<->/127.0.0.1:56965], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:08.296Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:08.298Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:08.299Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:08.299Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}}, :remote-addr 127.0.0.1, :start-time 157001142327375, :params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x31eb2c46 HikariProxyConnection@837495878 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc, content-length 98, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x13651b4c /127.0.0.1:3230<->/127.0.0.1:56965], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x45278f4b HikariProxyConnection@1160220491 wrapping org.postgresql.jdbc.PgConnection@38ca26f5], :level 1, :rollback #object[clojure.lang.Atom 0x65c234ad {:status :ready, :val false}]}, :content-length 98, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0xd23ad4f BytesInputStream[len=98]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x31eb2c46 HikariProxyConnection@837495878 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:08.412Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:08.413Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:08.413Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:08.414Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}}, :remote-addr 127.0.0.1, :start-time 157001218902250, :params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1f03d0e8 HikariProxyConnection@520343784 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc, content-length 106, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2c15a0b6 /127.0.0.1:3230<->/127.0.0.1:56965], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x56415c89 HikariProxyConnection@1447124105 wrapping org.postgresql.jdbc.PgConnection@38ca26f5], :level 1, :rollback #object[clojure.lang.Atom 0x60d2f1d6 {:status :ready, :val false}]}, :content-length 106, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x6157e9b4 BytesInputStream[len=106]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1f03d0e8 HikariProxyConnection@520343784 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:08.488Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:08.489Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:08.489Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:08.489Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157001274549333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6d688704 /127.0.0.1:3230<->/127.0.0.1:56965], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x54dd01df leihs.procurement.backend.html$not_found_handler@54dd01df], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.567Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.568Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.568Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.569Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.570Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.570Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.572Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.572Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157001509034125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6ccb1c97 /127.0.0.1:3230<->/127.0.0.1:56975], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x54dd01df leihs.procurement.backend.html$not_found_handler@54dd01df], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.787Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.788Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.788Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.789Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.789Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.789Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.790Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.791Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157001516372208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7e35e6be /127.0.0.1:3230<->/127.0.0.1:56965], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.793Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.794Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.794Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.795Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.795Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.796Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.796Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.797Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:08.799Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
2023-12-08T08:44:08.800Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
>>>2 {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}
>>oida>> #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
2023-12-08T08:44:08.802Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.825Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.826Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
2023-12-08T08:44:08.846Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"be2c64df-1af5-4533-bccd-a02fd55d6dcc\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"d2b20225-6495-4fb4-b72c-9d2b96dc6152\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157001678485416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x587e4353 /127.0.0.1:3230<->/127.0.0.1:56979], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.959Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at >o> admin? {:exists false}
#time/instant "2023-12-08T08:44:08.503699Z">myprint>  , :idadmin  false
#uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies >o> inspector? {leihs-anti-csrf-token [{SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result :value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
{>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read :valuetrue, :is_admin false, :authentication-method  :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157001677583708, :params #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", {:scope_system_admin_read false, }, :access-rights :settings (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
{:email_sending_enabled 
>> authorize >
false, 
>> authorize::handler > :sessions_max_lifetime_secs #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157001677399583, :params 2023-12-08T08:44:08.960Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
{}, :settings 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false{, :email_sending_enabled:external_base_url  nilfalse, , :sessions_max_lifetime_secs :sessions_force_uniqueness false, 432000, :email_signature :smtp_default_from_addressCheers,} , your.lending.desk@example.com, :tx-next :public_image_caching_enabled true, :sessions_force_secure false#next.jdbc.default_options.DefaultOptions, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}{, :tx-next #next.jdbc.default_options.DefaultOptions:connectable {:connectable #object[com.zaxxer.hikari.HikariDataSource #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x225fb0ee HikariDataSource (HikariPool-1)], :options 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw{ :builder-fn {}, :route-params #object[next.jdbc.result_set$as_unqualified_lower_maps nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, 0x73775793 user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, next.jdbc.result_set$as_unqualified_lower_maps@73775793]content-type application/json, }}, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, :query-params-rawcontent-length  534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3{}, , sec-fetch-dest :route-params empty, nil, accept-encoding:headers gzip, deflate, br,  sec-fetch-mode cors}, :async-channel {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2fcb8fcd /127.0.0.1:3230<->/127.0.0.1:56965], :server-port 3230, :params-raw #object[org.httpkit.server.AsyncChannel {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, 0x42404455 /127.0.0.1:3230<->/127.0.0.1:56975:query-params ], {}, :server-port :content-type 3230, application/json, :params-raw :form-params-raw {}, {}:tx , :character-encoding utf8, :uri /procure/graphql{, :server-name :datasource localhost, :handler-key :graphql, :query-string nil, #object[:body com.zaxxer.hikari.HikariDataSource {:operationName 0x321108bd RequestFilters, HikariDataSource (db-pool)]:variables }, :content-length 3575, {}, :form-params :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema {}, :websocket? #CompiledSchema<>false, , :query-params :handler {}, :content-type application/json, :form-params-raw #object[leihs.procurement.graphql$handler {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName 0x59a9daed RequestsIndexFiltered, :variables leihs.procurement.graphql$handler@59a9daed], {}:multipart-params,  :query {}, :scheme query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :http, :graphql-schema:request-method  :post, :accept #CompiledSchema<>, {:handler :mime :json, :charset nil, :encoding nil, :language nil}}#object[

>> authorize::handler-key >> :graphql
leihs.procurement.graphql$handler >myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, 0x59a9daed leihs.procurement.graphql$handler@59a9daed:authentication-method :session, ], :login nil, :multipart-params :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, {}, :user_session_created_at :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >>#time/instant "2023-12-08T08:44:08.503699Z" , :graphql:id
>o> inspector? {:result false>myprint> } authEnt?
 >myprint>   inspector false
{:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin#uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" , false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :user_session_id :scope_admin_write false, :user_session_created_at #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", (:scope_system_admin_read false, ):access-rights , (:user_id),  :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", 0, :scope_admin_read false}
:is_system_admin >myprint> false,  txn :external_sign_out_url# next.jdbc.default_options.DefaultOptionsnil, {:language_locale nil, :connectable :inventory_pool_roles_count #object[com.zaxxer.hikari.HikariDataSource 0, :scope_admin_read false}0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn 
#object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable >o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
#object[com.zaxxer.hikari.HikariDataSource >o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
2023-12-08T08:44:08.960Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.961Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.961Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> admin? {:exists false}
>myprint>  admin false
>o> requester?? >o> inspector? [[SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]#uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]

>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.961Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.961Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.961Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
2023-12-08T08:44:08.962Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.962Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? {:result false}
>myprint>  viewer false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
2023-12-08T08:44:08.963Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.963Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
2023-12-08T08:44:08.963Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.963Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.964Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> requester?? >o> viewer? {[SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result :exists#uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] 
true}
>myprint>  requester true
2023-12-08T08:44:08.964Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
2023-12-08T08:44:08.964Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.964Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.965Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? {:exists false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.965Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.965Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> viewer? {:result false}
>o> inspector? >o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) {#uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
:result false}
2023-12-08T08:44:08.966Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
2023-12-08T08:44:08.966Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.967Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
> 1 anti-csrf-token > 
 be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-08T08:44:08.968Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
pure-handler >> 2
2023-12-08T08:44:08.969Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
2023-12-08T08:44:08.969Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
>>>2 {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}
>>oida>> #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
2023-12-08T08:44:08.970Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>>>3 nil
pure-handler >> 2
2023-12-08T08:44:08.972Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>get-dashboard
>>args {}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.981Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.982Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
2023-12-08T08:44:08.984Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"be2c64df-1af5-4533-bccd-a02fd55d6dcc\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"d2b20225-6495-4fb4-b72c-9d2b96dc6152\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
>>ToCheck mainCats [{:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia}]
>>queryA1 [SELECT * FROM procurement_budget_periods ORDER BY end_date DESC]
>>ToCheck dashboard:::procurement_budget_periods.id [{:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}]
>>resultA1-2 [{:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}]
>>requestsB2-triggerError {} nil
>o> helper1 id= nil
>o> helper2 nil nil nil
>oo> helper3a priority nil
>oo> helper3b priority nil
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority nil
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.993Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.994Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.996Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:08.997Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 nil nil nil
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) nil
>o> apply-scope #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.997Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.998Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.000Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.000Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.001Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
2023-12-08T08:44:09.001Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:categories [#ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "6a766d44-305d-4631-a269-5a83b8756a75"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :HIGH
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :article_number 12345, :inspector_priority :MEDIUM, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :replacement false, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :priority :HIGH, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
>o>dashboard-cache-keyB2 {:id -15128758}
2023-12-08T08:44:09.039Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => d2b20225-6495-4fb4-b72c-9d2b96dc6152
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.040Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.041Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.042Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:09.047Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:09.048Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> viewer? {:result false}
2023-12-08T08:44:09.051Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:09.051Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:09.051Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:09.051Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:09.052Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:09.052Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:09.052Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:09.053Z NX-41294 DEBUG [leihs.procurement.dashboard:228] - (count requests) => 1
2023-12-08T08:44:09.053Z NX-41294 DEBUG [leihs.procurement.dashboard:229] - (cache-key dashboard-cache-key) => -15128758
>o> bp {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>oo> 1sum-total-price :total_price_cents (>o> mc {:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia}
>o> filter-and-assoc-cats ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
>oo> 1sum-total-price :total_price_cents (>o> c {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> c {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> 2 requests* ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
>oo> 1sum-total-price :total_price_cents ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
>oo> 2sum-total-price :total_price_cents (500000)
>>1 500000

>o> result 1a {:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey -15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil} 

{:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey -15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil})
>oo> 2sum-total-price :total_price_cents (500000)
>>1 500000

>>ToCheck dashboard::determine-budget-periods {:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia, :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey -15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil}), :total_price_cents 500000, :cacheKey -15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71} 

{:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia, :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey -15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil}), :total_price_cents 500000, :cacheKey -15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71})
>oo> 2sum-total-price :total_price_cents (500000)
>>1 500000
2023-12-08T08:44:09.053Z NX-41294 DEBUG [leihs.procurement.dashboard:230] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ({:main_categories ({:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Colombia", :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Category C", :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name "Category C", :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name "Category C", :cost_center nil, :main_category {:id "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Colombia"}, :main_category_id "b12cf49d-b54a-4cb1-8890-742f810a8a71", :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value "And why not", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default "aquisition", :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value "12345", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default "MEDIUM", :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name "Budget-Period-BP", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name "Budget-Period-BP", :inspection_start_date "2024-02-08T00:00:00+01:00", :end_date "2024-03-08T00:00:00+01:00", :created_at "2023-12-08T09:44:08.114337", :updated_at "2023-12-08T09:44:08.114337", :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value "Camera", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id "6a766d44-305d-4631-a269-5a83b8756a75", :name "Baby, Toys & Computers", :parent_id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3", :shortname nil, :department {:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3", :name "Toys, Kids & Baby", :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default "NOT_PROCURED", :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default "NORMAL", :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default "CHF", :required true, :value "CHF", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name "general room", :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name "general building", :code nil}}, :required true, :value {:id "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :name "Room R", :general false, :building {:id "60b21266-49f4-402b-b01e-e12cb0ae4d3d", :code nil, :name "Building B"}, :building_id "60b21266-49f4-402b-b01e-e12cb0ae4d3d", :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname "Krysta", :lastname "Pfeffer"}, :value {:system_admin_protected false, :address nil, :email "lynsey_kertzmann@klein-wehner.org", :pool_protected false, :last_sign_in_at "2023-12-08T09:44:08.503699+01:00", :img32_url nil, :account_enabled true, :lastname "Pfeffer", :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization "local", :login nil, :searchable "Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta", :updated_at "2023-12-08T09:44:08.503699+01:00", :firstname "Krysta", :zip nil, :id "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at "2023-12-08T09:44:08.119041+01:00", :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value "Hans Heiri", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id "Budget-Period-BP.001", :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey "-15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6", :cost_center nil}), :total_price_cents 500000, :cacheKey "-15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71"}), :name "Budget-Period-BP", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :total_price_cents 500000, :cacheKey "-15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741", :created_at #inst "2023-12-08T08:44:08.114337000-00:00"})
2023-12-08T08:44:09.070Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 1] [:budget_periods [#ordered/map ([:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:cacheKey "-15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:total_price_cents "500000"] [:main_categories [#ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:cacheKey "-15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:image_url nil] [:total_price_cents "500000"] [:categories [#ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:cacheKey "-15128758_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:total_price_cents "500000"] [:requests [#ordered/map ([:id "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:main_category #ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "6a766d44-305d-4631-a269-5a83b8756a75"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "e8c80b80-0105-4afa-8b11-2c63dae1bd8a"] [:name "Room R"] [:building #ordered/map ([:id "60b21266-49f4-402b-b01e-e12cb0ae4d3d"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "500000"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157001823548791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x30070ffb /127.0.0.1:3230<->/127.0.0.1:56975], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [6a766d44-305d-4631-a269-5a83b8756a75], :categories [9458ba86-a4c6-43d2-bae2-0e4e479106d6], :priority [NORMAL HIGH], :budgetPeriods [139cd63f-9e4e-44a4-98b9-98170b5ed741]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.105Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.105Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.106Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.106Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.107Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.107Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.108Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.108Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:09.113Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["6a766d44-305d-4631-a269-5a83b8756a75"], :categories ["9458ba86-a4c6-43d2-bae2-0e4e479106d6"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["139cd63f-9e4e-44a4-98b9-98170b5ed741"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MEDIUM HIGH MANDATORY] {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [6a766d44-305d-4631-a269-5a83b8756a75], :categories [9458ba86-a4c6-43d2-bae2-0e4e479106d6], :priority [NORMAL HIGH], :budgetPeriods [139cd63f-9e4e-44a4-98b9-98170b5ed741]}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [6a766d44-305d-4631-a269-5a83b8756a75], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [139cd63f-9e4e-44a4-98b9-98170b5ed741], :category_id [9458ba86-a4c6-43d2-bae2-0e4e479106d6]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats [{:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741"]
>>ToCheck dashboard:::procurement_budget_periods.id [{:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}]
>>resultA1-2 [{:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}]
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [6a766d44-305d-4631-a269-5a83b8756a75], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [139cd63f-9e4e-44a4-98b9-98170b5ed741], :category_id [9458ba86-a4c6-43d2-bae2-0e4e479106d6]} nil
>o> helper1 id= nil
>o> helper2 [9458ba86-a4c6-43d2-bae2-0e4e479106d6] [139cd63f-9e4e-44a4-98b9-98170b5ed741] [6a766d44-305d-4631-a269-5a83b8756a75]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>debug> 1a
>debug> 1a
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
low medium high mandatory)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
not_processed in_progress procured alternative_procured not_procured)
>oo> helper5c :order_status java.lang.String
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.123Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.124Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.125Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:09.125Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low medium high mandatory) (normal high)
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) nil
>debug> 2
>oo> >here> to-name-and-lower-case-enums (not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.155Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.156Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN (CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM))) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 9458ba86-a4c6-43d2-bae2-0e4e479106d6 139cd63f-9e4e-44a4-98b9-98170b5ed741 6a766d44-305d-4631-a269-5a83b8756a75 normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN (CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM))) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 9458ba86-a4c6-43d2-bae2-0e4e479106d6 139cd63f-9e4e-44a4-98b9-98170b5ed741 6a766d44-305d-4631-a269-5a83b8756a75 normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.187Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.188Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.189Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :HIGH
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :article_number 12345, :inspector_priority :MEDIUM, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :replacement false, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :priority :HIGH, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
>o>dashboard-cache-keyB2 {:id 1731285267}
2023-12-08T08:44:09.235Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => d2b20225-6495-4fb4-b72c-9d2b96dc6152
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.235Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.236Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.236Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:09.240Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:09.240Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> viewer? {:result false}
2023-12-08T08:44:09.241Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:09.241Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:09.241Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:09.241Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:09.241Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:09.241Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:09.241Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:09.242Z NX-41294 DEBUG [leihs.procurement.dashboard:228] - (count requests) => 1
2023-12-08T08:44:09.242Z NX-41294 DEBUG [leihs.procurement.dashboard:229] - (cache-key dashboard-cache-key) => 1731285267
>o> bp {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>oo> 1sum-total-price :total_price_cents (>o> mc {:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia}
>o> filter-and-assoc-cats ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
>oo> 1sum-total-price :total_price_cents (>o> c {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> c {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> 2 requests* ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
>oo> 1sum-total-price :total_price_cents ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
>oo> 2sum-total-price :total_price_cents (500000)
>>1 500000

>o> result 1a {:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey 1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil} 

{:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey 1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil})
>oo> 2sum-total-price :total_price_cents (500000)
>>1 500000

>>ToCheck dashboard::determine-budget-periods {:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia, :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey 1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil}), :total_price_cents 500000, :cacheKey 1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71} 

{:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia, :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey 1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil}), :total_price_cents 500000, :cacheKey 1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71})
>oo> 2sum-total-price :total_price_cents (500000)
>>1 500000
2023-12-08T08:44:09.242Z NX-41294 DEBUG [leihs.procurement.dashboard:230] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ({:main_categories ({:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Colombia", :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Category C", :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name "Category C", :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name "Category C", :cost_center nil, :main_category {:id "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Colombia"}, :main_category_id "b12cf49d-b54a-4cb1-8890-742f810a8a71", :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value "And why not", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default "aquisition", :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value "12345", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default "MEDIUM", :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name "Budget-Period-BP", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name "Budget-Period-BP", :inspection_start_date "2024-02-08T00:00:00+01:00", :end_date "2024-03-08T00:00:00+01:00", :created_at "2023-12-08T09:44:08.114337", :updated_at "2023-12-08T09:44:08.114337", :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value "Camera", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id "6a766d44-305d-4631-a269-5a83b8756a75", :name "Baby, Toys & Computers", :parent_id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3", :shortname nil, :department {:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3", :name "Toys, Kids & Baby", :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default "NOT_PROCURED", :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default "NORMAL", :required true, :value :HIGH, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency {:read true, :write false, :default "CHF", :required true, :value "CHF", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name "general room", :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name "general building", :code nil}}, :required true, :value {:id "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :name "Room R", :general false, :building {:id "60b21266-49f4-402b-b01e-e12cb0ae4d3d", :code nil, :name "Building B"}, :building_id "60b21266-49f4-402b-b01e-e12cb0ae4d3d", :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname "Krysta", :lastname "Pfeffer"}, :value {:system_admin_protected false, :address nil, :email "lynsey_kertzmann@klein-wehner.org", :pool_protected false, :last_sign_in_at "2023-12-08T09:44:08.503699+01:00", :img32_url nil, :account_enabled true, :lastname "Pfeffer", :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization "local", :login nil, :searchable "Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta", :updated_at "2023-12-08T09:44:08.503699+01:00", :firstname "Krysta", :zip nil, :id "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at "2023-12-08T09:44:08.119041+01:00", :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value "Hans Heiri", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id "Budget-Period-BP.001", :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 500000, :procurement_account nil, :cacheKey "1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6", :cost_center nil}), :total_price_cents 500000, :cacheKey "1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71"}), :name "Budget-Period-BP", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :total_price_cents 500000, :cacheKey "1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741", :created_at #inst "2023-12-08T08:44:08.114337000-00:00"})
2023-12-08T08:44:09.308Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1731285267"] [:total_count 1] [:budget_periods [#ordered/map ([:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:cacheKey "1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:total_price_cents "500000"] [:main_categories [#ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:cacheKey "1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:image_url nil] [:total_price_cents "500000"] [:categories [#ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:cacheKey "1731285267_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:total_price_cents "500000"] [:requests [#ordered/map ([:id "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:main_category #ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "6a766d44-305d-4631-a269-5a83b8756a75"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "e8c80b80-0105-4afa-8b11-2c63dae1bd8a"] [:name "Room R"] [:building #ordered/map ([:id "60b21266-49f4-402b-b01e-e12cb0ae4d3d"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "500000"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157002686042791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x55d0f726 /127.0.0.1:3230<->/127.0.0.1:56975], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.966Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.967Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.967Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.968Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.968Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.968Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.969Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.969Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:09.976Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
 with variables {:id ["e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"]}
>oo> vars from graphQL-Requst nil nil nil {:id [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]}
>o> helper1 id= [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]
>o> helper2 nil nil nil
>oo> helper3a priority nil
>oo> helper3b priority nil
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority nil
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.983Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.984Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.984Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:09.985Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 nil nil nil
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]
>o> apply-scope #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.986Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.987Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.988Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.988Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.989Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :HIGH
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :article_number 12345, :inspector_priority :MEDIUM, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :replacement false, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :priority :HIGH, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
2023-12-08T08:44:09.998Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => d2b20225-6495-4fb4-b72c-9d2b96dc6152
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.999Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:09.999Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.000Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:10.001Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:10.002Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> viewer? {:result false}
2023-12-08T08:44:10.003Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:10.003Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:10.003Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:10.003Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:10.003Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:10.003Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:10.003Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:10.014Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:main_category #ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6a766d44-305d-4631-a269-5a83b8756a75"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "e8c80b80-0105-4afa-8b11-2c63dae1bd8a"] [:name "Room R"] [:building #ordered/map ([:id "60b21266-49f4-402b-b01e-e12cb0ae4d3d"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:categories [#ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157002799408208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}>>> authenticate::skip= , nil  handler-key= :query-params-raw :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type#time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights  application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 137, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}#object[
org.httpkit.server.AsyncChannel 
>> authorize >

>> authorize::handler > 0x6ad730bf /127.0.0.1:3230<->/127.0.0.1:56975], :server-port #object[3230, leihs.core.locale$wrap$fn__44398 :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]
0x321108bd HikariDataSource (db-pool)]
>> authorize::request > }, :content-length 137, {:form-params :authenticated-entity {}, {:websocket? false, :email :query-params lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, {}, :content-type application/json, :scope_admin_write false, :form-params-raw :user_session_created_at {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables #time/instant "2023-12-08T08:44:08.503699Z", :id {#uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", }:user_session_id , #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :query :access-rights query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, #object[:external_sign_out_url nil, leihs.procurement.graphql$handler :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies 0x59a9daed leihs.procurement.graphql$handler@59a9daed]{, :multipart-params leihs-anti-csrf-token {}{, :value be2c64df-1af5-4533-bccd-a02fd55d6dcc:scheme }:http, , leihs-user-session :request-method :post, {:accept :value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr {127.0.0.1, :start-time :mime 157002799811208, :json, :params :charset nil, :encoding nil, :language nil}{}}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next 
#next.jdbc.default_options.DefaultOptions
>> authorize::handler-key >> {:graphql
:connectable >myprint>  authEnt? #object[com.zaxxer.hikari.HikariDataSource {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers :scope_system_admin_write false, {:scope_write true, :firstname Krystaorigin , http://localhost:3230:scope_admin_write false, , :user_session_created_at sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br#time/instant "2023-12-08T08:44:08.503699Z", , sec-fetch-mode cors:id }, #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152":async-channel , :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
#object[org.httpkit.server.AsyncChannel 0x4f72b274 /127.0.0.1:3230<->/127.0.0.1:56979]>myprint>  , txn :server-port 3230, #next.jdbc.default_options.DefaultOptions:params-raw {{}, :tx {:connectable :datasource #object[com.zaxxer.hikari.HikariDataSource #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee 0x321108bd HikariDataSource (HikariPool-1)HikariDataSource (db-pool)]], }, :options :content-length 257, :form-params {{:builder-fn }, :websocket? false, :query-params #object[next.jdbc.result_set$as_unqualified_lower_maps {}, :content-type application/json, :form-params-raw 0x73775793 {next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}}, :character-encoding 
utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId 60b21266-49f4-402b-b01e-e12cb0ae4d3d}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.077Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.076Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? >o> inspector? [[SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]#uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]

2023-12-08T08:44:10.077Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.077Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  2023-12-08T08:44:10.078Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
2023-12-08T08:44:10.078Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.078Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? {:exists true}
>myprint>  requester true
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> requester?? >o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
{:exists true}
>myprint>  requester true
2023-12-08T08:44:10.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.080Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.080Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.081Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>o> requester?? {:exists true}
pure-handler >> 2
2023-12-08T08:44:10.081Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:10.083Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
 with variables {:buildingId "60b21266-49f4-402b-b01e-e12cb0ae4d3d"}
>oo> vars from graphQL-Requst nil nil nil {:buildingId 60b21266-49f4-402b-b01e-e12cb0ae4d3d}
2023-12-08T08:44:10.083Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "ab3f5d69-9c74-43f0-a75f-e6866505a1d1"] [:name "Building B X"] [:__typename :Building]) #ordered/map ([:id "60b21266-49f4-402b-b01e-e12cb0ae4d3d"] [:name "Building B"] [:__typename :Building])]])}
2023-12-08T08:44:10.085Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "166f0157-4bec-484a-8364-13e45e005885"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "e8c80b80-0105-4afa-8b11-2c63dae1bd8a"] [:name "Room R"] [:description nil] [:__typename :Room])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157002818396541, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x49b37bc4 /127.0.0.1:3230<->/127.0.0.1:56965], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.092Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.093Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.093Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.093Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.094Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.094Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.094Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.095Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:10.096Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
2023-12-08T08:44:10.097Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
>>>2 {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}
>>oida>> #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
2023-12-08T08:44:10.098Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.109Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.110Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
2023-12-08T08:44:10.112Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"be2c64df-1af5-4533-bccd-a02fd55d6dcc\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"d2b20225-6495-4fb4-b72c-9d2b96dc6152\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157002860913791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x52252838 /127.0.0.1:3230<->/127.0.0.1:56975], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.139Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.140Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.140Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.141Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.142Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.142Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.143Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.143Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:10.149Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
 with variables {:id ["e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"]}
>oo> vars from graphQL-Requst nil nil nil {:id [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]}
>o> helper1 id= [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]
>o> helper2 nil nil nil
>oo> helper3a priority nil
>oo> helper3b priority nil
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority nil
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.155Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.156Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.156Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:10.156Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 nil nil nil
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]
>o> apply-scope #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.157Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.157Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.159Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.159Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.159Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :HIGH
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :article_number 12345, :inspector_priority :MEDIUM, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :replacement false, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :priority :HIGH, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
2023-12-08T08:44:10.167Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => d2b20225-6495-4fb4-b72c-9d2b96dc6152
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.168Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.168Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.168Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:10.170Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:10.170Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> viewer? {:result false}
2023-12-08T08:44:10.171Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:10.171Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:10.171Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:10.171Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:10.171Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:10.171Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:10.171Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:10.177Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:main_category #ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6a766d44-305d-4631-a269-5a83b8756a75"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "e8c80b80-0105-4afa-8b11-2c63dae1bd8a"] [:name "Room R"] [:building #ordered/map ([:id "60b21266-49f4-402b-b01e-e12cb0ae4d3d"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:categories [#ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157003568847958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x496cbe05 /127.0.0.1:3230<->/127.0.0.1:56975], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId ab3f5d69-9c74-43f0-a75f-e6866505a1d1}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.845Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.846Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.846Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.847Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.847Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.847Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.848Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:10.848Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:10.850Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
 with variables {:buildingId "ab3f5d69-9c74-43f0-a75f-e6866505a1d1"}
>oo> vars from graphQL-Requst nil nil nil {:buildingId ab3f5d69-9c74-43f0-a75f-e6866505a1d1}
2023-12-08T08:44:10.851Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "602ebd14-f9e3-45ba-839c-615f61e82eb5"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "88cabe8e-ff28-4580-920d-8244ebf0823e"] [:name "Room R X"] [:description nil] [:__typename :Room])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157004837699875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x37f1cde HikariProxyConnection@58662110 wrapping org.postgresql.jdbc.PgConnection@1ca2c0b9], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 5644, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4a32c23d /127.0.0.1:3230<->/127.0.0.1:56975], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x15c4fe5c HikariProxyConnection@365231708 wrapping org.postgresql.jdbc.PgConnection@6e2689d6], :level 1, :rollback #object[clojure.lang.Atom 0x640b2ba3 {:status :ready, :val false}]}, :content-length 5644, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName updateRequest, :variables {:requestData {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :attachments [], :supplier_name Supplier S, :order_status NOT_PROCESSED, :requested_quantity 99, :priority NORMAL, :id e59fa9c4-7a4c-44b8-ae09-fa71c3a84334, :room 88cabe8e-ff28-4580-920d-8244ebf0823e, :receiver Hans Heiri X}}, :query mutation updateRequest($requestData: RequestInput) {
  request(input_data: $requestData) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x37f1cde HikariProxyConnection@58662110 wrapping org.postgresql.jdbc.PgConnection@1ca2c0b9], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.118Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.119Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.120Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.120Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.121Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.121Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.122Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.122Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 1
2023-12-08T08:44:12.128Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query mutation updateRequest($requestData: RequestInput) {
  request(input_data: $requestData) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
 with variables {:requestData {:motivation "And why not X", :article_number "12345 X", :price_cents 99900, :article_name "Camera X", :replacement true, :attachments [], :supplier_name "Supplier S", :order_status "NOT_PROCESSED", :requested_quantity "99", :priority "NORMAL", :id "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :room "88cabe8e-ff28-4580-920d-8244ebf0823e", :receiver "Hans Heiri X"}}
>oo> vars from graphQL-Requst nil nil nil {:requestData {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :attachments [], :supplier_name Supplier S, :order_status NOT_PROCESSED, :requested_quantity 99, :priority NORMAL, :id e59fa9c4-7a4c-44b8-ae09-fa71c3a84334, :room 88cabe8e-ff28-4580-920d-8244ebf0823e, :receiver Hans Heiri X}}
>debug> 37
>oo> input-data >here>  {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :attachments [], :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :priority :NORMAL, :id e59fa9c4-7a4c-44b8-ae09-fa71c3a84334, :room 88cabe8e-ff28-4580-920d-8244ebf0823e, :receiver Hans Heiri X}
>oo> input-data >here>  :NOT_PROCESSED
>debug> 36
>oo> >here> cast-to-order-status-enum :NOT_PROCESSED
>debug> 1a
>debug> 1a
>debug> 25
>debug> 24
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.137Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.138Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.138Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:12.139Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :users
>o> nest-key :user
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE procurement_requests.id = CAST(? AS UUID) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.140Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.141Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.141Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority high, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :HIGH
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :template_id nil, :article_number 12345, :inspector_priority medium, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement false, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :HIGH, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "e8c80b80-0105-4afa-8b11-2c63dae1bd8a", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not, :accounting_type aquisition, :article_number 12345, :inspector_priority :MEDIUM, :price_cents 50000, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera, :replacement false, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 10, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :priority :HIGH, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 500000, :price_currency CHF, :procurement_account nil, :room {:id e8c80b80-0105-4afa-8b11-2c63dae1bd8a, :name Room R, :general false, :building {:id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :code nil, :name Building B}, :building_id 60b21266-49f4-402b-b01e-e12cb0ae4d3d, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
>debug> 3
2023-12-08T08:44:12.161Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => d2b20225-6495-4fb4-b72c-9d2b96dc6152
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.163Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.163Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.164Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:12.166Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:12.167Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> viewer? {:result false}
2023-12-08T08:44:12.168Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:12.168Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:12.169Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:12.169Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:12.169Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:12.169Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:12.169Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>debug> 5
>debug> 6
2023-12-08T08:44:12.170Z NX-41294 DEBUG [leihs.procurement.resources.request:42] - (exchange-attrs req attrs-mapping) => {:motivation "And why not X", :article_number "12345 X", :price_cents 99900, :article_name "Camera X", :replacement true, :supplier_name "Supplier S", :order_status [[:cast "not_processed" :order_status_enum]], :requested_quantity 99, :priority "normal", :room_id "88cabe8e-ff28-4580-920d-8244ebf0823e", :receiver "Hans Heiri X"}
>debug> 30
>debug> update!= {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :supplier_name Supplier S, :order_status [[:cast not_processed :order_status_enum]], :requested_quantity 99, :priority normal, :room_id 88cabe8e-ff28-4580-920d-8244ebf0823e, :receiver Hans Heiri X}
>o> no / my-cast /debug  {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :supplier_name Supplier S, :order_status [[:cast not_processed :order_status_enum]], :requested_quantity 99, :priority normal, :room_id 88cabe8e-ff28-4580-920d-8244ebf0823e, :receiver Hans Heiri X}
>o> no before _> room_id= 88cabe8e-ff28-4580-920d-8244ebf0823e
>o> no after _> room_id= {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :supplier_name Supplier S, :order_status [[:cast not_processed :order_status_enum]], :requested_quantity 99, :priority normal, :room_id [[:cast 88cabe8e-ff28-4580-920d-8244ebf0823e :uuid]], :receiver Hans Heiri X}
>o> no before quest _> room_id= {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :supplier_name Supplier S, :order_status [[:cast not_processed :order_status_enum]], :requested_quantity 99, :priority normal, :room_id [[:cast 88cabe8e-ff28-4580-920d-8244ebf0823e :uuid]], :receiver Hans Heiri X}
>o> no / my-cast /debug  {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :supplier_name Supplier S, :order_status [[:cast not_processed :order_status_enum]], :requested_quantity 99, :priority normal, :room_id 88cabe8e-ff28-4580-920d-8244ebf0823e, :receiver Hans Heiri X}
>o> no before _> room_id= 88cabe8e-ff28-4580-920d-8244ebf0823e
>o> no after _> room_id= {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :supplier_name Supplier S, :order_status [[:cast not_processed :order_status_enum]], :requested_quantity 99, :priority normal, :room_id [[:cast 88cabe8e-ff28-4580-920d-8244ebf0823e :uuid]], :receiver Hans Heiri X}
2023-12-08T08:44:12.174Z NX-41294 DEBUG [leihs.procurement.resources.request:972] - (update! tx req-id (exchange-attrs update-data)) => [{:next.jdbc/update-count 1}]
>debug> 25
>debug> 24
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.174Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.174Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.175Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:12.175Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:= :procurement_requests.id [:cast e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 :uuid]]}
>o> tbl :users
>o> nest-key :user
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE procurement_requests.id = CAST(? AS UUID) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.177Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.177Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.178Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :NORMAL
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :article_number 12345 X, :inspector_priority :MEDIUM, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :replacement true, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :priority :NORMAL, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
2023-12-08T08:44:12.197Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => d2b20225-6495-4fb4-b72c-9d2b96dc6152
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.198Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.198Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.199Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:12.200Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:12.201Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> viewer? {:result false}
2023-12-08T08:44:12.201Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:12.202Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:12.202Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:12.202Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:12.202Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:12.202Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:12.202Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
2023-12-08T08:44:12.205Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:request #ordered/map ([:id "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:main_category #ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6a766d44-305d-4631-a269-5a83b8756a75"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345 X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "88cabe8e-ff28-4580-920d-8244ebf0823e"] [:name "Room R X"] [:building #ordered/map ([:id "ab3f5d69-9c74-43f0-a75f-e6866505a1d1"] [:name "Building B X"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157004976891166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 1228, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x416dab4f /127.0.0.1:3230<->/127.0.0.1:56975], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 1228, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:search nil, :budgetPeriods [139cd63f-9e4e-44a4-98b9-98170b5ed741], :categories [9458ba86-a4c6-43d2-bae2-0e4e479106d6], :organizations [6a766d44-305d-4631-a269-5a83b8756a75], :onlyOwnRequests false, :priority [NORMAL HIGH], :inspector_priority [LOW MEDIUM HIGH MANDATORY], :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    budget_periods {
      cacheKey
      total_price_cents
      main_categories {
        cacheKey
        total_price_cents
        categories {
          cacheKey
          total_price_cents
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.252Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.252Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.253Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.253Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.253Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.254Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.254Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.254Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  be2c64df-1af5-4533-bccd-a02fd55d6dcc

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:12.256Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    budget_periods {
      cacheKey
      total_price_cents
      main_categories {
        cacheKey
        total_price_cents
        categories {
          cacheKey
          total_price_cents
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}
 with variables {:search nil, :budgetPeriods ["139cd63f-9e4e-44a4-98b9-98170b5ed741"], :categories ["9458ba86-a4c6-43d2-bae2-0e4e479106d6"], :organizations ["6a766d44-305d-4631-a269-5a83b8756a75"], :onlyOwnRequests false, :priority ["NORMAL" "HIGH"], :inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"]}
>oo> vars from graphQL-Requst nil [NORMAL HIGH] [LOW MEDIUM HIGH MANDATORY] {:search nil, :budgetPeriods [139cd63f-9e4e-44a4-98b9-98170b5ed741], :categories [9458ba86-a4c6-43d2-bae2-0e4e479106d6], :organizations [6a766d44-305d-4631-a269-5a83b8756a75], :onlyOwnRequests false, :priority [NORMAL HIGH], :inspector_priority [LOW MEDIUM HIGH MANDATORY], :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED]}
>>>get-dashboard
>>args {:budget_period_id [139cd63f-9e4e-44a4-98b9-98170b5ed741], :category_id [9458ba86-a4c6-43d2-bae2-0e4e479106d6], :search nil, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :organization_id [6a766d44-305d-4631-a269-5a83b8756a75], :priority [:NORMAL :HIGH], :inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :requested_by_auth_user false}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats [{:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741"]
>>ToCheck dashboard:::procurement_budget_periods.id [{:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}]
>>resultA1-2 [{:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}]
>>requestsB2-triggerError {:budget_period_id [139cd63f-9e4e-44a4-98b9-98170b5ed741], :category_id [9458ba86-a4c6-43d2-bae2-0e4e479106d6], :search nil, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :organization_id [6a766d44-305d-4631-a269-5a83b8756a75], :priority [:NORMAL :HIGH], :inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :requested_by_auth_user false} nil
>o> helper1 id= nil
>o> helper2 [9458ba86-a4c6-43d2-bae2-0e4e479106d6] [139cd63f-9e4e-44a4-98b9-98170b5ed741] [6a766d44-305d-4631-a269-5a83b8756a75]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>debug> 1a
>debug> 1a
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
low medium high mandatory)
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.259Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.260Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.260Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:12.260Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 nil (low medium high mandatory) (normal high)
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) nil
>debug> 2
>o> apply-scope #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.261Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > >o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
#object[leihs.core.locale$wrap$fn__44398 2023-12-08T08:44:12.261Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value be2c64df-1af5-4533-bccd-a02fd55d6dcc}, leihs-user-session {:value 64d166f3-e5c3-45d0-9297-550617b3caba}}, :remote-addr 127.0.0.1, :start-time 157004983409958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=be2c64df-1af5-4533-bccd-a02fd55d6dcc; leihs-user-session=64d166f3-e5c3-45d0-9297-550617b3caba, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token be2c64df-1af5-4533-bccd-a02fd55d6dcc, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7da1abf4 /127.0.0.1:3230<->/127.0.0.1:56979], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, >o> inspector? :content-length 5678, :form-params {{}, :websocket?:result  false}false, 
:query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.262Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.262Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.262Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 9458ba86-a4c6-43d2-bae2-0e4e479106d6 139cd63f-9e4e-44a4-98b9-98170b5ed741 6a766d44-305d-4631-a269-5a83b8756a75 normal high low medium high mandatory 0 0 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at 2023-12-08T08:44:12.262Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
#time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 9458ba86-a4c6-43d2-bae2-0e4e479106d6 139cd63f-9e4e-44a4-98b9-98170b5ed741 6a766d44-305d-4631-a269-5a83b8756a75 normal high low medium high mandatory 0 0 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.267Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.268Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
2023-12-08T08:44:12.268Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.268Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.268Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
2023-12-08T08:44:12.268Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:12.274Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> requester?? >o> treat-inspector-priority: enum-state _>  :NEW
{>debug> 18
>debug> 19
>debug> 20
:exists true}
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}

> 1 anti-csrf-token > >debug> 11 
>o> upper-case-keyword-value: row => {be2c64df-1af5-4533-bccd-a02fd55d6dcc:category 
{:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, 
> 1 anti-csrf-token class > :name  java.lang.String
Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, 
> 2 anti-csrf-token-new >  :name Colombianil
}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :NORMAL
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :article_number 12345 X, :inspector_priority :MEDIUM, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :replacement true, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :priority :NORMAL, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
>o>dashboard-cache-keyB2 {:id 172256140}
pure-handler >> 2
2023-12-08T08:44:12.295Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => d2b20225-6495-4fb4-b72c-9d2b96dc6152
2023-12-08T08:44:12.295Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
 with variables {:id ["e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"]}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) >oo> vars from graphQL-Requst nil nil nil #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
{:id [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]}
2023-12-08T08:44:12.302Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.303Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.303Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:12.305Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:12.306Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> viewer? {:result false}
2023-12-08T08:44:12.307Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:12.307Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:12.307Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:12.307Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:12.307Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:12.307Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:12.307Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>o> helper1 id= [e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]
>o> helper2 nil nil nil
>oo> helper3a priority nil
>oo> helper3b priority nil
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority nil
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.310Z NX-41294 DEBUG [leihs.procurement.dashboard:228] - (count requests) => 1
2023-12-08T08:44:12.310Z NX-41294 DEBUG [leihs.procurement.dashboard:229] - (cache-key dashboard-cache-key) => 172256140
>o> bp {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:002023-12-08T08:44:12.310Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>oo> 1sum-total-price :total_price_cents (>o> mc {:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia}
>o> filter-and-assoc-cats ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345 X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 99900, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value Supplier S, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 99, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.317Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {>oo>:result  false}1sum-total-price :total_price_cents 
(>o> c {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> c {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> 2 requests* ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345 X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 99900, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value Supplier S, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 99, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required2023-12-08T08:44:12.318Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
 false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
>o> admin? >oo> 1sum-total-price :total_price_cents ({{:exists :category false}{:read true
, :write true, >o> helper7 nil
:default>debug> 9b
 >o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
{>o> s-map  :id {:NEW [:or #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", [:and :name [:< :procurement_budget_periods.end_date Category C, :current_date] :main_category_id [#uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", := :general_ledger_account :procurement_requests.approved_quantity nil]nil, ] :cost_center nil, :procurement_account nil}, :required true, :value [{:< :id :current_date 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name:procurement_budget_periods.inspection_start_date]],  Category C, :APPROVED :cost_center nil, [:and :main_category [:< :procurement_budget_periods.end_date :current_date] {[:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :>= :procurement_requests.approved_quantity :name :procurement_requests.requested_quantity]]Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, , :PARTIALLY_APPROVED :procurement_account [nil, :and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] :general_ledger_account [nil}, := :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_requests.approved_quantity :supplier 0]], :IN_APPROVAL {[:read true, :and [:write true, :>= :default nil, :required :current_date :procurement_budget_periods.inspection_start_date] false, [:value nil, :request-id :< :current_date #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_budget_periods.end_date]]}:motivation 
{:read true, :write true, :required true, :value And why not X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false>o>map-4 , :write false, :default aquisition, :required true, :value nil, (:request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number >o> map NEW
{>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
:read true, [:and :write true, [:< :default nil, :procurement_budget_periods.end_date :current_date] :required false, [:value 12345 X, :>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] :request-id >o> map #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, PARTIALLY_APPROVED
>o> map [:and :inspector_priority [:< :procurement_budget_periods.end_date :current_date] [:and {[:read :< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] false, :write false, :default [:> MEDIUM, :required true, :procurement_requests.approved_quantity :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]{]
:read DENIED true, :write >o> map true, IN_APPROVAL
:default 0, :required true, [:value :and 99900, :request-id [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] :budget_period PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and {[:>= :current_date :read :procurement_budget_periods.inspection_start_date] true, :write [true, :< :default :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
{:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value Supplier S, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 99, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}})
2023-12-08T08:44:12.324Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>oo> 2sum-total-price :total_price_cents (9890100)
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[>>1 9890100
(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] 
>o> result 1a PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [{:= :procurement_requests.approved_quantity 0]] DENIED [:and :main_category_id [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [#uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :procurement_requests], :name :left-join [Category C, :models :requests [:= (:models.id :procurement_requests.model_id]], :order-by {:category [[{[:raw :read concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [true, :write :procurement_budget_periods [true, := :default :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
{>o> join-and-nest-budget-periods
>o> sqlmap :id {:select [#uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6"[, [:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] :name [Category C, :main_category_id [#uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", [:general_ledger_account (nil, :case :cost_center nil, [:procurement_account nil}:or , [:required :and true, [:< :value :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date {:procurement_budget_periods.inspection_start_date]] :id NEW 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name [Category C, :and :cost_center [nil, :< :procurement_budget_periods.end_date :current_date] :main_category [:>= :procurement_requests.approved_quantity {:procurement_requests.requested_quantity]] :id APPROVED b12cf49d-b54a-4cb1-8890-742f810a8a71, [:name :and Colombia}, [:main_category_id:<  b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_budget_periods.end_date :procurement_account nil, :current_date] :general_ledger_account nil}, [:and :request-id [:< #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_requests.approved_quantity :procurement_requests.requested_quantity] :supplier [:> {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_requests.approved_quantity :motivation 0]]] PARTIALLY_APPROVED {:read [true, :and :write true, [:required :< :procurement_budget_periods.end_date true, :current_date] :value [And why not X, := :request-id :procurement_requests.approved_quantity #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, 0]] :accounting_type DENIED {[:read :and false, :write [false, :>= :current_date :default :procurement_budget_periods.inspection_start_date] aquisition, :required true, [:value nil, :request-id :< #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :current_date :procurement_budget_periods.end_date]]:actionPermissions  IN_APPROVAL){]] :edit :state]], true, :from :delete true, :moveBudgetPeriod true[, :procurement_requests], :moveCategory true}, :left-join :article_number [:models {[:read := true, :write :models.id true, :procurement_requests.model_id]]:default nil, , :required :order-by false, :value [12345 X, :request-id [#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, [:inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]]:request-id , #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :join :price_cents [:procurement_budget_periods {:read [true, :write true, := :default :procurement_budget_periods.id :procurement_requests.budget_period_id]]}0, :required true
>o> tbl , :procurement_budget_periods_2
:value >o> nest-key :budget_period
99900, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default >o> join-and-nest-categories
{:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date >o> sqlmap {#inst ":select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 2024-02-07T23:00:00nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [.000000000-00:00", [:end_date [:raw #inst "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [2024-03-07T23:00:00:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [.000000000-00:00", :created_at #inst "2023-12-08T08:44:08{:select [:* .114337000-00:00", [:updated_at [#inst ":> :current_date 2023-12-08T08:44:08:end_date] :is_past]], :from .114337000-00:00"}[:procurement_budget_periods], } :procurement_budget_periods_2] :required [:= true, :value :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
{:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement >o> {join-and-nest-templates
:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {>o> sqlmap :read true, :write true, :required false, :value :unqueried, :request-id {#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :select :DELETE [true, [:template [:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case{:read true,  [:write false, :default nil, :or [:required true, :value nil, :and [:request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :< :state :procurement_budget_periods.end_date :current_date] :NEW, [:organization := :procurement_requests.approved_quantity {nil]] :value [{:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname :< :current_date :procurement_budget_periods.inspection_start_date]] nil, :department NEW {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name[ Toys, Kids & Baby, :and [:parent_id nil, :shortname nil}:< :procurement_budget_periods.end_date :current_date] }, [:read false, :write :>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, APPROVED :supplier_name [{:and :read [true, :write true, :< :procurement_budget_periods.end_date :current_date] :default nil[:and , [:required false, :value:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity]  Supplier S[, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :> :order_status :procurement_requests.approved_quantity {0]]] PARTIALLY_APPROVED :read [true, :write true, :default :and [NOT_PROCURED, :required true, :< :procurement_budget_periods.end_date :current_date] :value [:NOT_PROCESSED, :request-id := :procurement_requests.approved_quantity#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"},  :requested_quantity 0]] DENIED{:read true, :write true, :required true, :value  99, :request-id [#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :and :general_ledger_account [:>= :current_date :procurement_budget_periods.inspection_start_date] {[:read false, :write false, :< :current_date:required false,  :procurement_budget_periods.end_date]] IN_APPROVAL)]:value nil, :request-id ] #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state] :updated_at [{:value [#inst "[:row_to_json :procurement_budget_periods_2]] :budget_period] [2023-12-08T08:44:08[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[.148190000-00:00", [:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority [{:procurement_requests], :read true, :write :left-join true, :default [:models NORMAL, [:required true, :value := :models.id:NORMAL, :request-id  :procurement_requests.model_id]], :order-by #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id [#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents [9890100, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id [:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center :join {[:read false, :write false, :procurement_budget_periods :required false, :value nil, [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] :request-id [#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:select [:* {:read true, :write false, [[:required :> true, :default :current_date :end_date] :is_past]], :from {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, [:lastname Pfeffer}, :value :procurement_budget_periods]} :procurement_budget_periods_2] {[:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:=:system_admin_protected  :procurement_categories.id :procurement_requests.category_id] false, :procurement_main_categories [:address := nil, :procurement_main_categories.id :procurement_categories.main_category_id] :email lynsey_kertzmann@klein-wehner.org, :procurement_organizations [:pool_protected false, := :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :procurement_organizations.id :procurement_requests.organization_id] :img32_url nil, [:account_enabled true, :procurement_organizations :procurement_departments] :lastname [Pfeffer, :phone := :procurement_departments.id nil, :procurement_organizations.parent_id]]}:img_digest nil, 
:org_id nil, >o> tbl :extended_info nil, :procurement_templates:secondary_email nil, :city nil, 
:settings nil, >o> nest-key :template
:is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 9890100, :procurement_account nil, :cacheKey 172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil} 

{:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345 X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 99900, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value Supplier S, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 99, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, >o> sqlmap :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:select {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, [:default NORMAL, :required [true, :value [:NORMAL, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :raw :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] :total_price_cents [9890100, [:price_currency [{:read true, :write false, :default CHF, (:required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :case :procurement_account {[:read false, :write :or false, :value nil[:and [:< :procurement_budget_periods.end_date , :current_date] :request-id [#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, := :room :procurement_requests.approved_quantity {nil]] :read [true, :< :write true, :current_date :default :procurement_budget_periods.inspection_start_date]] NEW {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, [:building :and {[:id :< #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name :procurement_budget_periods.end_date general building, :current_date] :code nil}}, [:required true, :>= :procurement_requests.approved_quantity :value :procurement_requests.requested_quantity]] APPROVED {:id [88cabe8e-ff28-4580-920d-8244ebf0823e, :and :name Room R X, [:general :< :procurement_budget_periods.end_date :current_date] false, :building [:and {[:id :< :procurement_requests.approved_quantityab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil,  :name :procurement_requests.requested_quantity] Building B X}, [:building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :> :description nil}, :procurement_requests.approved_quantity :request-id 0]]] PARTIALLY_APPROVED [:and #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, [:< :inspection_comment :procurement_budget_periods.end_date :current_date] {[:read := false, :procurement_requests.approved_quantity 0:write ]] false, DENIED :required false, :value [nil, :and :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id [#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}:>= :current_date,  :order_quantity :procurement_budget_periods.inspection_start_date] {[:read :< :current_date false, :procurement_budget_periods.end_date]] :write false, IN_APPROVAL)]] :required false:state] , :value nil, [:request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, [:cost_center [{:row_to_json :read false, :write :procurement_budget_periods_2]] false, :budget_period] :required false, [:value nil, [:request-id :raw #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] :user [[[:row_to_json :models]] :model] [{:read [true, :raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] :write [false, :required true, [:default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value [:row_to_json :procurement_templates]] :template]{ [[:raw :system_admin_protected falserow_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], , :address nil, :from :email [lynsey_kertzmann@klein-wehner.org, :procurement_requests], :pool_protected false, :left-join :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, (:img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :models :extended_info nil, :secondary_email nil, [:city nil, := :settings nil, :models.id :procurement_requests.model_id] :procurement_templates :is_admin false, [:organization := local, :login nil, :procurement_templates.id :searchable :procurement_requests.template_id]), Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :order-by :updated_at 2023-12-08T09:44:08.503699+01:00, [:firstname Krysta, [:zip nil, [:id :raw d2b20225-6495-4fb4-b72c-9d2b96dc6152, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :url :join nil, [:password_sign_in_enabled :procurement_budget_periods true, :account_disabled_at nil, [:is_system_admin false, := :badge_id nil, :procurement_budget_periods.id :language_locale nil, :procurement_requests.budget_period_id] :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, [:request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, {:receiver :select [:* [{[:> :read true, :current_date :write true, :end_date] :required false, :is_past]], :value :from Hans Heiri X, :request-id [#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_budget_periods]} :internal_order_number :procurement_budget_periods_2] [{:= :read :procurement_budget_periods_2.id false, :procurement_requests.budget_period_id]:write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at  {:procurement_categories :value [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] #inst ":rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
2023-12-08T08:44:08>o> tbl :suppliers
>o> nest-key :supplier
.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents >o> join-and-nest-users
9890100, >o> sqlmap :procurement_account nil, :cacheKey 172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil}{):select 
[[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] >oo> [2sum-total-price :total_price_cents [[((:case [:or [9890100)
:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< >>1:procurement_requests.approved_quantity  :procurement_requests.requested_quantity] 9890100[
:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl 
>>ToCheck dashboard::determine-budget-periods:users 
>o> nest-key :user
{:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia, :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default >o> helper8
>oo> helper8 nil nil nil
>oo> helper9 {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil{}, :required true, :value :select {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, [:name Category C, :cost_center nil, [:main_category [{:raw:id  b12cf49d-b54a-4cb1-8890-742f810a8a71, :name DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account [nil, :general_ledger_account nil}, [:request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, [:supplier {:read true, :write true, :default nil, :required false, (:value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :case :motivation [:or {:read true, :write true, :required true, :value And why not X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345 X, :request-id [#uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :and :inspector_priority [{:read :< false, :procurement_budget_periods.end_date :write false, :default :current_date] MEDIUM, [:required true, := :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] :value NEW nil, [:request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :and :price_cents [:< :procurement_budget_periods.end_date {:current_date] :read true[, :>= :write true, :default :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and 0, :required true, :value[:< :procurement_budget_periods.end_date  99900, :current_date] [:request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :and :budget_period [:< {:procurement_requests.approved_quantity :procurement_requests.requested_quantity] :read true, :write true, [:default :> :procurement_requests.approved_quantity {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] #inst "[[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from 2024-02-07T23:00:00[:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= .000000000-00:00", :procurement_organizations.id :procurement_requests.organization_id] :end_date [:procurement_organizations #inst ":procurement_departments] 2024-03-07T23:00:00[:= :procurement_departments.id :procurement_organizations.parent_id] :rooms .000000000-00:00", :created_at #inst "2023-12-08T08:44:08[:= :rooms.id :procurement_requests.room_id] :buildings .114337000-00:00", [:updated_at := #inst ":buildings.id :rooms.building_id]]}2023-12-08T08:44:08
.114337000-00:00"}, :required true, :value >o>> where [:in :procurement_requests.id [:cast id :uuid]]) [{:id e59fa9c4-7a4c-44b8-ae09-fa71c3a84334]139cd63f-9e4e-44a4-98b9-98170b5ed741, 
:name >o> apply-scope Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"
:article_name {:read true, :write true, :default nil, :required true, :value Camera X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value Supplier S, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 99, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 9890100, :procurement_account nil, :cacheKey 172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil}), :total_price_cents 9890100, :cacheKey 172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71} 

{:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Colombia, :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name Category C, :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value And why not X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345 X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 99900, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value Supplier S, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 99, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency 2023-12-08T08:44:12.381Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
{:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value Hans Heiri X, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 9890100, :procurement_account nil, :cacheKey 172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6, :cost_center nil}), :total_price_cents 9890100, :cacheKey 172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71})
>oo> 2sum-total-price :total_price_cents (9890100)
>>1 9890100
>o> admin? {:exists false}
2023-12-08T08:44:12.310Z NX-41294 DEBUG [leihs.procurement.dashboard:230] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ({:main_categories ({:id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Colombia", :categories ({:main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Category C", :requests ({:category {:read true, :write true, :default {:id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name "Category C", :main_category_id #uuid "b12cf49d-b54a-4cb1-8890-742f810a8a71", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :name "Category C", :cost_center nil, :main_category {:id "b12cf49d-b54a-4cb1-8890-742f810a8a71", :name "Colombia"}, :main_category_id "b12cf49d-b54a-4cb1-8890-742f810a8a71", :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :motivation {:read true, :write true, :required true, :value "And why not X", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :accounting_type {:read false, :write false, :default "aquisition", :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value "12345 X", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspector_priority {:read false, :write false, :default "MEDIUM", :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :price_cents {:read true, :write true, :default 0, :required true, :value 99900, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :budget_period {:read true, :write true, :default {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name "Budget-Period-BP", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}, :required true, :value {:id "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name "Budget-Period-BP", :inspection_start_date "2024-02-08T00:00:00+01:00", :end_date "2024-03-08T00:00:00+01:00", :created_at "2023-12-08T09:44:08.114337", :updated_at "2023-12-08T09:44:08.114337", :is_past false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :article_name {:read true, :write true, :default nil, :required true, :value "Camera X", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :state :NEW, :organization {:value {:id "6a766d44-305d-4631-a269-5a83b8756a75", :name "Baby, Toys & Computers", :parent_id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3", :shortname nil, :department {:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3", :name "Toys, Kids & Baby", :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :supplier_name {:read true, :write true, :default nil, :required false, :value "Supplier S", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_status {:read true, :write true, :default "NOT_PROCURED", :required true, :value :NOT_PROCESSED, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :requested_quantity {:read true, :write true, :required true, :value 99, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :updated_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :priority {:read true, :write true, :default "NORMAL", :required true, :value :NORMAL, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency {:read true, :write false, :default "CHF", :required true, :value "CHF", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name "general room", :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name "general building", :code nil}}, :required true, :value {:id "88cabe8e-ff28-4580-920d-8244ebf0823e", :name "Room R X", :general false, :building {:id "ab3f5d69-9c74-43f0-a75f-e6866505a1d1", :code nil, :name "Building B X"}, :building_id "ab3f5d69-9c74-43f0-a75f-e6866505a1d1", :description nil}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :user {:read true, :write false, :required true, :default {:id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :firstname "Krysta", :lastname "Pfeffer"}, :value {:system_admin_protected false, :address nil, :email "lynsey_kertzmann@klein-wehner.org", :pool_protected false, :last_sign_in_at "2023-12-08T09:44:08.503699+01:00", :img32_url nil, :account_enabled true, :lastname "Pfeffer", :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization "local", :login nil, :searchable "Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta", :updated_at "2023-12-08T09:44:08.503699+01:00", :firstname "Krysta", :zip nil, :id "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at "2023-12-08T09:44:08.119041+01:00", :admin_protected false}, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :receiver {:read true, :write true, :required false, :value "Hans Heiri X", :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :created_at {:value #inst "2023-12-08T08:44:08.148190000-00:00", :read false, :write false, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}, :short_id "Budget-Period-BP.001", :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"}}), :general_ledger_account nil, :id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :total_price_cents 9890100, :procurement_account nil, :cacheKey "172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6", :cost_center nil}), :total_price_cents 9890100, :cacheKey "172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71"}), :name "Budget-Period-BP", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :total_price_cents 9890100, :cacheKey "172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741", :created_at #inst "2023-12-08T08:44:08.114337000-00:00"})
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.401Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.402Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "172256140"] [:budget_periods [#ordered/map ([:cacheKey "172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:total_price_cents "9890100"] [:main_categories [#ordered/map ([:cacheKey "172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:total_price_cents "9890100"] [:categories [#ordered/map ([:cacheKey "172256140_139cd63f-9e4e-44a4-98b9-98170b5ed741_b12cf49d-b54a-4cb1-8890-742f810a8a71_9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:total_price_cents "9890100"] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:08.503699Z", :id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :user_session_id #uuid "9576a687-7c4d-43ea-a450-f9fc40ee8033", :scope_system_admin_read false, :access-rights (), :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL e59fa9c4-7a4c-44b8-ae09-fa71c3a84334 #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.410Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.411Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.411Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status not_processed, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :NORMAL
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :template_id nil, :article_number 12345 X, :inspector_priority medium, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :organization_id #uuid "6a766d44-305d-4631-a269-5a83b8756a75", :replacement true, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :user_id #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152", :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "88cabe8e-ff28-4580-920d-8244ebf0823e", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :category_id #uuid "9458ba86-a4c6-43d2-bae2-0e4e479106d6", :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 9458ba86-a4c6-43d2-bae2-0e4e479106d6, :name Category C, :cost_center nil, :main_category {:id b12cf49d-b54a-4cb1-8890-742f810a8a71, :name Colombia}, :main_category_id b12cf49d-b54a-4cb1-8890-742f810a8a71, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation And why not X, :accounting_type aquisition, :article_number 12345 X, :inspector_priority :MEDIUM, :price_cents 99900, :budget_period {:id 139cd63f-9e4e-44a4-98b9-98170b5ed741, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:08.114337, :updated_at 2023-12-08T09:44:08.114337, :is_past false}, :article_name Camera X, :replacement true, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 6a766d44-305d-4631-a269-5a83b8756a75, :name Baby, Toys & Computers, :parent_id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :shortname nil, :department {:id b4c4fa8f-2440-460e-98f6-9ff670db2ae3, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name Supplier S, :order_status :NOT_PROCESSED, :requested_quantity 99, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:08.148190000-00:00", :priority :NORMAL, :id #uuid "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334", :total_price_cents 9890100, :price_currency CHF, :procurement_account nil, :room {:id 88cabe8e-ff28-4580-920d-8244ebf0823e, :name Room R X, :general false, :building {:id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :code nil, :name Building B X}, :building_id ab3f5d69-9c74-43f0-a75f-e6866505a1d1, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:08.503699+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:08.503699+01:00, :firstname Krysta, :zip nil, :id d2b20225-6495-4fb4-b72c-9d2b96dc6152, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:08.119041+01:00, :admin_protected false}, :receiver Hans Heiri X, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:08.148190000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
2023-12-08T08:44:12.462Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => d2b20225-6495-4fb4-b72c-9d2b96dc6152
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.462Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.463Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
2023-12-08T08:44:12.463Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "139cd63f-9e4e-44a4-98b9-98170b5ed741", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:08.114337000-00:00", :updated_at #inst "2023-12-08T08:44:08.114337000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:12.465Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" 9458ba86-a4c6-43d2-bae2-0e4e479106d6]
2023-12-08T08:44:12.467Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "d2b20225-6495-4fb4-b72c-9d2b96dc6152" "9458ba86-a4c6-43d2-bae2-0e4e479106d6"]
>o> viewer? {:result false}
2023-12-08T08:44:12.469Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:12.469Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:12.469Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:12.469Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:12.469Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:12.469Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:12.469Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:12.473Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "e59fa9c4-7a4c-44b8-ae09-fa71c3a84334"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "d2b20225-6495-4fb4-b72c-9d2b96dc6152"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:main_category #ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6a766d44-305d-4631-a269-5a83b8756a75"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "b4c4fa8f-2440-460e-98f6-9ff670db2ae3"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345 X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "88cabe8e-ff28-4580-920d-8244ebf0823e"] [:name "Room R X"] [:building #ordered/map ([:id "ab3f5d69-9c74-43f0-a75f-e6866505a1d1"] [:name "Building B X"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "b12cf49d-b54a-4cb1-8890-742f810a8a71"] [:name "Colombia"] [:categories [#ordered/map ([:id "9458ba86-a4c6-43d2-bae2-0e4e479106d6"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "139cd63f-9e4e-44a4-98b9-98170b5ed741"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 157023985161958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1de44183 /127.0.0.1:3230<->/127.0.0.1:57095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:31.267Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:31.271Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:31.272Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:31.273Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  nil

> 1 anti-csrf-token class >  nil

> 2 anti-csrf-token-new >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}}, :remote-addr 127.0.0.1, :start-time 157024110360791, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7af48573 /127.0.0.1:3230<->/127.0.0.1:57095], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:31.378Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:31.379Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:31.379Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:31.380Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}}, :remote-addr 127.0.0.1, :start-time 157024237422958, :params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x78196f7a HikariProxyConnection@2014932858 wrapping org.postgresql.jdbc.PgConnection@1ca2c0b9], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0, content-length 98, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7b34f16 /127.0.0.1:3230<->/127.0.0.1:57095], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x398a6327 HikariProxyConnection@965370663 wrapping org.postgresql.jdbc.PgConnection@38ca26f5], :level 1, :rollback #object[clojure.lang.Atom 0x6724f1f8 {:status :ready, :val false}]}, :content-length 98, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x54f520d9 BytesInputStream[len=98]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x78196f7a HikariProxyConnection@2014932858 wrapping org.postgresql.jdbc.PgConnection@1ca2c0b9], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:31.506Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:31.507Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:31.508Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:31.509Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}}, :remote-addr 127.0.0.1, :start-time 157024327099000, :params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x35afadb2 HikariProxyConnection@900705714 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0, content-length 106, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x64709635 /127.0.0.1:3230<->/127.0.0.1:57095], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0xdd7f653 HikariProxyConnection@232257107 wrapping org.postgresql.jdbc.PgConnection@38ca26f5], :level 1, :rollback #object[clojure.lang.Atom 0x5ef10e78 {:status :ready, :val false}]}, :content-length 106, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x16fbfa29 BytesInputStream[len=106]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x71d0681d compojure.core$routes$fn__27950@71d0681d], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x35afadb2 HikariProxyConnection@900705714 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:31.596Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(NULL AS UUID))"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:31.597Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(NULL AS UUID)) AS result"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result]
2023-12-08T08:44:31.599Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(NULL AS UUID)) AS result"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))]
2023-12-08T08:44:31.599Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(NULL AS UUID))"]
>o> requester?? {:exists false}
>myprint>  requester false

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157024365019625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4206e39e /127.0.0.1:3230<->/127.0.0.1:57095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x54dd01df leihs.procurement.backend.html$not_found_handler@54dd01df], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.662Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.662Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.663Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.663Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.664Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.664Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.664Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.665Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157024598274375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x466c01f2 /127.0.0.1:3230<->/127.0.0.1:57102], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x54dd01df leihs.procurement.backend.html$not_found_handler@54dd01df], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.874Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.874Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.875Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.875Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.875Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.876Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.876Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.876Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157024602650791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x13cd1c39 /127.0.0.1:3230<->/127.0.0.1:57095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.878Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.878Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.879Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.879Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.880Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.880Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.880Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.880Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:31.882Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
2023-12-08T08:44:31.883Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
>>>2 {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}
>>oida>> #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
2023-12-08T08:44:31.884Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.910Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:31.910Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
2023-12-08T08:44:31.928Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"a9786580-ea6d-4780-bf3c-1c8527eaa2e0\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"f6b7e682-851d-4543-ab7f-b9d8ec9acf07\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157024760893500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a8d650f /127.0.0.1:3230<->/127.0.0.1:57107], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.036Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.036Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies >o> viewer? {[leihs-anti-csrf-token {SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result :value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {#uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]:value 
41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157024760364708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5307f564 /127.0.0.1:3230<->/127.0.0.1:57095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights 2023-12-08T08:44:32.037Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
(), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.037Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.037Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.038Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.038Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> admin? {:exists false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.038Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.038Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
2023-12-08T08:44:32.039Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.039Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.039Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [2023-12-08T08:44:32.039Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.040Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.040Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.040Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>o> requester?? {:exists true}
pure-handler >> 2
2023-12-08T08:44:32.041Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>>1 #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
2023-12-08T08:44:32.042Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
pure-handler >> 2
2023-12-08T08:44:32.042Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>2 {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}
>>oida>> #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
2023-12-08T08:44:32.042Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.053Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.053Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
2023-12-08T08:44:32.055Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"a9786580-ea6d-4780-bf3c-1c8527eaa2e0\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"f6b7e682-851d-4543-ab7f-b9d8ec9acf07\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157024760249250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x27390b10 /127.0.0.1:3230<->/127.0.0.1:57102], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.061Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.061Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.061Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.062Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.062Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.063Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.063Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.063Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:32.068Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>get-dashboard
>>args {}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats [{:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Colombia}]
>>queryA1 [SELECT * FROM procurement_budget_periods ORDER BY end_date DESC]
>>ToCheck dashboard:::procurement_budget_periods.id [{:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}]
>>resultA1-2 [{:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}]
>>requestsB2-triggerError {} nil
>o> helper1 id= nil
>o> helper2 nil nil nil
>oo> helper3a priority nil
>oo> helper3b priority nil
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority nil
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.074Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.074Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.074Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:32.075Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 nil nil nil
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) nil
>o> apply-scope #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.075Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.076Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.077Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.078Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.078Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
2023-12-08T08:44:32.085Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:categories [#ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :NORMAL
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :article_number nil, :inspector_priority :MEDIUM, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :replacement true, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :priority :NORMAL, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
>o>dashboard-cache-keyB2 {:id -15128758}
2023-12-08T08:44:32.097Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => f6b7e682-851d-4543-ab7f-b9d8ec9acf07
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.098Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.099Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.099Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:32.101Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:32.101Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> viewer? {:result false}
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.dashboard:228] - (count requests) => 1
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.dashboard:229] - (cache-key dashboard-cache-key) => -15128758
>o> bp {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}
>oo> 1sum-total-price :total_price_cents (>o> mc {:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Colombia}
>o> filter-and-assoc-cats ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}})
>oo> 1sum-total-price :total_price_cents (>o> c {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> c {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> 2 requests* ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}})
>oo> 1sum-total-price :total_price_cents ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0

>o> result 1a {:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765, :cost_center nil} 

{:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765, :cost_center nil})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0

>>ToCheck dashboard::determine-budget-periods {:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Colombia, :categories ({:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765, :cost_center nil}), :total_price_cents 0, :cacheKey -15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1} 

{:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Colombia, :categories ({:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey -15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765, :cost_center nil}), :total_price_cents 0, :cacheKey -15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0
2023-12-08T08:44:32.102Z NX-41294 DEBUG [leihs.procurement.dashboard:230] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ({:main_categories ({:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name "Colombia", :categories ({:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name "Category C", :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name "Category C", :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name "Category C", :cost_center nil, :main_category {:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name "Colombia"}, :main_category_id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value "Consectetur asperiores quis expedita.", :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default "aquisition", :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default "MEDIUM", :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name "Budget-Period-BP", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name "Budget-Period-BP", :inspection_start_date "2024-02-08T00:00:00+01:00", :end_date "2024-03-08T00:00:00+01:00", :created_at "2023-12-08T09:44:31.201146", :updated_at "2023-12-08T09:44:31.201146", :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value "Mediocre Aluminum Shoes", :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :name "Baby, Toys & Computers", :parent_id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4", :shortname nil, :department {:id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4", :name "Toys, Kids & Baby", :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default "NOT_PROCURED", :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default "NORMAL", :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default "CHF", :required true, :value "CHF", :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name "general room", :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name "general building", :code nil}}, :required true, :value {:id "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :name "conservatory", :general false, :building {:id "222fe58b-906a-4c31-8dec-c499dcc39400", :code nil, :name "3605 Nanci Heights"}, :building_id "222fe58b-906a-4c31-8dec-c499dcc39400", :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname "Krysta", :lastname "Pfeffer"}, :value {:system_admin_protected false, :address nil, :email "lynsey_kertzmann@klein-wehner.org", :pool_protected false, :last_sign_in_at "2023-12-08T09:44:31.611482+01:00", :img32_url nil, :account_enabled true, :lastname "Pfeffer", :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization "local", :login nil, :searchable "Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta", :updated_at "2023-12-08T09:44:31.611482+01:00", :firstname "Krysta", :zip nil, :id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at "2023-12-08T09:44:31.211091+01:00", :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id "Budget-Period-BP.001", :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey "-15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765", :cost_center nil}), :total_price_cents 0, :cacheKey "-15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1"}), :name "Budget-Period-BP", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :total_price_cents 0, :cacheKey "-15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09", :created_at #inst "2023-12-08T08:44:31.201146000-00:00"})
2023-12-08T08:44:32.147Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 1] [:budget_periods [#ordered/map ([:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:cacheKey "-15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:cacheKey "-15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:cacheKey "-15128758_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:total_price_cents "0"] [:requests [#ordered/map ([:id "75ed4778-c966-4722-9c24-1e79a56ce427"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:main_category #ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "7cc593b5-b6e0-450f-88db-3407e5a4f36c"] [:name "conservatory"] [:building #ordered/map ([:id "222fe58b-906a-4c31-8dec-c499dcc39400"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "0"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157024900289041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6a72aed2 /127.0.0.1:3230<->/127.0.0.1:57102], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [84d2ecaa-8fa2-414c-9e11-c6a21c210cdb], :categories [3d4e36c8-6747-41b1-98ba-6be8935bc765], :priority [NORMAL HIGH], :budgetPeriods [18999fec-1a5f-4b7f-a2e4-78b733c89f09]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.177Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.177Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.178Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.178Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.178Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.179Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.179Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.180Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:32.184Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["84d2ecaa-8fa2-414c-9e11-c6a21c210cdb"], :categories ["3d4e36c8-6747-41b1-98ba-6be8935bc765"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["18999fec-1a5f-4b7f-a2e4-78b733c89f09"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MEDIUM HIGH MANDATORY] {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [84d2ecaa-8fa2-414c-9e11-c6a21c210cdb], :categories [3d4e36c8-6747-41b1-98ba-6be8935bc765], :priority [NORMAL HIGH], :budgetPeriods [18999fec-1a5f-4b7f-a2e4-78b733c89f09]}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [84d2ecaa-8fa2-414c-9e11-c6a21c210cdb], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [18999fec-1a5f-4b7f-a2e4-78b733c89f09], :category_id [3d4e36c8-6747-41b1-98ba-6be8935bc765]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats [{:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Colombia}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09"]
>>ToCheck dashboard:::procurement_budget_periods.id [{:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}]
>>resultA1-2 [{:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}]
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [84d2ecaa-8fa2-414c-9e11-c6a21c210cdb], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [18999fec-1a5f-4b7f-a2e4-78b733c89f09], :category_id [3d4e36c8-6747-41b1-98ba-6be8935bc765]} nil
>o> helper1 id= nil
>o> helper2 [3d4e36c8-6747-41b1-98ba-6be8935bc765] [18999fec-1a5f-4b7f-a2e4-78b733c89f09] [84d2ecaa-8fa2-414c-9e11-c6a21c210cdb]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>debug> 1a
>debug> 1a
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
low medium high mandatory)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
>debug> 1a
not_processed in_progress procured alternative_procured not_procured)
>oo> helper5c :order_status java.lang.String
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.189Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.189Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.190Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:32.195Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low medium high mandatory) (normal high)
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) nil
>debug> 2
>oo> >here> to-name-and-lower-case-enums (not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.225Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.226Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN (CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM))) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 3d4e36c8-6747-41b1-98ba-6be8935bc765 18999fec-1a5f-4b7f-a2e4-78b733c89f09 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN (CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM), CAST(? AS ORDER_STATUS_ENUM))) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 3d4e36c8-6747-41b1-98ba-6be8935bc765 18999fec-1a5f-4b7f-a2e4-78b733c89f09 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.244Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.247Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.247Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :NORMAL
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :article_number nil, :inspector_priority :MEDIUM, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :replacement true, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :priority :NORMAL, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
>o>dashboard-cache-keyB2 {:id -529786781}
2023-12-08T08:44:32.295Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => f6b7e682-851d-4543-ab7f-b9d8ec9acf07
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.295Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.296Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:32.296Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:32.298Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:32.299Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> viewer? {:result false}
2023-12-08T08:44:32.300Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:32.300Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:32.300Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:32.300Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:32.300Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:32.300Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:32.300Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:32.301Z NX-41294 DEBUG [leihs.procurement.dashboard:228] - (count requests) => 1
2023-12-08T08:44:32.301Z NX-41294 DEBUG [leihs.procurement.dashboard:229] - (cache-key dashboard-cache-key) => -529786781
>o> bp {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}
>oo> 1sum-total-price :total_price_cents (>o> mc {:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Colombia}
>o> filter-and-assoc-cats ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}})
>oo> 1sum-total-price :total_price_cents (>o> c {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> c {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}
>o> 2 requests* ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}})
>oo> 1sum-total-price :total_price_cents ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0

>o> result 1a {:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey -529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765, :cost_center nil} 

{:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey -529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765, :cost_center nil})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0

>>ToCheck dashboard::determine-budget-periods {:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Colombia, :categories ({:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey -529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765, :cost_center nil}), :total_price_cents 0, :cacheKey -529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1} 

{:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Colombia, :categories ({:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name Category C, :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name Category C, :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey -529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765, :cost_center nil}), :total_price_cents 0, :cacheKey -529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1})
>oo> 2sum-total-price :total_price_cents (0)
>>1 0
2023-12-08T08:44:32.301Z NX-41294 DEBUG [leihs.procurement.dashboard:230] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ({:main_categories ({:id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name "Colombia", :categories ({:main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name "Category C", :requests ({:category {:read true, :write true, :default {:id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name "Category C", :main_category_id #uuid "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id "3d4e36c8-6747-41b1-98ba-6be8935bc765", :name "Category C", :cost_center nil, :main_category {:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :name "Colombia"}, :main_category_id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1", :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :motivation {:read true, :write true, :required true, :value "Consectetur asperiores quis expedita.", :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :accounting_type {:read false, :write false, :default "aquisition", :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspector_priority {:read false, :write false, :default "MEDIUM", :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :budget_period {:read true, :write true, :default {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name "Budget-Period-BP", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}, :required true, :value {:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name "Budget-Period-BP", :inspection_start_date "2024-02-08T00:00:00+01:00", :end_date "2024-03-08T00:00:00+01:00", :created_at "2023-12-08T09:44:31.201146", :updated_at "2023-12-08T09:44:31.201146", :is_past false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :article_name {:read true, :write true, :default nil, :required true, :value "Mediocre Aluminum Shoes", :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :state :NEW, :organization {:value {:id "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :name "Baby, Toys & Computers", :parent_id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4", :shortname nil, :department {:id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4", :name "Toys, Kids & Baby", :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_status {:read true, :write true, :default "NOT_PROCURED", :required true, :value :NOT_PROCESSED, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :updated_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :priority {:read true, :write true, :default "NORMAL", :required true, :value :NORMAL, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency {:read true, :write false, :default "CHF", :required true, :value "CHF", :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name "general room", :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name "general building", :code nil}}, :required true, :value {:id "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :name "conservatory", :general false, :building {:id "222fe58b-906a-4c31-8dec-c499dcc39400", :code nil, :name "3605 Nanci Heights"}, :building_id "222fe58b-906a-4c31-8dec-c499dcc39400", :description nil}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :user {:read true, :write false, :required true, :default {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname "Krysta", :lastname "Pfeffer"}, :value {:system_admin_protected false, :address nil, :email "lynsey_kertzmann@klein-wehner.org", :pool_protected false, :last_sign_in_at "2023-12-08T09:44:31.611482+01:00", :img32_url nil, :account_enabled true, :lastname "Pfeffer", :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization "local", :login nil, :searchable "Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta", :updated_at "2023-12-08T09:44:31.611482+01:00", :firstname "Krysta", :zip nil, :id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at "2023-12-08T09:44:31.211091+01:00", :admin_protected false}, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :created_at {:value #inst "2023-12-08T08:44:31.233838000-00:00", :read false, :write false, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}, :short_id "Budget-Period-BP.001", :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427"}}), :general_ledger_account nil, :id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :total_price_cents 0, :procurement_account nil, :cacheKey "-529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765", :cost_center nil}), :total_price_cents 0, :cacheKey "-529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1"}), :name "Budget-Period-BP", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00", :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :total_price_cents 0, :cacheKey "-529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09", :created_at #inst "2023-12-08T08:44:31.201146000-00:00"})
2023-12-08T08:44:32.366Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-529786781"] [:total_count 1] [:budget_periods [#ordered/map ([:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:cacheKey "-529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:cacheKey "-529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:cacheKey "-529786781_18999fec-1a5f-4b7f-a2e4-78b733c89f09_293b0c43-ac4d-4c29-a446-ffced2ceb4a1_3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:total_price_cents "0"] [:requests [#ordered/map ([:id "75ed4778-c966-4722-9c24-1e79a56ce427"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:main_category #ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "7cc593b5-b6e0-450f-88db-3407e5a4f36c"] [:name "conservatory"] [:building #ordered/map ([:id "222fe58b-906a-4c31-8dec-c499dcc39400"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "0"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157025749703791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6b907f86 /127.0.0.1:3230<->/127.0.0.1:57102], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [75ed4778-c966-4722-9c24-1e79a56ce427]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.027Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.028Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.028Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.029Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.029Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.029Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.030Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.030Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:33.035Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
 with variables {:id ["75ed4778-c966-4722-9c24-1e79a56ce427"]}
>oo> vars from graphQL-Requst nil nil nil {:id [75ed4778-c966-4722-9c24-1e79a56ce427]}
>o> helper1 id= [75ed4778-c966-4722-9c24-1e79a56ce427]
>o> helper2 nil nil nil
>oo> helper3a priority nil
>oo> helper3b priority nil
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority nil
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.040Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.041Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.041Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:33.042Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 nil nil nil
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) [75ed4778-c966-4722-9c24-1e79a56ce427]
>o> apply-scope #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.042Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.043Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 75ed4778-c966-4722-9c24-1e79a56ce427 #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 75ed4778-c966-4722-9c24-1e79a56ce427 #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.043Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.044Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.044Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :NORMAL
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :article_number nil, :inspector_priority :MEDIUM, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :replacement true, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :priority :NORMAL, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
2023-12-08T08:44:33.052Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => f6b7e682-851d-4543-ab7f-b9d8ec9acf07
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.052Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.052Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.052Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:33.053Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:33.054Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> viewer? {:result false}
2023-12-08T08:44:33.054Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:33.055Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:33.055Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:33.055Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:33.055Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:33.055Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:33.055Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:33.062Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "75ed4778-c966-4722-9c24-1e79a56ce427"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:main_category #ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "7cc593b5-b6e0-450f-88db-3407e5a4f36c"] [:name "conservatory"] [:building #ordered/map ([:id "222fe58b-906a-4c31-8dec-c499dcc39400"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:categories [#ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= >>> authenticate::skip= nilnil   handler-key= handler-key=  :graphql:graphql

>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at >>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read :scope_system_admin_read falsefalse, , :access-rights :access-rights ((), ), :user_id :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin :is_system_admin false, false, :external_sign_out_url nil, :external_sign_out_url :language_locale nil, nil, :inventory_pool_roles_count :language_locale nil, 0, :inventory_pool_roles_count :scope_admin_read false0, }:scope_admin_read false}


>> authorize >

>> authorize::handler > #object[
>> authorize >
leihs.core.locale$wrap$fn__44398 
>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bbleihs.core.locale$wrap$fn__44398@52d373bb]]


>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {
>> authorize::request > leihs-anti-csrf-token {:value {a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :authenticated-entity :remote-addr 127.0.0.1, :start-time {157025850067125, :email :params lynsey_kertzmann@klein-wehner.org, :contracts_count {}, 0, :settings :lastname Pfeffer, :org_id nil, :scope_read {true, :is_admin :email_sending_enabled false, false, :authentication-method :sessions_max_lifetime_secs :session, :login nil, :scope_system_admin_write false, :scope_write true, 432000, :firstname :smtp_default_from_address your.lending.desk@example.com, Krysta, :public_image_caching_enabled :scope_admin_write true, false, :sessions_force_secure false, :user_session_created_at :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{#time/instant "2023-12-08T08:44:31.611482Z", :connectable :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157025849838000, :params #object[{}, :settings com.zaxxer.hikari.HikariDataSource {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, 0x225fb0ee :email_signature HikariDataSource (HikariPool-1)]Cheers,}, , :tx-next :options #next.jdbc.default_options.DefaultOptions{:builder-fn {#object[next.jdbc.result_set$as_unqualified_lower_maps :connectable 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {#object[origin com.zaxxer.hikari.HikariDataSource http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 137, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, #object[org.httpkit.server.AsyncChannel accept-encoding gzip, deflate, br, 0x2cb9b05e sec-fetch-mode /127.0.0.1:3230<->/127.0.0.1:57107]cors}, :async-channel , :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, #object[:content-length org.httpkit.server.AsyncChannel 257, :form-params {}, :websocket? false, 0x5801d48 :query-params /127.0.0.1:3230<->/127.0.0.1:57102], :server-port {}, 3230, :params-raw :content-type application/json, :form-params-raw {}, :tx {}, :character-encoding {utf8, :datasource :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body #object[com.zaxxer.hikari.HikariDataSource {:operationName getRoomsByBuilding0x321108bd , HikariDataSource (db-pool)]}, :content-length :variables 137, :form-params {:buildingId {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, 222fe58b-906a-4c31-8dec-c499dcc39400}, :body :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, {:graphql-schema :operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, #CompiledSchema<>, :handler :handler #object[#object[leihs.procurement.graphql$handler leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params :multipart-params {}, {}, :scheme :scheme :http, :http, :request-method :request-method :post, :post, :accept :accept {{:mime :mime :json, :json, :charset nil, :charset nil, :encoding nil, :encoding nil, :language nil}}:language nil}}

>> authorize::handler-key >> :graphql

>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, 
>> authorize::handler-key >> :contracts_count :graphql0, 
>myprint>  authEnt?:lastname  Pfeffer, :org_id nil, :scope_read true, {:is_admin false, :authentication-method :email :session, lynsey_kertzmann@klein-wehner.org, :login nil, :scope_system_admin_write false, :contracts_count :scope_write true, 0, :firstname :lastname Krysta, Pfeffer, :scope_admin_write :org_id false, nil, :user_session_created_at :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint> #time/instant "2023-12-08T08:44:31.611482Z",  :id txn #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", #:user_session_id next.jdbc.default_options.DefaultOptions#uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, {:access-rights (), :connectable :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count #object[0, com.zaxxer.hikari.HikariDataSource :scope_admin_read false}
0x225fb0ee HikariDataSource (HikariPool-1)], :options {>myprint> :builder-fn  txn #object[#next.jdbc.result_set$as_unqualified_lower_maps next.jdbc.default_options.DefaultOptions{0x73775793 :connectable next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}#object[
com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin?>o> admin?  [[SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]#uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]

2023-12-08T08:44:33.124Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.124Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
2023-12-08T08:44:33.125Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.125Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? 2023-12-08T08:44:33.125Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
{:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
2023-12-08T08:44:33.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
2023-12-08T08:44:33.127Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.127Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
2023-12-08T08:44:33.127Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.127Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? {:exists true}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.127Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:33.128Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
pure-handler >> 2
2023-12-08T08:44:33.129Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
 with variables {:buildingId "222fe58b-906a-4c31-8dec-c499dcc39400"}
>oo> vars from graphQL-Requst nil nil nil {:buildingId 222fe58b-906a-4c31-8dec-c499dcc39400}
2023-12-08T08:44:33.129Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "222fe58b-906a-4c31-8dec-c499dcc39400"] [:name "3605 Nanci Heights"] [:__typename :Building])]])}
2023-12-08T08:44:33.130Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "a3275383-3b4d-4060-96c0-67326a7319bf"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "7cc593b5-b6e0-450f-88db-3407e5a4f36c"] [:name "conservatory"] [:description nil] [:__typename :Room])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157025868548750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x72521359 /127.0.0.1:3230<->/127.0.0.1:57102], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.141Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.142Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.142Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.142Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.143Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.143Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.143Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.143Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:33.145Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
2023-12-08T08:44:33.145Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
>>>2 {:id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :firstname Krysta, :lastname Pfeffer}
>>oida>> #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
2023-12-08T08:44:33.147Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.157Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.157Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
2023-12-08T08:44:33.159Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"a9786580-ea6d-4780-bf3c-1c8527eaa2e0\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"f6b7e682-851d-4543-ab7f-b9d8ec9acf07\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157025908862416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x22b45889 /127.0.0.1:3230<->/127.0.0.1:57102], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [75ed4778-c966-4722-9c24-1e79a56ce427]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.189Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.189Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.190Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.190Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.190Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.191Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.191Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.191Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:33.196Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
 with variables {:id ["75ed4778-c966-4722-9c24-1e79a56ce427"]}
>oo> vars from graphQL-Requst nil nil nil {:id [75ed4778-c966-4722-9c24-1e79a56ce427]}
>o> helper1 id= [75ed4778-c966-4722-9c24-1e79a56ce427]
>o> helper2 nil nil nil
>oo> helper3a priority nil
>oo> helper3b priority nil
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority nil
>o> helper5
>oo> helper5a :order_status nil
>oo> helper5b :order_status nil
>oo> helper5c :order_status nil
>oo> order-status nil
>o> helper6
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.200Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.201Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.201Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> helper7 nil
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:33.202Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 nil nil nil
>oo> helper9 {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o>> where [:in :procurement_requests.id [:cast id :uuid]]) [75ed4778-c966-4722-9c24-1e79a56ce427]
>o> apply-scope #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.202Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.203Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 75ed4778-c966-4722-9c24-1e79a56ce427 #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.id = CAST((?) AS UUID)) AND ((procurement_category_viewers.user_id = CAST(? AS UUID)) OR (procurement_requests.user_id = CAST(? AS UUID))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 75ed4778-c966-4722-9c24-1e79a56ce427 #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.204Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.204Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.204Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :NORMAL
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :article_number nil, :inspector_priority :MEDIUM, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :replacement true, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :priority :NORMAL, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
2023-12-08T08:44:33.216Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => f6b7e682-851d-4543-ab7f-b9d8ec9acf07
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.217Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.217Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.217Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:33.219Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:33.219Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> viewer? {:result false}
2023-12-08T08:44:33.220Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:33.220Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:33.220Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:33.220Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:33.220Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:33.220Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:33.220Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
2023-12-08T08:44:33.224Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "75ed4778-c966-4722-9c24-1e79a56ce427"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:main_category #ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "7cc593b5-b6e0-450f-88db-3407e5a4f36c"] [:name "conservatory"] [:building #ordered/map ([:id "222fe58b-906a-4c31-8dec-c499dcc39400"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:categories [#ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157026075092666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x28649fc6 HikariProxyConnection@677683142 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 223, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x29d62b8c /127.0.0.1:3230<->/127.0.0.1:57102], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x3841172e HikariProxyConnection@943789870 wrapping org.postgresql.jdbc.PgConnection@6e2689d6], :level 1, :rollback #object[clojure.lang.Atom 0x23d841c4 {:status :ready, :val false}]}, :content-length 223, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName changeRequestCategory, :variables {:input {:id 75ed4778-c966-4722-9c24-1e79a56ce427}}, :query mutation changeRequestCategory($input: DeleteRequestInput) {
  delete_request(input_data: $input)
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x28649fc6 HikariProxyConnection@677683142 wrapping org.postgresql.jdbc.PgConnection@15a94830], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.350Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.350Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.351Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.351Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.351Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.351Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.352Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.352Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 1
2023-12-08T08:44:33.353Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query mutation changeRequestCategory($input: DeleteRequestInput) {
  delete_request(input_data: $input)
}
 with variables {:input {:id "75ed4778-c966-4722-9c24-1e79a56ce427"}}
>oo> vars from graphQL-Requst nil nil nil {:input {:id 75ed4778-c966-4722-9c24-1e79a56ce427}}
>debug> 38
>debug> 25
>debug> 24
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.354Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.355Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.355Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-08T08:44:33.356Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-associated-resources {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]], :where [:= :procurement_requests.id [:cast 75ed4778-c966-4722-9c24-1e79a56ce427 :uuid]]}
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]], :where [:= :procurement_requests.id [:cast 75ed4778-c966-4722-9c24-1e79a56ce427 :uuid]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]], :where [:= :procurement_requests.id [:cast 75ed4778-c966-4722-9c24-1e79a56ce427 :uuid]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]], :where [:= :procurement_requests.id [:cast 75ed4778-c966-4722-9c24-1e79a56ce427 :uuid]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:= :procurement_requests.id [:cast 75ed4778-c966-4722-9c24-1e79a56ce427 :uuid]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:= :procurement_requests.id [:cast 75ed4778-c966-4722-9c24-1e79a56ce427 :uuid]]}
>o> tbl :users
>o> nest-key :user
>debug> 23d
>o> HERE query-requests, auth-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE procurement_requests.id = CAST(? AS UUID) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 75ed4778-c966-4722-9c24-1e79a56ce427]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.357Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.357Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.357Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> >o> HERE :row-fn (>debug> 22
>oo> treat-order-status HERE: transform-row {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil} nil
>debug> 17
>o> treat-inspector-priority: enum-state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr / :state => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> treat-inspector-priority: enum-state _>  :NEW
>debug> 18
>debug> 19
>debug> 20
>debug> 16
>debug> 12
>o> treat-order-status: HERE row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status not_processed, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :order_status
>o> treat-:order_status: upperCase => :NOT_PROCESSED
>debug> 13
>o> treat-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority normal, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :priority
>o> treat-priority: upperCase => :NORMAL
>debug> 14
>o> treat-inspector-priority: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>debug> 11
>o> upper-case-keyword-value: row => {:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :template_id nil, :article_number nil, :inspector_priority medium, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :organization_id #uuid "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb", :replacement true, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :model_id nil, :priority :NORMAL, :supplier_id nil, :budget_period_id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :room_id #uuid "7cc593b5-b6e0-450f-88db-3407e5a4f36c", :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :category_id #uuid "3d4e36c8-6747-41b1-98ba-6be8935bc765", :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil}
>o> upper-case-keyword-value: attr => :inspector_priority
>o> treat-priority: upperCase => :MEDIUM
>debug> 15
>debug> 21
{:category {:id 3d4e36c8-6747-41b1-98ba-6be8935bc765, :name Category C, :cost_center nil, :main_category {:id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :name Colombia}, :main_category_id 293b0c43-ac4d-4c29-a446-ffced2ceb4a1, :procurement_account nil, :general_ledger_account nil}, :supplier nil, :motivation Consectetur asperiores quis expedita., :accounting_type aquisition, :article_number nil, :inspector_priority :MEDIUM, :price_cents 0, :budget_period {:id 18999fec-1a5f-4b7f-a2e4-78b733c89f09, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:44:31.201146, :updated_at 2023-12-08T09:44:31.201146, :is_past false}, :article_name Mediocre Aluminum Shoes, :replacement true, :attachments :unqueried, :template nil, :state :NEW, :organization {:id 84d2ecaa-8fa2-414c-9e11-c6a21c210cdb, :name Baby, Toys & Computers, :parent_id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :shortname nil, :department {:id bbb4b4db-bcf6-4a71-9229-1aa218c4bca4, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :supplier_name nil, :order_status :NOT_PROCESSED, :requested_quantity 1, :general_ledger_account nil, :updated_at #inst "2023-12-08T08:44:31.233838000-00:00", :priority :NORMAL, :id #uuid "75ed4778-c966-4722-9c24-1e79a56ce427", :total_price_cents 0, :price_currency CHF, :procurement_account nil, :room {:id 7cc593b5-b6e0-450f-88db-3407e5a4f36c, :name conservatory, :general false, :building {:id 222fe58b-906a-4c31-8dec-c499dcc39400, :code nil, :name 3605 Nanci Heights}, :building_id 222fe58b-906a-4c31-8dec-c499dcc39400, :description nil}, :inspection_comment nil, :approved_quantity nil, :order_quantity nil, :cost_center nil, :user {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:44:31.611482+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:44:31.611482+01:00, :firstname Krysta, :zip nil, :id f6b7e682-851d-4543-ab7f-b9d8ec9acf07, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:44:31.211091+01:00, :admin_protected false}, :receiver nil, :internal_order_number nil, :created_at #inst "2023-12-08T08:44:31.233838000-00:00", :order_comment nil, :short_id Budget-Period-BP.001, :model nil})
2023-12-08T08:44:33.368Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => f6b7e682-851d-4543-ab7f-b9d8ec9acf07
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.369Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.369Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.369Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "18999fec-1a5f-4b7f-a2e4-78b733c89f09", :name Budget-Period-BP, :inspection_start_date #inst "2024-02-07T23:00:00.000000000-00:00", :end_date #inst "2024-03-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T08:44:31.201146000-00:00", :updated_at #inst "2023-12-08T08:44:31.201146000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-03-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2024-02-08]
>oo> start/end [:cast 2024-02-08 :date] [:cast 2024-03-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:33.371Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" 3d4e36c8-6747-41b1-98ba-6be8935bc765]
2023-12-08T08:44:33.372Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07" "3d4e36c8-6747-41b1-98ba-6be8935bc765"]
>o> viewer? {:result false}
2023-12-08T08:44:33.373Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - requester => true
2023-12-08T08:44:33.373Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - own-request => true
2023-12-08T08:44:33.373Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - past-phase => false
2023-12-08T08:44:33.373Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:80] - inspector => false
2023-12-08T08:44:33.373Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:81] - category-viewer => false
2023-12-08T08:44:33.373Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - admin => false
2023-12-08T08:44:33.373Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:79] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => false
2023-12-08T08:44:33.375Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:delete_request false])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44398 0x52d373bb leihs.core.locale$wrap$fn__44398@52d373bb]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value a9786580-ea6d-4780-bf3c-1c8527eaa2e0}, leihs-user-session {:value 41e0e14a-0cc9-4223-8f44-77250f937c47}}, :remote-addr 127.0.0.1, :start-time 157026697928750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=a9786580-ea6d-4780-bf3c-1c8527eaa2e0; leihs-user-session=41e0e14a-0cc9-4223-8f44-77250f937c47, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token a9786580-ea6d-4780-bf3c-1c8527eaa2e0, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2866ac80 0.0.0.0/0.0.0.0:3230<->null], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x321108bd HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x59a9daed leihs.procurement.graphql$handler@59a9daed], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:44:31.611482Z", :id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :user_session_id #uuid "c31746b1-d02c-46a1-b9bb-d70d68c082c5", :scope_system_admin_read false, :access-rights (), :user_id #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x225fb0ee HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x73775793 next.jdbc.result_set$as_unqualified_lower_maps@73775793]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.983Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.983Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.984Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.984Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.985Z NX-41294 DEBUG [leihs.procurement.permissions.user:32] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.985Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.985Z NX-41294 DEBUG [leihs.procurement.permissions.user:79] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
2023-12-08T08:44:33.986Z NX-41294 DEBUG [leihs.procurement.permissions.user:163] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "f6b7e682-851d-4543-ab7f-b9d8ec9acf07"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  a9786580-ea6d-4780-bf3c-1c8527eaa2e0

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-08T08:44:33.987Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
2023-12-08T08:44:33.997Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "18999fec-1a5f-4b7f-a2e4-78b733c89f09"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-08 00:00:00.0"] [:end_date "2024-03-08 00:00:00.0"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "293b0c43-ac4d-4c29-a446-ffced2ceb4a1"] [:name "Colombia"] [:categories [#ordered/map ([:id "3d4e36c8-6747-41b1-98ba-6be8935bc765"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "bbb4b4db-bcf6-4a71-9229-1aa218c4bca4"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "84d2ecaa-8fa2-414c-9e11-c6a21c210cdb"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
