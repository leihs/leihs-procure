# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-12-11T09:38:55.384Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-11T09:38:56.033Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-11T09:38:56.040Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x575120a "taoensso.timbre$default_output_fn@575120a"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x1284f7bd "taoensso.timbre.appenders.core$println_appender$fn__3459@1284f7bd"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-11T09:38:56.042Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-11T09:38:56.054Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 21843, :repl-port-file ".nrepl-port"}
2023-12-11T09:38:56.056Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  21843 localhost
2023-12-11T09:38:56.087Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-11T09:38:56.090Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 21843, :repl-port-file .nrepl-port}
2023-12-11T09:38:56.090Z NX-41294 INFO [leihs.core.shutdown:20] - PID 5607
2023-12-11T09:38:56.123Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-11T09:38:56.190Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-11T09:38:56.192Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-11T09:38:56.198Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-11T09:38:56.316Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@68a8008a
2023-12-11T09:38:56.322Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-11T09:38:56.322Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a "HikariDataSource (db-pool)"]}
2023-12-11T09:38:56.323Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-11T09:38:56.339Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-11T09:38:56.347Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@69836a84
2023-12-11T09:38:56.348Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-11T09:38:56.353Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d "next.jdbc.result_set$as_unqualified_lower_maps@10136e9d"]}}
2023-12-11T09:38:56.360Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x55d50ec3 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x228f1ba7 "java.util.concurrent.ThreadPoolExecutor@228f1ba7[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-11T09:38:56.372Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value a8666744-3bc7-42bc-ba0e-b81d8c71fbd1}}, :remote-addr 127.0.0.1, :start-time 1143805103916, :params {:return-to /procure/favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {:return-to /procure/favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=a8666744-3bc7-42bc-ba0e-b81d8c71fbd1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, accept image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x592d86de /127.0.0.1:3230<->/127.0.0.1:49934], :server-port 3230, :params-raw {:return-to /procure/favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure/favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54fbd40b compojure.core$routes$fn__27950@54fbd40b], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :apng, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-11T09:40:15.219Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-11T09:40:15.334Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\"><input name=\"return-to\" type=\"hidden\" value=\"/procure/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value a8666744-3bc7-42bc-ba0e-b81d8c71fbd1}}, :remote-addr 127.0.0.1, :start-time 1143961882416, :params {:return-to /procure/favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {:return-to /procure/favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=a8666744-3bc7-42bc-ba0e-b81d8c71fbd1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, accept image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x42edd3ac /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {:return-to /procure/favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure/favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54fbd40b compojure.core$routes$fn__27950@54fbd40b], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :apng, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-11T09:40:15.351Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-11T09:40:15.381Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\"><input name=\"return-to\" type=\"hidden\" value=\"/procure/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value a8666744-3bc7-42bc-ba0e-b81d8c71fbd1}}, :remote-addr 127.0.0.1, :start-time 1153381052875, :params {:return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {:return-to /procure}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=a8666744-3bc7-42bc-ba0e-b81d8c71fbd1, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68d4a544 /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {:return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54fbd40b compojure.core$routes$fn__27950@54fbd40b], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-11T09:40:24.783Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-11T09:40:24.796Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\"><input name=\"return-to\" type=\"hidden\" value=\"/procure\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value a8666744-3bc7-42bc-ba0e-b81d8c71fbd1}}, :remote-addr 127.0.0.1, :start-time 1153501168875, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=a8666744-3bc7-42bc-ba0e-b81d8c71fbd1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, accept image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x43287864 /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54fbd40b compojure.core$routes$fn__27950@54fbd40b], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :apng, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-11T09:40:24.885Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-11T09:40:24.894Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value a8666744-3bc7-42bc-ba0e-b81d8c71fbd1}}, :remote-addr 127.0.0.1, :start-time 1160887364041, :params {:user amelia@rosenbaum.name, :password password, :csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, :return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7815f800 HikariProxyConnection@2014705664 wrapping org.postgresql.jdbc.PgConnection@69836a84], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=a8666744-3bc7-42bc-ba0e-b81d8c71fbd1, content-length 115, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control max-age=0}, :async-channel #object[org.httpkit.server.AsyncChannel 0x632bbbb3 /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {:user amelia@rosenbaum.name, :password password, :csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, :return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7a28e146 HikariProxyConnection@2049499462 wrapping org.postgresql.jdbc.PgConnection@68a8008a], :level 1, :rollback #object[clojure.lang.Atom 0x3651349e {:status :ready, :val false}]}, :content-length 115, :form-params {:user amelia@rosenbaum.name, :password password, :csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, :return-to /procure}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user amelia@rosenbaum.name, :password password, :csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, :return-to /procure}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x2d85222f BytesInputStream[len=115]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x54fbd40b compojure.core$routes$fn__27950@54fbd40b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7a28e146 HikariProxyConnection@2049499462 wrapping org.postgresql.jdbc.PgConnection@68a8008a], :level 1, :rollback #object[clojure.lang.Atom 0x3651349e {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-11T09:40:32.308Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-11T09:40:32.496Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "ec09a61e-81a5-4995-98ae-f9159a1a35e8", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1161200940250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control max-age=0}, :async-channel #object[org.httpkit.server.AsyncChannel 0x21d62740 /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x755fb52c leihs.procurement.backend.html$not_found_handler@755fb52c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector true
>myprint>  viewer false
>myprint>  requester true
2023-12-11T09:40:32.591Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-11T09:40:32.595Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-11T09:40:32.597Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Mon, 11 Dec 2023 09:36:21 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x647cd09a "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1161400415791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x13275362 /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector true
>myprint>  viewer false
>myprint>  requester true
2023-12-11T09:40:32.797Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1161408150333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7cb235db /127.0.0.1:3230<->/127.0.0.1:49934], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x755fb52c leihs.procurement.backend.html$not_found_handler@755fb52c], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :apng, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector true
2023-12-11T09:40:32.800Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>myprint>  viewer false
>myprint>  requester true
2023-12-11T09:40:32.801Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>>>exec-query::variables {}
2023-12-11T09:40:32.803Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-11T09:40:32.804Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-11T09:40:32.805Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-11T09:40:32.807Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Mon, 11 Dec 2023 09:36:21 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x61dfcee4 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
2023-12-11T09:40:32.806Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "dc7e186c-6046-4dce-9a37-5d14ea14e0e1"}, "leihs-user-session" {:value "ec09a61e-81a5-4995-98ae-f9159a1a35e8"}}, :remote-addr "127.0.0.1", :start-time 1161400415791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d "next.jdbc.result_set$as_unqualified_lower_maps@10136e9d"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8", "content-length" "502", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure", "connection" "keep-alive", "x-csrf-token" "dc7e186c-6046-4dce-9a37-5d14ea14e0e1", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x13275362 "/127.0.0.1:3230<->/127.0.0.1:49936"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f "leihs.procurement.graphql$handler@1e10516f"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1161400415791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x13275362 /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-11T09:40:32.291787Z","id":"33019487-6bff-402c-8c03-3bf6cbc28a70","user_session_id":"52ab0127-d271-40fb-9aa6-e6327a59b362","scope_system_admin_read":false,"access-rights":[],"user_id":"33019487-6bff-402c-8c03-3bf6cbc28a70","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"ec09a61e-81a5-4995-98ae-f9159a1a35e8"}},"remote-addr":"127.0.0.1","start-time":1161400415791,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8","content-length":"502","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure","connection":"keep-alive","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"33019487-6bff-402c-8c03-3bf6cbc28a70","firstname":"Dawna","lastname":"Kemmer","login":null,"email":"amelia@rosenbaum.name"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 33019487-6bff-402c-8c03-3bf6cbc28a70] [:firstname Dawna] [:lastname Kemmer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id 282c1f70-201c-489e-88a3-39b0c3f059a0] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-11T09:40:32.903Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"33019487-6bff-402c-8c03-3bf6cbc28a70\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "33019487-6bff-402c-8c03-3bf6cbc28a70"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "282c1f70-201c-489e-88a3-39b0c3f059a0"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-11T09:40:32.904Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"33019487-6bff-402c-8c03-3bf6cbc28a70\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "33019487-6bff-402c-8c03-3bf6cbc28a70"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "282c1f70-201c-489e-88a3-39b0c3f059a0"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity >>> authenticate::skip= nil  handler-key= {:graphql
>>> authenticate::authenticated-entity:email  amelia@rosenbaum.name, :contracts_count {0:email,  :lastnameamelia@rosenbaum.name , Kemmer:contracts_count,  :org_id 0nil, , :lastname:scope_read  Kemmer, :org_idtrue , nil:is_admin,  :scope_readfalse , true:authentication-method,  :is_admin:session , false:login,  :authentication-methodnil , :session:scope_system_admin_write,  :loginfalse , nil:scope_write,  :scope_system_admin_writetrue , false:firstname,  :scope_writeDawna , true, :scope_admin_write:firstname  falseDawna, , :user_session_created_at:scope_admin_write  false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z"#time/instant "2023-12-11T09:40:32.291787Z", , :id:id  #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70"#uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", , :user_session_id:user_session_id  #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362":scope_system_admin_read,  :scope_system_admin_read falsefalse, , :access-rights:access-rights  (()), , :user_id:user_id  #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70"#uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", , :is_system_admin:is_system_admin  falsefalse, , :external_sign_out_url :external_sign_out_urlnil , nil:language_locale,  :language_localenil , nil, :inventory_pool_roles_count:inventory_pool_roles_count  00, , :scope_admin_read:scope_admin_read  falsefalse}}


>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 
>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, 0x43092b6d :remote-addr leihs.core.locale$wrap$fn__44419@43092b6d127.0.0.1], 
:start-time 1161549687791, 
>> authorize::request >:params  {}, :settings {{:email_sending_enabled:authenticated-entity  false, :sessions_max_lifetime_secs {432000:email,  :smtp_default_from_addressamelia@rosenbaum.name , your.lending.desk@example.com:contracts_count,  :public_image_caching_enabled 0true, , :lastname:sessions_force_secure  Kemmerfalse, , :org_id:deliver_received_order_notifications  nilfalse, , :scope_read:external_base_url  truenil, , :is_admin:sessions_force_uniqueness  falsefalse, , :authentication-method:email_signature  :sessionCheers,, }:login,  :tx-nextnil , :scope_system_admin_write #falsenext.jdbc.default_options.DefaultOptions, :scope_write true, :firstname {Dawna, :scope_admin_write false, :user_session_created_at :connectable #object[com.zaxxer.hikari.HikariDataSource #time/instant "2023-12-11T09:40:32.291787Z", :id 0x4f9cc839 HikariDataSource (HikariPool-1)], #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70":options,  :user_session_id {#uuid "52ab0127-d271-40fb-9aa6-e6327a59b362":builder-fn,  :scope_system_admin_read false#object[, next.jdbc.result_set$as_unqualified_lower_maps:access-rights  0x10136e9d (next.jdbc.result_set$as_unqualified_lower_maps@10136e9d)], }:user_id} , #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70":query-params-raw,  :is_system_admin false, {:external_sign_out_url} , nil, :route-params:language_locale  nilnil, , :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x37784a22 /127.0.0.1:3230<->/127.0.0.1:49956], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 502, :form-params :inventory_pool_roles_count{}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding  utf8, 0:uri,  :scope_admin_read/procure/graphql , false:server-name} , localhost, :cookies :handler-key :graphql, :query-string nil, :body{ leihs-anti-csrf-token {{:operationName:value  medc7e186c-6046-4dce-9a37-5d14ea14e0e1, }:variables,  leihs-user-session {}, {:query :value query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, }:graphql-schema,  :remote-addr 127.0.0.1, :start-time #CompiledSchema<>, 1161549250000, :handler:params  {}#object[, leihs.procurement.graphql$handler:settings  {0x1e10516f :email_sending_enabledleihs.procurement.graphql$handler@1e10516f ]false, , :multipart-params:sessions_max_lifetime_secs  432000, :smtp_default_from_address your.lending.desk@example.com{, }:public_image_caching_enabled,  :schemetrue , :http, :sessions_force_secure:request-method  false, :post, :deliver_received_order_notifications :acceptfalse , :external_base_url {nil, :mime:sessions_force_uniqueness  :jsonfalse, , :charset:email_signature  nilCheers,, }:encoding,  :tx-nextnil , #:languagenext.jdbc.default_options.DefaultOptions nil}{}

>> authorize::handler-key >> :graphql
:connectable>myprint>   authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #object[#uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", com.zaxxer.hikari.HikariDataSource:user_session_id  #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id 0x4f9cc839 #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_adminHikariDataSource (HikariPool-1) ]false, , :external_sign_out_url nil:options,  :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false{}
:builder-fn>myprint>   txn #object[next.jdbc.result_set$as_unqualified_lower_maps{ :datasource #object[com.zaxxer.hikari.HikariDataSource 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, 0xc249f8a :query-params-rawHikariDataSource (db-pool) ]}
{}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1bc21ce1 /127.0.0.1:3230<->/127.0.0.1:49934], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector true
>myprint>  admin false
>myprint>  viewer false
>myprint>  inspector true
>myprint>  requester true
2023-12-11T09:40:32.945Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>myprint>  viewer false
>myprint>  requester true
2023-12-11T09:40:32.948Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1161549161583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 4137, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1d9297bb /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 4137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :categories [], :priority [NORMAL HIGH], :budgetPeriods [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
2023-12-11T09:40:32.950Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-11T09:40:32.952Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>myprint>  inspector true

>>>exec-query::variables {}
>myprint>  viewer false
2023-12-11T09:40:32.954Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-11T09:40:32.955Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}

>>>exec-query::variables {}
2023-12-11T09:40:32.955Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "dc7e186c-6046-4dce-9a37-5d14ea14e0e1"}, "leihs-user-session" {:value "ec09a61e-81a5-4995-98ae-f9159a1a35e8"}}, :remote-addr "127.0.0.1", :start-time 1161549687791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d "next.jdbc.result_set$as_unqualified_lower_maps@10136e9d"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8", "content-length" "502", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "dc7e186c-6046-4dce-9a37-5d14ea14e0e1", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x37784a22 "/127.0.0.1:3230<->/127.0.0.1:49956"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f "leihs.procurement.graphql$handler@1e10516f"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-12-11T09:40:32.955Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}

2023-12-11T09:40:32.955Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-11T09:40:32.955Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "dc7e186c-6046-4dce-9a37-5d14ea14e0e1"}, "leihs-user-session" {:value "ec09a61e-81a5-4995-98ae-f9159a1a35e8"}}, :remote-addr "127.0.0.1", :start-time 1161549250000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d "next.jdbc.result_set$as_unqualified_lower_maps@10136e9d"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8", "content-length" "534", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "dc7e186c-6046-4dce-9a37-5d14ea14e0e1", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1bc21ce1 "/127.0.0.1:3230<->/127.0.0.1:49934"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a "HikariDataSource (db-pool)"]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestFilters", :variables {}, :query "query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f "leihs.procurement.graphql$handler@1e10516f"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>myprint>  requester true
2023-12-11T09:40:32.956Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-11T09:40:32.959Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :categories [], :priority [NORMAL HIGH], :budgetPeriods [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4]}
2023-12-11T09:40:32.978Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-11T09:40:32.979Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["9465c0d7-fda6-4a28-8482-f19047127964" "ade586cb-80d8-4c93-9a34-042eaa426bd5" "32d74dbf-9308-42fc-b66b-9889c2af2c73" "6fa6a22f-c444-4083-af19-7bb720d050ae"], :categories [], :priority ["NORMAL" "HIGH"], :budgetPeriods ["aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e" "186cccc7-7b33-489f-b76e-4e7c97db22e4"]}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1161549687791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x37784a22 /127.0.0.1:3230<->/127.0.0.1:49956], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-11T09:40:32.979Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "dc7e186c-6046-4dce-9a37-5d14ea14e0e1"}, "leihs-user-session" {:value "ec09a61e-81a5-4995-98ae-f9159a1a35e8"}}, :remote-addr "127.0.0.1", :start-time 1161549161583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d "next.jdbc.result_set$as_unqualified_lower_maps@10136e9d"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8", "content-length" "4137", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "dc7e186c-6046-4dce-9a37-5d14ea14e0e1", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1d9297bb "/127.0.0.1:3230<->/127.0.0.1:49936"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a "HikariDataSource (db-pool)"]}, :content-length 4137, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["9465c0d7-fda6-4a28-8482-f19047127964" "ade586cb-80d8-4c93-9a34-042eaa426bd5" "32d74dbf-9308-42fc-b66b-9889c2af2c73" "6fa6a22f-c444-4083-af19-7bb720d050ae"], :categories [], :priority ["NORMAL" "HIGH"], :budgetPeriods ["aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e" "186cccc7-7b33-489f-b76e-4e7c97db22e4"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f "leihs.procurement.graphql$handler@1e10516f"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-11T09:40:32.291787Z","id":"33019487-6bff-402c-8c03-3bf6cbc28a70","user_session_id":"52ab0127-d271-40fb-9aa6-e6327a59b362","scope_system_admin_read":false,"access-rights":[],"user_id":"33019487-6bff-402c-8c03-3bf6cbc28a70","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"ec09a61e-81a5-4995-98ae-f9159a1a35e8"}},"remote-addr":"127.0.0.1","start-time":1161549687791,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8","content-length":"502","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"33019487-6bff-402c-8c03-3bf6cbc28a70","firstname":"Dawna","lastname":"Kemmer","login":null,"email":"amelia@rosenbaum.name"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 33019487-6bff-402c-8c03-3bf6cbc28a70] [:firstname Dawna] [:lastname Kemmer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id 282c1f70-201c-489e-88a3-39b0c3f059a0] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-11T09:40:32.980Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"33019487-6bff-402c-8c03-3bf6cbc28a70\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "33019487-6bff-402c-8c03-3bf6cbc28a70"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "282c1f70-201c-489e-88a3-39b0c3f059a0"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-11T09:40:32.980Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"33019487-6bff-402c-8c03-3bf6cbc28a70\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "33019487-6bff-402c-8c03-3bf6cbc28a70"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "282c1f70-201c-489e-88a3-39b0c3f059a0"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4], :category_id []}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>debug 2
>debug 3
2023-12-11T09:40:32.995Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format main-categories-base-query) => ["SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC"]
>>ToCheck mainCats ({:id #uuid "a40bf28f-6eea-46b5-8a2d-63cb1afb5035", :name Geisha})
>debug 4
>debug 5 {:id #uuid "a40bf28f-6eea-46b5-8a2d-63cb1afb5035", :name Geisha}
>debug 5a id #uuid "a40bf28f-6eea-46b5-8a2d-63cb1afb5035"
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?, ?)) ORDER BY end_date DESC aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4]
2023-12-11T09:40:33.008Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql/format (image/image-query-for-main-category (:id mc))) => ["SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?" #uuid "a40bf28f-6eea-46b5-8a2d-63cb1afb5035"]
>>ToCheck dashboard:::procurement_budget_periods.id ()
>>resultA1-2 ()
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4], :category_id []} nil
>debug 5b nil
2023-12-11T09:40:33.012Z NX-41294 DEBUG [leihs.procurement.resources.categories:?] - (sql/format (sql/merge-where categories-base-query [:= :procurement_categories.main_category_id main-cat-id])) => ["SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC" #uuid "a40bf28f-6eea-46b5-8a2d-63cb1afb5035"]
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-11T09:40:33.015Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-11T09:40:33.016Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-11T09:40:33.017Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-11T09:40:33.017Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-11T09:40:33.018Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1161549250000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1bc21ce1 /127.0.0.1:3230<->/127.0.0.1:49934], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-11T09:40:32.291787Z","id":"33019487-6bff-402c-8c03-3bf6cbc28a70","user_session_id":"52ab0127-d271-40fb-9aa6-e6327a59b362","scope_system_admin_read":false,"access-rights":[],"user_id":"33019487-6bff-402c-8c03-3bf6cbc28a70","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"ec09a61e-81a5-4995-98ae-f9159a1a35e8"}},"remote-addr":"127.0.0.1","start-time":1161549250000,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8","content-length":"534","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":534,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestFilters","variables":{},"query":"query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id ebc0f610-ac1f-40cb-bc7a-f7eb9cf73ad3] [:name BP-in-inspection-phase] [:inspection_start_date 2023-12-09T23:00:00Z] [:end_date 2024-01-10T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id a40bf28f-6eea-46b5-8a2d-63cb1afb5035] [:name Geisha] [:categories [#ordered/map ([:id 282c1f70-201c-489e-88a3-39b0c3f059a0] [:name Ennarea] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id 549c5a79-74f9-4e6f-8f34-29c7269c28cf] [:name Books & Baby] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 5e4c5b1e-2c4e-43ba-aad2-5d10e856ae65] [:name Sports, Electronics & Health] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id c9fe18fe-94c4-4ae0-a78b-c66334d2a98e] [:name Garden, Industrial & Clothing] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 63b0355e-1deb-45af-9fec-de6eac5da9a5] [:name Movies] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id b3d43d27-5592-489c-b51c-fbf31becdc3f] [:name Health, Grocery & Beauty] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 08a3e1f6-09fd-4646-9ba9-f90bb7571661] [:name Kids, Electronics & Music] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id c042c5c8-b98c-444d-8914-a517241e2333] [:name Jewelry] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id cd9484a8-22b8-46a7-a330-eaa03766c293] [:name Music & Automotive] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 79e0d424-38a5-4c02-87e1-e819360d16cc] [:name Outdoors & Home] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 6d367b7a-233f-4317-a9b5-64a35109be6c] [:name Electronics & Home] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 29cb5361-738e-449c-b3f3-9b825bab299a] [:name Tools, Baby & Kids] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 13a7000d-7301-444c-8c68-04f0c2799784] [:name Grocery, Electronics & Industrial] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-11T09:40:33.055Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "ebc0f610-ac1f-40cb-bc7a-f7eb9cf73ad3"] [:name "BP-in-inspection-phase"] [:inspection_start_date "2023-12-09T23:00:00Z"] [:end_date "2024-01-10T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "a40bf28f-6eea-46b5-8a2d-63cb1afb5035"] [:name "Geisha"] [:categories [#ordered/map ([:id "282c1f70-201c-489e-88a3-39b0c3f059a0"] [:name "Ennarea"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "549c5a79-74f9-4e6f-8f34-29c7269c28cf"] [:name "Books & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "5e4c5b1e-2c4e-43ba-aad2-5d10e856ae65"] [:name "Sports, Electronics & Health"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "c9fe18fe-94c4-4ae0-a78b-c66334d2a98e"] [:name "Garden, Industrial & Clothing"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "63b0355e-1deb-45af-9fec-de6eac5da9a5"] [:name "Movies"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "b3d43d27-5592-489c-b51c-fbf31becdc3f"] [:name "Health, Grocery & Beauty"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "08a3e1f6-09fd-4646-9ba9-f90bb7571661"] [:name "Kids, Electronics & Music"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "c042c5c8-b98c-444d-8914-a517241e2333"] [:name "Jewelry"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "cd9484a8-22b8-46a7-a330-eaa03766c293"] [:name "Music & Automotive"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "79e0d424-38a5-4c02-87e1-e819360d16cc"] [:name "Outdoors & Home"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "6d367b7a-233f-4317-a9b5-64a35109be6c"] [:name "Electronics & Home"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "29cb5361-738e-449c-b3f3-9b825bab299a"] [:name "Tools, Baby & Kids"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "13a7000d-7301-444c-8c68-04f0c2799784"] [:name "Grocery, Electronics & Industrial"] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-11T09:40:33.055Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "ebc0f610-ac1f-40cb-bc7a-f7eb9cf73ad3"] [:name "BP-in-inspection-phase"] [:inspection_start_date "2023-12-09T23:00:00Z"] [:end_date "2024-01-10T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "a40bf28f-6eea-46b5-8a2d-63cb1afb5035"] [:name "Geisha"] [:categories [#ordered/map ([:id "282c1f70-201c-489e-88a3-39b0c3f059a0"] [:name "Ennarea"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "549c5a79-74f9-4e6f-8f34-29c7269c28cf"] [:name "Books & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "5e4c5b1e-2c4e-43ba-aad2-5d10e856ae65"] [:name "Sports, Electronics & Health"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "c9fe18fe-94c4-4ae0-a78b-c66334d2a98e"] [:name "Garden, Industrial & Clothing"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "63b0355e-1deb-45af-9fec-de6eac5da9a5"] [:name "Movies"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "b3d43d27-5592-489c-b51c-fbf31becdc3f"] [:name "Health, Grocery & Beauty"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "08a3e1f6-09fd-4646-9ba9-f90bb7571661"] [:name "Kids, Electronics & Music"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "c042c5c8-b98c-444d-8914-a517241e2333"] [:name "Jewelry"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "cd9484a8-22b8-46a7-a330-eaa03766c293"] [:name "Music & Automotive"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "79e0d424-38a5-4c02-87e1-e819360d16cc"] [:name "Outdoors & Home"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "6d367b7a-233f-4317-a9b5-64a35109be6c"] [:name "Electronics & Home"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "29cb5361-738e-449c-b3f3-9b825bab299a"] [:name "Tools, Baby & Kids"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "13a7000d-7301-444c-8c68-04f0c2799784"] [:name "Grocery, Electronics & Industrial"] [:shortname nil] [:__typename :Organization])]])]])}}
>>requestsB2 ()
>>dashboard-cache-keyB2 {:id 1022635603}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1161549161583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 4137, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1d9297bb /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 4137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :categories [], :priority [NORMAL HIGH], :budgetPeriods [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-11T09:40:32.291787Z","id":"33019487-6bff-402c-8c03-3bf6cbc28a70","user_session_id":"52ab0127-d271-40fb-9aa6-e6327a59b362","scope_system_admin_read":false,"access-rights":[],"user_id":"33019487-6bff-402c-8c03-3bf6cbc28a70","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"ec09a61e-81a5-4995-98ae-f9159a1a35e8"}},"remote-addr":"127.0.0.1","start-time":1161549161583,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8","content-length":"4137","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":4137,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"inspector_priority":["LOW","MEDIUM","HIGH","MANDATORY"],"onlyOwnRequests":false,"state":["NEW","APPROVED","PARTIALLY_APPROVED","DENIED"],"order_status":["NOT_PROCESSED","IN_PROGRESS","PROCURED","ALTERNATIVE_PROCURED","NOT_PROCURED"],"search":null,"organizations":["9465c0d7-fda6-4a28-8482-f19047127964","ade586cb-80d8-4c93-9a34-042eaa426bd5","32d74dbf-9308-42fc-b66b-9889c2af2c73","6fa6a22f-c444-4083-af19-7bb720d050ae"],"categories":[],"priority":["NORMAL","HIGH"],"budgetPeriods":["aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e","186cccc7-7b33-489f-b76e-4e7c97db22e4"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey 1022635603] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}
2023-12-11T09:40:33.185Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1022635603"] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}
2023-12-11T09:40:33.185Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1022635603"] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1188029503083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 4136, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2b06a9db /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 4136, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search a, :organizations [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :categories [], :priority [NORMAL HIGH], :budgetPeriods [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector true
>myprint>  viewer false
>myprint>  requester true
2023-12-11T09:40:59.447Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-11T09:40:59.450Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search a, :organizations [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :categories [], :priority [NORMAL HIGH], :budgetPeriods [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4]}
2023-12-11T09:40:59.466Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-11T09:40:59.466Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search "a", :organizations ["9465c0d7-fda6-4a28-8482-f19047127964" "ade586cb-80d8-4c93-9a34-042eaa426bd5" "32d74dbf-9308-42fc-b66b-9889c2af2c73" "6fa6a22f-c444-4083-af19-7bb720d050ae"], :categories [], :priority ["NORMAL" "HIGH"], :budgetPeriods ["aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e" "186cccc7-7b33-489f-b76e-4e7c97db22e4"]}
2023-12-11T09:40:59.466Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "dc7e186c-6046-4dce-9a37-5d14ea14e0e1"}, "leihs-user-session" {:value "ec09a61e-81a5-4995-98ae-f9159a1a35e8"}}, :remote-addr "127.0.0.1", :start-time 1188029503083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d "next.jdbc.result_set$as_unqualified_lower_maps@10136e9d"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8", "content-length" "4136", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "pragma" "no-cache", "x-csrf-token" "dc7e186c-6046-4dce-9a37-5d14ea14e0e1", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors", "cache-control" "no-cache"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2b06a9db "/127.0.0.1:3230<->/127.0.0.1:49936"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a "HikariDataSource (db-pool)"]}, :content-length 4136, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search "a", :organizations ["9465c0d7-fda6-4a28-8482-f19047127964" "ade586cb-80d8-4c93-9a34-042eaa426bd5" "32d74dbf-9308-42fc-b66b-9889c2af2c73" "6fa6a22f-c444-4083-af19-7bb720d050ae"], :categories [], :priority ["NORMAL" "HIGH"], :budgetPeriods ["aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e" "186cccc7-7b33-489f-b76e-4e7c97db22e4"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f "leihs.procurement.graphql$handler@1e10516f"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search a, :priority [:NORMAL :HIGH], :budget_period_id [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4], :category_id []}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats ({:id #uuid "a40bf28f-6eea-46b5-8a2d-63cb1afb5035", :name Geisha})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?, ?)) ORDER BY end_date DESC aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4]
>>ToCheck dashboard:::procurement_budget_periods.id ()
>>resultA1-2 ()
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search a, :priority [:NORMAL :HIGH], :budget_period_id [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4], :category_id []} nil
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-11T09:40:59.481Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-11T09:40:59.481Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-11T09:40:59.482Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-11T09:40:59.482Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-11T09:40:59.482Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>>requestsB2 ()
>>dashboard-cache-keyB2 {:id -1220371560}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1188029503083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 4136, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2b06a9db /127.0.0.1:3230<->/127.0.0.1:49936], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 4136, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search a, :organizations [9465c0d7-fda6-4a28-8482-f19047127964 ade586cb-80d8-4c93-9a34-042eaa426bd5 32d74dbf-9308-42fc-b66b-9889c2af2c73 6fa6a22f-c444-4083-af19-7bb720d050ae], :categories [], :priority [NORMAL HIGH], :budgetPeriods [aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e 186cccc7-7b33-489f-b76e-4e7c97db22e4]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-11T09:40:32.291787Z","id":"33019487-6bff-402c-8c03-3bf6cbc28a70","user_session_id":"52ab0127-d271-40fb-9aa6-e6327a59b362","scope_system_admin_read":false,"access-rights":[],"user_id":"33019487-6bff-402c-8c03-3bf6cbc28a70","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"ec09a61e-81a5-4995-98ae-f9159a1a35e8"}},"remote-addr":"127.0.0.1","start-time":1188029503083,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8","content-length":"4136","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":4136,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"inspector_priority":["LOW","MEDIUM","HIGH","MANDATORY"],"onlyOwnRequests":false,"state":["NEW","APPROVED","PARTIALLY_APPROVED","DENIED"],"order_status":["NOT_PROCESSED","IN_PROGRESS","PROCURED","ALTERNATIVE_PROCURED","NOT_PROCURED"],"search":"a","organizations":["9465c0d7-fda6-4a28-8482-f19047127964","ade586cb-80d8-4c93-9a34-042eaa426bd5","32d74dbf-9308-42fc-b66b-9889c2af2c73","6fa6a22f-c444-4083-af19-7bb720d050ae"],"categories":[],"priority":["NORMAL","HIGH"],"budgetPeriods":["aaff8b99-a0c0-4e41-88f4-75ed40f9bd3e","186cccc7-7b33-489f-b76e-4e7c97db22e4"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -1220371560] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}
2023-12-11T09:40:59.531Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-1220371560"] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}
2023-12-11T09:40:59.531Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-1220371560"] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1221157628791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 382, referer http://localhost:3230/procure/requests/new?budgetPeriod=09a055f1-fd42-4c77-8dea-eb983bdbcd45&category=aecb8b1b-4710-4f17-a6d1-85971675c19d, connection keep-alive, x-csrf-token b9c2f36b-1e6d-4922-bea6-cdc764b1f653, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, postman-token 313320dd-7dfa-4d06-9de2-3cb6a885cead}, :async-channel #object[org.httpkit.server.AsyncChannel 0x340ea3c4 /127.0.0.1:3230<->/127.0.0.1:49874], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 382, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:query query searchUsers($searchTerm: String! = "", $excludeIds: [ID], $isRequester: Boolean) {
  users(search_term: $searchTerm, limit: 25, offset: 0, exclude_ids: $excludeIds, isRequester: $isRequester) {
    id
    firstname
    lastname
    __typename
  }
}
, :operationName searchUsers, :variables {:searchTerm Procurement Admin, :isRequester true}}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector true
>myprint>  viewer false
>myprint>  requester true
2023-12-11T09:41:32.564Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-11T09:41:32.574Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-11T09:41:32.600Z NX-41294 WARN [leihs.procurement.utils.ring-exception:326] -   THROWABLE: clojure.lang.ExceptionInfo: The x-csrf-token is not equal to the anti-csrf cookie value.
{:status 403} {:status 403}
2023-12-11T09:41:32.602Z NX-41294 DEBUG [leihs.procurement.utils.ring-exception:326] - #error {
 :cause The x-csrf-token is not equal to the anti-csrf cookie value.
 :data {:status 403}
 :via
 [{:type clojure.lang.ExceptionInfo
   :message The x-csrf-token is not equal to the anti-csrf cookie value.
   :data {:status 403}
   :at [leihs.core.anti_csrf.back$wrap$fn__44381 invoke back.clj 58]}]
 :trace
 [[leihs.core.anti_csrf.back$wrap$fn__44381 invoke back.clj 58]
  [leihs.core.locale$wrap$fn__44419 invoke locale.clj 99]
  [leihs.procurement.authorization$authorize invokeStatic authorization.clj 141]
  [leihs.procurement.authorization$authorize invoke authorization.clj 115]
  [leihs.procurement.authorization$wrap_authorize$fn__39346 invoke authorization.clj 150]
  [leihs.procurement.authorization$authenticate invokeStatic authorization.clj 92]
  [leihs.procurement.authorization$authenticate invoke authorization.clj 85]
  [leihs.procurement.authorization$wrap_authenticate$fn__39324 invoke authorization.clj 111]
  [leihs.core.auth.session$wrap_authenticate$fn__38126 invoke session.clj 93]
  [ring.middleware.cookies$wrap_cookies$fn__47686 invoke cookies.clj 214]
  [leihs.core.settings$wrap invokeStatic settings.clj 47]
  [leihs.core.settings$wrap invoke settings.clj 42]
  [leihs.core.settings$wrap$fn__45475 invoke settings.clj 45]
  [leihs.core.status$wrap$fn__28078 invoke status.clj 78]
  [leihs.core.db$wrap_tx$fn__25321 invoke db.clj 208]
  [ring.middleware.json$wrap_json_response$fn__47852 invoke json.clj 143]
  [ring.middleware.json$wrap_json_body$fn__47801 invoke json.clj 60]
  [leihs.procurement.routes$wrap_empty$fn__48597 invoke routes.clj 97]
  [leihs.core.graphql$wrap_with_schema$fn__17899 invoke graphql.clj 80]
  [leihs.core.routing.back$wrap_canonicalize_params_maps$fn__47051 invoke back.clj 74]
  [ring.middleware.params$wrap_params$fn__48017 invoke params.clj 75]
  [ring.middleware.multipart_params$handle_request_and_errors$fn__47974$fn__47975 invoke multipart_params.clj 135]
  [ring.middleware.multipart_params$handle_request_and_errors invokeStatic multipart_params.clj 133]
  [ring.middleware.multipart_params$handle_request_and_errors invoke multipart_params.clj 132]
  [ring.middleware.multipart_params$wrap_multipart_params$fn__47980 invoke multipart_params.clj 187]
  [leihs.core.http_cache_buster2$wrap_resource$fn__44773 invoke http_cache_buster2.clj 117]
  [leihs.procurement.routes$wrap_rewrite_uri_for_static_paths$fn__48604 invoke routes.clj 116]
  [leihs.procurement.routes$wrap_resolve_handler invokeStatic routes.clj 90]
  [leihs.procurement.routes$wrap_resolve_handler invoke routes.clj 82]
  [leihs.procurement.routes$wrap_resolve_handler$fn__48592 invoke routes.clj 83]
  [ring.middleware.accept$wrap_accept$fn__47487 invoke accept.clj 125]
  [ring.middleware.content_type$wrap_content_type$fn__46741 invoke content_type.clj 34]
  [leihs.procurement.utils.ring_exception$wrap$fn__44562 invoke ring_exception.clj 22]
  [org.httpkit.server.HttpHandler run RingHandler.java 123]
  [java.util.concurrent.Executors$RunnableAdapter call Executors.java 515]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44419 0x43092b6d leihs.core.locale$wrap$fn__44419@43092b6d]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1242538071750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 382, referer http://localhost:3230/procure/requests/new?budgetPeriod=09a055f1-fd42-4c77-8dea-eb983bdbcd45&category=aecb8b1b-4710-4f17-a6d1-85971675c19d, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, postman-token a5416804-bf12-4d83-a968-b14a0a07872c}, :async-channel #object[org.httpkit.server.AsyncChannel 0x11ebaee5 /127.0.0.1:3230<->/127.0.0.1:49874], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 382, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:query query searchUsers($searchTerm: String! = "", $excludeIds: [ID], $isRequester: Boolean) {
  users(search_term: $searchTerm, limit: 25, offset: 0, exclude_ids: $excludeIds, isRequester: $isRequester) {
    id
    firstname
    lastname
    __typename
  }
}
, :operationName searchUsers, :variables {:searchTerm Procurement Admin, :isRequester true}}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector true
>myprint>  viewer false
>myprint>  requester true
2023-12-11T09:41:53.937Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-11T09:41:53.939Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:searchTerm Procurement Admin, :isRequester true}
2023-12-11T09:41:53.942Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query searchUsers($searchTerm: String! = "", $excludeIds: [ID], $isRequester: Boolean) {
  users(search_term: $searchTerm, limit: 25, offset: 0, exclude_ids: $excludeIds, isRequester: $isRequester) {
    id
    firstname
    lastname
    __typename
  }
}

2023-12-11T09:41:53.942Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:searchTerm "Procurement Admin", :isRequester true}
2023-12-11T09:41:53.942Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "amelia@rosenbaum.name", :contracts_count 0, :lastname "Kemmer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Dawna", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "dc7e186c-6046-4dce-9a37-5d14ea14e0e1"}, "leihs-user-session" {:value "ec09a61e-81a5-4995-98ae-f9159a1a35e8"}}, :remote-addr "127.0.0.1", :start-time 1242538071750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d "next.jdbc.result_set$as_unqualified_lower_maps@10136e9d"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8", "content-length" "382", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=09a055f1-fd42-4c77-8dea-eb983bdbcd45&category=aecb8b1b-4710-4f17-a6d1-85971675c19d", "connection" "keep-alive", "x-csrf-token" "dc7e186c-6046-4dce-9a37-5d14ea14e0e1", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors", "postman-token" "a5416804-bf12-4d83-a968-b14a0a07872c"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x11ebaee5 "/127.0.0.1:3230<->/127.0.0.1:49874"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a "HikariDataSource (db-pool)"]}, :content-length 382, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:query "query searchUsers($searchTerm: String! = \"\", $excludeIds: [ID], $isRequester: Boolean) {\n  users(search_term: $searchTerm, limit: 25, offset: 0, exclude_ids: $excludeIds, isRequester: $isRequester) {\n    id\n    firstname\n    lastname\n    __typename\n  }\n}\n", :operationName "searchUsers", :variables {:searchTerm "Procurement Admin", :isRequester true}}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f "leihs.procurement.graphql$handler@1e10516f"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>1x {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}
>>2x {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> users::get-users #object[leihs.procurement.resources.users$get_users 0x7518df3d leihs.procurement.resources.users$get_users@7518df3d]
>o> >tocheck> search-term= Procurement Admin
>o> >tocheck> term-parts= (%Procurement% %Admin%)
>o> >tocheck> is-requester= true
>o> >tocheck> exclude-ids= nil
>o> >tocheck> offset= 0
>o> >tocheck> limit= 25
>o> >tocheck> merge-where1= nil 0
>o> >tocheck> merge-where2= (%Procurement% %Admin%)
2023-12-11T09:41:53.947Z NX-41294 DEBUG [leihs.procurement.resources.users:62] - (fn [term-percent] ["~~*" (->> (sql/call :concat :users.firstname (sql/call :cast " " :varchar) :users.lastname) (sql/call :unaccent)) (sql/call :unaccent term-percent)]) => #object[leihs.procurement.resources.users$get_users$fn__39386$fn__39388$result__4237__auto____39389 0x15d809c9 "leihs.procurement.resources.users$get_users$fn__39386$fn__39388$result__4237__auto____39389@15d809c9"]
2023-12-11T09:41:53.950Z NX-41294 DEBUG [leihs.procurement.resources.users:?] - (sql/format (cond-> users-base-query is-requester (sql/merge-join :procurement_requesters_organizations [:= :procurement_requesters_organizations.user_id :users.id]) term-parts (sql/merge-where (into [:and] (map (spy (fn [term-percent] ["~~*" (->> (sql/call :concat :users.firstname (sql/call :cast " " :varchar) :users.lastname) (sql/call :unaccent)) (sql/call :unaccent term-percent)])) term-parts))) exclude-ids (sql/merge-where [:not-in :users.id exclude-ids]) offset (sql/offset offset) limit (sql/limit limit))) => ["SELECT users.id, users.firstname, users.lastname FROM users INNER JOIN procurement_requesters_organizations ON procurement_requesters_organizations.user_id = users.id WHERE (unaccent(concat(users.firstname, CAST(? AS varchar), users.lastname)) ~~* unaccent(?) AND unaccent(concat(users.firstname, CAST(? AS varchar), users.lastname)) ~~* unaccent(?)) ORDER BY concat(users.firstname, users.lastname, users.login, users.id) LIMIT ? OFFSET ?" " " "%Procurement%" " " "%Admin%" 25 0]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-11T09:40:32.291787Z", :id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :user_session_id #uuid "52ab0127-d271-40fb-9aa6-e6327a59b362", :scope_system_admin_read false, :access-rights (), :user_id #uuid "33019487-6bff-402c-8c03-3bf6cbc28a70", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value ec09a61e-81a5-4995-98ae-f9159a1a35e8}}, :remote-addr 127.0.0.1, :start-time 1242538071750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x4f9cc839 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x10136e9d next.jdbc.result_set$as_unqualified_lower_maps@10136e9d]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8, content-length 382, referer http://localhost:3230/procure/requests/new?budgetPeriod=09a055f1-fd42-4c77-8dea-eb983bdbcd45&category=aecb8b1b-4710-4f17-a6d1-85971675c19d, connection keep-alive, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, postman-token a5416804-bf12-4d83-a968-b14a0a07872c}, :async-channel #object[org.httpkit.server.AsyncChannel 0x11ebaee5 /127.0.0.1:3230<->/127.0.0.1:49874], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xc249f8a HikariDataSource (db-pool)]}, :content-length 382, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:query query searchUsers($searchTerm: String! = "", $excludeIds: [ID], $isRequester: Boolean) {
  users(search_term: $searchTerm, limit: 25, offset: 0, exclude_ids: $excludeIds, isRequester: $isRequester) {
    id
    firstname
    lastname
    __typename
  }
}
, :operationName searchUsers, :variables {:searchTerm Procurement Admin, :isRequester true}}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1e10516f leihs.procurement.graphql$handler@1e10516f], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-11T09:40:32.291787Z","id":"33019487-6bff-402c-8c03-3bf6cbc28a70","user_session_id":"52ab0127-d271-40fb-9aa6-e6327a59b362","scope_system_admin_read":false,"access-rights":[],"user_id":"33019487-6bff-402c-8c03-3bf6cbc28a70","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"ec09a61e-81a5-4995-98ae-f9159a1a35e8"}},"remote-addr":"127.0.0.1","start-time":1242538071750,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=ec09a61e-81a5-4995-98ae-f9159a1a35e8","content-length":"382","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=09a055f1-fd42-4c77-8dea-eb983bdbcd45&category=aecb8b1b-4710-4f17-a6d1-85971675c19d","connection":"keep-alive","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","postman-token":"a5416804-bf12-4d83-a968-b14a0a07872c"},"server-port":3230,"params-raw":{},"content-length":382,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"query":"query searchUsers($searchTerm: String! = \"\", $excludeIds: [ID], $isRequester: Boolean) {\n  users(search_term: $searchTerm, limit: 25, offset: 0, exclude_ids: $excludeIds, isRequester: $isRequester) {\n    id\n    firstname\n    lastname\n    __typename\n  }\n}\n","operationName":"searchUsers","variables":{"searchTerm":"Procurement Admin","isRequester":true}},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query searchUsers($searchTerm: String! = "", $excludeIds: [ID], $isRequester: Boolean) {
  users(search_term: $searchTerm, limit: 25, offset: 0, exclude_ids: $excludeIds, isRequester: $isRequester) {
    id
    firstname
    lastname
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:users []])}
2023-12-11T09:41:53.983Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:users []])}
2023-12-11T09:41:53.983Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:users []])}}
