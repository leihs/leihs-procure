# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-12-08T08:47:48.639Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-08T08:47:49.330Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-08T08:47:49.337Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x373cb12 "taoensso.timbre$default_output_fn@373cb12"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x4d522b2e "taoensso.timbre.appenders.core$println_appender$fn__3459@4d522b2e"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-08T08:47:49.339Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-08T08:47:49.352Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 23927, :repl-port-file ".nrepl-port"}
2023-12-08T08:47:49.354Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  23927 localhost
2023-12-08T08:47:49.374Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-08T08:47:49.378Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 23927, :repl-port-file .nrepl-port}
2023-12-08T08:47:49.379Z NX-41294 INFO [leihs.core.shutdown:20] - PID 8503
2023-12-08T08:47:49.392Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-08T08:47:49.457Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-08T08:47:49.458Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-08T08:47:49.464Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-08T08:47:49.529Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@57361acd
2023-12-08T08:47:49.535Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-08T08:47:49.535Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}
2023-12-08T08:47:49.536Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-08T08:47:49.550Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-08T08:47:49.558Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@5b0d8269
2023-12-08T08:47:49.558Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-08T08:47:49.564Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}
2023-12-08T08:47:49.571Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x573e28fc "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x3fc3f93b "java.util.concurrent.ThreadPoolExecutor@3fc3f93b[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-08T08:47:49.582Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 157240746610375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x23b3d07 /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:08.104Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:08.206Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", :http-only false, :path "/", :secure false}}}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}}, :remote-addr 127.0.0.1, :start-time 157241007612750, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6722f625 /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:08.284Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:08.296Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}}, :remote-addr 127.0.0.1, :start-time 157241128696791, :params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6e92c35b HikariProxyConnection@1855112027 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, content-length 98, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x202ffacd /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x67f4bfa0 HikariProxyConnection@1744093088 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 1, :rollback #object[clojure.lang.Atom 0x1ab1c799 {:status :ready, :val false}]}, :content-length 98, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x445fe2b3 BytesInputStream[len=98]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x67f4bfa0 HikariProxyConnection@1744093088 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 1, :rollback #object[clojure.lang.Atom 0x1ab1c799 {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:08.413Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:08.427Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"lynsey_kertzmann@klein-wehner.org\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}}, :remote-addr 127.0.0.1, :start-time 157241229034916, :params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x62e742b4 HikariProxyConnection@1659323060 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, content-length 106, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1fd086e5 /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5b035c4e HikariProxyConnection@1526946894 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 1, :rollback #object[clojure.lang.Atom 0x4f9b3290 {:status :ready, :val false}]}, :content-length 106, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x17b12b35 BytesInputStream[len=106]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5b035c4e HikariProxyConnection@1526946894 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 1, :rollback #object[clojure.lang.Atom 0x4f9b3290 {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:08.501Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:08.572Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241316706083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7f0cddb9 /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0xa418c5e leihs.procurement.backend.html$not_found_handler@a418c5e], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:08.604Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:08.608Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:08.613Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 07 Dec 2023 20:08:40 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x16d9aead "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241544695625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x72b6d158 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0xa418c5e leihs.procurement.backend.html$not_found_handler@a418c5e], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:08.823Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:08.826Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:08.828Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 07 Dec 2023 20:08:40 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x69fbd5f7 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241549178166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x331188ba /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:08.870Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:08.873Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:08.877Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:08.878Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:08.878Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157241549178166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "502", "referer" "http://localhost:3230/procure", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x331188ba "/127.0.0.1:3230<->/127.0.0.1:58038"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241549178166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x331188ba /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157241549178166,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"502","referer":"http:\/\/localhost:3230\/procure","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"87e89e4c-6976-4316-8ff2-47b072a12018","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 87e89e4c-6976-4316-8ff2-47b072a12018] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:08.976Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:08.977Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241806352666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x187a2742 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:09.103Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241806055000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6d314e21 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
2023-12-08T08:48:09.119Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>myprint>  requester true
2023-12-08T08:48:09.121Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.131Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:09.132Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:09.132Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:09.132Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157241806352666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "502", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x187a2742 "/127.0.0.1:3230<->/127.0.0.1:58047"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>>>exec-query::variables {}
2023-12-08T08:48:09.144Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T08:48:09.144Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:09.144Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157241806055000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "3575", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6d314e21 "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241806352666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x187a2742 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157241806352666,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"87e89e4c-6976-4316-8ff2-47b072a12018","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 87e89e4c-6976-4316-8ff2-47b072a12018] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:09.155Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:09.155Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>>get-dashboard
>>args {}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241806147958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4cc94ee1 /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>>ToCheck mainCats ({:id #uuid "285224f6-2f93-4ac8-8a9f-aa7180473754", :name Sarchimor})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  ORDER BY end_date DESC]
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:09.187Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.190Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:07.920468Z", :updated_at #time/instant "2023-12-08T08:48:07.920468Z"})
>>resultA1-2 ({:id #uuid "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:07.920468Z", :updated_at #time/instant "2023-12-08T08:48:07.920468Z"})
>>requestsB2-triggerError {} nil
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from 
>>>exec-query::variables {}
2023-12-08T08:48:09.203Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}

2023-12-08T08:48:09.204Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
(:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:09.204Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157241806147958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "534", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4cc94ee1 "/127.0.0.1:3230<->/127.0.0.1:58038"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestFilters", :variables {}, :query "query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-12-08T08:48:09.204Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:09.205Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:09.206Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:09.207Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:09.207Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241806147958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4cc94ee1 /127.0.0.1:3230<->/127.0.0.1:58038], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157241806147958,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"534","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":534,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestFilters","variables":{},"query":"query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id 285224f6-2f93-4ac8-8a9f-aa7180473754] [:name Sarchimor] [:categories [#ordered/map ([:id 493e3a6b-1268-41c7-8d12-6e06dd866153] [:name Colombia] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id bc88faf8-d561-4ccb-93f6-dfd2af889e73] [:name Toys, Kids & Baby] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 896b1258-4f9a-4f7f-957f-a1fec3dd6c85] [:name Baby, Toys & Computers] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T08:48:09.261Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "bc88faf8-d561-4ccb-93f6-dfd2af889e73"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "896b1258-4f9a-4f7f-957f-a1fec3dd6c85"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T08:48:09.261Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "bc88faf8-d561-4ccb-93f6-dfd2af889e73"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "896b1258-4f9a-4f7f-957f-a1fec3dd6c85"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}}
>>requestsB2 ()
>>dashboard-cache-keyB2 {:id -15128758}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157241806055000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6d314e21 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157241806055000,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"3575","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":3575,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -15128758] [:total_count 0] [:budget_periods [#ordered/map ([:id 3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:cacheKey -15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id 285224f6-2f93-4ac8-8a9f-aa7180473754] [:cacheKey -15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754] [:name Sarchimor] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id 493e3a6b-1268-41c7-8d12-6e06dd866153] [:cacheKey -15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754_493e3a6b-1268-41c7-8d12-6e06dd866153] [:name Colombia] [:total_price_cents 0] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:09.286Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 0] [:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:cacheKey "-15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:cacheKey "-15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:cacheKey "-15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754_493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:09.287Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 0] [:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:cacheKey "-15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:cacheKey "-15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:cacheKey "-15128758_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754_493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242083545041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x649f3eaf /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [896b1258-4f9a-4f7f-957f-a1fec3dd6c85], :categories [493e3a6b-1268-41c7-8d12-6e06dd866153], :priority [NORMAL HIGH], :budgetPeriods [3c183c08-5f4b-4ec2-8c10-dd814a93fb72]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:09.385Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.387Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [896b1258-4f9a-4f7f-957f-a1fec3dd6c85], :categories [493e3a6b-1268-41c7-8d12-6e06dd866153], :priority [NORMAL HIGH], :budgetPeriods [3c183c08-5f4b-4ec2-8c10-dd814a93fb72]}
2023-12-08T08:48:09.397Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T08:48:09.397Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["896b1258-4f9a-4f7f-957f-a1fec3dd6c85"], :categories ["493e3a6b-1268-41c7-8d12-6e06dd866153"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["3c183c08-5f4b-4ec2-8c10-dd814a93fb72"]}
2023-12-08T08:48:09.397Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157242083545041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "4033", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x649f3eaf "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["896b1258-4f9a-4f7f-957f-a1fec3dd6c85"], :categories ["493e3a6b-1268-41c7-8d12-6e06dd866153"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["3c183c08-5f4b-4ec2-8c10-dd814a93fb72"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [896b1258-4f9a-4f7f-957f-a1fec3dd6c85], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [3c183c08-5f4b-4ec2-8c10-dd814a93fb72], :category_id [493e3a6b-1268-41c7-8d12-6e06dd866153]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats ({:id #uuid "285224f6-2f93-4ac8-8a9f-aa7180473754", :name Sarchimor})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC 3c183c08-5f4b-4ec2-8c10-dd814a93fb72]
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:07.920468Z", :updated_at #time/instant "2023-12-08T08:48:07.920468Z"})
>>resultA1-2 ({:id #uuid "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:07.920468Z", :updated_at #time/instant "2023-12-08T08:48:07.920468Z"})
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [896b1258-4f9a-4f7f-957f-a1fec3dd6c85], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [3c183c08-5f4b-4ec2-8c10-dd814a93fb72], :category_id [493e3a6b-1268-41c7-8d12-6e06dd866153]} nil
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:09.417Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:09.417Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:09.418Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:09.418Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:09.418Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>>requestsB2 ()
>>dashboard-cache-keyB2 {:id -1447070290}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242083545041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x649f3eaf /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [896b1258-4f9a-4f7f-957f-a1fec3dd6c85], :categories [493e3a6b-1268-41c7-8d12-6e06dd866153], :priority [NORMAL HIGH], :budgetPeriods [3c183c08-5f4b-4ec2-8c10-dd814a93fb72]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157242083545041,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"4033","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":4033,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"inspector_priority":["LOW","MEDIUM","HIGH","MANDATORY"],"onlyOwnRequests":false,"state":["NEW","IN_APPROVAL","APPROVED","PARTIALLY_APPROVED","DENIED"],"order_status":["NOT_PROCESSED","IN_PROGRESS","PROCURED","ALTERNATIVE_PROCURED","NOT_PROCURED"],"search":null,"organizations":["896b1258-4f9a-4f7f-957f-a1fec3dd6c85"],"categories":["493e3a6b-1268-41c7-8d12-6e06dd866153"],"priority":["NORMAL","HIGH"],"budgetPeriods":["3c183c08-5f4b-4ec2-8c10-dd814a93fb72"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -1447070290] [:total_count 0] [:budget_periods [#ordered/map ([:id 3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:cacheKey -1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id 285224f6-2f93-4ac8-8a9f-aa7180473754] [:cacheKey -1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754] [:name Sarchimor] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id 493e3a6b-1268-41c7-8d12-6e06dd866153] [:cacheKey -1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754_493e3a6b-1268-41c7-8d12-6e06dd866153] [:name Colombia] [:total_price_cents 0] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:09.456Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-1447070290"] [:total_count 0] [:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:cacheKey "-1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:cacheKey "-1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:cacheKey "-1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754_493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:09.456Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-1447070290"] [:total_count 0] [:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:cacheKey "-1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:cacheKey "-1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:cacheKey "-1447070290_3c183c08-5f4b-4ec2-8c10-dd814a93fb72_285224f6-2f93-4ac8-8a9f-aa7180473754_493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242288579125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x53e99be5 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:09.567Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.570Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:09.572Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:09.572Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:09.572Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157242288579125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "502", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x53e99be5 "/127.0.0.1:3230<->/127.0.0.1:58047"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242287870875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 669, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6882d6b3 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 669, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestPreselectionQuery, :variables {}, :query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:09.581Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.583Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:09.586Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}

2023-12-08T08:48:09.586Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:09.586Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157242287870875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "669", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6882d6b3 "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 669, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "newRequestPreselectionQuery", :variables {}, :query "query newRequestPreselectionQuery {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    image_url\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  templates {\n    id\n    category {\n      id\n      __typename\n    }\n    is_archived\n    article_name\n    article_number\n    model {\n      id\n      product\n      version\n      __typename\n    }\n    price_cents\n    price_currency\n    supplier {\n      id\n      __typename\n    }\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>oo> templates::get-templates2 _> HERE value contains :id??) nil nil
>oo> templates::get-templates1a ?broken-base-query? {:select (:procurement_templates.*), :from (:procurement_templates), :left-join (:models [:= :models.id :procurement_templates.model_id]), :order-by (#sql/call [:concat (#sql/call [:lower #sql/call [:coalesce :procurement_templates.article_name ]] #sql/call [:lower #sql/call [:coalesce :models.product ]] #sql/call [:lower #sql/call [:coalesce :models.version ]])])}
>oo> templates::get-templates1b ?broken-base-query? [SELECT procurement_templates.* FROM procurement_templates  LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY concat((lower(coalesce(procurement_templates.article_name, ?)), lower(coalesce(models.product, ?)), lower(coalesce(models.version, ?))))   ]
>oo> templates::get-templates1c [SELECT procurement_templates.* FROM procurement_templates  LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY concat((lower(coalesce(procurement_templates.article_name, ?)), lower(coalesce(models.product, ?)), lower(coalesce(models.version, ?))))   ]
2023-12-08T08:48:09.592Z NX-41294 DEBUG [leihs.procurement.resources.templates:44] - (-> context :request :tx) => {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}
2023-12-08T08:48:09.592Z NX-41294 DEBUG [leihs.procurement.resources.templates:42] - query => {:select (:procurement_templates.*), :from (:procurement_templates), :left-join (:models [:= :models.id :procurement_templates.model_id]), :order-by (#sql/call [:concat (#sql/call [:lower #sql/call [:coalesce :procurement_templates.article_name ""]] #sql/call [:lower #sql/call [:coalesce :models.product ""]] #sql/call [:lower #sql/call [:coalesce :models.version ""]])])}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242288579125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x53e99be5 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157242288579125,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"87e89e4c-6976-4316-8ff2-47b072a12018","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 87e89e4c-6976-4316-8ff2-47b072a12018] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:09.594Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:09.594Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242287870875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 669, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6882d6b3 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 669, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestPreselectionQuery, :variables {}, :query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157242287870875,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"669","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":669,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"newRequestPreselectionQuery","variables":{},"query":"query newRequestPreselectionQuery {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    image_url\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  templates {\n    id\n    category {\n      id\n      __typename\n    }\n    is_archived\n    article_name\n    article_number\n    model {\n      id\n      product\n      version\n      __typename\n    }\n    price_cents\n    price_currency\n    supplier {\n      id\n      __typename\n    }\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id 285224f6-2f93-4ac8-8a9f-aa7180473754] [:name Sarchimor] [:image_url nil] [:categories [#ordered/map ([:id 493e3a6b-1268-41c7-8d12-6e06dd866153] [:name Colombia] [:__typename :Category])]] [:__typename :MainCategory])]] [:templates []])}
2023-12-08T08:48:09.596Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:image_url nil] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:templates []])}
2023-12-08T08:48:09.596Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:image_url nil] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:templates []])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242528380958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x26ea9245 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:09.815Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.826Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242539988750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 5445, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x49a45e32 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5445, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestQuery, :variables {:budgetPeriod 3c183c08-5f4b-4ec2-8c10-dd814a93fb72, :category 493e3a6b-1268-41c7-8d12-6e06dd866153}, :query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}

>>>exec-query::variables {}
2023-12-08T08:48:09.829Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:09.829Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
>myprint>  admin false
2023-12-08T08:48:09.829Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157242528380958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "502", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x26ea9245 "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:09.832Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.836Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242528380958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x26ea9245 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>>>exec-query::variables {:budgetPeriod 3c183c08-5f4b-4ec2-8c10-dd814a93fb72, :category 493e3a6b-1268-41c7-8d12-6e06dd866153}
2023-12-08T08:48:09.847Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157242528380958,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map (2023-12-08T08:48:09.847Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:budgetPeriod "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :category "493e3a6b-1268-41c7-8d12-6e06dd866153"}
[:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"87e89e4c-6976-4316-8ff2-47b072a12018","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 87e89e4c-6976-4316-8ff2-47b072a12018] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:09.848Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:09.848Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
2023-12-08T08:48:09.848Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157242539988750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "5445", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x49a45e32 "/127.0.0.1:3230<->/127.0.0.1:58047"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 5445, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "newRequestQuery", :variables {:budgetPeriod "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :category "493e3a6b-1268-41c7-8d12-6e06dd866153"}, :query "query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {\n  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {\n    ...RequestFieldsForEdit\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>oo> past? budget-period= {:id #uuid "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:07.920468Z", :updated_at #time/instant "2023-12-08T08:48:07.920468Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242539988750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 5445, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x49a45e32 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5445, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestQuery, :variables {:budgetPeriod 3c183c08-5f4b-4ec2-8c10-dd814a93fb72, :category 493e3a6b-1268-41c7-8d12-6e06dd866153}, :query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157242539988750,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"5445","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5445,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"newRequestQuery","variables":{"budgetPeriod":"3c183c08-5f4b-4ec2-8c10-dd814a93fb72","category":"493e3a6b-1268-41c7-8d12-6e06dd866153"},"query":"query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {\n  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {\n    ...RequestFieldsForEdit\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:new_request #ordered/map ([:id nil] [:short_id nil] [:user #ordered/map ([:value #ordered/map ([:id 87e89e4c-6976-4316-8ff2-47b072a12018] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 493e3a6b-1268-41c7-8d12-6e06dd866153] [:name Colombia] [:main_category nil] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id 3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization nil] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value nil] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id b8927fd2-014c-48c2-b095-fa1d5620debe] [:name general room] [:building #ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value nil] [:__typename :RequestFieldOrderStatus] [:read false] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
2023-12-08T08:48:09.883Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:new_request #ordered/map ([:id nil] [:short_id nil] [:user #ordered/map ([:value #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:main_category nil] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization nil] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value nil] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:building #ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value nil] [:__typename :RequestFieldOrderStatus] [:read false] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
2023-12-08T08:48:09.883Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:new_request #ordered/map ([:id nil] [:short_id nil] [:user #ordered/map ([:value #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:main_category nil] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization nil] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value nil] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:building #ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value nil] [:__typename :RequestFieldOrderStatus] [:read false] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}}
>>> authenticate::skip= >>> authenticate::skip= nil nil  handler-key=  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :graphql:id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id 
#uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights >>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018"(, :user_session_id )#uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, , :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count :user_id0, :scope_admin_read  false}

>> authorize >

>> authorize::handler > #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", #object[:is_system_adminleihs.core.locale$wrap$fn__44263  false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]0x37262b71 
leihs.core.locale$wrap$fn__44263@37262b71
>> authorize::request >] 

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z"{, :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights :authenticated-entity( ), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil{, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {:emailleihs-anti-csrf-token  lynsey_kertzmann@klein-wehner.org{, :value:contracts_count  5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {0:value,  :lastnameaf367295-0606-4bc3-8c39-172e1baade5d }Pfeffer}, , :org_id:remote-addr  127.0.0.1nil, , :start-time:scope_read  157242660447708true, , :params:is_admin  false, :authentication-method :session, :login {nil}, , :scope_system_admin_write:settings  false, :scope_write {true, :email_sending_enabled:firstname  falseKrysta, , :sessions_max_lifetime_secs:scope_admin_write  false, 432000:user_session_created_at,  :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018"#object[, com.zaxxer.hikari.HikariDataSource:user_session_id  #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights 0x24fde1b6 HikariDataSource (HikariPool-1)], (:options) , :user_id {#uuid "87e89e4c-6976-4316-8ff2-47b072a12018":builder-fn,  :is_system_admin false, :external_sign_out_url nil#object[, next.jdbc.result_set$as_unqualified_lower_maps:language_locale  nil, :inventory_pool_roles_count 00x4cbf173b , next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b:scope_admin_read] }false}}, , :query-params-raw:cookies  {}, :route-params{ nil, leihs-anti-csrf-token:headers  {{:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, originleihs-user-session  http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0{, :valuecontent-type  af367295-0606-4bc3-8c39-172e1baade5dapplication/json}, }cookie,  :remote-addrleihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d , 127.0.0.1content-length,  :start-time137 , 157242660522916referer,  :paramshttp://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153 , {connection} , keep-alive:settings,  x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept {application/json, :email_sending_enabledaccept-language  falsede,en-US;q=0.7,en;q=0.3, , :sessions_max_lifetime_secssec-fetch-dest  empty432000, , accept-encoding:smtp_default_from_address  gzip, deflate, bryour.lending.desk@example.com, , sec-fetch-mode:public_image_caching_enabled  corstrue}, , :sessions_force_secure:async-channel  false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{#object[org.httpkit.server.AsyncChannel :connectable 0x42128339 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[#object[com.zaxxer.hikari.HikariDataSource com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler0x24fde1b6  HikariDataSource (HikariPool-1)], :options 0x11927a29 leihs.procurement.graphql$handler@11927a29{]:builder-fn,  :multipart-params {}, #object[:schemenext.jdbc.result_set$as_unqualified_lower_maps  :http, :request-method :post, :accept 0x4cbf173b {next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b:mime] }:json}, :charset nil, :encoding , nil, :query-params-raw:language  nil}{}}, 
:route-params
>> authorize::handler-key >> :graphql
 >myprint>  authEnt? nil, {:headers:email  lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname {Pfeffer, :org_id nilorigin,  :scope_readhttp://localhost:3230 , truesec-fetch-site , same-origin:is_admin,  hostfalse , localhost:3230:authentication-method,  user-agent:session , Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0:login,  content-typenil , application/json:scope_system_admin_write,  cookiefalse , leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d:scope_write,  content-lengthtrue , 257:firstname,  refererKrysta , http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153:scope_admin_write,  connectionfalse , keep-alive:user_session_created_at,  x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights #object[()org.httpkit.server.AsyncChannel,  :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}0x6c830246 
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
/127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId abae04c5-d767-425e-acc2-7ce04df645d1}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  admin false
>myprint>  inspector false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  viewer false
>myprint>  requester true
>myprint>  requester true
2023-12-08T08:48:09.941Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.941Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:09.944Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:09.944Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:09.945Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getBuildings {
  buildings {
    id
    name
    __typename
  }
}

2023-12-08T08:48:09.946Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:09.946Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157242660447708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "137", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x42128339 "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getBuildings", :variables {}, :query "query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>>>exec-query::variables {:buildingId abae04c5-d767-425e-acc2-7ce04df645d1}
2023-12-08T08:48:09.947Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}

2023-12-08T08:48:09.947Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:buildingId "abae04c5-d767-425e-acc2-7ce04df645d1"}
2023-12-08T08:48:09.947Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157242660522916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "257", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6c830246 "/127.0.0.1:3230<->/127.0.0.1:58047"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getRoomsByBuilding", :variables {:buildingId "abae04c5-d767-425e-acc2-7ce04df645d1"}, :query "query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242660447708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 137, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x42128339 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157242660447708,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"137","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":137,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getBuildings","variables":{},"query":"query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:buildings [#ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building]) #ordered/map ([:id 11c3cbdf-dadc-44a9-92b6-3c91208a648d] [:name Building B] [:__typename :Building])]])}
2023-12-08T08:48:09.949Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "11c3cbdf-dadc-44a9-92b6-3c91208a648d"] [:name "Building B"] [:__typename :Building])]])}
2023-12-08T08:48:09.950Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "11c3cbdf-dadc-44a9-92b6-3c91208a648d"] [:name "Building B"] [:__typename :Building])]])}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157242660522916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 257, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6c830246 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId abae04c5-d767-425e-acc2-7ce04df645d1}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157242660522916,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"257","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":257,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getRoomsByBuilding","variables":{"buildingId":"abae04c5-d767-425e-acc2-7ce04df645d1"},"query":"query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:rooms [#ordered/map ([:id b8927fd2-014c-48c2-b095-fa1d5620debe] [:name general room] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:09.952Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:09.952Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:rooms [#ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:description nil] [:__typename :Room])]])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157243126323041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 257, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6290d60b /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId 11c3cbdf-dadc-44a9-92b6-3c91208a648d}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:10.405Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:10.407Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:buildingId 11c3cbdf-dadc-44a9-92b6-3c91208a648d}
2023-12-08T08:48:10.410Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}

2023-12-08T08:48:10.410Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:buildingId "11c3cbdf-dadc-44a9-92b6-3c91208a648d"}
2023-12-08T08:48:10.410Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157243126323041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "257", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6290d60b "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getRoomsByBuilding", :variables {:buildingId "11c3cbdf-dadc-44a9-92b6-3c91208a648d"}, :query "query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157243126323041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 257, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6290d60b /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId 11c3cbdf-dadc-44a9-92b6-3c91208a648d}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157243126323041,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"257","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":257,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getRoomsByBuilding","variables":{"buildingId":"11c3cbdf-dadc-44a9-92b6-3c91208a648d"},"query":"query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:rooms [#ordered/map ([:id 623a1fce-9857-4824-8050-6c0f5a33d26a] [:name general room] [:description nil] [:__typename :Room]) #ordered/map ([:id bb69e16b-83d3-46ad-b779-1deb3ac2ca7e] [:name Room R] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:10.414Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "623a1fce-9857-4824-8050-6c0f5a33d26a"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "bb69e16b-83d3-46ad-b779-1deb3ac2ca7e"] [:name "Room R"] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:10.414Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:rooms [#ordered/map ([:id "623a1fce-9857-4824-8050-6c0f5a33d26a"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "bb69e16b-83d3-46ad-b779-1deb3ac2ca7e"] [:name "Room R"] [:description nil] [:__typename :Room])]])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157244369236708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x166e7f4c HikariProxyConnection@376340300 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 593, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x77e4ecdf /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7e3ab37e HikariProxyConnection@2117776254 wrapping org.postgresql.jdbc.PgConnection@4eb3be11], :level 1, :rollback #object[clojure.lang.Atom 0x2bc22c94 {:status :ready, :val false}]}, :content-length 593, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName createRequest, :variables {:requestData {:category 493e3a6b-1268-41c7-8d12-6e06dd866153, :motivation And why not, :article_number 12345, :price_cents 50000, :budget_period 3c183c08-5f4b-4ec2-8c10-dd814a93fb72, :article_name Camera, :replacement false, :attachments [], :supplier_name Supplier S, :requested_quantity 10, :priority HIGH, :room bb69e16b-83d3-46ad-b779-1deb3ac2ca7e, :receiver Hans Heiri}}, :query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7e3ab37e HikariProxyConnection@2117776254 wrapping org.postgresql.jdbc.PgConnection@4eb3be11], :level 1, :rollback #object[clojure.lang.Atom 0x2bc22c94 {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:11.650Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:11.651Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:requestData {:category 493e3a6b-1268-41c7-8d12-6e06dd866153, :motivation And why not, :article_number 12345, :price_cents 50000, :budget_period 3c183c08-5f4b-4ec2-8c10-dd814a93fb72, :article_name Camera, :replacement false, :attachments [], :supplier_name Supplier S, :requested_quantity 10, :priority HIGH, :room bb69e16b-83d3-46ad-b779-1deb3ac2ca7e, :receiver Hans Heiri}}
2023-12-08T08:48:11.653Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}

2023-12-08T08:48:11.653Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:requestData {:category "493e3a6b-1268-41c7-8d12-6e06dd866153", :motivation "And why not", :article_number "12345", :price_cents 50000, :budget_period "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :article_name "Camera", :replacement false, :attachments [], :supplier_name "Supplier S", :requested_quantity "10", :priority "HIGH", :room "bb69e16b-83d3-46ad-b779-1deb3ac2ca7e", :receiver "Hans Heiri"}}
2023-12-08T08:48:11.653Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157244369236708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x166e7f4c "HikariProxyConnection@376340300 wrapping org.postgresql.jdbc.PgConnection@5b0d8269"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "593", "referer" "http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x77e4ecdf "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7e3ab37e "HikariProxyConnection@2117776254 wrapping org.postgresql.jdbc.PgConnection@4eb3be11"], :level 2, :rollback #object[clojure.lang.Atom 0x2bc22c94 {:status :ready, :val false}]}, :content-length 593, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "createRequest", :variables {:requestData {:category "493e3a6b-1268-41c7-8d12-6e06dd866153", :motivation "And why not", :article_number "12345", :price_cents 50000, :budget_period "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :article_name "Camera", :replacement false, :attachments [], :supplier_name "Supplier S", :requested_quantity "10", :priority "HIGH", :room "bb69e16b-83d3-46ad-b779-1deb3ac2ca7e", :receiver "Hans Heiri"}}, :query "mutation createRequest($requestData: CreateRequestInput) {\n  create_request(input_data: $requestData) {\n    id\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>oo> past? budget-period= {:id #uuid "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:07.920468Z", :updated_at #time/instant "2023-12-08T08:48:07.920468Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:11.739Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:11.740Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:11.740Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:11.740Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:11.741Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id #uuid "8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
>oo> past? budget-period= {:id #uuid "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:07.920468Z", :updated_at #time/instant "2023-12-08T08:48:07.920468Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157244369236708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x166e7f4c HikariProxyConnection@376340300 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 593, referer http://localhost:3230/procure/requests/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x77e4ecdf /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7e3ab37e HikariProxyConnection@2117776254 wrapping org.postgresql.jdbc.PgConnection@4eb3be11], :level 2, :rollback #object[clojure.lang.Atom 0x2bc22c94 {:status :ready, :val false}]}, :content-length 593, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName createRequest, :variables {:requestData {:category 493e3a6b-1268-41c7-8d12-6e06dd866153, :motivation And why not, :article_number 12345, :price_cents 50000, :budget_period 3c183c08-5f4b-4ec2-8c10-dd814a93fb72, :article_name Camera, :replacement false, :attachments [], :supplier_name Supplier S, :requested_quantity 10, :priority HIGH, :room bb69e16b-83d3-46ad-b779-1deb3ac2ca7e, :receiver Hans Heiri}}, :query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157244369236708,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"593","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=3c183c08-5f4b-4ec2-8c10-dd814a93fb72&category=493e3a6b-1268-41c7-8d12-6e06dd866153","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":593,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"createRequest","variables":{"requestData":{"category":"493e3a6b-1268-41c7-8d12-6e06dd866153","motivation":"And why not","article_number":"12345","price_cents":50000,"budget_period":"3c183c08-5f4b-4ec2-8c10-dd814a93fb72","article_name":"Camera","replacement":false,"attachments":[],"supplier_name":"Supplier S","requested_quantity":"10","priority":"HIGH","room":"bb69e16b-83d3-46ad-b779-1deb3ac2ca7e","receiver":"Hans Heiri"}},"query":"mutation createRequest($requestData: CreateRequestInput) {\n  create_request(input_data: $requestData) {\n    id\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:create_request #ordered/map ([:id 8a5a50df-2771-437c-b852-5ba0c2efabbe] [:__typename :Request])])}
2023-12-08T08:48:11.764Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:create_request #ordered/map ([:id "8a5a50df-2771-437c-b852-5ba0c2efabbe"] [:__typename :Request])])}
2023-12-08T08:48:11.765Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:create_request #ordered/map ([:id "8a5a50df-2771-437c-b852-5ba0c2efabbe"] [:__typename :Request])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157244524754666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x74967235 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights >myprint> (),  :user_id viewer #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url falsenil
, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157244524665333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 5678, referer http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1e1438c9 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [8a5a50df-2771-437c-b852-5ba0c2efabbe]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  requester true
>myprint>  admin false2023-12-08T08:48:11.806Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:11.812Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:11.813Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:11.814Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:11.815Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:11.815Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:11.815Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157244524754666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "502", "referer" "http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x74967235 "/127.0.0.1:3230<->/127.0.0.1:58047"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>>>exec-query::variables {:id [8a5a50df-2771-437c-b852-5ba0c2efabbe]}
2023-12-08T08:48:11.820Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T08:48:11.820Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:id ["8a5a50df-2771-437c-b852-5ba0c2efabbe"]}
2023-12-08T08:48:11.821Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157244524665333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "5678", "referer" "http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1e1438c9 "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestForEdit", :variables {:id ["8a5a50df-2771-437c-b852-5ba0c2efabbe"]}, :query "query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:11.830Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:11.830Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:11.830Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:11.831Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:11.831Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157244524754666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x74967235 /127.0.0.1:3230<->/127.0.0.1:58047], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157244524754666,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests\/8a5a50df-2771-437c-b852-5ba0c2efabbe","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"87e89e4c-6976-4316-8ff2-47b072a12018","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 87e89e4c-6976-4316-8ff2-47b072a12018] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:11.832Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:11.832Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>oo> past? budget-period= {:id #uuid "3c183c08-5f4b-4ec2-8c10-dd814a93fb72", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:07.920468Z", :updated_at #time/instant "2023-12-08T08:48:07.920468Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157244524665333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 5678, referer http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1e1438c9 /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [8a5a50df-2771-437c-b852-5ba0c2efabbe]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157244524665333,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"5678","referer":"http:\/\/localhost:3230\/procure\/requests\/8a5a50df-2771-437c-b852-5ba0c2efabbe","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5678,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestForEdit","variables":{"id":["8a5a50df-2771-437c-b852-5ba0c2efabbe"]},"query":"query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:requests [#ordered/map ([:id 8a5a50df-2771-437c-b852-5ba0c2efabbe] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 87e89e4c-6976-4316-8ff2-47b072a12018] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 493e3a6b-1268-41c7-8d12-6e06dd866153] [:name Colombia] [:main_category #ordered/map ([:id 285224f6-2f93-4ac8-8a9f-aa7180473754] [:name Sarchimor] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id 3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value Hans Heiri] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 896b1258-4f9a-4f7f-957f-a1fec3dd6c85] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id bc88faf8-d561-4ccb-93f6-dfd2af889e73] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value 12345] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value Supplier S] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id bb69e16b-83d3-46ad-b779-1deb3ac2ca7e] [:name Room R] [:building #ordered/map ([:id 11c3cbdf-dadc-44a9-92b6-3c91208a648d] [:name Building B] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value And why not] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id 285224f6-2f93-4ac8-8a9f-aa7180473754] [:name Sarchimor] [:categories [#ordered/map ([:id 493e3a6b-1268-41c7-8d12-6e06dd866153] [:name Colombia] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id 3c183c08-5f4b-4ec2-8c10-dd814a93fb72] [:name Budget-Period-BP] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:11.903Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "8a5a50df-2771-437c-b852-5ba0c2efabbe"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:main_category #ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "896b1258-4f9a-4f7f-957f-a1fec3dd6c85"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "bc88faf8-d561-4ccb-93f6-dfd2af889e73"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "bb69e16b-83d3-46ad-b779-1deb3ac2ca7e"] [:name "Room R"] [:building #ordered/map ([:id "11c3cbdf-dadc-44a9-92b6-3c91208a648d"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:11.904Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:requests [#ordered/map ([:id "8a5a50df-2771-437c-b852-5ba0c2efabbe"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:main_category #ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "896b1258-4f9a-4f7f-957f-a1fec3dd6c85"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "bc88faf8-d561-4ccb-93f6-dfd2af889e73"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "bb69e16b-83d3-46ad-b779-1deb3ac2ca7e"] [:name "Room R"] [:building #ordered/map ([:id "11c3cbdf-dadc-44a9-92b6-3c91208a648d"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "285224f6-2f93-4ac8-8a9f-aa7180473754"] [:name "Sarchimor"] [:categories [#ordered/map ([:id "493e3a6b-1268-41c7-8d12-6e06dd866153"] [:name "Colombia"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "3c183c08-5f4b-4ec2-8c10-dd814a93fb72"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157244682686666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x414a4f4b /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:11.962Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:11.964Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:11.966Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:11.966Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:11.966Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"}, "leihs-user-session" {:value "af367295-0606-4bc3-8c39-172e1baade5d"}}, :remote-addr "127.0.0.1", :start-time 157244682686666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d", "content-length" "502", "referer" "http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe", "connection" "keep-alive", "x-csrf-token" "5fcf9fbf-3181-4bf5-9322-fc7f0df5f164", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x414a4f4b "/127.0.0.1:3230<->/127.0.0.1:58046"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:08.500040Z", :id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :user_session_id #uuid "a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e", :scope_system_admin_read false, :access-rights (), :user_id #uuid "87e89e4c-6976-4316-8ff2-47b072a12018", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164}, leihs-user-session {:value af367295-0606-4bc3-8c39-172e1baade5d}}, :remote-addr 127.0.0.1, :start-time 157244682686666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d, content-length 502, referer http://localhost:3230/procure/requests/8a5a50df-2771-437c-b852-5ba0c2efabbe, connection keep-alive, x-csrf-token 5fcf9fbf-3181-4bf5-9322-fc7f0df5f164, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x414a4f4b /127.0.0.1:3230<->/127.0.0.1:58046], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:08.500040Z","id":"87e89e4c-6976-4316-8ff2-47b072a12018","user_session_id":"a608fbc7-c3c0-4df2-83d4-f24dd3a3c36e","scope_system_admin_read":false,"access-rights":[],"user_id":"87e89e4c-6976-4316-8ff2-47b072a12018","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164"},"leihs-user-session":{"value":"af367295-0606-4bc3-8c39-172e1baade5d"}},"remote-addr":"127.0.0.1","start-time":157244682686666,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=5fcf9fbf-3181-4bf5-9322-fc7f0df5f164; leihs-user-session=af367295-0606-4bc3-8c39-172e1baade5d","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests\/8a5a50df-2771-437c-b852-5ba0c2efabbe","connection":"keep-alive","x-csrf-token":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"87e89e4c-6976-4316-8ff2-47b072a12018","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 87e89e4c-6976-4316-8ff2-47b072a12018] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:11.982Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:11.982Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"5fcf9fbf-3181-4bf5-9322-fc7f0df5f164\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"87e89e4c-6976-4316-8ff2-47b072a12018\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "87e89e4c-6976-4316-8ff2-47b072a12018"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 157249357771958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x996a7a /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:16.666Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:16.720Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"416b4561-12c1-45c5-a449-253e8f577996\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996", :http-only false, :path "/", :secure false}}}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}}, :remote-addr 127.0.0.1, :start-time 157249527224208, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x331f5f10 /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:16.797Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:16.804Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"416b4561-12c1-45c5-a449-253e8f577996\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}}, :remote-addr 127.0.0.1, :start-time 157249647923791, :params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token 416b4561-12c1-45c5-a449-253e8f577996}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x7c9fa3bb HikariProxyConnection@2090836923 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996, content-length 98, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x32f84989 /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token 416b4561-12c1-45c5-a449-253e8f577996}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x600f55af HikariProxyConnection@1611617711 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 1, :rollback #object[clojure.lang.Atom 0x7546306e {:status :ready, :val false}]}, :content-length 98, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token 416b4561-12c1-45c5-a449-253e8f577996}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token 416b4561-12c1-45c5-a449-253e8f577996}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x7445c706 BytesInputStream[len=98]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x600f55af HikariProxyConnection@1611617711 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 1, :rollback #object[clojure.lang.Atom 0x7546306e {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:16.924Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:16.935Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"lynsey_kertzmann@klein-wehner.org\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"416b4561-12c1-45c5-a449-253e8f577996\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}}, :remote-addr 127.0.0.1, :start-time 157249743933416, :params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 416b4561-12c1-45c5-a449-253e8f577996}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x87b183b HikariProxyConnection@142284859 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996, content-length 106, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x41b7de63 /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 416b4561-12c1-45c5-a449-253e8f577996}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2a881d2 HikariProxyConnection@44597714 wrapping org.postgresql.jdbc.PgConnection@4eb3be11], :level 1, :rollback #object[clojure.lang.Atom 0x4a66f206 {:status :ready, :val false}]}, :content-length 106, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 416b4561-12c1-45c5-a449-253e8f577996}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 416b4561-12c1-45c5-a449-253e8f577996}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x1a0c81b1 BytesInputStream[len=106]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2a881d2 HikariProxyConnection@44597714 wrapping org.postgresql.jdbc.PgConnection@4eb3be11], :level 1, :rollback #object[clojure.lang.Atom 0x4a66f206 {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:17.016Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:17.054Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157249794098166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x71be5c28 /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0xa418c5e leihs.procurement.backend.html$not_found_handler@a418c5e], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:17.102Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:17.105Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:17.107Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 07 Dec 2023 20:08:40 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x5257f451 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250037912416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x29303bd5 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0xa418c5e leihs.procurement.backend.html$not_found_handler@a418c5e], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at >myprint>  requester true
#time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250044581041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x28dc90fa /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
2023-12-08T08:48:17.318Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:17.320Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:17.320Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:17.322Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 07 Dec 2023 20:08:40 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x17f0d707 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
2023-12-08T08:48:17.322Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:17.325Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:17.325Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:17.325Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157250044581041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "502", "referer" "http://localhost:3230/procure", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x28dc90fa "/127.0.0.1:3230<->/127.0.0.1:58104"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250044581041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x28dc90fa /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157250044581041,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"502","referer":"http:\/\/localhost:3230\/procure","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"416b4561-12c1-45c5-a449-253e8f577996","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:17.373Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"416b4561-12c1-45c5-a449-253e8f577996\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"13e4e803-d39e-4d8a-93e7-115b1b27085f\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:17.374Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"416b4561-12c1-45c5-a449-253e8f577996\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"13e4e803-d39e-4d8a-93e7-115b1b27085f\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250202989125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x41a71e45 /127.0.0.1:3230<->/127.0.0.1:58118], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250202683083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2493a1bb /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  viewer false
>myprint>  admin false
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id >myprint>  requester true
#uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250202277500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5aa2896b /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  inspector false
2023-12-08T08:48:17.483Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>myprint>  admin false
>myprint>  viewer false
>myprint>  inspector false
>myprint>  requester true
2023-12-08T08:48:17.484Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:17.485Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:17.485Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:17.486Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:17.487Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:17.487Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:17.487Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:17.487Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157250202989125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "502", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x41a71e45 "/127.0.0.1:3230<->/127.0.0.1:58118"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>>>exec-query::variables {}
2023-12-08T08:48:17.488Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}

2023-12-08T08:48:17.488Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:17.488Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157250202683083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "534", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2493a1bb "/127.0.0.1:3230<->/127.0.0.1:58104"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestFilters", :variables {}, :query "query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>>>exec-query::variables {}
2023-12-08T08:48:17.491Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T08:48:17.491Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:17.491Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157250202277500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "3575", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5aa2896b "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>>get-dashboard
>>args {}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats ({:id #uuid "ca399b0a-8a02-486c-8d27-471ffc4bd4a3", :name Colombia})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  ORDER BY end_date DESC]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250202989125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x41a71e45 /127.0.0.1:3230<->/127.0.0.1:58118], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157250202989125,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"416b4561-12c1-45c5-a449-253e8f577996","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"})
>>resultA1-2 ({:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"})
>>requestsB2-triggerError {} nil
2023-12-08T08:48:17.511Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"416b4561-12c1-45c5-a449-253e8f577996\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"13e4e803-d39e-4d8a-93e7-115b1b27085f\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:17.511Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"416b4561-12c1-45c5-a449-253e8f577996\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"13e4e803-d39e-4d8a-93e7-115b1b27085f\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:17.514Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:17.514Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:17.514Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:17.515Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:17.515Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250202683083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2493a1bb /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157250202683083,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"534","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":534,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestFilters","variables":{},"query":"query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:categories [#ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224] [:name Toys, Kids & Baby] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 6f62bca0-ec72-4349-8eeb-648a128b6d99] [:name Baby, Toys & Computers] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T08:48:17.541Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T08:48:17.541Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}}
>>requestsB2 (>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
{:category {:read true, :write true, :default {:id #uuid "326da6e2-ef0e-491c-8184-35ce21fcb4da", :name Category C, :main_category_id #uuid "ca399b0a-8a02-486c-8d27-471ffc4bd4a3", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 326da6e2-ef0e-491c-8184-35ce21fcb4da, :name Category C, :cost_center nil, :main_category {:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3, :name Colombia}, :main_category_id ca399b0a-8a02-486c-8d27-471ffc4bd4a3, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :budget_period {:read true, :write true, :default {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}, :required true, :value {:id bc14a636-b51c-4458-8928-dfff9f5b9c47, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:48:16.545986, :updated_at 2023-12-08T09:48:16.545986, :is_past false}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :state :NEW, :organization {:value {:id 6f62bca0-ec72-4349-8eeb-648a128b6d99, :name Baby, Toys & Computers, :parent_id f435f94a-f0eb-4aa8-ba60-b143d3d0f224, :shortname nil, :department {:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_status {:read true, :write false, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :updated_at {:value #time/instant "2023-12-08T08:48:16.608176Z", :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 40fbc607-96a7-4162-899d-e2e0ad7dc131, :name Room R, :general false, :building {:id 5f4efd47-e9a7-4c56-be7c-009628dd228b, :code nil, :name Building B}, :building_id 5f4efd47-e9a7-4c56-be7c-009628dd228b, :description nil}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :user {:read true, :write false, :required true, :default {:id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:48:17.014415+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:48:17.014415+01:00, :firstname Krysta, :zip nil, :id 13e4e803-d39e-4d8a-93e7-115b1b27085f, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:48:16.556333+01:00, :admin_protected false}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :created_at {:value #time/instant "2023-12-08T08:48:16.608176Z", :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}})
>>dashboard-cache-keyB2 {:id -15128758}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250202277500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5aa2896b /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157250202277500,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"3575","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":3575,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -15128758] [:total_count 1] [:budget_periods [#ordered/map ([:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:cacheKey -15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 500000] [:main_categories [#ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:cacheKey -15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:image_url nil] [:total_price_cents 500000] [:categories [#ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:cacheKey -15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:total_price_cents 500000] [:requests [#ordered/map ([:id 2f906f7c-76a3-4f4a-a065-37d540e52220] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:main_category #ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value Hans Heiri] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id 6f62bca0-ec72-4349-8eeb-648a128b6d99] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value 12345] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id 40fbc607-96a7-4162-899d-e2e0ad7dc131] [:name Room R] [:building #ordered/map ([:id 5f4efd47-e9a7-4c56-be7c-009628dd228b] [:name Building B] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value And why not] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents 500000] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:17.568Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 1] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:cacheKey "-15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "500000"] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:cacheKey "-15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:image_url nil] [:total_price_cents "500000"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:cacheKey "-15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:total_price_cents "500000"] [:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:building #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "500000"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:17.568Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 1] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:cacheKey "-15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "500000"] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:cacheKey "-15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:image_url nil] [:total_price_cents "500000"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:cacheKey "-15128758_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:total_price_cents "500000"] [:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:building #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "500000"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250358979958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2a000d06 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [6f62bca0-ec72-4349-8eeb-648a128b6d99], :categories [326da6e2-ef0e-491c-8184-35ce21fcb4da], :priority [NORMAL HIGH], :budgetPeriods [bc14a636-b51c-4458-8928-dfff9f5b9c47]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:17.643Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:17.645Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [6f62bca0-ec72-4349-8eeb-648a128b6d99], :categories [326da6e2-ef0e-491c-8184-35ce21fcb4da], :priority [NORMAL HIGH], :budgetPeriods [bc14a636-b51c-4458-8928-dfff9f5b9c47]}
2023-12-08T08:48:17.658Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T08:48:17.658Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["6f62bca0-ec72-4349-8eeb-648a128b6d99"], :categories ["326da6e2-ef0e-491c-8184-35ce21fcb4da"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["bc14a636-b51c-4458-8928-dfff9f5b9c47"]}
2023-12-08T08:48:17.658Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157250358979958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "4033", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2a000d06 "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["6f62bca0-ec72-4349-8eeb-648a128b6d99"], :categories ["326da6e2-ef0e-491c-8184-35ce21fcb4da"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["bc14a636-b51c-4458-8928-dfff9f5b9c47"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [6f62bca0-ec72-4349-8eeb-648a128b6d99], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [bc14a636-b51c-4458-8928-dfff9f5b9c47], :category_id [326da6e2-ef0e-491c-8184-35ce21fcb4da]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats ({:id #uuid "ca399b0a-8a02-486c-8d27-471ffc4bd4a3", :name Colombia})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC bc14a636-b51c-4458-8928-dfff9f5b9c47]
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"})
>>resultA1-2 ({:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"})
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [6f62bca0-ec72-4349-8eeb-648a128b6d99], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [bc14a636-b51c-4458-8928-dfff9f5b9c47], :category_id [326da6e2-ef0e-491c-8184-35ce21fcb4da]} nil
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:17.666Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:17.666Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:17.666Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:17.667Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:17.667Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>>requestsB2 (>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
{:category {:read true, :write true, :default {:id #uuid "326da6e2-ef0e-491c-8184-35ce21fcb4da", :name Category C, :main_category_id #uuid "ca399b0a-8a02-486c-8d27-471ffc4bd4a3", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 326da6e2-ef0e-491c-8184-35ce21fcb4da, :name Category C, :cost_center nil, :main_category {:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3, :name Colombia}, :main_category_id ca399b0a-8a02-486c-8d27-471ffc4bd4a3, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :motivation {:read true, :write true, :required true, :value And why not, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :price_cents {:read true, :write true, :default 0, :required true, :value 50000, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :budget_period {:read true, :write true, :default {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}, :required true, :value {:id bc14a636-b51c-4458-8928-dfff9f5b9c47, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:48:16.545986, :updated_at 2023-12-08T09:48:16.545986, :is_past false}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :replacement {:read true, :write true, :default nil, :required true, :value false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :state :NEW, :organization {:value {:id 6f62bca0-ec72-4349-8eeb-648a128b6d99, :name Baby, Toys & Computers, :parent_id f435f94a-f0eb-4aa8-ba60-b143d3d0f224, :shortname nil, :department {:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_status {:read true, :write false, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :requested_quantity {:read true, :write true, :required true, :value 10, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :updated_at {:value #time/instant "2023-12-08T08:48:16.608176Z", :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :HIGH, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220", :total_price_cents 500000, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 40fbc607-96a7-4162-899d-e2e0ad7dc131, :name Room R, :general false, :building {:id 5f4efd47-e9a7-4c56-be7c-009628dd228b, :code nil, :name Building B}, :building_id 5f4efd47-e9a7-4c56-be7c-009628dd228b, :description nil}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :user {:read true, :write false, :required true, :default {:id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:48:17.014415+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:48:17.014415+01:00, :firstname Krysta, :zip nil, :id 13e4e803-d39e-4d8a-93e7-115b1b27085f, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:48:16.556333+01:00, :admin_protected false}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :receiver {:read true, :write true, :required false, :value Hans Heiri, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :created_at {:value #time/instant "2023-12-08T08:48:16.608176Z", :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}})
>>dashboard-cache-keyB2 {:id 45169892}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157250358979958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2a000d06 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [6f62bca0-ec72-4349-8eeb-648a128b6d99], :categories [326da6e2-ef0e-491c-8184-35ce21fcb4da], :priority [NORMAL HIGH], :budgetPeriods [bc14a636-b51c-4458-8928-dfff9f5b9c47]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157250358979958,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"4033","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":4033,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"inspector_priority":["LOW","MEDIUM","HIGH","MANDATORY"],"onlyOwnRequests":false,"state":["NEW","IN_APPROVAL","APPROVED","PARTIALLY_APPROVED","DENIED"],"order_status":["NOT_PROCESSED","IN_PROGRESS","PROCURED","ALTERNATIVE_PROCURED","NOT_PROCURED"],"search":null,"organizations":["6f62bca0-ec72-4349-8eeb-648a128b6d99"],"categories":["326da6e2-ef0e-491c-8184-35ce21fcb4da"],"priority":["NORMAL","HIGH"],"budgetPeriods":["bc14a636-b51c-4458-8928-dfff9f5b9c47"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey 45169892] [:total_count 1] [:budget_periods [#ordered/map ([:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:cacheKey 45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 500000] [:main_categories [#ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:cacheKey 45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:image_url nil] [:total_price_cents 500000] [:categories [#ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:cacheKey 45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:total_price_cents 500000] [:requests [#ordered/map ([:id 2f906f7c-76a3-4f4a-a065-37d540e52220] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:main_category #ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value Hans Heiri] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id 6f62bca0-ec72-4349-8eeb-648a128b6d99] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value 12345] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id 40fbc607-96a7-4162-899d-e2e0ad7dc131] [:name Room R] [:building #ordered/map ([:id 5f4efd47-e9a7-4c56-be7c-009628dd228b] [:name Building B] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value And why not] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents 500000] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:17.709Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "45169892"] [:total_count 1] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:cacheKey "45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "500000"] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:cacheKey "45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:image_url nil] [:total_price_cents "500000"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:cacheKey "45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:total_price_cents "500000"] [:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:building #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "500000"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:17.709Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "45169892"] [:total_count 1] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:cacheKey "45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "500000"] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:cacheKey "45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:image_url nil] [:total_price_cents "500000"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:cacheKey "45169892_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:total_price_cents "500000"] [:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:building #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "500000"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251118637666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7fef953d /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:18.403Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:18.405Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}
2023-12-08T08:48:18.411Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T08:48:18.411Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:id ["2f906f7c-76a3-4f4a-a065-37d540e52220"]}
2023-12-08T08:48:18.411Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157251118637666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "5678", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7fef953d "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestForEdit", :variables {:id ["2f906f7c-76a3-4f4a-a065-37d540e52220"]}, :query "query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:18.419Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:18.419Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:18.419Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:18.420Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:18.420Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251118637666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7fef953d /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157251118637666,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"5678","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5678,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestForEdit","variables":{"id":["2f906f7c-76a3-4f4a-a065-37d540e52220"]},"query":"query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:requests [#ordered/map ([:id 2f906f7c-76a3-4f4a-a065-37d540e52220] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:main_category #ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value Hans Heiri] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 6f62bca0-ec72-4349-8eeb-648a128b6d99] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value 12345] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 40fbc607-96a7-4162-899d-e2e0ad7dc131] [:name Room R] [:building #ordered/map ([:id 5f4efd47-e9a7-4c56-be7c-009628dd228b] [:name Building B] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value And why not] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:categories [#ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:name Budget-Period-BP] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:18.456Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:building #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:18.456Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:building #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= >>> authenticate::skip= nilnil   handler-key= handler-key=  :graphql:graphql

>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", >>> authenticate::authenticated-entity :id {:email #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id lynsey_kertzmann@klein-wehner.org, #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :contracts_count :scope_system_admin_read false, :access-rights 0, :lastname Pfeffer, :org_id nil, :scope_read true, (:is_admin ), false, :user_id :authentication-method :session, #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :login nil, :is_system_admin :scope_system_admin_write false, false, :external_sign_out_url :scope_write nil, true, :language_locale nil, :firstname :inventory_pool_roles_count Krysta, 0, :scope_admin_write :scope_admin_read false, false:user_session_created_at }

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]
0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]
>> authorize::request > 

>> authorize::request > {:authenticated-entity {{:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id :language_locale nil, #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :inventory_pool_roles_count :is_system_admin 0, false, :scope_admin_read false}:external_sign_out_url nil, :language_locale nil, , :inventory_pool_roles_count :cookies 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {{leihs-anti-csrf-token :value 416b4561-12c1-45c5-a449-253e8f577996}, {leihs-user-session :value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, {:remote-addr :value 127.0.0.1, 134241df-830f-462b-a543-a2aa0705e6bc}}, :start-time :remote-addr 127.0.0.1, 157251239190666, :start-time :params {}, :settings {157251239287750, :params :email_sending_enabled false, :sessions_max_lifetime_secs {}, :settings {:email_sending_enabled 432000, :smtp_default_from_addressfalse,  :sessions_max_lifetime_secs your.lending.desk@example.com, :public_image_caching_enabled true, 432000, :sessions_force_secure false:smtp_default_from_address , your.lending.desk@example.com, :deliver_received_order_notifications false:public_image_caching_enabled true, , :sessions_force_secure :external_base_url false, nil, :deliver_received_order_notifications false, :sessions_force_uniqueness :external_base_url nil, false, :sessions_force_uniqueness :email_signature false, Cheers,}, :email_signature Cheers,}, :tx-next :tx-next ##next.jdbc.default_options.DefaultOptionsnext.jdbc.default_options.DefaultOptions{{:connectable :connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options #object[org.httpkit.server.AsyncChannel {:builder-fn 0xf77a032 /127.0.0.1:3230<->/127.0.0.1:58118], #object[next.jdbc.result_set$as_unqualified_lower_maps :server-port 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw 3230, {}, :params-raw :route-params nil, :headers {{}, :tx origin http://localhost:3230, sec-fetch-site same-origin, {host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, :datasource content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 137, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, #object[:websocket? org.httpkit.server.AsyncChannel false, :query-params {}, :content-type 0x76331c89 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port application/json, 3230, :form-params-raw :params-raw {}, {}, :character-encoding :tx utf8, {:datasource :uri /procure/graphql, :server-name localhost, :handler-key #object[com.zaxxer.hikari.HikariDataSource :graphql, :query-string nil, :body 0x1ff097bb HikariDataSource (db-pool)]}, {:content-length 137, :form-params :operationName getRoomsByBuilding, {}, :variables :websocket? false, :query-params {{}, :buildingId :content-type 5f4efd47-e9a7-4c56-be7c-009628dd228b}, application/json, :form-params-raw :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
{}, }, :character-encoding utf8, :uri /procure/graphql, :graphql-schema :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables #CompiledSchema<>, :handler {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params :multipart-params {}, {}, :scheme :scheme :http, :http, :request-method:request-method :post, :accept {:mime  :post, :json, :accept :charset nil, :encoding nil, {:language nil}}:mime :json, :charset nil, :encoding nil, :language nil}}


>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, 
>> authorize::handler-key >>:scope_read  true, :is_admin :graphqlfalse, 
:authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at >myprint>  authEnt? {:email #time/instant "2023-12-08T08:48:17.014415Z", :id lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
#uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", >myprint>  :user_session_id txn #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read {false, :access-rights :datasource (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}#object[
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSourcecom.zaxxer.hikari.HikariDataSource  0x1ff097bb 0x1ff097bb HikariDataSource (db-pool)]HikariDataSource (db-pool)}]}

>myprint>  admin false
>myprint>  admin false
>myprint>  inspector false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  viewer false
>myprint>  requester true
>myprint>  requester true
2023-12-08T08:48:18.520Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:18.520Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:18.523Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:18.522Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}

>>>exec-query::variables {:buildingId 5f4efd47-e9a7-4c56-be7c-009628dd228b}
2023-12-08T08:48:18.525Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getBuildings {
  buildings {
    id
    name
    __typename
  }
}

2023-12-08T08:48:18.525Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}

2023-12-08T08:48:18.525Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:18.525Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:buildingId "5f4efd47-e9a7-4c56-be7c-009628dd228b"}
2023-12-08T08:48:18.525Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157251239190666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "137", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x76331c89 "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getBuildings", :variables {}, :query "query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-12-08T08:48:18.525Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157251239287750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "257", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0xf77a032 "/127.0.0.1:3230<->/127.0.0.1:58118"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getRoomsByBuilding", :variables {:buildingId "5f4efd47-e9a7-4c56-be7c-009628dd228b"}, :query "query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251239190666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 137, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x76331c89 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157251239190666,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"137","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":137,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getBuildings","variables":{},"query":"query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:buildings [#ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building]) #ordered/map ([:id 5f4efd47-e9a7-4c56-be7c-009628dd228b] [:name Building B] [:__typename :Building]) #ordered/map ([:id e5847638-e5c1-4ffc-93a1-186c4b389ed1] [:name Building B X] [:__typename :Building])]])}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251239287750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0xf77a032 /127.0.0.1:3230<->/127.0.0.1:58118], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId 5f4efd47-e9a7-4c56-be7c-009628dd228b}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-08T08:48:18.528Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building]) #ordered/map ([:id "e5847638-e5c1-4ffc-93a1-186c4b389ed1"] [:name "Building B X"] [:__typename :Building])]])}
2023-12-08T08:48:18.528Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building]) #ordered/map ([:id "e5847638-e5c1-4ffc-93a1-186c4b389ed1"] [:name "Building B X"] [:__typename :Building])]])}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157251239287750,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"257","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":257,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getRoomsByBuilding","variables":{"buildingId":"5f4efd47-e9a7-4c56-be7c-009628dd228b"},"query":"query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:rooms [#ordered/map ([:id d5101464-e7c5-46d4-8e8b-42c6ab0aec61] [:name general room] [:description nil] [:__typename :Room]) #ordered/map ([:id 40fbc607-96a7-4162-899d-e2e0ad7dc131] [:name Room R] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:18.528Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "d5101464-e7c5-46d4-8e8b-42c6ab0aec61"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:18.528Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:rooms [#ordered/map ([:id "d5101464-e7c5-46d4-8e8b-42c6ab0aec61"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:description nil] [:__typename :Room])]])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251258582750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3e97c09 /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:18.535Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:18.537Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:18.538Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:18.538Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:18.538Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157251258582750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "502", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3e97c09 "/127.0.0.1:3230<->/127.0.0.1:58104"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251258582750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3e97c09 /127.0.0.1:3230<->/127.0.0.1:58104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157251258582750,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"416b4561-12c1-45c5-a449-253e8f577996","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:18.553Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"416b4561-12c1-45c5-a449-253e8f577996\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"13e4e803-d39e-4d8a-93e7-115b1b27085f\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:18.553Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"416b4561-12c1-45c5-a449-253e8f577996\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"13e4e803-d39e-4d8a-93e7-115b1b27085f\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251303331083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2c9521d5 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:18.584Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:18.587Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}
2023-12-08T08:48:18.592Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T08:48:18.592Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:id ["2f906f7c-76a3-4f4a-a065-37d540e52220"]}
2023-12-08T08:48:18.592Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157251303331083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "5678", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2c9521d5 "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestForEdit", :variables {:id ["2f906f7c-76a3-4f4a-a065-37d540e52220"]}, :query "query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:18.599Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:18.599Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:18.599Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:18.599Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:18.599Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251303331083, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2c9521d5 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157251303331083,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"5678","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5678,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestForEdit","variables":{"id":["2f906f7c-76a3-4f4a-a065-37d540e52220"]},"query":"query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:requests [#ordered/map ([:id 2f906f7c-76a3-4f4a-a065-37d540e52220] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:main_category #ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value Hans Heiri] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 6f62bca0-ec72-4349-8eeb-648a128b6d99] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value 12345] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 40fbc607-96a7-4162-899d-e2e0ad7dc131] [:name Room R] [:building #ordered/map ([:id 5f4efd47-e9a7-4c56-be7c-009628dd228b] [:name Building B] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value And why not] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:categories [#ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:name Budget-Period-BP] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:18.635Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:building #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:18.635Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 50000] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 10] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value false] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :HIGH] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "40fbc607-96a7-4162-899d-e2e0ad7dc131"] [:name "Room R"] [:building #ordered/map ([:id "5f4efd47-e9a7-4c56-be7c-009628dd228b"] [:name "Building B"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251992442750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8288cab /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId e5847638-e5c1-4ffc-93a1-186c4b389ed1}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:19.270Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:19.272Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:buildingId e5847638-e5c1-4ffc-93a1-186c4b389ed1}
2023-12-08T08:48:19.273Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}

2023-12-08T08:48:19.273Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:buildingId "e5847638-e5c1-4ffc-93a1-186c4b389ed1"}
2023-12-08T08:48:19.273Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157251992442750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "257", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8288cab "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getRoomsByBuilding", :variables {:buildingId "e5847638-e5c1-4ffc-93a1-186c4b389ed1"}, :query "query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157251992442750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8288cab /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId e5847638-e5c1-4ffc-93a1-186c4b389ed1}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157251992442750,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"257","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":257,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getRoomsByBuilding","variables":{"buildingId":"e5847638-e5c1-4ffc-93a1-186c4b389ed1"},"query":"query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:rooms [#ordered/map ([:id 1ab2ca1b-e37e-4ec3-876e-00a8c5d6afa3] [:name general room] [:description nil] [:__typename :Room]) #ordered/map ([:id 677cd0af-a224-48bc-b30b-205f59a45eba] [:name Room R X] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:19.275Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "1ab2ca1b-e37e-4ec3-876e-00a8c5d6afa3"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "677cd0af-a224-48bc-b30b-205f59a45eba"] [:name "Room R X"] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:19.275Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:rooms [#ordered/map ([:id "1ab2ca1b-e37e-4ec3-876e-00a8c5d6afa3"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "677cd0af-a224-48bc-b30b-205f59a45eba"] [:name "Room R X"] [:description nil] [:__typename :Room])]])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253271022791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1027ff93 HikariProxyConnection@271056787 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5613, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6182dcc4 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x334441c5 HikariProxyConnection@860111301 wrapping org.postgresql.jdbc.PgConnection@6c361fbd], :level 1, :rollback #object[clojure.lang.Atom 0x4342becf {:status :ready, :val false}]}, :content-length 5613, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName updateRequest, :variables {:requestData {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :attachments [], :supplier_name Supplier S, :requested_quantity 99, :priority NORMAL, :id 2f906f7c-76a3-4f4a-a065-37d540e52220, :room 677cd0af-a224-48bc-b30b-205f59a45eba, :receiver Hans Heiri X}}, :query mutation updateRequest($requestData: RequestInput) {
  request(input_data: $requestData) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x334441c5 HikariProxyConnection@860111301 wrapping org.postgresql.jdbc.PgConnection@6c361fbd], :level 1, :rollback #object[clojure.lang.Atom 0x4342becf {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:20.551Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:20.554Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:requestData {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :attachments [], :supplier_name Supplier S, :requested_quantity 99, :priority NORMAL, :id 2f906f7c-76a3-4f4a-a065-37d540e52220, :room 677cd0af-a224-48bc-b30b-205f59a45eba, :receiver Hans Heiri X}}
2023-12-08T08:48:20.558Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => mutation updateRequest($requestData: RequestInput) {
  request(input_data: $requestData) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T08:48:20.558Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:requestData {:motivation "And why not X", :article_number "12345 X", :price_cents 99900, :article_name "Camera X", :replacement true, :attachments [], :supplier_name "Supplier S", :requested_quantity "99", :priority "NORMAL", :id "2f906f7c-76a3-4f4a-a065-37d540e52220", :room "677cd0af-a224-48bc-b30b-205f59a45eba", :receiver "Hans Heiri X"}}
2023-12-08T08:48:20.558Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157253271022791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1027ff93 "HikariProxyConnection@271056787 wrapping org.postgresql.jdbc.PgConnection@5b0d8269"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "5613", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6182dcc4 "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x334441c5 "HikariProxyConnection@860111301 wrapping org.postgresql.jdbc.PgConnection@6c361fbd"], :level 2, :rollback #object[clojure.lang.Atom 0x4342becf {:status :ready, :val false}]}, :content-length 5613, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "updateRequest", :variables {:requestData {:motivation "And why not X", :article_number "12345 X", :price_cents 99900, :article_name "Camera X", :replacement true, :attachments [], :supplier_name "Supplier S", :requested_quantity "99", :priority "NORMAL", :id "2f906f7c-76a3-4f4a-a065-37d540e52220", :room "677cd0af-a224-48bc-b30b-205f59a45eba", :receiver "Hans Heiri X"}}, :query "mutation updateRequest($requestData: RequestInput) {\n  request(input_data: $requestData) {\n    ...RequestFieldsForEdit\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:20.567Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:20.567Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:20.567Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:20.568Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:20.568Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:20.621Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:20.621Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:20.621Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:20.621Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id 2f906f7c-76a3-4f4a-a065-37d540e52220]}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:20.622Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id "2f906f7c-76a3-4f4a-a065-37d540e52220"]}
>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253271022791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1027ff93 HikariProxyConnection@271056787 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5613, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6182dcc4 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x334441c5 HikariProxyConnection@860111301 wrapping org.postgresql.jdbc.PgConnection@6c361fbd], :level 2, :rollback #object[clojure.lang.Atom 0x4342becf {:status :ready, :val false}]}, :content-length 5613, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName updateRequest, :variables {:requestData {:motivation And why not X, :article_number 12345 X, :price_cents 99900, :article_name Camera X, :replacement true, :attachments [], :supplier_name Supplier S, :requested_quantity 99, :priority NORMAL, :id 2f906f7c-76a3-4f4a-a065-37d540e52220, :room 677cd0af-a224-48bc-b30b-205f59a45eba, :receiver Hans Heiri X}}, :query mutation updateRequest($requestData: RequestInput) {
  request(input_data: $requestData) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157253271022791,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"5613","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5613,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"updateRequest","variables":{"requestData":{"motivation":"And why not X","article_number":"12345 X","price_cents":99900,"article_name":"Camera X","replacement":true,"attachments":[],"supplier_name":"Supplier S","requested_quantity":"99","priority":"NORMAL","id":"2f906f7c-76a3-4f4a-a065-37d540e52220","room":"677cd0af-a224-48bc-b30b-205f59a45eba","receiver":"Hans Heiri X"}},"query":"mutation updateRequest($requestData: RequestInput) {\n  request(input_data: $requestData) {\n    ...RequestFieldsForEdit\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query mutation updateRequest($requestData: RequestInput) {
  request(input_data: $requestData) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:request #ordered/map ([:id 2f906f7c-76a3-4f4a-a065-37d540e52220] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:main_category #ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera X] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value Hans Heiri X] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 6f62bca0-ec72-4349-8eeb-648a128b6d99] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value 12345 X] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value Supplier S] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 677cd0af-a224-48bc-b30b-205f59a45eba] [:name Room R X] [:building #ordered/map ([:id e5847638-e5c1-4ffc-93a1-186c4b389ed1] [:name Building B X] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value And why not X] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
2023-12-08T08:48:20.648Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:request #ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345 X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "677cd0af-a224-48bc-b30b-205f59a45eba"] [:name "Room R X"] [:building #ordered/map ([:id "e5847638-e5c1-4ffc-93a1-186c4b389ed1"] [:name "Building B X"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
2023-12-08T08:48:20.648Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:request #ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345 X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "677cd0af-a224-48bc-b30b-205f59a45eba"] [:name "Room R X"] [:building #ordered/map ([:id "e5847638-e5c1-4ffc-93a1-186c4b389ed1"] [:name "Building B X"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253412713708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 1228, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3824c1dc /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 1228, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:search nil, :budgetPeriods [bc14a636-b51c-4458-8928-dfff9f5b9c47], :categories [326da6e2-ef0e-491c-8184-35ce21fcb4da], :organizations [6f62bca0-ec72-4349-8eeb-648a128b6d99], :onlyOwnRequests false, :priority [NORMAL HIGH], :inspector_priority [LOW MEDIUM HIGH MANDATORY], :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    budget_periods {
      cacheKey
      total_price_cents
      main_categories {
        cacheKey
        total_price_cents
        categories {
          cacheKey
          total_price_cents
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:20.692Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253414134291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x634f4f /127.0.0.1:3230<->/127.0.0.1:58118], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
2023-12-08T08:48:20.695Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:20.697Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil

>>>exec-query::variables {:search nil, :budgetPeriods [bc14a636-b51c-4458-8928-dfff9f5b9c47], :categories [326da6e2-ef0e-491c-8184-35ce21fcb4da], :organizations [6f62bca0-ec72-4349-8eeb-648a128b6d99], :onlyOwnRequests false, :priority [NORMAL HIGH], :inspector_priority [LOW MEDIUM HIGH MANDATORY], :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED]}
2023-12-08T08:48:20.698Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    budget_periods {
      cacheKey
      total_price_cents
      main_categories {
        cacheKey
        total_price_cents
        categories {
          cacheKey
          total_price_cents
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

2023-12-08T08:48:20.698Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:search nil, :budgetPeriods ["bc14a636-b51c-4458-8928-dfff9f5b9c47"], :categories ["326da6e2-ef0e-491c-8184-35ce21fcb4da"], :organizations ["6f62bca0-ec72-4349-8eeb-648a128b6d99"], :onlyOwnRequests false, :priority ["NORMAL" "HIGH"], :inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"]}
2023-12-08T08:48:20.698Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157253412713708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "1228", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3824c1dc "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 1228, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:search nil, :budgetPeriods ["bc14a636-b51c-4458-8928-dfff9f5b9c47"], :categories ["326da6e2-ef0e-491c-8184-35ce21fcb4da"], :organizations ["6f62bca0-ec72-4349-8eeb-648a128b6d99"], :onlyOwnRequests false, :priority ["NORMAL" "HIGH"], :inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    budget_periods {\n      cacheKey\n      total_price_cents\n      main_categories {\n        cacheKey\n        total_price_cents\n        categories {\n          cacheKey\n          total_price_cents\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-12-08T08:48:20.698Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>>>get-dashboard
>>args {:budget_period_id [bc14a636-b51c-4458-8928-dfff9f5b9c47], :category_id [326da6e2-ef0e-491c-8184-35ce21fcb4da], :search nil, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :organization_id [6f62bca0-ec72-4349-8eeb-648a128b6d99], :priority [:NORMAL :HIGH], :inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :requested_by_auth_user false}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats ({:id #uuid "ca399b0a-8a02-486c-8d27-471ffc4bd4a3", :name Colombia})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC bc14a636-b51c-4458-8928-dfff9f5b9c47]
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"})
>>resultA1-2 ({:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"})
>>requestsB2-triggerError {:budget_period_id [bc14a636-b51c-4458-8928-dfff9f5b9c47], :category_id [326da6e2-ef0e-491c-8184-35ce21fcb4da], :search nil, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :organization_id [6f62bca0-ec72-4349-8eeb-648a128b6d99], :priority [:NORMAL :HIGH], :inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :requested_by_auth_user false} nil

>>>exec-query::variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}
2023-12-08T08:48:20.704Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T08:48:20.704Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:id ["2f906f7c-76a3-4f4a-a065-37d540e52220"]}
2023-12-08T08:48:20.704Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157253414134291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "5678", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x634f4f "/127.0.0.1:3230<->/127.0.0.1:58118"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestForEdit", :variables {:id ["2f906f7c-76a3-4f4a-a065-37d540e52220"]}, :query "query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:20.706Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:20.707Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:20.707Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:20.707Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:20.707Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:20.712Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:20.713Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:20.713Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:20.719Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:20.720Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>>requestsB2 (>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
{:category {:read true, :write true, :default {:id #uuid "326da6e2-ef0e-491c-8184-35ce21fcb4da", :name Category C, :main_category_id #uuid "ca399b0a-8a02-486c-8d27-471ffc4bd4a3", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 326da6e2-ef0e-491c-8184-35ce21fcb4da, :name Category C, :cost_center nil, :main_category {:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3, :name Colombia}, :main_category_id ca399b0a-8a02-486c-8d27-471ffc4bd4a3, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :motivation {:read true, :write true, :required true, :value And why not X, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value 12345 X, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :price_cents {:read true, :write true, :default 0, :required true, :value 99900, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :budget_period {:read true, :write true, :default {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}, :required true, :value {:id bc14a636-b51c-4458-8928-dfff9f5b9c47, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:48:16.545986, :updated_at 2023-12-08T09:48:16.545986, :is_past false}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :article_name {:read true, :write true, :default nil, :required true, :value Camera X, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :state :NEW, :organization {:value {:id 6f62bca0-ec72-4349-8eeb-648a128b6d99, :name Baby, Toys & Computers, :parent_id f435f94a-f0eb-4aa8-ba60-b143d3d0f224, :shortname nil, :department {:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :supplier_name {:read true, :write true, :default nil, :required false, :value Supplier S, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_status {:read true, :write false, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :requested_quantity {:read true, :write true, :required true, :value 99, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :updated_at {:value #time/instant "2023-12-08T08:48:16.608176Z", :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220", :total_price_cents 9890100, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 677cd0af-a224-48bc-b30b-205f59a45eba, :name Room R X, :general false, :building {:id e5847638-e5c1-4ffc-93a1-186c4b389ed1, :code nil, :name Building B X}, :building_id e5847638-e5c1-4ffc-93a1-186c4b389ed1, :description nil}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :user {:read true, :write false, :required true, :default {:id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:48:17.014415+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:48:17.014415+01:00, :firstname Krysta, :zip nil, :id 13e4e803-d39e-4d8a-93e7-115b1b27085f, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:48:16.556333+01:00, :admin_protected false}, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :receiver {:read true, :write true, :required false, :value Hans Heiri X, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :created_at {:value #time/instant "2023-12-08T08:48:16.608176Z", :read false, :write false, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "2f906f7c-76a3-4f4a-a065-37d540e52220"}})
>>dashboard-cache-keyB2 {:id 138755835}
>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253412713708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 1228, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3824c1dc /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 1228, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:search nil, :budgetPeriods [bc14a636-b51c-4458-8928-dfff9f5b9c47], :categories [326da6e2-ef0e-491c-8184-35ce21fcb4da], :organizations [6f62bca0-ec72-4349-8eeb-648a128b6d99], :onlyOwnRequests false, :priority [NORMAL HIGH], :inspector_priority [LOW MEDIUM HIGH MANDATORY], :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    budget_periods {
      cacheKey
      total_price_cents
      main_categories {
        cacheKey
        total_price_cents
        categories {
          cacheKey
          total_price_cents
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
>o> past? result= false

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157253412713708,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"1228","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":1228,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"search":null,"budgetPeriods":["bc14a636-b51c-4458-8928-dfff9f5b9c47"],"categories":["326da6e2-ef0e-491c-8184-35ce21fcb4da"],"organizations":["6f62bca0-ec72-4349-8eeb-648a128b6d99"],"onlyOwnRequests":false,"priority":["NORMAL","HIGH"],"inspector_priority":["LOW","MEDIUM","HIGH","MANDATORY"],"state":["NEW","IN_APPROVAL","APPROVED","PARTIALLY_APPROVED","DENIED"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    budget_periods {\n      cacheKey\n      total_price_cents\n      main_categories {\n        cacheKey\n        total_price_cents\n        categories {\n          cacheKey\n          total_price_cents\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> request
>request-c-grapql _> query  query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    budget_periods {
      cacheKey
      total_price_cents
      main_categories {
        cacheKey
        total_price_cents
        categories {
          cacheKey
          total_price_cents
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}


>request-grapql _> result => {{:data :leihs-user-language #ordered/map {:name English (UK), :locale en-GB, :default (true, :active true}, :authenticated-entity [{:email lynsey_kertzmann@klein-wehner.org, :dashboard :contracts_count #ordered/map ([:cacheKey 138755835] 0, [:lastname Pfeffer, :budget_periods :org_id [nil, #ordered/map :scope_read true, (:is_admin false, [:authentication-method :cacheKey :session, 138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47]:login  nil, :scope_system_admin_write [false, :scope_write true, :firstname :total_price_cents Krysta, 9890100] :scope_admin_write false[, :main_categories :user_session_created_at [#ordered/map ([:cacheKey 138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:total_price_cents 9890100] [:categories [#ordered/map ([:cacheKey 138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da] [:total_price_cents 9890100] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
#time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253414134291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x634f4f /127.0.0.1:3230<->/127.0.0.1:58118], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-08T08:48:20.753Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "138755835"] [:budget_periods [#ordered/map ([:cacheKey "138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:total_price_cents "9890100"] [:main_categories [#ordered/map ([:cacheKey "138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:total_price_cents "9890100"] [:categories [#ordered/map ([:cacheKey "138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:total_price_cents "9890100"] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157253414134291,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"5678","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5678,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestForEdit","variables":{"id":["2f906f7c-76a3-4f4a-a065-37d540e52220"]},"query":"query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}
2023-12-08T08:48:20.771Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "138755835"] [:budget_periods [#ordered/map ([:cacheKey "138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:total_price_cents "9890100"] [:main_categories [#ordered/map ([:cacheKey "138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:total_price_cents "9890100"] [:categories [#ordered/map ([:cacheKey "138755835_bc14a636-b51c-4458-8928-dfff9f5b9c47_ca399b0a-8a02-486c-8d27-471ffc4bd4a3_326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:total_price_cents "9890100"] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}

>request-c-grapql _> query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:requests [#ordered/map ([:id 2f906f7c-76a3-4f4a-a065-37d540e52220] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:main_category #ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera X] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value Hans Heiri X] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 6f62bca0-ec72-4349-8eeb-648a128b6d99] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value 12345 X] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value Supplier S] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 677cd0af-a224-48bc-b30b-205f59a45eba] [:name Room R X] [:building #ordered/map ([:id e5847638-e5c1-4ffc-93a1-186c4b389ed1] [:name Building B X] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value And why not X] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:categories [#ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:name Budget-Period-BP] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:20.792Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345 X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "677cd0af-a224-48bc-b30b-205f59a45eba"] [:name "Room R X"] [:building #ordered/map ([:id "e5847638-e5c1-4ffc-93a1-186c4b389ed1"] [:name "Building B X"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:20.792Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345 X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "677cd0af-a224-48bc-b30b-205f59a45eba"] [:name "Room R X"] [:building #ordered/map ([:id "e5847638-e5c1-4ffc-93a1-186c4b389ed1"] [:name "Building B X"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253567345625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4107902 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:20.844Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:20.846Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:20.847Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:20.847Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:20.847Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157253567345625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "502", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4107902 "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253567345625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4107902 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157253567345625,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"416b4561-12c1-45c5-a449-253e8f577996","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:20.857Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"416b4561-12c1-45c5-a449-253e8f577996\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"13e4e803-d39e-4d8a-93e7-115b1b27085f\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:20.858Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"416b4561-12c1-45c5-a449-253e8f577996\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"13e4e803-d39e-4d8a-93e7-115b1b27085f\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253601223791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68f2a8a5 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:20.880Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:20.882Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}
2023-12-08T08:48:20.886Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T08:48:20.886Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:id ["2f906f7c-76a3-4f4a-a065-37d540e52220"]}
2023-12-08T08:48:20.886Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "416b4561-12c1-45c5-a449-253e8f577996"}, "leihs-user-session" {:value "134241df-830f-462b-a543-a2aa0705e6bc"}}, :remote-addr "127.0.0.1", :start-time 157253601223791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc", "content-length" "5678", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "416b4561-12c1-45c5-a449-253e8f577996", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68f2a8a5 "/127.0.0.1:3230<->/127.0.0.1:58109"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestForEdit", :variables {:id ["2f906f7c-76a3-4f4a-a065-37d540e52220"]}, :query "query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:20.892Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:20.892Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:20.892Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:20.893Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:20.893Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>oo> past? budget-period= {:id #uuid "bc14a636-b51c-4458-8928-dfff9f5b9c47", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:16.545986Z", :updated_at #time/instant "2023-12-08T08:48:16.545986Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:17.014415Z", :id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :user_session_id #uuid "cd516ad5-fdb3-4215-96db-cebdbf1e1cd4", :scope_system_admin_read false, :access-rights (), :user_id #uuid "13e4e803-d39e-4d8a-93e7-115b1b27085f", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 416b4561-12c1-45c5-a449-253e8f577996}, leihs-user-session {:value 134241df-830f-462b-a543-a2aa0705e6bc}}, :remote-addr 127.0.0.1, :start-time 157253601223791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 416b4561-12c1-45c5-a449-253e8f577996, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68f2a8a5 /127.0.0.1:3230<->/127.0.0.1:58109], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [2f906f7c-76a3-4f4a-a065-37d540e52220]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:17.014415Z","id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","user_session_id":"cd516ad5-fdb3-4215-96db-cebdbf1e1cd4","scope_system_admin_read":false,"access-rights":[],"user_id":"13e4e803-d39e-4d8a-93e7-115b1b27085f","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"416b4561-12c1-45c5-a449-253e8f577996"},"leihs-user-session":{"value":"134241df-830f-462b-a543-a2aa0705e6bc"}},"remote-addr":"127.0.0.1","start-time":157253601223791,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=416b4561-12c1-45c5-a449-253e8f577996; leihs-user-session=134241df-830f-462b-a543-a2aa0705e6bc","content-length":"5678","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"416b4561-12c1-45c5-a449-253e8f577996","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5678,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestForEdit","variables":{"id":["2f906f7c-76a3-4f4a-a065-37d540e52220"]},"query":"query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:requests [#ordered/map ([:id 2f906f7c-76a3-4f4a-a065-37d540e52220] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 13e4e803-d39e-4d8a-93e7-115b1b27085f] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:main_category #ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Camera X] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value Hans Heiri X] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 6f62bca0-ec72-4349-8eeb-648a128b6d99] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id f435f94a-f0eb-4aa8-ba60-b143d3d0f224] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value 12345 X] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value Supplier S] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 677cd0af-a224-48bc-b30b-205f59a45eba] [:name Room R X] [:building #ordered/map ([:id e5847638-e5c1-4ffc-93a1-186c4b389ed1] [:name Building B X] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value And why not X] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id ca399b0a-8a02-486c-8d27-471ffc4bd4a3] [:name Colombia] [:categories [#ordered/map ([:id 326da6e2-ef0e-491c-8184-35ce21fcb4da] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id bc14a636-b51c-4458-8928-dfff9f5b9c47] [:name Budget-Period-BP] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:20.923Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345 X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "677cd0af-a224-48bc-b30b-205f59a45eba"] [:name "Room R X"] [:building #ordered/map ([:id "e5847638-e5c1-4ffc-93a1-186c4b389ed1"] [:name "Building B X"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:20.929Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:requests [#ordered/map ([:id "2f906f7c-76a3-4f4a-a065-37d540e52220"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "13e4e803-d39e-4d8a-93e7-115b1b27085f"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:main_category #ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Camera X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value "Hans Heiri X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "6f62bca0-ec72-4349-8eeb-648a128b6d99"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "f435f94a-f0eb-4aa8-ba60-b143d3d0f224"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 99900] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 99] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "12345 X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value "Supplier S"] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "677cd0af-a224-48bc-b30b-205f59a45eba"] [:name "Room R X"] [:building #ordered/map ([:id "e5847638-e5c1-4ffc-93a1-186c4b389ed1"] [:name "Building B X"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "And why not X"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "ca399b0a-8a02-486c-8d27-471ffc4bd4a3"] [:name "Colombia"] [:categories [#ordered/map ([:id "326da6e2-ef0e-491c-8184-35ce21fcb4da"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "bc14a636-b51c-4458-8928-dfff9f5b9c47"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {}, :remote-addr 127.0.0.1, :start-time 157258485245500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, sec-fetch-user ?1, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5eb8131 /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:25.794Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:25.848Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\"><div><button type=\"submit\">Continue</button></div></form></body></html>", :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", :http-only false, :path "/", :secure false}}}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity nil
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}}, :remote-addr 127.0.0.1, :start-time 157258642212958, :params {:return-to /favicon.ico}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {:return-to /favicon.ico}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4, referer http://localhost:3230/sign-in, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5a6686b4 /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {:return-to /favicon.ico}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /favicon.ico}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Ffavicon.ico, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:25.918Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:25.926Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\"><input name=\"return-to\" type=\"hidden\" value=\"/favicon.ico\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}}, :remote-addr 127.0.0.1, :start-time 157258760096000, :params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2106027f HikariProxyConnection@554041983 wrapping org.postgresql.jdbc.PgConnection@5b0d8269], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4, content-length 98, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x28e4c537 /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5bbb9291 HikariProxyConnection@1539019409 wrapping org.postgresql.jdbc.PgConnection@6c361fbd], :level 1, :rollback #object[clojure.lang.Atom 0x6dc67b7f {:status :ready, :val false}]}, :content-length 98, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password nil, :csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password , :csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x7c429942 BytesInputStream[len=98]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5bbb9291 HikariProxyConnection@1539019409 wrapping org.postgresql.jdbc.PgConnection@6c361fbd], :level 1, :rollback #object[clojure.lang.Atom 0x6dc67b7f {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:26.034Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:26.043Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 200, :headers {"Content-Type" "text/html; charset=utf-8"}, :body "<!DOCTYPE html>\n<html><head><style>body { font-family: sans-serif; width: 400px; margin: 2rem auto; text-align: center; }\n             * { margin: 0.5rem; }\n             input { width: 15rem; }\n             .message { background-color: pink; padding: 1rem; }</style></head><body><h1>Leihs Simple Login</h1><p>For testing only</p><form action=\"/sign-in\" class=\"ui-form-signin\" method=\"POST\"><div><label>Username<input name=\"user\" type=\"text\" value=\"lynsey_kertzmann@klein-wehner.org\"></label></div><div><label>Password<input name=\"password\" type=\"password\" value=\"\"></label></div><input name=\"csrf-token\" type=\"hidden\" value=\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\"><div><button type=\"submit\">Continue</button></div></form></body></html>"}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}}, :remote-addr 127.0.0.1, :start-time 157258850564791, :params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x244697c1 HikariProxyConnection@608606145 wrapping org.postgresql.jdbc.PgConnection@3c11573a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/x-www-form-urlencoded, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4, content-length 106, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2055a053 /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x66a12d63 HikariProxyConnection@1721838947 wrapping org.postgresql.jdbc.PgConnection@6c361fbd], :level 1, :rollback #object[clojure.lang.Atom 0x764946e9 {:status :ready, :val false}]}, :content-length 106, :form-params {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user lynsey_kertzmann@klein-wehner.org, :password password, :csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x4057679d BytesInputStream[len=106]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x1c5b15a0 compojure.core$routes$fn__27950@1c5b15a0], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? nil
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x66a12d63 HikariProxyConnection@1721838947 wrapping org.postgresql.jdbc.PgConnection@6c361fbd], :level 1, :rollback #object[clojure.lang.Atom 0x764946e9 {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester false
2023-12-08T08:48:26.121Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-12-08T08:48:26.161Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body "", :cookies {"leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82", :http-only true, :max-age 307584000, :path "/", :secure false}, "leihs-user-locale" {:value nil, :path "/", :max-age 0}}}
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157258901270458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, sec-fetch-user ?1, referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x47f5b48c /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0xa418c5e leihs.procurement.backend.html$not_found_handler@a418c5e], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:26.209Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:26.211Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:26.213Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 07 Dec 2023 20:08:40 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x1de175e0 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259140192000, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, referer http://localhost:3230/procure, connection keep-alive, accept image/avif,image/webp,*/*, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest image, accept-encoding gzip, deflate, br, sec-fetch-mode no-cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5fd9e227 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/favicon.ico, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0xa418c5e leihs.procurement.backend.html$not_found_handler@a418c5e], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:26.417Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259145088208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8a01976 /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
2023-12-08T08:48:26.418Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:26.420Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:26.419Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Thu, 07 Dec 2023 20:08:40 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x92672d7 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
2023-12-08T08:48:26.421Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:26.423Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:26.423Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:26.423Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157259145088208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "502", "referer" "http://localhost:3230/procure", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8a01976 "/127.0.0.1:3230<->/127.0.0.1:58176"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259145088208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 502, referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8a01976 /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157259145088208,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"502","referer":"http:\/\/localhost:3230\/procure","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8405b014-df04-4d73-8986-dea4b8b2026e","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8405b014-df04-4d73-8986-dea4b8b2026e] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:26.466Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8405b014-df04-4d73-8986-dea4b8b2026e\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:26.466Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8405b014-df04-4d73-8986-dea4b8b2026e\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259296866375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3759453e /127.0.0.1:3230<->/127.0.0.1:58189], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259296017458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x66cb681a /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  admin false
>myprint>  inspector false
>myprint>  inspector false
>myprint>  viewer false
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259296406416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6f7a8ee6 /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:26.577Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>myprint>  admin >myprint>  requester false
true
2023-12-08T08:48:26.577Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:26.580Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:26.580Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:26.582Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:26.583Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:26.584Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:26.584Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157259296866375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "502", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3759453e "/127.0.0.1:3230<->/127.0.0.1:58189"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-12-08T08:48:26.584Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}

>>>exec-query::variables {}
2023-12-08T08:48:26.591Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}

2023-12-08T08:48:26.591Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T08:48:26.597Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:26.597Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:26.597Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157259296406416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "534", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6f7a8ee6 "/127.0.0.1:3230<->/127.0.0.1:58176"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestFilters", :variables {}, :query "query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-12-08T08:48:26.597Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157259296017458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "3575", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x66cb681a "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>>get-dashboard
>>args {}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259296866375, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3759453e /127.0.0.1:3230<->/127.0.0.1:58189], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157259296866375,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8405b014-df04-4d73-8986-dea4b8b2026e","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8405b014-df04-4d73-8986-dea4b8b2026e] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:26.605Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8405b014-df04-4d73-8986-dea4b8b2026e\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:26.605Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8405b014-df04-4d73-8986-dea4b8b2026e\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>ToCheck mainCats ({:id #uuid "b436ad1e-395a-4e22-8482-ab086b23e017", :name Colombia})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  ORDER BY end_date DESC]
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"})
>>resultA1-2 ({:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"})
>>requestsB2-triggerError {} nil
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:26.614Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:26.614Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:26.615Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:26.615Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:26.615Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259296406416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6f7a8ee6 /127.0.0.1:3230<->/127.0.0.1:58176], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157259296406416,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"534","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":534,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestFilters","variables":{},"query":"query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:categories [#ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id 43e2a8bd-6570-4a3b-8421-700c592863e9] [:name Toys, Kids & Baby] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 265d6fb8-2bc5-4edf-a2c8-219c84a0619e] [:name Baby, Toys & Computers] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T08:48:26.623Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T08:48:26.624Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}}
>>requestsB2 (>oo> past? budget-period= {:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
{:category {:read true, :write true, :default {:id #uuid "dff229ca-eafa-497e-8251-a11912bcf1f7", :name Category C, :main_category_id #uuid "b436ad1e-395a-4e22-8482-ab086b23e017", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id dff229ca-eafa-497e-8251-a11912bcf1f7, :name Category C, :cost_center nil, :main_category {:id b436ad1e-395a-4e22-8482-ab086b23e017, :name Colombia}, :main_category_id b436ad1e-395a-4e22-8482-ab086b23e017, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :budget_period {:read true, :write true, :default {:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"}, :required true, :value {:id acf7a2f9-807d-418b-b48d-f5073d5988c5, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:48:25.669616, :updated_at 2023-12-08T09:48:25.669616, :is_past false}, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :state :NEW, :organization {:value {:id 265d6fb8-2bc5-4edf-a2c8-219c84a0619e, :name Baby, Toys & Computers, :parent_id 43e2a8bd-6570-4a3b-8421-700c592863e9, :shortname nil, :department {:id 43e2a8bd-6570-4a3b-8421-700c592863e9, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :order_status {:read true, :write false, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :updated_at {:value #time/instant "2023-12-08T08:48:25.716248Z", :read false, :write false, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 44402360-ad23-4b0e-b261-6875a1512172, :name conservatory, :general false, :building {:id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7, :code nil, :name 3605 Nanci Heights}, :building_id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7, :description nil}, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :user {:read true, :write false, :required true, :default {:id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:48:26.120356+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:48:26.120356+01:00, :firstname Krysta, :zip nil, :id 8405b014-df04-4d73-8986-dea4b8b2026e, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:48:25.678545+01:00, :admin_protected false}, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :created_at {:value #time/instant "2023-12-08T08:48:25.716248Z", :read false, :write false, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}})
>>dashboard-cache-keyB2 {:id -15128758}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259296017458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 3575, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x66cb681a /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 3575, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157259296017458,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"3575","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":3575,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey -15128758] [:total_count 1] [:budget_periods [#ordered/map ([:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:cacheKey -15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:cacheKey -15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:cacheKey -15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:total_price_cents 0] [:requests [#ordered/map ([:id eb42f2b2-a188-48e1-91d3-db302c493d66] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 8405b014-df04-4d73-8986-dea4b8b2026e] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:main_category #ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id 265d6fb8-2bc5-4edf-a2c8-219c84a0619e] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id 43e2a8bd-6570-4a3b-8421-700c592863e9] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id 44402360-ad23-4b0e-b261-6875a1512172] [:name conservatory] [:building #ordered/map ([:id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7] [:name 3605 Nanci Heights] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value Consectetur asperiores quis expedita.] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents 0] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:26.658Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 1] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:cacheKey "-15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:cacheKey "-15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:cacheKey "-15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:total_price_cents "0"] [:requests [#ordered/map ([:id "eb42f2b2-a188-48e1-91d3-db302c493d66"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:main_category #ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:building #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "0"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:26.659Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "-15128758"] [:total_count 1] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:cacheKey "-15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:cacheKey "-15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:cacheKey "-15128758_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:total_price_cents "0"] [:requests [#ordered/map ([:id "eb42f2b2-a188-48e1-91d3-db302c493d66"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:main_category #ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:building #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "0"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259442657791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x17065de0 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :categories [dff229ca-eafa-497e-8251-a11912bcf1f7], :priority [NORMAL HIGH], :budgetPeriods [acf7a2f9-807d-418b-b48d-f5073d5988c5]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:26.724Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:26.726Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :categories [dff229ca-eafa-497e-8251-a11912bcf1f7], :priority [NORMAL HIGH], :budgetPeriods [acf7a2f9-807d-418b-b48d-f5073d5988c5]}
2023-12-08T08:48:26.729Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T08:48:26.729Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["265d6fb8-2bc5-4edf-a2c8-219c84a0619e"], :categories ["dff229ca-eafa-497e-8251-a11912bcf1f7"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["acf7a2f9-807d-418b-b48d-f5073d5988c5"]}
2023-12-08T08:48:26.729Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157259442657791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "4033", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x17065de0 "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["265d6fb8-2bc5-4edf-a2c8-219c84a0619e"], :categories ["dff229ca-eafa-497e-8251-a11912bcf1f7"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["acf7a2f9-807d-418b-b48d-f5073d5988c5"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [acf7a2f9-807d-418b-b48d-f5073d5988c5], :category_id [dff229ca-eafa-497e-8251-a11912bcf1f7]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats ({:id #uuid "b436ad1e-395a-4e22-8482-ab086b23e017", :name Colombia})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC acf7a2f9-807d-418b-b48d-f5073d5988c5]
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"})
>>resultA1-2 ({:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"})
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [acf7a2f9-807d-418b-b48d-f5073d5988c5], :category_id [dff229ca-eafa-497e-8251-a11912bcf1f7]} nil
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:26.735Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:26.735Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:26.735Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:26.736Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:26.736Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>>requestsB2 (>oo> past? budget-period= {:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false
{:category {:read true, :write true, :default {:id #uuid "dff229ca-eafa-497e-8251-a11912bcf1f7", :name Category C, :main_category_id #uuid "b436ad1e-395a-4e22-8482-ab086b23e017", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id dff229ca-eafa-497e-8251-a11912bcf1f7, :name Category C, :cost_center nil, :main_category {:id b436ad1e-395a-4e22-8482-ab086b23e017, :name Colombia}, :main_category_id b436ad1e-395a-4e22-8482-ab086b23e017, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :supplier {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :motivation {:read true, :write true, :required true, :value Consectetur asperiores quis expedita., :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :accounting_type {:read false, :write false, :default aquisition, :required true, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :actionPermissions {:edit true, :delete true, :moveBudgetPeriod true, :moveCategory true}, :article_number {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :inspector_priority {:read false, :write false, :default MEDIUM, :required true, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :price_cents {:read true, :write true, :default 0, :required true, :value 0, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :budget_period {:read true, :write true, :default {:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"}, :required true, :value {:id acf7a2f9-807d-418b-b48d-f5073d5988c5, :name Budget-Period-BP, :inspection_start_date 2024-02-08T00:00:00+01:00, :end_date 2024-03-08T00:00:00+01:00, :created_at 2023-12-08T09:48:25.669616, :updated_at 2023-12-08T09:48:25.669616, :is_past false}, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :article_name {:read true, :write true, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :replacement {:read true, :write true, :default nil, :required true, :value true, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :attachments {:read true, :write true, :required false, :value :unqueried, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :DELETE true, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :state :NEW, :organization {:value {:id 265d6fb8-2bc5-4edf-a2c8-219c84a0619e, :name Baby, Toys & Computers, :parent_id 43e2a8bd-6570-4a3b-8421-700c592863e9, :shortname nil, :department {:id 43e2a8bd-6570-4a3b-8421-700c592863e9, :name Toys, Kids & Baby, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :supplier_name {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :order_status {:read true, :write false, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :requested_quantity {:read true, :write true, :required true, :value 1, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :general_ledger_account {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :updated_at {:value #time/instant "2023-12-08T08:48:25.716248Z", :read false, :write false, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :priority {:read true, :write true, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :procurement_account {:read false, :write false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :room {:read true, :write true, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 44402360-ad23-4b0e-b261-6875a1512172, :name conservatory, :general false, :building {:id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7, :code nil, :name 3605 Nanci Heights}, :building_id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7, :description nil}, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :inspection_comment {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :approved_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :order_quantity {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :cost_center {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :user {:read true, :write false, :required true, :default {:id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :firstname Krysta, :lastname Pfeffer}, :value {:system_admin_protected false, :address nil, :email lynsey_kertzmann@klein-wehner.org, :pool_protected false, :last_sign_in_at 2023-12-08T09:48:26.120356+01:00, :img32_url nil, :account_enabled true, :lastname Pfeffer, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Krysta Pfeffer lynsey_kertzmann@klein-wehner.org    Pfeffer Krysta, :updated_at 2023-12-08T09:48:26.120356+01:00, :firstname Krysta, :zip nil, :id 8405b014-df04-4d73-8986-dea4b8b2026e, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-12-08T09:48:25.678545+01:00, :admin_protected false}, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :receiver {:read true, :write true, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :internal_order_number {:read false, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :created_at {:value #time/instant "2023-12-08T08:48:25.716248Z", :read false, :write false, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :order_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}, :short_id Budget-Period-BP.001, :model {:read true, :write true, :default nil, :required false, :value nil, :request-id #uuid "eb42f2b2-a188-48e1-91d3-db302c493d66"}})
>>dashboard-cache-keyB2 {:id 402967585}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157259442657791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x17065de0 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :categories [dff229ca-eafa-497e-8251-a11912bcf1f7], :priority [NORMAL HIGH], :budgetPeriods [acf7a2f9-807d-418b-b48d-f5073d5988c5]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157259442657791,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"4033","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":4033,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"inspector_priority":["LOW","MEDIUM","HIGH","MANDATORY"],"onlyOwnRequests":false,"state":["NEW","IN_APPROVAL","APPROVED","PARTIALLY_APPROVED","DENIED"],"order_status":["NOT_PROCESSED","IN_PROGRESS","PROCURED","ALTERNATIVE_PROCURED","NOT_PROCURED"],"search":null,"organizations":["265d6fb8-2bc5-4edf-a2c8-219c84a0619e"],"categories":["dff229ca-eafa-497e-8251-a11912bcf1f7"],"priority":["NORMAL","HIGH"],"budgetPeriods":["acf7a2f9-807d-418b-b48d-f5073d5988c5"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey 402967585] [:total_count 1] [:budget_periods [#ordered/map ([:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:cacheKey 402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:cacheKey 402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:cacheKey 402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:total_price_cents 0] [:requests [#ordered/map ([:id eb42f2b2-a188-48e1-91d3-db302c493d66] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 8405b014-df04-4d73-8986-dea4b8b2026e] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:main_category #ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id 265d6fb8-2bc5-4edf-a2c8-219c84a0619e] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id 43e2a8bd-6570-4a3b-8421-700c592863e9] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id 44402360-ad23-4b0e-b261-6875a1512172] [:name conservatory] [:building #ordered/map ([:id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7] [:name 3605 Nanci Heights] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value Consectetur asperiores quis expedita.] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents 0] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:26.780Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "402967585"] [:total_count 1] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:total_price_cents "0"] [:requests [#ordered/map ([:id "eb42f2b2-a188-48e1-91d3-db302c493d66"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:main_category #ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:building #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "0"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:26.781Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "402967585"] [:total_count 1] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:total_price_cents "0"] [:requests [#ordered/map ([:id "eb42f2b2-a188-48e1-91d3-db302c493d66"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:main_category #ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:building #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "0"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260140035625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x9cbde5 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [eb42f2b2-a188-48e1-91d3-db302c493d66]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:27.420Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:27.422Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:id [eb42f2b2-a188-48e1-91d3-db302c493d66]}
2023-12-08T08:48:27.426Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T08:48:27.426Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:id ["eb42f2b2-a188-48e1-91d3-db302c493d66"]}
2023-12-08T08:48:27.426Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157260140035625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "5678", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x9cbde5 "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestForEdit", :variables {:id ["eb42f2b2-a188-48e1-91d3-db302c493d66"]}, :query "query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:27.433Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:27.433Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:27.433Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:27.433Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:27.434Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>oo> past? budget-period= {:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260140035625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x9cbde5 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [eb42f2b2-a188-48e1-91d3-db302c493d66]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157260140035625,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"5678","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5678,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestForEdit","variables":{"id":["eb42f2b2-a188-48e1-91d3-db302c493d66"]},"query":"query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:requests [#ordered/map ([:id eb42f2b2-a188-48e1-91d3-db302c493d66] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 8405b014-df04-4d73-8986-dea4b8b2026e] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:main_category #ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 265d6fb8-2bc5-4edf-a2c8-219c84a0619e] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id 43e2a8bd-6570-4a3b-8421-700c592863e9] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 44402360-ad23-4b0e-b261-6875a1512172] [:name conservatory] [:building #ordered/map ([:id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7] [:name 3605 Nanci Heights] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value Consectetur asperiores quis expedita.] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:categories [#ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:name Budget-Period-BP] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:27.463Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "eb42f2b2-a188-48e1-91d3-db302c493d66"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:main_category #ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:building #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:27.463Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:requests [#ordered/map ([:id "eb42f2b2-a188-48e1-91d3-db302c493d66"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:main_category #ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:building #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260247254625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1632ce26 /127.0.0.1:3230<->/127.0.0.1:58189], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId e7b6a95e-b33c-44f6-8c82-47ff4243d7b7}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260246911666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 137, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2d86041e /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  admin false
>myprint>  inspector false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  viewer false
>myprint>  requester true
>myprint>  requester true
2023-12-08T08:48:27.522Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:27.522Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:27.524Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-12-08T08:48:27.524Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}

>>>exec-query::variables {:buildingId e7b6a95e-b33c-44f6-8c82-47ff4243d7b7}
2023-12-08T08:48:27.525Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getBuildings {
  buildings {
    id
    name
    __typename
  }
}

2023-12-08T08:48:27.525Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}

2023-12-08T08:48:27.525Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:buildingId "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"}
2023-12-08T08:48:27.525Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:27.525Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157260246911666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "137", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2d86041e "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getBuildings", :variables {}, :query "query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-12-08T08:48:27.525Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157260247254625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "257", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1632ce26 "/127.0.0.1:3230<->/127.0.0.1:58189"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "getRoomsByBuilding", :variables {:buildingId "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"}, :query "query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260246911666, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 137, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2d86041e /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157260246911666,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"137","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":137,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getBuildings","variables":{},"query":"query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:buildings [#ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building]) #ordered/map ([:id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7] [:name 3605 Nanci Heights] [:__typename :Building])]])}
2023-12-08T08:48:27.527Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])]])}
2023-12-08T08:48:27.527Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:buildings [#ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])]])}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260247254625, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 257, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1632ce26 /127.0.0.1:3230<->/127.0.0.1:58189], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId e7b6a95e-b33c-44f6-8c82-47ff4243d7b7}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157260247254625,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"257","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":257,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getRoomsByBuilding","variables":{"buildingId":"e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"},"query":"query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:rooms [#ordered/map ([:id c47d092d-ffaf-4e44-acd9-94bbd9f6d90a] [:name general room] [:description nil] [:__typename :Room]) #ordered/map ([:id 44402360-ad23-4b0e-b261-6875a1512172] [:name conservatory] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:27.528Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "c47d092d-ffaf-4e44-acd9-94bbd9f6d90a"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:description nil] [:__typename :Room])]])}
2023-12-08T08:48:27.528Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:rooms [#ordered/map ([:id "c47d092d-ffaf-4e44-acd9-94bbd9f6d90a"] [:name "general room"] [:description nil] [:__typename :Room]) #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:description nil] [:__typename :Room])]])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260264958791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2147b22a /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:27.542Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:27.544Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:27.545Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-12-08T08:48:27.545Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:27.545Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157260264958791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "502", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2147b22a "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260264958791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 502, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2147b22a /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157260264958791,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"502","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"8405b014-df04-4d73-8986-dea4b8b2026e","firstname":"Krysta","lastname":"Pfeffer","login":null,"email":"lynsey_kertzmann@klein-wehner.org"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 8405b014-df04-4d73-8986-dea4b8b2026e] [:firstname Krysta] [:lastname Pfeffer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:27.553Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8405b014-df04-4d73-8986-dea4b8b2026e\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:27.553Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"8d40acf5-7d25-4512-8b75-47db7d1bf4e4\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"8405b014-df04-4d73-8986-dea4b8b2026e\",\"firstname\":\"Krysta\",\"lastname\":\"Pfeffer\",\"login\":null,\"email\":\"lynsey_kertzmann@klein-wehner.org\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260301333125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2db00b1d /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [eb42f2b2-a188-48e1-91d3-db302c493d66]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:27.585Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:27.587Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:id [eb42f2b2-a188-48e1-91d3-db302c493d66]}
2023-12-08T08:48:27.590Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}

2023-12-08T08:48:27.591Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:id ["eb42f2b2-a188-48e1-91d3-db302c493d66"]}
2023-12-08T08:48:27.591Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157260301333125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "5678", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2db00b1d "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestForEdit", :variables {:id ["eb42f2b2-a188-48e1-91d3-db302c493d66"]}, :query "query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:27.596Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:27.596Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:27.596Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:27.597Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:27.597Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>oo> past? budget-period= {:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260301333125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 5678, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2db00b1d /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 5678, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestForEdit, :variables {:id [eb42f2b2-a188-48e1-91d3-db302c493d66]}, :query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157260301333125,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"5678","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":5678,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestForEdit","variables":{"id":["eb42f2b2-a188-48e1-91d3-db302c493d66"]},"query":"query RequestForEdit($id: [ID!]!) {\n  requests(id: $id) {\n    ...RequestFieldsForEdit\n    actionPermissions {\n      delete\n      edit\n      moveBudgetPeriod\n      moveCategory\n      __typename\n    }\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  budget_periods(whereRequestsCanBeMovedTo: $id) {\n    id\n    name\n    __typename\n  }\n  settings {\n    inspection_comments\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestForEdit($id: [ID!]!) {
  requests(id: $id) {
    ...RequestFieldsForEdit
    actionPermissions {
      delete
      edit
      moveBudgetPeriod
      moveCategory
      __typename
    }
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  budget_periods(whereRequestsCanBeMovedTo: $id) {
    id
    name
    __typename
  }
  settings {
    inspection_comments
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:requests [#ordered/map ([:id eb42f2b2-a188-48e1-91d3-db302c493d66] [:short_id Budget-Period-BP.001] [:user #ordered/map ([:value #ordered/map ([:id 8405b014-df04-4d73-8986-dea4b8b2026e] [:firstname Krysta] [:lastname Pfeffer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:main_category #ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name Budget-Period-BP] [:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id 265d6fb8-2bc5-4edf-a2c8-219c84a0619e] [:name Baby, Toys & Computers] [:shortname nil] [:department #ordered/map ([:id 43e2a8bd-6570-4a3b-8421-700c592863e9] [:name Toys, Kids & Baby] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id 44402360-ad23-4b0e-b261-6875a1512172] [:name conservatory] [:building #ordered/map ([:id e7b6a95e-b33c-44f6-8c82-47ff4243d7b7] [:name 3605 Nanci Heights] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value Consectetur asperiores quis expedita.] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:categories [#ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:name Budget-Period-BP] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments [Eum architecto minus magnam.]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:27.629Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:requests [#ordered/map ([:id "eb42f2b2-a188-48e1-91d3-db302c493d66"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:main_category #ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:building #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}
2023-12-08T08:48:27.629Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:requests [#ordered/map ([:id "eb42f2b2-a188-48e1-91d3-db302c493d66"] [:short_id "Budget-Period-BP.001"] [:user #ordered/map ([:value #ordered/map ([:id "8405b014-df04-4d73-8986-dea4b8b2026e"] [:firstname "Krysta"] [:lastname "Pfeffer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write false] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:main_category #ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "Budget-Period-BP"] [:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write true] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization #ordered/map ([:value #ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:department #ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt] [:read true] [:write true] [:required true])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:order_quantity #ordered/map ([:read false] [:value nil] [:__typename :RequestFieldInt] [:write false] [:required false])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write true] [:required false])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "44402360-ad23-4b0e-b261-6875a1512172"] [:name "conservatory"] [:building #ordered/map ([:id "e7b6a95e-b33c-44f6-8c82-47ff4243d7b7"] [:name "3605 Nanci Heights"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value "Consectetur asperiores quis expedita."] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:inspector_priority #ordered/map ([:value nil] [:__typename :RequestFieldInspectorPriority] [:read false] [:write false] [:required true])] [:accounting_type #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read false] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read false])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read false] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus] [:read true] [:write false] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value nil] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])] [:actionPermissions #ordered/map ([:delete true] [:edit true] [:moveBudgetPeriod true] [:moveCategory true] [:__typename :RequestActionPermissions])])]] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:__typename :BudgetPeriod])]] [:settings #ordered/map ([:inspection_comments ["Eum architecto minus magnam."]] [:__typename :ProcurementSettings])])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260456907458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6eb0af33 HikariProxyConnection@1857072947 wrapping org.postgresql.jdbc.PgConnection@3c11573a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 223, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x34232f2f /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x12b18791 HikariProxyConnection@313624465 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 1, :rollback #object[clojure.lang.Atom 0x326675dc {:status :ready, :val false}]}, :content-length 223, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName changeRequestCategory, :variables {:input {:id eb42f2b2-a188-48e1-91d3-db302c493d66}}, :query mutation changeRequestCategory($input: DeleteRequestInput) {
  delete_request(input_data: $input)
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x12b18791 HikariProxyConnection@313624465 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 1, :rollback #object[clojure.lang.Atom 0x326675dc {:status :ready, :val false}]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:27.734Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:27.735Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:input {:id eb42f2b2-a188-48e1-91d3-db302c493d66}}
2023-12-08T08:48:27.737Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => mutation changeRequestCategory($input: DeleteRequestInput) {
  delete_request(input_data: $input)
}

2023-12-08T08:48:27.737Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:input {:id "eb42f2b2-a188-48e1-91d3-db302c493d66"}}
2023-12-08T08:48:27.737Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157260456907458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6eb0af33 "HikariProxyConnection@1857072947 wrapping org.postgresql.jdbc.PgConnection@3c11573a"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "223", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x34232f2f "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x12b18791 "HikariProxyConnection@313624465 wrapping org.postgresql.jdbc.PgConnection@57361acd"], :level 2, :rollback #object[clojure.lang.Atom 0x326675dc {:status :ready, :val false}]}, :content-length 223, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "changeRequestCategory", :variables {:input {:id "eb42f2b2-a188-48e1-91d3-db302c493d66"}}, :query "mutation changeRequestCategory($input: DeleteRequestInput) {\n  delete_request(input_data: $input)\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id eb42f2b2-a188-48e1-91d3-db302c493d66]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:27.739Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]), :where [:= :procurement_requests.id "eb42f2b2-a188-48e1-91d3-db302c493d66"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id eb42f2b2-a188-48e1-91d3-db302c493d66]}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:27.739Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]), :where [:= :procurement_requests.id "eb42f2b2-a188-48e1-91d3-db302c493d66"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id eb42f2b2-a188-48e1-91d3-db302c493d66]}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:27.740Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]), :where [:= :procurement_requests.id "eb42f2b2-a188-48e1-91d3-db302c493d66"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id eb42f2b2-a188-48e1-91d3-db302c493d66]}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:27.740Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id "eb42f2b2-a188-48e1-91d3-db302c493d66"]}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id eb42f2b2-a188-48e1-91d3-db302c493d66]}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:27.740Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:= :procurement_requests.id "eb42f2b2-a188-48e1-91d3-db302c493d66"]}
>oo> past? budget-period= {:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"}
>o> past? query= [SELECT current_date > CAST(? AS date) AS result  2024-03-08]
>o> past? result= false

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260456907458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6eb0af33 HikariProxyConnection@1857072947 wrapping org.postgresql.jdbc.PgConnection@3c11573a], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 223, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x34232f2f /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x12b18791 HikariProxyConnection@313624465 wrapping org.postgresql.jdbc.PgConnection@57361acd], :level 2, :rollback #object[clojure.lang.Atom 0x326675dc {:status :ready, :val false}]}, :content-length 223, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName changeRequestCategory, :variables {:input {:id eb42f2b2-a188-48e1-91d3-db302c493d66}}, :query mutation changeRequestCategory($input: DeleteRequestInput) {
  delete_request(input_data: $input)
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157260456907458,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"223","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":223,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"changeRequestCategory","variables":{"input":{"id":"eb42f2b2-a188-48e1-91d3-db302c493d66"}},"query":"mutation changeRequestCategory($input: DeleteRequestInput) {\n  delete_request(input_data: $input)\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query mutation changeRequestCategory($input: DeleteRequestInput) {
  delete_request(input_data: $input)
}


>request-grapql _> result => {:data #ordered/map ([:delete_request true])}
2023-12-08T08:48:27.762Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:delete_request true])}
2023-12-08T08:48:27.762Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:delete_request true])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260736518416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d8898a6 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:28.012Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:28.015Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {}
2023-12-08T08:48:28.016Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}

2023-12-08T08:48:28.016Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {}
2023-12-08T08:48:28.016Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157260736518416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "534", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d8898a6 "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestFilters", :variables {}, :query "query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260736518416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 534, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d8898a6 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157260736518416,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"534","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":534,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestFilters","variables":{},"query":"query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:categories [#ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id 43e2a8bd-6570-4a3b-8421-700c592863e9] [:name Toys, Kids & Baby] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 265d6fb8-2bc5-4edf-a2c8-219c84a0619e] [:name Baby, Toys & Computers] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T08:48:28.020Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-08T08:48:28.020Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "43e2a8bd-6570-4a3b-8421-700c592863e9"] [:name "Toys, Kids & Baby"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "265d6fb8-2bc5-4edf-a2c8-219c84a0619e"] [:name "Baby, Toys & Computers"] [:shortname nil] [:__typename :Organization])]])]])}}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44263 0x37262b71 leihs.core.locale$wrap$fn__44263@37262b71]

>> authorize::request > {:authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260994818208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0xb4b9293 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :categories [dff229ca-eafa-497e-8251-a11912bcf1f7], :priority [NORMAL HIGH], :budgetPeriods [acf7a2f9-807d-418b-b48d-f5073d5988c5]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}
>myprint>  admin false
>myprint>  inspector false
>myprint>  viewer false
>myprint>  requester true
2023-12-08T08:48:28.274Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-12-08T08:48:28.276Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39327#] (p1__39327# (:tx request) (:authenticated-entity request)))) (some true?)) => true

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :categories [dff229ca-eafa-497e-8251-a11912bcf1f7], :priority [NORMAL HIGH], :budgetPeriods [acf7a2f9-807d-418b-b48d-f5073d5988c5]}
2023-12-08T08:48:28.279Z NX-41294 DEBUG [leihs.procurement.graphql:52] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-08T08:48:28.279Z NX-41294 DEBUG [leihs.procurement.graphql:53] - (-> request :body :variables) => {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["265d6fb8-2bc5-4edf-a2c8-219c84a0619e"], :categories ["dff229ca-eafa-497e-8251-a11912bcf1f7"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["acf7a2f9-807d-418b-b48d-f5073d5988c5"]}
2023-12-08T08:48:28.279Z NX-41294 DEBUG [leihs.procurement.graphql:56] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "lynsey_kertzmann@klein-wehner.org", :contracts_count 0, :lastname "Pfeffer", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Krysta", :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"leihs-anti-csrf-token" {:value "8d40acf5-7d25-4512-8b75-47db7d1bf4e4"}, "leihs-user-session" {:value "af6712de-6778-4d20-a6be-57fe0dda5d82"}}, :remote-addr "127.0.0.1", :start-time 157260994818208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b "next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0", "content-type" "application/json", "cookie" "leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82", "content-length" "4033", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "x-csrf-token" "8d40acf5-7d25-4512-8b75-47db7d1bf4e4", "accept" "application/json", "accept-language" "de,en-US;q=0.7,en;q=0.3", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors"}, :async-channel #object[org.httpkit.server.AsyncChannel 0xb4b9293 "/127.0.0.1:3230<->/127.0.0.1:58183"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb "HikariDataSource (db-pool)"]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "IN_APPROVAL" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["265d6fb8-2bc5-4edf-a2c8-219c84a0619e"], :categories ["dff229ca-eafa-497e-8251-a11912bcf1f7"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["acf7a2f9-807d-418b-b48d-f5073d5988c5"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 "leihs.procurement.graphql$handler@11927a29"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [acf7a2f9-807d-418b-b48d-f5073d5988c5], :category_id [dff229ca-eafa-497e-8251-a11912bcf1f7]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
>>ToCheck mainCats ({:id #uuid "b436ad1e-395a-4e22-8482-ab086b23e017", :name Colombia})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC acf7a2f9-807d-418b-b48d-f5073d5988c5]
>>ToCheck dashboard:::procurement_budget_periods.id ({:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"})
>>resultA1-2 ({:id #uuid "acf7a2f9-807d-418b-b48d-f5073d5988c5", :name Budget-Period-BP, :inspection_start_date #time/instant "2024-02-07T23:00:00Z", :end_date #time/instant "2024-03-07T23:00:00Z", :created_at #time/instant "2023-12-08T08:48:25.669616Z", :updated_at #time/instant "2023-12-08T08:48:25.669616Z"})
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :requested_by_auth_user false, :state [:NEW :IN_APPROVAL :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [acf7a2f9-807d-418b-b48d-f5073d5988c5], :category_id [dff229ca-eafa-497e-8251-a11912bcf1f7]} nil
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-12-08T08:48:28.285Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-12-08T08:48:28.285Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-12-08T08:48:28.285Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-12-08T08:48:28.286Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-12-08T08:48:28.286Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>>requestsB2 ()
>>dashboard-cache-keyB2 {:id 402967585}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email lynsey_kertzmann@klein-wehner.org, :contracts_count 0, :lastname Pfeffer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Krysta, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-08T08:48:26.120356Z", :id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :user_session_id #uuid "124c50b7-db6e-497f-8bd4-ab9800f785fd", :scope_system_admin_read false, :access-rights (), :user_id #uuid "8405b014-df04-4d73-8986-dea4b8b2026e", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 8d40acf5-7d25-4512-8b75-47db7d1bf4e4}, leihs-user-session {:value af6712de-6778-4d20-a6be-57fe0dda5d82}}, :remote-addr 127.0.0.1, :start-time 157260994818208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x24fde1b6 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4cbf173b next.jdbc.result_set$as_unqualified_lower_maps@4cbf173b]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/115.0, content-type application/json, cookie leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82, content-length 4033, referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 8d40acf5-7d25-4512-8b75-47db7d1bf4e4, accept application/json, accept-language de,en-US;q=0.7,en;q=0.3, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0xb4b9293 /127.0.0.1:3230<->/127.0.0.1:58183], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x1ff097bb HikariDataSource (db-pool)]}, :content-length 4033, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW IN_APPROVAL APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [265d6fb8-2bc5-4edf-a2c8-219c84a0619e], :categories [dff229ca-eafa-497e-8251-a11912bcf1f7], :priority [NORMAL HIGH], :budgetPeriods [acf7a2f9-807d-418b-b48d-f5073d5988c5]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x11927a29 leihs.procurement.graphql$handler@11927a29], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"lynsey_kertzmann@klein-wehner.org","contracts_count":0,"lastname":"Pfeffer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Krysta","scope_admin_write":false,"user_session_created_at":"2023-12-08T08:48:26.120356Z","id":"8405b014-df04-4d73-8986-dea4b8b2026e","user_session_id":"124c50b7-db6e-497f-8bd4-ab9800f785fd","scope_system_admin_read":false,"access-rights":[],"user_id":"8405b014-df04-4d73-8986-dea4b8b2026e","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4"},"leihs-user-session":{"value":"af6712de-6778-4d20-a6be-57fe0dda5d82"}},"remote-addr":"127.0.0.1","start-time":157260994818208,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko\/20100101 Firefox\/115.0","content-type":"application\/json","cookie":"leihs-anti-csrf-token=8d40acf5-7d25-4512-8b75-47db7d1bf4e4; leihs-user-session=af6712de-6778-4d20-a6be-57fe0dda5d82","content-length":"4033","referer":"http:\/\/localhost:3230\/procure\/requests","connection":"keep-alive","x-csrf-token":"8d40acf5-7d25-4512-8b75-47db7d1bf4e4","accept":"application\/json","accept-language":"de,en-US;q=0.7,en;q=0.3","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors"},"server-port":3230,"params-raw":{},"content-length":4033,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"RequestsIndexFiltered","variables":{"inspector_priority":["LOW","MEDIUM","HIGH","MANDATORY"],"onlyOwnRequests":false,"state":["NEW","IN_APPROVAL","APPROVED","PARTIALLY_APPROVED","DENIED"],"order_status":["NOT_PROCESSED","IN_PROGRESS","PROCURED","ALTERNATIVE_PROCURED","NOT_PROCURED"],"search":null,"organizations":["265d6fb8-2bc5-4edf-a2c8-219c84a0619e"],"categories":["dff229ca-eafa-497e-8251-a11912bcf1f7"],"priority":["NORMAL","HIGH"],"budgetPeriods":["acf7a2f9-807d-418b-b48d-f5073d5988c5"]},"query":"query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-c-grapql _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>request-grapql _> result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey 402967585] [:total_count 0] [:budget_periods [#ordered/map ([:id acf7a2f9-807d-418b-b48d-f5073d5988c5] [:cacheKey 402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5] [:name Budget-Period-BP] [:inspection_start_date 2024-02-07T23:00:00Z] [:end_date 2024-03-07T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id b436ad1e-395a-4e22-8482-ab086b23e017] [:cacheKey 402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017] [:name Colombia] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id dff229ca-eafa-497e-8251-a11912bcf1f7] [:cacheKey 402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7] [:name Category C] [:total_price_cents 0] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:28.312Z NX-41294 DEBUG [leihs.procurement.graphql:80] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "402967585"] [:total_count 0] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-12-08T08:48:28.312Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "402967585"] [:total_count 0] [:budget_periods [#ordered/map ([:id "acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5"] [:name "Budget-Period-BP"] [:inspection_start_date "2024-02-07T23:00:00Z"] [:end_date "2024-03-07T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "b436ad1e-395a-4e22-8482-ab086b23e017"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017"] [:name "Colombia"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "dff229ca-eafa-497e-8251-a11912bcf1f7"] [:cacheKey "402967585_acf7a2f9-807d-418b-b48d-f5073d5988c5_b436ad1e-395a-4e22-8482-ab086b23e017_dff229ca-eafa-497e-8251-a11912bcf1f7"] [:name "Category C"] [:total_price_cents "0"] [:requests []] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}}
