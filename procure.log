# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
2023-12-02T09:22:21.058Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-02T09:22:21.677Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-02T09:22:21.684Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x35c66901 "taoensso.timbre$default_output_fn@35c66901"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x5e868e3c "taoensso.timbre.appenders.core$println_appender$fn__3459@5e868e3c"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-02T09:22:21.686Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-12-02T09:22:21.698Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 15928, :repl-port-file ".nrepl-port"}
2023-12-02T09:22:21.700Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  15928 localhost
2023-12-02T09:22:21.733Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-02T09:22:21.737Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 15928, :repl-port-file .nrepl-port}
2023-12-02T09:22:21.738Z NX-41294 INFO [leihs.core.shutdown:20] - PID 99684
2023-12-02T09:22:21.772Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-02T09:22:21.844Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-02T09:22:21.846Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-02T09:22:21.852Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-02T09:22:21.926Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@6da83f3d
2023-12-02T09:22:21.934Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-02T09:22:21.934Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 "HikariDataSource (db-pool)"]}
2023-12-02T09:22:21.935Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-02T09:22:21.949Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-02T09:22:21.956Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@45dd695a
2023-12-02T09:22:21.957Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-02T09:22:21.963Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 "next.jdbc.result_set$as_unqualified_lower_maps@3004cd53"]}}
2023-12-02T09:22:21.970Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x15a94830 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x4370b2f7 "java.util.concurrent.ThreadPoolExecutor@4370b2f7[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-02T09:22:21.981Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231345210223500, :params {:return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {:return-to /procure}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x74736072 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {:return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x27c1c853 compojure.core$routes$fn__27950@27c1c853], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:22:30.828Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:30.853Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:22:30.858Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:22:30.885Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:22:30.903Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231345745653416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate}, :async-channel #object[org.httpkit.server.AsyncChannel 0x58c16d3e /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x56069856 leihs.procurement.backend.html$not_found_handler@56069856], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:22:30.965Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:30.966Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:22:30.967Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:22:30.968Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:22:30.968Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false
2023-12-02T09:22:30.970Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:30.971Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:30.972Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:22:30.973Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:22:30.975Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231346160798208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x62509e52 /127.0.0.1:3230<->/127.0.0.1:53760], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:22:31.428Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.429Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:22:31.430Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:22:31.430Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:22:31.431Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false
2023-12-02T09:22:31.432Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.433Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.434Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:22:31.434Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:22:31.435Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-02T09:22:31.440Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:22:31.450Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
>>>2 {:id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :firstname Urs, :lastname van Binsbergen}
>>oida>> #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:22:31.454Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>>>3 nil
2023-12-02T09:22:31.493Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.495Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.496Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

>oo>1pure-handler _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231346160798208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x62509e52 /127.0.0.1:3230<->/127.0.0.1:53760], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>o>3pure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"6e1aae74-85d2-42a1-a803-d998943e2e69","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"23a3d006-581e-4dee-a717-4ac7d0fd7ab7","firstname":"Urs","lastname":"van Binsbergen","login":"uvanbins","email":"urs.vanbinsbergen@zhdk.ch"}},"subApps":{"borrow":true,"admin":true,"procure":false,"manage":[{"name":"Ausleihe Toni-Areal","href":"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily"},{"name":"IT-Zentrum","href":"/manage/5dd25b58-fa56-5095-bd97-2696d92c2fb1/daily"},{"name":"ITZ-Software","href":"/manage/3977012c-ce0e-501f-889b-8715fdb5d83b/daily"}]},"locales":[{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":true,"isSelected":true},{"name":"English","locale":"en-GB","active":true,"isDefault":false,"isSelected":false},{"name":"Castellano","locale":"es","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 23a3d006-581e-4dee-a717-4ac7d0fd7ab7] [:firstname Urs] [:lastname van Binsbergen] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung] [:__typename :ProcurementSettings])])}
2023-12-02T09:22:31.524Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"6e1aae74-85d2-42a1-a803-d998943e2e69\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"23a3d006-581e-4dee-a717-4ac7d0fd7ab7\",\"firstname\":\"Urs\",\"lastname\":\"van Binsbergen\",\"login\":\"uvanbins\",\"email\":\"urs.vanbinsbergen@zhdk.ch\"}},\"subApps\":{\"borrow\":true,\"admin\":true,\"procure\":false,\"manage\":[{\"name\":\"Ausleihe Toni-Areal\",\"href\":\"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily\"},{\"name\":\"IT-Zentrum\",\"href\":\"/manage/5dd25b58-fa56-5095-bd97-2696d92c2fb1/daily\"},{\"name\":\"ITZ-Software\",\"href\":\"/manage/3977012c-ce0e-501f-889b-8715fdb5d83b/daily\"}]},\"locales\":[{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Castellano\",\"locale\":\"es\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"] [:firstname "Urs"] [:lastname "van Binsbergen"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231346358014041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4d1f7be4 /127.0.0.1:3230<->/127.0.0.1:53768], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:22:31.589Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.590Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:22:31.591Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:22:31.591Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:22:31.592Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false
2023-12-02T09:22:31.593Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.594Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.595Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:22:31.595Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:22:31.596Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-02T09:22:31.607Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id >>>1 #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"true
, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231346357826291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 3938, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a803101 /127.0.0.1:3230<->/127.0.0.1:53760], :server-port 3230, :params-raw {}, 2023-12-02T09:22:31.610Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
:tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 3938, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [nil], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:22:31.611Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
>>>2 {:id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :firstname Urs, :lastname van Binsbergen}
>>oida>> #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:22:31.611Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>>>3 nil
2023-12-02T09:22:31.612Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:22:31.613Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:22:31.614Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231346357679333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection 2023-12-02T09:22:31.616Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7c53ff09 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:22:31.616Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  requester false
2023-12-02T09:22:31.617Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.620Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.620Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:22:31.621Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:22:31.621Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:22:31.621Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:22:31.622Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:22:31.623Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
2023-12-02T09:22:31.624Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false
2023-12-02T09:22:31.627Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.628Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.629Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.630Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.633Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:22:31.633Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-02T09:22:31.634Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:22:31.636Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-02T09:22:31.640Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}

>oo>1pure-handler _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231346358014041, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4d1f7be4 /127.0.0.1:3230<->/127.0.0.1:53768], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>o>3pure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"6e1aae74-85d2-42a1-a803-d998943e2e69","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"23a3d006-581e-4dee-a717-4ac7d0fd7ab7","firstname":"Urs","lastname":"van Binsbergen","login":"uvanbins","email":"urs.vanbinsbergen@zhdk.ch"}},"subApps":{"borrow":true,"admin":true,"procure":false,"manage":[{"name":"Ausleihe Toni-Areal","href":"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily"},{"name":"IT-Zentrum","href":"/manage/5dd25b58-fa56-5095-bd97-2696d92c2fb1/daily"},{"name":"ITZ-Software","href":"/manage/3977012c-ce0e-501f-889b-8715fdb5d83b/daily"}]},"locales":[{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":true,"isSelected":true},{"name":"English","locale":"en-GB","active":true,"isDefault":false,"isSelected":false},{"name":"Castellano","locale":"es","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 23a3d006-581e-4dee-a717-4ac7d0fd7ab7] [:firstname Urs] [:lastname van Binsbergen] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung] [:__typename :ProcurementSettings])])}
2023-12-02T09:22:31.641Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"6e1aae74-85d2-42a1-a803-d998943e2e69\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"23a3d006-581e-4dee-a717-4ac7d0fd7ab7\",\"firstname\":\"Urs\",\"lastname\":\"van Binsbergen\",\"login\":\"uvanbins\",\"email\":\"urs.vanbinsbergen@zhdk.ch\"}},\"subApps\":{\"borrow\":true,\"admin\":true,\"procure\":false,\"manage\":[{\"name\":\"Ausleihe Toni-Areal\",\"href\":\"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily\"},{\"name\":\"IT-Zentrum\",\"href\":\"/manage/5dd25b58-fa56-5095-bd97-2696d92c2fb1/daily\"},{\"name\":\"ITZ-Software\",\"href\":\"/manage/3977012c-ce0e-501f-889b-8715fdb5d83b/daily\"}]},\"locales\":[{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Castellano\",\"locale\":\"es\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"] [:firstname "Urs"] [:lastname "van Binsbergen"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung"] [:__typename :ProcurementSettings])])}
pure-handler >> 2
2023-12-02T09:22:31.645Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MANDATORY" "MEDIUM"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search "", :organizations [nil], :categories [], :priority ["NORMAL" "HIGH"], :budgetPeriods ["1173b482-b9e6-46b4-a5e3-0b021c860e9b"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MANDATORY MEDIUM] {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [nil], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MANDATORY :MEDIUM], :organization_id [nil], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search , :priority [:NORMAL :HIGH], :budget_period_id [1173b482-b9e6-46b4-a5e3-0b021c860e9b], :category_id []}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>mainCats [{:id #uuid "519f7a95-9ca7-5256-bf63-142cfc23dc62", :name Audio- und Videotechnik} {:id #uuid "1a047acd-dc98-52c2-99d3-dc6332adc1e0", :name Bauliche Anpassungen und Mobiliar} {:id #uuid "dda588f4-660c-573c-a2ff-944ae93ad42e", :name Beleuchtungstechnik} {:id #uuid "2b07eb8a-4174-5257-83eb-920d536cc44a", :name Betriebseinrichtungen und Fahrzeuge} {:id #uuid "f6827594-33a6-5760-ac41-f94ceefacfab", :name Bühnentechnik} {:id #uuid "517b82ae-2b7e-4822-9aeb-0d4753dec821", :name Darlehen} {:id #uuid "ca1d97ac-0ac4-597a-8edb-f9c466b1c7da", :name Fotografie} {:id #uuid "2ea39047-e663-50d5-9080-838b75883704", :name IT & Elektronik} {:id #uuid "f6885671-3bf3-56f2-8e92-b5112d0f703f", :name Musikinstrumente} {:id #uuid "6c8a0d77-6711-5156-a59a-12425ba01cff", :name Werkstatt-Technik}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
>>resultA1 [{:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}]
>>resultA1-2 [{:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}]
>>requestsB2-triggerError {:inspector_priority [:LOW :MANDATORY :MEDIUM], :organization_id [nil], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search , :priority [:NORMAL :HIGH], :budget_period_id [1173b482-b9e6-46b4-a5e3-0b021c860e9b], :category_id []} nil
>o> helper1
>o> helper2 [] [1173b482-b9e6-46b4-a5e3-0b021c860e9b] [nil]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>oo> >>1 :NORMAL
>oo> >>1 :HIGH
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>oo> >>1 :LOW
>oo> >>1 :MANDATORY
>oo> >>1 :MEDIUM
low mandatory medium)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>oo> >>1 :NOT_PROCESSED
>oo> >>1 :IN_PROGRESS
>oo> >>1 :PROCURED
>oo> >>1 :ALTERNATIVE_PROCURED
>oo> >>1 :NOT_PROCURED
not_processed in_progress procured alternative_procured not_procured)
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
2023-12-02T09:22:31.677Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:22:31.678Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:22:31.679Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.679Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.680Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - (->> [viewer? inspector? admin?] (map (fn* [p1__39304#] (p1__39304# tx auth-entity))) (some true?)) => true
>o> helper7 true
>o> requests-base-query-with-state
>o> state-sql true
>o> s-map  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>o>map-4 (>o> map NEW
>o> map [:= :procurement_requests.approved_quantity nil]
:case >o> map NEW
[:= :procurement_requests.approved_quantity nil] >o> map APPROVED
>o> map [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]
NEW >o> map APPROVED
[:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] >o> map DENIED
>o> map [:= :procurement_requests.approved_quantity 0]
PARTIALLY_APPROVED >o> map DENIED
[:= :procurement_requests.approved_quantity 0] DENIED)
>o>map-5 (:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)
2023-12-02T09:22:31.683Z NX-41294 DEBUG [leihs.procurement.resources.request:171] - result => [[(:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED")]]
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low mandatory medium) (normal high)
>oo> enum (not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:22:31.688Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.688Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.690Z NX-41294 DEBUG [leihs.procurement.permissions.requests:25] - sqlmap => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]] [[[(:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED")]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category"]] [[[:row_to_json :models]] :model] [[:raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization"]] [[[:row_to_json :procurement_templates]] :template] [[:raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room"]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:and [:= true false] [:in :procurement_requests.budget_period_id ([:cast "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid])] [:in :procurement_requests.organization_id ([:cast nil :uuid])] [:in :procurement_requests.priority ("normal" "high")] [:in :procurement_requests.inspector_priority ("low" "mandatory" "medium")] [:or [:= :procurement_requests.approved_quantity nil] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] [:= :procurement_requests.approved_quantity 0]] [:in :procurement_requests.order_status ([[:cast "not_processed" :order_status_enum]] [[:cast "in_progress" :order_status_enum]] [[:cast "procured" :order_status_enum]] [[:cast "alternative_procured" :order_status_enum]] [[:cast "not_procured" :order_status_enum]])] [:or ["~~*" :buildings.name "%%"] ["~~*" :procurement_requests.short_id "%%"] ["~~*" :procurement_requests.article_name "%%"] ["~~*" :procurement_requests.article_number "%%"] ["~~*" :procurement_requests.inspection_comment "%%"] ["~~*" :procurement_requests.order_comment "%%"] ["~~*" :procurement_requests.motivation "%%"] ["~~*" :procurement_requests.receiver "%%"] ["~~*" :procurement_requests.supplier_name "%%"] ["~~*" :rooms.name "%%"] ["~~*" :models.product "%%"] ["~~*" :models.version "%%"] ["~~*" :users.firstname "%%"] ["~~*" :users.lastname "%%"]]]}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(NULL AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?)) AND ((procurement_requests.approved_quantity IS NULL) OR (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) OR ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) OR (procurement_requests.approved_quantity = ?)) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1173b482-b9e6-46b4-a5e3-0b021c860e9b normal high low mandatory medium 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %%]
>o> query-requests, auth-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(NULL AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?)) AND ((procurement_requests.approved_quantity IS NULL) OR (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) OR ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) OR (procurement_requests.approved_quantity = ?)) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1173b482-b9e6-46b4-a5e3-0b021c860e9b normal high low mandatory medium 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %%]
2023-12-02T09:22:31.696Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:22:31.696Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:22:31.697Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:22:31.698Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:22:31.698Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - (->> [viewer? inspector? admin?] (map (fn* [p1__39304#] (p1__39304# tx auth-entity))) (some true?)) => true
>e> #error {
 :cause ERROR: argument of OR must be type boolean, not type record
  Position: 3175
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: argument of OR must be type boolean, not type record
  Position: 3175
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11849 invoke result_set.clj 944]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 254]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 462]
  [leihs.procurement.resources.request$query_requests invoke request.clj 456]
  [leihs.procurement.resources.requests$get_requests invokeStatic requests.clj 236]
  [leihs.procurement.resources.requests$get_requests invoke requests.clj 224]
  [leihs.procurement.dashboard$get_dashboard invokeStatic dashboard.clj 209]
  [leihs.procurement.dashboard$get_dashboard invoke dashboard.clj 165]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44479 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-12-02T09:22:31.712Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - ERROR: argument of OR must be type boolean, not type record
  Position: 3175
2023-12-02T09:22:31.712Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause ERROR: argument of OR must be type boolean, not type record
  Position: 3175
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: argument of OR must be type boolean, not type record
  Position: 3175
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11849 invoke result_set.clj 944]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 254]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 462]
  [leihs.procurement.resources.request$query_requests invoke request.clj 456]
  [leihs.procurement.resources.requests$get_requests invokeStatic requests.clj 236]
  [leihs.procurement.resources.requests$get_requests invoke requests.clj 224]
  [leihs.procurement.dashboard$get_dashboard invokeStatic dashboard.clj 209]
  [leihs.procurement.dashboard$get_dashboard invoke dashboard.clj 165]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44479 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}

>oo>1pure-handler _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231346357826291, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 3938, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1a803101 /127.0.0.1:3230<->/127.0.0.1:53760], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 3938, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [nil], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>o>3pure-handler, result=> {:data #ordered/map ([:dashboard nil]), :errors ({:message ERROR: argument of OR must be type boolean, not type record
  Position: 3175, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception PSQLException, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-02T09:22:31.715Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:dashboard nil]), :errors ({:message "ERROR: argument of OR must be type boolean, not type record\n  Position: 3175", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "PSQLException", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-02T09:22:31.715Z NX-41294 DEBUG [leihs.procurement.graphql:86] - {:data #ordered/map ([:dashboard nil]), :errors ({:message "ERROR: argument of OR must be type boolean, not type record\n  Position: 3175", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "PSQLException", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}

>o> ERROR 4pure-handler, result=> {:data #ordered/map ([:dashboard nil]), :errors ({:message ERROR: argument of OR must be type boolean, not type record
  Position: 3175, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception PSQLException, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}

>oo>1pure-handler _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231346357679333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7c53ff09 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>o>3pure-handler, result=> {:data #ordered/map ([:budget_periods [#ordered/map ([:id 1a1dab20-c661-4204-a913-28065d570f7c] [:name 2028] [:inspection_start_date 2027-11-01 01:00:00.0] [:end_date 2027-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id dfdd0798-6462-46fc-995f-a7d7233f30fd] [:name 2027] [:inspection_start_date 2026-11-02 01:00:00.0] [:end_date 2026-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 6b689ed8-8148-485a-b1ca-86c1c739503e] [:name 2026] [:inspection_start_date 2025-11-03 01:00:00.0] [:end_date 2025-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b] [:name 2025] [:inspection_start_date 2024-11-04 01:00:00.0] [:end_date 2024-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f] [:name 2024] [:inspection_start_date 2023-10-01 12:00:00.0] [:end_date 2023-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5] [:name 2023] [:inspection_start_date 2022-11-01 01:00:00.0] [:end_date 2022-12-31 12:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 76b66d78-bfe0-4c54-8c92-edbf467af784] [:name 2022] [:inspection_start_date 2021-10-29 12:00:00.0] [:end_date 2021-12-31 12:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 24171a61-aec6-428e-b7ed-7461b3795454] [:name 2021] [:inspection_start_date 2020-10-26 12:00:00.0] [:end_date 2020-12-31 12:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 3b7eab1e-c8b5-512b-9146-91cc295be955] [:name 2020] [:inspection_start_date 2019-11-09 12:00:00.0] [:end_date 2019-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 9fb023db-725d-5881-8838-bae3e970ffd0] [:name 2019] [:inspection_start_date 2018-11-10 01:00:00.0] [:end_date 2018-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d] [:name 2018] [:inspection_start_date 2017-11-04 01:00:00.0] [:end_date 2017-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 4f367b79-76cf-5f12-ab7b-535a7430e6da] [:name 2016] [:inspection_start_date 2016-11-01 01:00:00.0] [:end_date 2017-01-30 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1] [:name 2017] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id 519f7a95-9ca7-5256-bf63-142cfc23dc62] [:name Audio- und Videotechnik] [:categories [#ordered/map ([:id 4e48b48c-e1bf-50d7-ab2d-9aa438c638de] [:name Beamer] [:__typename :Category]) #ordered/map ([:id a1727606-c7c8-54a2-aaa1-ceff7a7d4b40] [:name Funk-Strecken] [:__typename :Category]) #ordered/map ([:id 00382e27-a87a-5313-b31b-a369dad6c5f8] [:name Lautsprecher] [:__typename :Category]) #ordered/map ([:id ce5424cc-ce77-5e67-8201-333ec20963eb] [:name Lautsprecherstative] [:__typename :Category]) #ordered/map ([:id ce0812d7-080b-5f49-8530-dd4a821c57b6] [:name Mikrofone] [:__typename :Category]) #ordered/map ([:id 67e5fc60-6fe3-53bb-9495-3669b917038a] [:name Mikrofonstative] [:__typename :Category]) #ordered/map ([:id f94f72e8-ff65-5bad-b1f9-81ddd8fa7c0c] [:name Monitore / Screens] [:__typename :Category]) #ordered/map ([:id 89e4a22f-7d6c-5006-b26a-3ef6f8f19630] [:name Schnittplatz / Mischpult / Regie] [:__typename :Category]) #ordered/map ([:id 1fb59e17-a703-5abc-8a80-fc7a9c20ee1d] [:name Video/Film-Kameras] [:__typename :Category]) #ordered/map ([:id c17698c1-5d5d-51ea-927f-b6ca96431a50] [:name Video/Film-Stative] [:__typename :Category]) #ordered/map ([:id fabe3b8c-58b5-5009-8873-cc3e945a7c0d] [:name Video/Filmobjektive] [:__typename :Category]) #ordered/map ([:id ebb12585-ce23-5cbe-8f4f-41a42d60a656] [:name Zuteilung unbekannt - Audio- und Videotechnik] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 1a047acd-dc98-52c2-99d3-dc6332adc1e0] [:name Bauliche Anpassungen und Mobiliar] [:categories [#ordered/map ([:id 0a082661-cc1c-5b49-baab-f4db926faa7e] [:name Bauprojekte] [:__typename :Category]) #ordered/map ([:id 42cc2d9a-cc45-5d77-85d3-0f21270d7a35] [:name Einrichtungsprojekte] [:__typename :Category]) #ordered/map ([:id 56aaec64-8d65-50b3-bd81-f788d477b927] [:name Mobiliarergänzungen] [:__typename :Category]) #ordered/map ([:id 483ac871-b632-5dcd-9d37-789d65f4c424] [:name Schliessanlagen und Türen] [:__typename :Category]) #ordered/map ([:id 2b3749a2-6a59-5a25-9b9f-32f5e485e635] [:name Signaletik] [:__typename :Category]) #ordered/map ([:id fad911e4-8c69-535c-a138-f3e2544519ba] [:name Vorhänge] [:__typename :Category]) #ordered/map ([:id c3f14f79-931c-52c8-a847-ed77449ce9a6] [:name Zuteilung unbekannt - Bauliche Anpassungen und Mobiliar] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id dda588f4-660c-573c-a2ff-944ae93ad42e] [:name Beleuchtungstechnik] [:categories [#ordered/map ([:id b9e4f492-55e3-57e4-9467-91c81bfe2325] [:name Bühnenlicht] [:__typename :Category]) #ordered/map ([:id a7cca5a4-e265-5f36-b794-1024c8aacc3e] [:name Film-Beleuchtung] [:__typename :Category]) #ordered/map ([:id 79822b89-0edb-588c-b9e5-65b7722ac50b] [:name Kameralicht] [:__typename :Category]) #ordered/map ([:id ab911807-6431-5ca7-890a-3573737bb4d3] [:name Mobiles Raumlicht für Ausstellungen] [:__typename :Category]) #ordered/map ([:id 64c6f8ad-a1b7-530b-946a-ebb1644ac897] [:name Studio-Licht] [:__typename :Category]) #ordered/map ([:id f2bb3f23-bb5b-5855-b03f-0166bd19fc0c] [:name Zuteilung unbekannt - Beleuchtungstechnik] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 2b07eb8a-4174-5257-83eb-920d536cc44a] [:name Betriebseinrichtungen und Fahrzeuge] [:categories [#ordered/map ([:id 5d8639a3-4569-5009-af28-f63f2af5209d] [:name Betriebseinrichtungen] [:__typename :Category]) #ordered/map ([:id b34f1cbb-4ac7-59a0-81f2-3ca7ecc94e71] [:name Fahrzeuge] [:__typename :Category]) #ordered/map ([:id 73e97867-43ea-5bee-b46b-d7c74fbf873b] [:name Hub- und Hebegeräte] [:__typename :Category]) #ordered/map ([:id b6601a86-b5d3-5682-88b6-cff956b00d7b] [:name Zuteilung unbekannt - Betriebseinrichtungen und Fahrzeuge] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id f6827594-33a6-5760-ac41-f94ceefacfab] [:name Bühnentechnik] [:categories [#ordered/map ([:id 455bc6dc-afbd-579d-a621-6d75e0fca9ea] [:name Bühnentechnik] [:__typename :Category]) #ordered/map ([:id 747b6b21-9fad-4a01-acd9-cd8983aed286] [:name Fundus] [:__typename :Category]) #ordered/map ([:id 07a6af37-e127-5f4b-94ec-698a5698d98c] [:name Zuteilung unbekannt - Bühnentechnik] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 517b82ae-2b7e-4822-9aeb-0d4753dec821] [:name Darlehen] [:categories [#ordered/map ([:id 671ab85c-b8c1-4659-9c6e-9ebe2f122a59] [:name Darlehen] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id ca1d97ac-0ac4-597a-8edb-f9c466b1c7da] [:name Fotografie] [:categories [#ordered/map ([:id e1b4cad8-0416-5cf7-9e4a-dde208d0abad] [:name Blitzanlagen] [:__typename :Category]) #ordered/map ([:id 011ff3f3-09fa-59e1-9713-52466786adf8] [:name Fotokameras] [:__typename :Category]) #ordered/map ([:id 54b87eb0-061c-5a97-96ad-e9b6da605184] [:name Fotostative] [:__typename :Category]) #ordered/map ([:id 5858ec5d-5f01-50fb-bc96-4b4766bd7799] [:name Kompakt-Blitze] [:__typename :Category]) #ordered/map ([:id ba5b41a7-4317-5160-9b82-b0931a48aec0] [:name Objektive] [:__typename :Category]) #ordered/map ([:id 9df68a66-4523-5072-aa31-1df9abeaa1c7] [:name Zuteilung unbekannt - Fotografie] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 2ea39047-e663-50d5-9080-838b75883704] [:name IT & Elektronik] [:categories [#ordered/map ([:id f2531d7e-d9ff-5c3e-9e88-6d3a16a89aa1] [:name Desktop] [:__typename :Category]) #ordered/map ([:id 1af3a7f2-b16a-4203-b6ac-f2c7be612d74] [:name IT_Projekte] [:__typename :Category]) #ordered/map ([:id ccab158d-79c7-5c28-a8a2-47cb4925f101] [:name IT-Basisinfrastruktur] [:__typename :Category]) #ordered/map ([:id eb1e7bef-80c6-4958-b16e-35555735ce61] [:name IT-Security] [:__typename :Category]) #ordered/map ([:id 4ecc9e97-2d12-5173-bd8c-781482c842e8] [:name Laptops] [:__typename :Category]) #ordered/map ([:id 80226a51-c17a-5fd8-93db-40aef5b03491] [:name Monitore] [:__typename :Category]) #ordered/map ([:id fe602c35-1097-52d0-acd0-40579d295f00] [:name Scanner] [:__typename :Category]) #ordered/map ([:id 56065d53-cd2f-5a39-9b66-532fd83ad2e6] [:name Schnittstellengeräte] [:__typename :Category]) #ordered/map ([:id fc7bc38c-62f3-5576-802f-c874e06ee776] [:name Software] [:__typename :Category]) #ordered/map ([:id 76fdca98-4a2a-5640-bc98-f33059d6ffa0] [:name Tablets] [:__typename :Category]) #ordered/map ([:id 77857566-03d9-58f4-8b0d-290227434aff] [:name Telefon] [:__typename :Category]) #ordered/map ([:id 5059c4fc-d34c-5c9a-9efe-257c7ec6fb6b] [:name Zuteilung unbekannt - IT & Elektronik] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id f6885671-3bf3-56f2-8e92-b5112d0f703f] [:name Musikinstrumente] [:categories [#ordered/map ([:id af3372a1-63a8-52dc-850e-c2ae91c1c078] [:name Musikinstrumente] [:__typename :Category]) #ordered/map ([:id 17a52112-1986-5074-b1d9-0faff29a785b] [:name Zuteilung unbekannt - Musikinstrumente] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 6c8a0d77-6711-5156-a59a-12425ba01cff] [:name Werkstatt-Technik] [:categories [#ordered/map ([:id 6870a16c-9a71-5e60-b94a-f0b784398fec] [:name Handwerkzeug] [:__typename :Category]) #ordered/map ([:id 771fddcf-b19a-5e6b-8b6f-7266b6922c4f] [:name Maschinen] [:__typename :Category]) #ordered/map ([:id c7ece4a6-2b5c-409f-96ea-e4fd6e8f9792] [:name Sicherheit] [:__typename :Category]) #ordered/map ([:id 3eaad5d5-516a-5610-8caf-342cfdcaac62] [:name Zuteilung unbekannt - Werkstatt-Technik] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id 6e16eaec-ff6f-5850-bcf9-a67038b019e0] [:name DDE] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 7259bd26-7af4-52d0-83e6-9d0be46e3c9d] [:name Design] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id fe7d2ef9-1d86-50b1-be23-4197ee5002f0] [:name Direktion] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id a80d7883-9e83-5d93-b7b7-11af0eee9142] [:name DDK] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 0fcff067-33c3-5ddf-8c95-2be79425fb58] [:name BA Theater] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id f6d6714c-c7fa-513a-8863-0f8db9899fd2] [:name DDK] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id f57d9be4-e051-4278-89e2-93509b722f1f] [:name DDK Produktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 30f4f288-ec31-53e7-beda-57a5fcdbfaac] [:name Direktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 4846f9d8-d504-44cf-95d9-23612bb30739] [:name Disziplin Film] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 4b51b317-e746-4db4-b9e6-dfc427a7ba26] [:name Disziplin Tanz] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id f9d45317-e9e3-489e-8f4b-0b7fa944931d] [:name Disziplin Theater] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id e9dc753a-0584-55e4-bb9e-e4b86d841ed5] [:name Institute Performing Arts + Film] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 464c31eb-0ba9-4c52-a7e7-f11b25d7c8d0] [:name Leitung] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id e7f865cd-c426-5d4e-b8be-f63fa395a5fa] [:name MA Film] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id f6a2c53d-2b9f-5ae8-a2f3-54e3f70e68ce] [:name NFH Tanz Akademie] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id dee5706d-5163-4259-bf3d-fe72e0c4a338] [:name DFA] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 529a71c7-b268-4661-9ecc-be0ccba3f00f] [:name BA Fine Arts] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 7b2faf21-d842-45b5-a5b0-1c8d590b8418] [:name Direktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 9c033410-cf0c-423e-ba8a-b07d68375cb9] [:name IFCAR] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id a305c3ae-bca3-429b-8395-b1a727d22a30] [:name MA DFA] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 23939ae1-2288-53cf-9d5b-54aaaa5e52c6] [:name DKM] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id da83d766-f73d-58e7-9299-ac75140812e0] [:name Direktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id d13b189b-319f-53d9-a33d-93450e7da352] [:name Institut für Gegenwartskünste] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 53266f06-6625-5967-9c39-d8e1941d8ae2] [:name DKV] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 2857586f-1ff0-4bc1-93f3-1050852cfe2a] [:name BA Art Education] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 06007991-b592-5d94-9b1e-a9156b393b84] [:name BA Vermittlung] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id a80f1fbb-5071-54c1-8757-a4cfd9b39a70] [:name Direktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 5656e676-663c-5402-9809-91f3f72ff4ad] [:name DKV] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 564e258b-ffda-4e57-aa89-f5e1f3aaef8d] [:name Forschung Art Eduacation] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 9161d8e2-9431-4bf7-8fea-279a6148c941] [:name Forschung Cultural Critique] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 7839f290-43e7-4957-84de-d075837e33d6] [:name FSP Ästhetik] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 314adc35-57a8-4119-bf8b-8fa9bcbeff9c] [:name FSP Kulturanalyse] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 4f5a58c5-c78e-53d7-a677-52072047952f] [:name FSP Transdisziplinarität] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id f67c24b6-3518-5b1c-8eef-54857ed7fc5f] [:name MA Art Education] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id bfee2323-2d85-4edb-a946-da54036a9244] [:name MA Cultural Critique] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id cf8c1737-60b6-58c5-9a66-02f10cb69194] [:name MA Transdisziplinarität] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 1486124f-b72f-4316-8b29-80b0e07d9bda] [:name Museum für Gestaltung] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 2c17d2e1-8df8-59f6-bfca-ba49aa6b921b] [:name Museum für Gestaltung Zürich] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id e84519d5-f877-58b5-9509-de82845342b8] [:name Propädeutikum] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 15876417-a25e-5cee-9f83-1a382ce6209a] [:name DMU] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 01f1470d-d97f-5f11-82eb-4ed40069d762] [:name Direktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 973fe7c5-2122-5965-9b22-1779f319ec06] [:name DMU] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 188ff0f7-9957-50f0-bfab-1a6303734a8b] [:name Forschung] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 51f80cb7-631c-5761-a4c7-ebaee6d0b818] [:name Inst. Computer Music + Sound Technology] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 12e8d4d4-f810-428b-9f46-c35333353593] [:name Institut for Music Research] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 66687f8e-6d83-4962-badb-efcd57700d9e] [:name Jazz & Pop] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 49679535-5619-54b5-bc48-d0692b08c59c] [:name Jazz + Pop] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 28f82510-4a16-5e6a-afd5-7c3ef44c2d8e] [:name Kirchenmusik] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id b3fc46c4-ae41-5905-9715-db6221171368] [:name Klassik I] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 7244df72-7e91-5a66-aeb6-07f52163bc6c] [:name Klassik II] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id af830cd6-8c3c-53db-b1d1-72258a6f33e0] [:name Klassik III] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id e6ff2869-4920-4307-93d1-20906c3e199b] [:name Komposition und Theorie] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 87dc9f2d-ef6d-5c65-bcd4-7d88a3e05743] [:name Musik + Bewegungspädagogik] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 4b3a3192-5d3c-51ae-989b-9dd8b8e8e306] [:name Pre College] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 88e7b28a-5e1a-5aae-8a02-336ab4d8710d] [:name Theorie] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id ab0bbd84-88e0-4355-be74-75d9b1926eb5] [:name Dossiers] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 74880d9f-4066-46c2-b118-cadb04703e42] [:name Dossier Lehre] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id d3fac247-5472-472e-a0f7-80fce2b19593] [:name Dossier Weiterbildung] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 8b0809c7-7f96-45e4-b821-0801bf4a41ba] [:name Dossiers] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id a5ecbe25-95e5-43d1-ab61-2a1abcad4ba6] [:name Forschung] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id e64b75d6-af09-5749-aac3-e4e0b9625842] [:name Rektorat] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 0a8c0f92-6e14-5b32-8a26-59c8633de2c3] [:name Rektorat] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id dc6b0705-5d02-563d-9194-db2ad8f85fef] [:name Services] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 72039dea-7ec1-5616-afa3-3772b84bed77] [:name Finanzen] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id f4e2fef4-1c52-57d0-b179-1767267c12cb] [:name FM] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 954e3858-15b5-5fc8-9dea-23d4b6af9ad8] [:name Hochschuladministration] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 81b6dd89-f7d8-48ac-8552-f9565ede8141] [:name HR] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 37bbe3df-7553-5d5f-82fa-7e9a2d94951a] [:name ITZ] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 552a8a15-7a48-5205-9aeb-a4b73ef8ca89] [:name TES] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 1a52b1ea-71ff-4e70-af9e-d3d6480c88d6] [:name Verwaltungsdirektion] [:shortname nil] [:__typename :Organization])]])]])}
2023-12-02T09:22:31.747Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "1a1dab20-c661-4204-a913-28065d570f7c"] [:name "2028"] [:inspection_start_date "2027-11-01 01:00:00.0"] [:end_date "2027-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "dfdd0798-6462-46fc-995f-a7d7233f30fd"] [:name "2027"] [:inspection_start_date "2026-11-02 01:00:00.0"] [:end_date "2026-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "6b689ed8-8148-485a-b1ca-86c1c739503e"] [:name "2026"] [:inspection_start_date "2025-11-03 01:00:00.0"] [:end_date "2025-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b"] [:name "2025"] [:inspection_start_date "2024-11-04 01:00:00.0"] [:end_date "2024-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"] [:name "2024"] [:inspection_start_date "2023-10-01 12:00:00.0"] [:end_date "2023-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"] [:name "2023"] [:inspection_start_date "2022-11-01 01:00:00.0"] [:end_date "2022-12-31 12:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "76b66d78-bfe0-4c54-8c92-edbf467af784"] [:name "2022"] [:inspection_start_date "2021-10-29 12:00:00.0"] [:end_date "2021-12-31 12:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "24171a61-aec6-428e-b7ed-7461b3795454"] [:name "2021"] [:inspection_start_date "2020-10-26 12:00:00.0"] [:end_date "2020-12-31 12:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3b7eab1e-c8b5-512b-9146-91cc295be955"] [:name "2020"] [:inspection_start_date "2019-11-09 12:00:00.0"] [:end_date "2019-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "9fb023db-725d-5881-8838-bae3e970ffd0"] [:name "2019"] [:inspection_start_date "2018-11-10 01:00:00.0"] [:end_date "2018-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"] [:name "2018"] [:inspection_start_date "2017-11-04 01:00:00.0"] [:end_date "2017-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "4f367b79-76cf-5f12-ab7b-535a7430e6da"] [:name "2016"] [:inspection_start_date "2016-11-01 01:00:00.0"] [:end_date "2017-01-30 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"] [:name "2017"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "519f7a95-9ca7-5256-bf63-142cfc23dc62"] [:name "Audio- und Videotechnik"] [:categories [#ordered/map ([:id "4e48b48c-e1bf-50d7-ab2d-9aa438c638de"] [:name "Beamer"] [:__typename :Category]) #ordered/map ([:id "a1727606-c7c8-54a2-aaa1-ceff7a7d4b40"] [:name "Funk-Strecken"] [:__typename :Category]) #ordered/map ([:id "00382e27-a87a-5313-b31b-a369dad6c5f8"] [:name "Lautsprecher"] [:__typename :Category]) #ordered/map ([:id "ce5424cc-ce77-5e67-8201-333ec20963eb"] [:name "Lautsprecherstative"] [:__typename :Category]) #ordered/map ([:id "ce0812d7-080b-5f49-8530-dd4a821c57b6"] [:name "Mikrofone"] [:__typename :Category]) #ordered/map ([:id "67e5fc60-6fe3-53bb-9495-3669b917038a"] [:name "Mikrofonstative"] [:__typename :Category]) #ordered/map ([:id "f94f72e8-ff65-5bad-b1f9-81ddd8fa7c0c"] [:name "Monitore / Screens"] [:__typename :Category]) #ordered/map ([:id "89e4a22f-7d6c-5006-b26a-3ef6f8f19630"] [:name "Schnittplatz / Mischpult / Regie"] [:__typename :Category]) #ordered/map ([:id "1fb59e17-a703-5abc-8a80-fc7a9c20ee1d"] [:name "Video/Film-Kameras"] [:__typename :Category]) #ordered/map ([:id "c17698c1-5d5d-51ea-927f-b6ca96431a50"] [:name "Video/Film-Stative"] [:__typename :Category]) #ordered/map ([:id "fabe3b8c-58b5-5009-8873-cc3e945a7c0d"] [:name "Video/Filmobjektive"] [:__typename :Category]) #ordered/map ([:id "ebb12585-ce23-5cbe-8f4f-41a42d60a656"] [:name "Zuteilung unbekannt - Audio- und Videotechnik"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "1a047acd-dc98-52c2-99d3-dc6332adc1e0"] [:name "Bauliche Anpassungen und Mobiliar"] [:categories [#ordered/map ([:id "0a082661-cc1c-5b49-baab-f4db926faa7e"] [:name "Bauprojekte"] [:__typename :Category]) #ordered/map ([:id "42cc2d9a-cc45-5d77-85d3-0f21270d7a35"] [:name "Einrichtungsprojekte"] [:__typename :Category]) #ordered/map ([:id "56aaec64-8d65-50b3-bd81-f788d477b927"] [:name "Mobiliarergänzungen"] [:__typename :Category]) #ordered/map ([:id "483ac871-b632-5dcd-9d37-789d65f4c424"] [:name "Schliessanlagen und Türen"] [:__typename :Category]) #ordered/map ([:id "2b3749a2-6a59-5a25-9b9f-32f5e485e635"] [:name "Signaletik"] [:__typename :Category]) #ordered/map ([:id "fad911e4-8c69-535c-a138-f3e2544519ba"] [:name "Vorhänge"] [:__typename :Category]) #ordered/map ([:id "c3f14f79-931c-52c8-a847-ed77449ce9a6"] [:name "Zuteilung unbekannt - Bauliche Anpassungen und Mobiliar"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "dda588f4-660c-573c-a2ff-944ae93ad42e"] [:name "Beleuchtungstechnik"] [:categories [#ordered/map ([:id "b9e4f492-55e3-57e4-9467-91c81bfe2325"] [:name "Bühnenlicht"] [:__typename :Category]) #ordered/map ([:id "a7cca5a4-e265-5f36-b794-1024c8aacc3e"] [:name "Film-Beleuchtung"] [:__typename :Category]) #ordered/map ([:id "79822b89-0edb-588c-b9e5-65b7722ac50b"] [:name "Kameralicht"] [:__typename :Category]) #ordered/map ([:id "ab911807-6431-5ca7-890a-3573737bb4d3"] [:name "Mobiles Raumlicht für Ausstellungen"] [:__typename :Category]) #ordered/map ([:id "64c6f8ad-a1b7-530b-946a-ebb1644ac897"] [:name "Studio-Licht"] [:__typename :Category]) #ordered/map ([:id "f2bb3f23-bb5b-5855-b03f-0166bd19fc0c"] [:name "Zuteilung unbekannt - Beleuchtungstechnik"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "2b07eb8a-4174-5257-83eb-920d536cc44a"] [:name "Betriebseinrichtungen und Fahrzeuge"] [:categories [#ordered/map ([:id "5d8639a3-4569-5009-af28-f63f2af5209d"] [:name "Betriebseinrichtungen"] [:__typename :Category]) #ordered/map ([:id "b34f1cbb-4ac7-59a0-81f2-3ca7ecc94e71"] [:name "Fahrzeuge"] [:__typename :Category]) #ordered/map ([:id "73e97867-43ea-5bee-b46b-d7c74fbf873b"] [:name "Hub- und Hebegeräte"] [:__typename :Category]) #ordered/map ([:id "b6601a86-b5d3-5682-88b6-cff956b00d7b"] [:name "Zuteilung unbekannt - Betriebseinrichtungen und Fahrzeuge"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "f6827594-33a6-5760-ac41-f94ceefacfab"] [:name "Bühnentechnik"] [:categories [#ordered/map ([:id "455bc6dc-afbd-579d-a621-6d75e0fca9ea"] [:name "Bühnentechnik"] [:__typename :Category]) #ordered/map ([:id "747b6b21-9fad-4a01-acd9-cd8983aed286"] [:name "Fundus"] [:__typename :Category]) #ordered/map ([:id "07a6af37-e127-5f4b-94ec-698a5698d98c"] [:name "Zuteilung unbekannt - Bühnentechnik"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "517b82ae-2b7e-4822-9aeb-0d4753dec821"] [:name "Darlehen"] [:categories [#ordered/map ([:id "671ab85c-b8c1-4659-9c6e-9ebe2f122a59"] [:name "Darlehen"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "ca1d97ac-0ac4-597a-8edb-f9c466b1c7da"] [:name "Fotografie"] [:categories [#ordered/map ([:id "e1b4cad8-0416-5cf7-9e4a-dde208d0abad"] [:name "Blitzanlagen"] [:__typename :Category]) #ordered/map ([:id "011ff3f3-09fa-59e1-9713-52466786adf8"] [:name "Fotokameras"] [:__typename :Category]) #ordered/map ([:id "54b87eb0-061c-5a97-96ad-e9b6da605184"] [:name "Fotostative"] [:__typename :Category]) #ordered/map ([:id "5858ec5d-5f01-50fb-bc96-4b4766bd7799"] [:name "Kompakt-Blitze"] [:__typename :Category]) #ordered/map ([:id "ba5b41a7-4317-5160-9b82-b0931a48aec0"] [:name "Objektive"] [:__typename :Category]) #ordered/map ([:id "9df68a66-4523-5072-aa31-1df9abeaa1c7"] [:name "Zuteilung unbekannt - Fotografie"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "2ea39047-e663-50d5-9080-838b75883704"] [:name "IT & Elektronik"] [:categories [#ordered/map ([:id "f2531d7e-d9ff-5c3e-9e88-6d3a16a89aa1"] [:name "Desktop"] [:__typename :Category]) #ordered/map ([:id "1af3a7f2-b16a-4203-b6ac-f2c7be612d74"] [:name "IT_Projekte"] [:__typename :Category]) #ordered/map ([:id "ccab158d-79c7-5c28-a8a2-47cb4925f101"] [:name "IT-Basisinfrastruktur"] [:__typename :Category]) #ordered/map ([:id "eb1e7bef-80c6-4958-b16e-35555735ce61"] [:name "IT-Security"] [:__typename :Category]) #ordered/map ([:id "4ecc9e97-2d12-5173-bd8c-781482c842e8"] [:name "Laptops"] [:__typename :Category]) #ordered/map ([:id "80226a51-c17a-5fd8-93db-40aef5b03491"] [:name "Monitore"] [:__typename :Category]) #ordered/map ([:id "fe602c35-1097-52d0-acd0-40579d295f00"] [:name "Scanner"] [:__typename :Category]) #ordered/map ([:id "56065d53-cd2f-5a39-9b66-532fd83ad2e6"] [:name "Schnittstellengeräte"] [:__typename :Category]) #ordered/map ([:id "fc7bc38c-62f3-5576-802f-c874e06ee776"] [:name "Software"] [:__typename :Category]) #ordered/map ([:id "76fdca98-4a2a-5640-bc98-f33059d6ffa0"] [:name "Tablets"] [:__typename :Category]) #ordered/map ([:id "77857566-03d9-58f4-8b0d-290227434aff"] [:name "Telefon"] [:__typename :Category]) #ordered/map ([:id "5059c4fc-d34c-5c9a-9efe-257c7ec6fb6b"] [:name "Zuteilung unbekannt - IT & Elektronik"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "f6885671-3bf3-56f2-8e92-b5112d0f703f"] [:name "Musikinstrumente"] [:categories [#ordered/map ([:id "af3372a1-63a8-52dc-850e-c2ae91c1c078"] [:name "Musikinstrumente"] [:__typename :Category]) #ordered/map ([:id "17a52112-1986-5074-b1d9-0faff29a785b"] [:name "Zuteilung unbekannt - Musikinstrumente"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "6c8a0d77-6711-5156-a59a-12425ba01cff"] [:name "Werkstatt-Technik"] [:categories [#ordered/map ([:id "6870a16c-9a71-5e60-b94a-f0b784398fec"] [:name "Handwerkzeug"] [:__typename :Category]) #ordered/map ([:id "771fddcf-b19a-5e6b-8b6f-7266b6922c4f"] [:name "Maschinen"] [:__typename :Category]) #ordered/map ([:id "c7ece4a6-2b5c-409f-96ea-e4fd6e8f9792"] [:name "Sicherheit"] [:__typename :Category]) #ordered/map ([:id "3eaad5d5-516a-5610-8caf-342cfdcaac62"] [:name "Zuteilung unbekannt - Werkstatt-Technik"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "6e16eaec-ff6f-5850-bcf9-a67038b019e0"] [:name "DDE"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "7259bd26-7af4-52d0-83e6-9d0be46e3c9d"] [:name "Design"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "fe7d2ef9-1d86-50b1-be23-4197ee5002f0"] [:name "Direktion"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "a80d7883-9e83-5d93-b7b7-11af0eee9142"] [:name "DDK"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "0fcff067-33c3-5ddf-8c95-2be79425fb58"] [:name "BA Theater"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f6d6714c-c7fa-513a-8863-0f8db9899fd2"] [:name "DDK"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f57d9be4-e051-4278-89e2-93509b722f1f"] [:name "DDK Produktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "30f4f288-ec31-53e7-beda-57a5fcdbfaac"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "4846f9d8-d504-44cf-95d9-23612bb30739"] [:name "Disziplin Film"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "4b51b317-e746-4db4-b9e6-dfc427a7ba26"] [:name "Disziplin Tanz"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f9d45317-e9e3-489e-8f4b-0b7fa944931d"] [:name "Disziplin Theater"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "e9dc753a-0584-55e4-bb9e-e4b86d841ed5"] [:name "Institute Performing Arts + Film"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "464c31eb-0ba9-4c52-a7e7-f11b25d7c8d0"] [:name "Leitung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "e7f865cd-c426-5d4e-b8be-f63fa395a5fa"] [:name "MA Film"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f6a2c53d-2b9f-5ae8-a2f3-54e3f70e68ce"] [:name "NFH Tanz Akademie"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "dee5706d-5163-4259-bf3d-fe72e0c4a338"] [:name "DFA"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "529a71c7-b268-4661-9ecc-be0ccba3f00f"] [:name "BA Fine Arts"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "7b2faf21-d842-45b5-a5b0-1c8d590b8418"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "9c033410-cf0c-423e-ba8a-b07d68375cb9"] [:name "IFCAR"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "a305c3ae-bca3-429b-8395-b1a727d22a30"] [:name "MA DFA"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "23939ae1-2288-53cf-9d5b-54aaaa5e52c6"] [:name "DKM"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "da83d766-f73d-58e7-9299-ac75140812e0"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "d13b189b-319f-53d9-a33d-93450e7da352"] [:name "Institut für Gegenwartskünste"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "53266f06-6625-5967-9c39-d8e1941d8ae2"] [:name "DKV"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "2857586f-1ff0-4bc1-93f3-1050852cfe2a"] [:name "BA Art Education"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "06007991-b592-5d94-9b1e-a9156b393b84"] [:name "BA Vermittlung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "a80f1fbb-5071-54c1-8757-a4cfd9b39a70"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "5656e676-663c-5402-9809-91f3f72ff4ad"] [:name "DKV"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "564e258b-ffda-4e57-aa89-f5e1f3aaef8d"] [:name "Forschung Art Eduacation"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "9161d8e2-9431-4bf7-8fea-279a6148c941"] [:name "Forschung Cultural Critique"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "7839f290-43e7-4957-84de-d075837e33d6"] [:name "FSP Ästhetik"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "314adc35-57a8-4119-bf8b-8fa9bcbeff9c"] [:name "FSP Kulturanalyse"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "4f5a58c5-c78e-53d7-a677-52072047952f"] [:name "FSP Transdisziplinarität"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f67c24b6-3518-5b1c-8eef-54857ed7fc5f"] [:name "MA Art Education"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "bfee2323-2d85-4edb-a946-da54036a9244"] [:name "MA Cultural Critique"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "cf8c1737-60b6-58c5-9a66-02f10cb69194"] [:name "MA Transdisziplinarität"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "1486124f-b72f-4316-8b29-80b0e07d9bda"] [:name "Museum für Gestaltung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "2c17d2e1-8df8-59f6-bfca-ba49aa6b921b"] [:name "Museum für Gestaltung Zürich"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "e84519d5-f877-58b5-9509-de82845342b8"] [:name "Propädeutikum"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "15876417-a25e-5cee-9f83-1a382ce6209a"] [:name "DMU"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "01f1470d-d97f-5f11-82eb-4ed40069d762"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "973fe7c5-2122-5965-9b22-1779f319ec06"] [:name "DMU"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "188ff0f7-9957-50f0-bfab-1a6303734a8b"] [:name "Forschung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "51f80cb7-631c-5761-a4c7-ebaee6d0b818"] [:name "Inst. Computer Music + Sound Technology"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "12e8d4d4-f810-428b-9f46-c35333353593"] [:name "Institut for Music Research"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "66687f8e-6d83-4962-badb-efcd57700d9e"] [:name "Jazz & Pop"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "49679535-5619-54b5-bc48-d0692b08c59c"] [:name "Jazz + Pop"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "28f82510-4a16-5e6a-afd5-7c3ef44c2d8e"] [:name "Kirchenmusik"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "b3fc46c4-ae41-5905-9715-db6221171368"] [:name "Klassik I"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "7244df72-7e91-5a66-aeb6-07f52163bc6c"] [:name "Klassik II"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "af830cd6-8c3c-53db-b1d1-72258a6f33e0"] [:name "Klassik III"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "e6ff2869-4920-4307-93d1-20906c3e199b"] [:name "Komposition und Theorie"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "87dc9f2d-ef6d-5c65-bcd4-7d88a3e05743"] [:name "Musik + Bewegungspädagogik"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "4b3a3192-5d3c-51ae-989b-9dd8b8e8e306"] [:name "Pre College"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "88e7b28a-5e1a-5aae-8a02-336ab4d8710d"] [:name "Theorie"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "ab0bbd84-88e0-4355-be74-75d9b1926eb5"] [:name "Dossiers"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "74880d9f-4066-46c2-b118-cadb04703e42"] [:name "Dossier Lehre"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "d3fac247-5472-472e-a0f7-80fce2b19593"] [:name "Dossier Weiterbildung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "8b0809c7-7f96-45e4-b821-0801bf4a41ba"] [:name "Dossiers"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "a5ecbe25-95e5-43d1-ab61-2a1abcad4ba6"] [:name "Forschung"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "e64b75d6-af09-5749-aac3-e4e0b9625842"] [:name "Rektorat"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "0a8c0f92-6e14-5b32-8a26-59c8633de2c3"] [:name "Rektorat"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "dc6b0705-5d02-563d-9194-db2ad8f85fef"] [:name "Services"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "72039dea-7ec1-5616-afa3-3772b84bed77"] [:name "Finanzen"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f4e2fef4-1c52-57d0-b179-1767267c12cb"] [:name "FM"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "954e3858-15b5-5fc8-9dea-23d4b6af9ad8"] [:name "Hochschuladministration"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "81b6dd89-f7d8-48ac-8552-f9565ede8141"] [:name "HR"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "37bbe3df-7553-5d5f-82fa-7e9a2d94951a"] [:name "ITZ"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "552a8a15-7a48-5205-9aeb-a4b73ef8ca89"] [:name "TES"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "1a52b1ea-71ff-4e70-af9e-d3d6480c88d6"] [:name "Verwaltungsdirektion"] [:shortname nil] [:__typename :Organization])]])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231374828212583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 3972, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x355a78a0 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 3972, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [5656e676-663c-5402-9809-91f3f72ff4ad], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:23:00.068Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:00.069Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:23:00.069Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:23:00.070Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:23:00.070Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false
2023-12-02T09:23:00.071Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:00.072Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:00.072Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:00.073Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:00.073Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-02T09:23:00.087Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MANDATORY" "MEDIUM"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search "", :organizations ["5656e676-663c-5402-9809-91f3f72ff4ad"], :categories [], :priority ["NORMAL" "HIGH"], :budgetPeriods ["1173b482-b9e6-46b4-a5e3-0b021c860e9b"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MANDATORY MEDIUM] {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [5656e676-663c-5402-9809-91f3f72ff4ad], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MANDATORY :MEDIUM], :organization_id [5656e676-663c-5402-9809-91f3f72ff4ad], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search , :priority [:NORMAL :HIGH], :budget_period_id [1173b482-b9e6-46b4-a5e3-0b021c860e9b], :category_id []}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>mainCats [{:id #uuid "519f7a95-9ca7-5256-bf63-142cfc23dc62", :name Audio- und Videotechnik} {:id #uuid "1a047acd-dc98-52c2-99d3-dc6332adc1e0", :name Bauliche Anpassungen und Mobiliar} {:id #uuid "dda588f4-660c-573c-a2ff-944ae93ad42e", :name Beleuchtungstechnik} {:id #uuid "2b07eb8a-4174-5257-83eb-920d536cc44a", :name Betriebseinrichtungen und Fahrzeuge} {:id #uuid "f6827594-33a6-5760-ac41-f94ceefacfab", :name Bühnentechnik} {:id #uuid "517b82ae-2b7e-4822-9aeb-0d4753dec821", :name Darlehen} {:id #uuid "ca1d97ac-0ac4-597a-8edb-f9c466b1c7da", :name Fotografie} {:id #uuid "2ea39047-e663-50d5-9080-838b75883704", :name IT & Elektronik} {:id #uuid "f6885671-3bf3-56f2-8e92-b5112d0f703f", :name Musikinstrumente} {:id #uuid "6c8a0d77-6711-5156-a59a-12425ba01cff", :name Werkstatt-Technik}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
>>resultA1 [{:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}]
>>resultA1-2 [{:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}]
>>requestsB2-triggerError {:inspector_priority [:LOW :MANDATORY :MEDIUM], :organization_id [5656e676-663c-5402-9809-91f3f72ff4ad], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search , :priority [:NORMAL :HIGH], :budget_period_id [1173b482-b9e6-46b4-a5e3-0b021c860e9b], :category_id []} nil
>o> helper1
>o> helper2 [] [1173b482-b9e6-46b4-a5e3-0b021c860e9b] [5656e676-663c-5402-9809-91f3f72ff4ad]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>oo> >>1 :NORMAL
>oo> >>1 :HIGH
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>oo> >>1 :LOW
>oo> >>1 :MANDATORY
>oo> >>1 :MEDIUM
low mandatory medium)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>oo> >>1 :NOT_PROCESSED
>oo> >>1 :IN_PROGRESS
>oo> >>1 :PROCURED
>oo> >>1 :ALTERNATIVE_PROCURED
>oo> >>1 :NOT_PROCURED
not_processed in_progress procured alternative_procured not_procured)
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
2023-12-02T09:23:00.102Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:00.103Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:00.103Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:00.104Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:00.105Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - (->> [viewer? inspector? admin?] (map (fn* [p1__39304#] (p1__39304# tx auth-entity))) (some true?)) => true
>o> helper7 true
>o> requests-base-query-with-state
>o> state-sql true
>o> s-map  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>o>map-4 (>o> map NEW
>o> map [:= :procurement_requests.approved_quantity nil]
:case >o> map NEW
[:= :procurement_requests.approved_quantity nil] >o> map APPROVED
>o> map [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]
NEW >o> map APPROVED
[:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] >o> map DENIED
>o> map [:= :procurement_requests.approved_quantity 0]
PARTIALLY_APPROVED >o> map DENIED
[:= :procurement_requests.approved_quantity 0] DENIED)
>o>map-5 (:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)
2023-12-02T09:23:00.105Z NX-41294 DEBUG [leihs.procurement.resources.request:171] - result => [[(:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED")]]
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low mandatory medium) (normal high)
>oo> enum (not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:23:00.106Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:00.106Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:00.107Z NX-41294 DEBUG [leihs.procurement.permissions.requests:25] - sqlmap => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]] [[[(:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED")]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category"]] [[[:row_to_json :models]] :model] [[:raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization"]] [[[:row_to_json :procurement_templates]] :template] [[:raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room"]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:and [:= true false] [:in :procurement_requests.budget_period_id ([:cast "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid])] [:in :procurement_requests.organization_id ([:cast "5656e676-663c-5402-9809-91f3f72ff4ad" :uuid])] [:in :procurement_requests.priority ("normal" "high")] [:in :procurement_requests.inspector_priority ("low" "mandatory" "medium")] [:or [:= :procurement_requests.approved_quantity nil] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] [:= :procurement_requests.approved_quantity 0]] [:in :procurement_requests.order_status ([[:cast "not_processed" :order_status_enum]] [[:cast "in_progress" :order_status_enum]] [[:cast "procured" :order_status_enum]] [[:cast "alternative_procured" :order_status_enum]] [[:cast "not_procured" :order_status_enum]])] [:or ["~~*" :buildings.name "%%"] ["~~*" :procurement_requests.short_id "%%"] ["~~*" :procurement_requests.article_name "%%"] ["~~*" :procurement_requests.article_number "%%"] ["~~*" :procurement_requests.inspection_comment "%%"] ["~~*" :procurement_requests.order_comment "%%"] ["~~*" :procurement_requests.motivation "%%"] ["~~*" :procurement_requests.receiver "%%"] ["~~*" :procurement_requests.supplier_name "%%"] ["~~*" :rooms.name "%%"] ["~~*" :models.product "%%"] ["~~*" :models.version "%%"] ["~~*" :users.firstname "%%"] ["~~*" :users.lastname "%%"]]]}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?)) AND ((procurement_requests.approved_quantity IS NULL) OR (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) OR ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) OR (procurement_requests.approved_quantity = ?)) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1173b482-b9e6-46b4-a5e3-0b021c860e9b 5656e676-663c-5402-9809-91f3f72ff4ad normal high low mandatory medium 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %%]
>o> query-requests, auth-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?)) AND ((procurement_requests.approved_quantity IS NULL) OR (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) OR ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) OR (procurement_requests.approved_quantity = ?)) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1173b482-b9e6-46b4-a5e3-0b021c860e9b 5656e676-663c-5402-9809-91f3f72ff4ad normal high low mandatory medium 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %%]
2023-12-02T09:23:00.109Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:00.110Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:00.110Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:00.111Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:00.112Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - (->> [viewer? inspector? admin?] (map (fn* [p1__39304#] (p1__39304# tx auth-entity))) (some true?)) => true
>e> #error {
 :cause ERROR: argument of OR must be type boolean, not type record
  Position: 3174
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: argument of OR must be type boolean, not type record
  Position: 3174
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11849 invoke result_set.clj 944]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 254]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 462]
  [leihs.procurement.resources.request$query_requests invoke request.clj 456]
  [leihs.procurement.resources.requests$get_requests invokeStatic requests.clj 236]
  [leihs.procurement.resources.requests$get_requests invoke requests.clj 224]
  [leihs.procurement.dashboard$get_dashboard invokeStatic dashboard.clj 209]
  [leihs.procurement.dashboard$get_dashboard invoke dashboard.clj 165]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44479 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-12-02T09:23:00.116Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - ERROR: argument of OR must be type boolean, not type record
  Position: 3174
2023-12-02T09:23:00.116Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause ERROR: argument of OR must be type boolean, not type record
  Position: 3174
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: argument of OR must be type boolean, not type record
  Position: 3174
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11849 invoke result_set.clj 944]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 254]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 462]
  [leihs.procurement.resources.request$query_requests invoke request.clj 456]
  [leihs.procurement.resources.requests$get_requests invokeStatic requests.clj 236]
  [leihs.procurement.resources.requests$get_requests invoke requests.clj 224]
  [leihs.procurement.dashboard$get_dashboard invokeStatic dashboard.clj 209]
  [leihs.procurement.dashboard$get_dashboard invoke dashboard.clj 165]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44479 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}

>oo>1pure-handler _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231374828212583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 3972, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors}, :async-channel #object[org.httpkit.server.AsyncChannel 0x355a78a0 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 3972, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [5656e676-663c-5402-9809-91f3f72ff4ad], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>o>3pure-handler, result=> {:data #ordered/map ([:dashboard nil]), :errors ({:message ERROR: argument of OR must be type boolean, not type record
  Position: 3174, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception PSQLException, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-02T09:23:00.117Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:dashboard nil]), :errors ({:message "ERROR: argument of OR must be type boolean, not type record\n  Position: 3174", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "PSQLException", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-02T09:23:00.117Z NX-41294 DEBUG [leihs.procurement.graphql:86] - {:data #ordered/map ([:dashboard nil]), :errors ({:message "ERROR: argument of OR must be type boolean, not type record\n  Position: 3174", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "PSQLException", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}

>o> ERROR 4pure-handler, result=> {:data #ordered/map ([:dashboard nil]), :errors ({:message ERROR: argument of OR must be type boolean, not type record
  Position: 3174, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception PSQLException, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231427875510750, :params {:return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {:return-to /procure}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6f8ccbf3 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {:return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x27c1c853 compojure.core$routes$fn__27950@27c1c853], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:23:53.100Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.104Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:23:53.104Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:23:53.105Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:23:53.106Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231427906492750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2d219bf8 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x56069856 leihs.procurement.backend.html$not_found_handler@56069856], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:23:53.124Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.125Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:23:53.125Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:23:53.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:23:53.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false
2023-12-02T09:23:53.126Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.127Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.127Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:53.128Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:53.128Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231428156184958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, pragma no-cache, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3f3e24e4 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:23:53.378Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.379Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
2023-12-02T09:23:53.380Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  inspector false
2023-12-02T09:23:53.381Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:23:53.382Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false
2023-12-02T09:23:53.383Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.383Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.385Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:53.386Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:53.387Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-02T09:23:53.390Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:23:53.392Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
>>>2 {:id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :firstname Urs, :lastname van Binsbergen}
>>oida>> #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:23:53.395Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>>>3 nil
2023-12-02T09:23:53.415Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.416Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.417Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

>oo>1pure-handler _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231428156184958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, pragma no-cache, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3f3e24e4 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>o>3pure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"6e1aae74-85d2-42a1-a803-d998943e2e69","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"23a3d006-581e-4dee-a717-4ac7d0fd7ab7","firstname":"Urs","lastname":"van Binsbergen","login":"uvanbins","email":"urs.vanbinsbergen@zhdk.ch"}},"subApps":{"borrow":true,"admin":true,"procure":false,"manage":[{"name":"Ausleihe Toni-Areal","href":"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily"},{"name":"IT-Zentrum","href":"/manage/5dd25b58-fa56-5095-bd97-2696d92c2fb1/daily"},{"name":"ITZ-Software","href":"/manage/3977012c-ce0e-501f-889b-8715fdb5d83b/daily"}]},"locales":[{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":true,"isSelected":true},{"name":"English","locale":"en-GB","active":true,"isDefault":false,"isSelected":false},{"name":"Castellano","locale":"es","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 23a3d006-581e-4dee-a717-4ac7d0fd7ab7] [:firstname Urs] [:lastname van Binsbergen] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung] [:__typename :ProcurementSettings])])}
2023-12-02T09:23:53.420Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"6e1aae74-85d2-42a1-a803-d998943e2e69\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"23a3d006-581e-4dee-a717-4ac7d0fd7ab7\",\"firstname\":\"Urs\",\"lastname\":\"van Binsbergen\",\"login\":\"uvanbins\",\"email\":\"urs.vanbinsbergen@zhdk.ch\"}},\"subApps\":{\"borrow\":true,\"admin\":true,\"procure\":false,\"manage\":[{\"name\":\"Ausleihe Toni-Areal\",\"href\":\"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily\"},{\"name\":\"IT-Zentrum\",\"href\":\"/manage/5dd25b58-fa56-5095-bd97-2696d92c2fb1/daily\"},{\"name\":\"ITZ-Software\",\"href\":\"/manage/3977012c-ce0e-501f-889b-8715fdb5d83b/daily\"}]},\"locales\":[{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Castellano\",\"locale\":\"es\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"] [:firstname "Urs"] [:lastname "van Binsbergen"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231428278476125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2e869f0c /127.0.0.1:3230<->/127.0.0.1:53768], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:23:53.500Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231428278299916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7a97f8b6 /127.0.0.1:3230<->/127.0.0.1:53760], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:23:53.504Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.506Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.508Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  admin true
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44359 0x468bd872 leihs.core.locale$wrap$fn__44359@468bd872]

>> authorize::request > {:authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} 2023-12-02T09:23:53.509Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
{:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231428278214875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 3972, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3e399e21 /127.0.0.1:3230<->/127.0.0.1:53759], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 3972, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [5656e676-663c-5402-9809-91f3f72ff4ad], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, >myprint> :accept  inspector {:mimefalse 
:json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights (>myprint> { :role inventory_manager, admin:inventory_pool_id  #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} true{:role inventory_manager, :inventory_pool_id 
#uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  txn {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}
2023-12-02T09:23:53.510Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:53.510Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  viewer false
2023-12-02T09:23:53.510Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:53.511Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
2023-12-02T09:23:53.511Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>myprint>  requester false
2023-12-02T09:23:53.511Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  admin true
>myprint>  inspector false
2023-12-02T09:23:53.512Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:53.512Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.512Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
>myprint>  inspector false
>myprint>  viewer false
2023-12-02T09:23:53.513Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
2023-12-02T09:23:53.512Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:53.512Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
>myprint>  viewer false
2023-12-02T09:23:53.514Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>myprint>  requester false
2023-12-02T09:23:53.514Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:53.514Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
>myprint>  requester false
2023-12-02T09:23:53.514Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.515Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
2023-12-02T09:23:53.515Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.515Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.516Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:53.516Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-02T09:23:53.516Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:53.516Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
pure-handler >> 2
2023-12-02T09:23:53.517Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
2023-12-02T09:23:53.517Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
2023-12-02T09:23:53.518Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-02T09:23:53.520Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:23:53.521Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
>>>2 {:id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :firstname Urs, :lastname van Binsbergen}
>>oida>> #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:23:53.522Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>>>3 nil

> 1 anti-csrf-token >  6e1aae74-85d2-42a1-a803-d998943e2e69

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-02T09:23:53.530Z NX-41294 DEBUG [leihs.procurement.graphql:45] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MANDATORY" "MEDIUM"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search "", :organizations ["5656e676-663c-5402-9809-91f3f72ff4ad"], :categories [], :priority ["NORMAL" "HIGH"], :budgetPeriods ["1173b482-b9e6-46b4-a5e3-0b021c860e9b"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MANDATORY MEDIUM] {:inspector_priority [LOW MANDATORY MEDIUM], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search , :organizations [5656e676-663c-5402-9809-91f3f72ff4ad], :categories [], :priority [NORMAL HIGH], :budgetPeriods [1173b482-b9e6-46b4-a5e3-0b021c860e9b]}
2023-12-02T09:23:53.534Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.535Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MANDATORY :MEDIUM], :organization_id [5656e676-663c-5402-9809-91f3f72ff4ad], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search , :priority [:NORMAL :HIGH], :budget_period_id [1173b482-b9e6-46b4-a5e3-0b021c860e9b], :category_id []}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
2023-12-02T09:23:53.536Z NX-41294 DEBUG [leihs.procurement.permissions.user:86] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"]
>>mainCats [{:id #uuid "519f7a95-9ca7-5256-bf63-142cfc23dc62", :name Audio- und Videotechnik} {:id #uuid "1a047acd-dc98-52c2-99d3-dc6332adc1e0", :name Bauliche Anpassungen und Mobiliar} {:id #uuid "dda588f4-660c-573c-a2ff-944ae93ad42e", :name Beleuchtungstechnik} {:id #uuid "2b07eb8a-4174-5257-83eb-920d536cc44a", :name Betriebseinrichtungen und Fahrzeuge} {:id #uuid "f6827594-33a6-5760-ac41-f94ceefacfab", :name Bühnentechnik} {:id #uuid "517b82ae-2b7e-4822-9aeb-0d4753dec821", :name Darlehen} {:id #uuid "ca1d97ac-0ac4-597a-8edb-f9c466b1c7da", :name Fotografie} {:id #uuid "2ea39047-e663-50d5-9080-838b75883704", :name IT & Elektronik} {:id #uuid "f6885671-3bf3-56f2-8e92-b5112d0f703f", :name Musikinstrumente} {:id #uuid "6c8a0d77-6711-5156-a59a-12425ba01cff", :name Werkstatt-Technik}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
>>resultA1 [{:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}]
>>resultA1-2 [{:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}]
>>requestsB2-triggerError {:inspector_priority [:LOW :MANDATORY :MEDIUM], :organization_id [5656e676-663c-5402-9809-91f3f72ff4ad], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search , :priority [:NORMAL :HIGH], :budget_period_id [1173b482-b9e6-46b4-a5e3-0b021c860e9b], :category_id []} nil
>o> helper1
>o> helper2 [] [1173b482-b9e6-46b4-a5e3-0b021c860e9b] [5656e676-663c-5402-9809-91f3f72ff4ad]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>oo> >>1 :NORMAL
>oo> >>1 :HIGH
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>oo> >>1 :LOW
>oo> >>1 :MANDATORY
>oo> >>1 :MEDIUM
low mandatory medium)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>oo> >>1 :NOT_PROCESSED
>oo> >>1 :IN_PROGRESS
>oo> >>1 :PROCURED
>oo> >>1 :ALTERNATIVE_PROCURED
>oo> >>1 :NOT_PROCURED
not_processed in_progress procured alternative_procured not_procured)
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
2023-12-02T09:23:53.538Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-02T09:23:53.538Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:53.539Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.540Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.541Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - (->> [viewer? inspector? admin?] (map (fn* [p1__39304#] (p1__39304# tx auth-entity))) (some true?)) => true
>o> helper7 true
>o> requests-base-query-with-state
>o> state-sql true
>o> s-map  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>o>map-4 (>o> map NEW
>o> map [:= :procurement_requests.approved_quantity nil]
:case >o> map NEW
[:= :procurement_requests.approved_quantity nil] >o> map APPROVED
>o> map [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]
NEW >o> map APPROVED
[:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] >o> map DENIED
>o> map [:= :procurement_requests.approved_quantity 0]
PARTIALLY_APPROVED >o> map DENIED
[:= :procurement_requests.approved_quantity 0] DENIED)
>o>map-5 (:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)
2023-12-02T09:23:53.542Z NX-41294 DEBUG [leihs.procurement.resources.request:171] - result => [[(:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED")]]
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low mandatory medium) (normal high)
>oo> enum (not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"
2023-12-02T09:23:53.543Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.544Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.544Z NX-41294 DEBUG [leihs.procurement.permissions.requests:25] - sqlmap => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]] [[[(:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED")]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category"]] [[[:row_to_json :models]] :model] [[:raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization"]] [[[:row_to_json :procurement_templates]] :template] [[:raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room"]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by [[[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:and [:= true false] [:in :procurement_requests.budget_period_id ([:cast "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid])] [:in :procurement_requests.organization_id ([:cast "5656e676-663c-5402-9809-91f3f72ff4ad" :uuid])] [:in :procurement_requests.priority ("normal" "high")] [:in :procurement_requests.inspector_priority ("low" "mandatory" "medium")] [:or [:= :procurement_requests.approved_quantity nil] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] [:= :procurement_requests.approved_quantity 0]] [:in :procurement_requests.order_status ([[:cast "not_processed" :order_status_enum]] [[:cast "in_progress" :order_status_enum]] [[:cast "procured" :order_status_enum]] [[:cast "alternative_procured" :order_status_enum]] [[:cast "not_procured" :order_status_enum]])] [:or ["~~*" :buildings.name "%%"] ["~~*" :procurement_requests.short_id "%%"] ["~~*" :procurement_requests.article_name "%%"] ["~~*" :procurement_requests.article_number "%%"] ["~~*" :procurement_requests.inspection_comment "%%"] ["~~*" :procurement_requests.order_comment "%%"] ["~~*" :procurement_requests.motivation "%%"] ["~~*" :procurement_requests.receiver "%%"] ["~~*" :procurement_requests.supplier_name "%%"] ["~~*" :rooms.name "%%"] ["~~*" :models.product "%%"] ["~~*" :models.version "%%"] ["~~*" :users.firstname "%%"] ["~~*" :users.lastname "%%"]]]}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?)) AND ((procurement_requests.approved_quantity IS NULL) OR (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) OR ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) OR (procurement_requests.approved_quantity = ?)) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1173b482-b9e6-46b4-a5e3-0b021c860e9b 5656e676-663c-5402-9809-91f3f72ff4ad normal high low mandatory medium 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %%]
>o> query-requests, auth-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE (TRUE = FALSE) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?)) AND ((procurement_requests.approved_quantity IS NULL) OR (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) OR ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) OR (procurement_requests.approved_quantity = ?)) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((?, buildings.name, ?) OR (?, procurement_requests.short_id, ?) OR (?, procurement_requests.article_name, ?) OR (?, procurement_requests.article_number, ?) OR (?, procurement_requests.inspection_comment, ?) OR (?, procurement_requests.order_comment, ?) OR (?, procurement_requests.motivation, ?) OR (?, procurement_requests.receiver, ?) OR (?, procurement_requests.supplier_name, ?) OR (?, rooms.name, ?) OR (?, models.product, ?) OR (?, models.version, ?) OR (?, users.firstname, ?) OR (?, users.lastname, ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1173b482-b9e6-46b4-a5e3-0b021c860e9b 5656e676-663c-5402-9809-91f3f72ff4ad normal high low mandatory medium 0 0 not_processed in_progress procured alternative_procured not_procured ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %% ~~* %%]
2023-12-02T09:23:53.546Z NX-41294 DEBUG [leihs.procurement.permissions.user:78] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]

>oo>1pure-handler _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231428278476125, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2e869f0c /127.0.0.1:3230<->/127.0.0.1:53768], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>o>3pure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"6e1aae74-85d2-42a1-a803-d998943e2e69","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"23a3d006-581e-4dee-a717-4ac7d0fd7ab7","firstname":"Urs","lastname":"van Binsbergen","login":"uvanbins","email":"urs.vanbinsbergen@zhdk.ch"}},"subApps":{"borrow":true,"admin":true,"procure":false,"manage":[{"name":"Ausleihe Toni-Areal","href":"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily"},{"name":"IT-Zentrum","href":"/manage/5dd25b58-fa56-5095-bd97-2696d92c2fb1/daily"},{"name":"ITZ-Software","href":"/manage/3977012c-ce0e-501f-889b-8715fdb5d83b/daily"}]},"locales":[{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":true,"isSelected":true},{"name":"English","locale":"en-GB","active":true,"isDefault":false,"isSelected":false},{"name":"Castellano","locale":"es","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 23a3d006-581e-4dee-a717-4ac7d0fd7ab7] [:firstname Urs] [:lastname van Binsbergen] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung] [:__typename :ProcurementSettings])])}
2023-12-02T09:23:53.547Z NX-41294 DEBUG [leihs.procurement.permissions.user:59] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-02T09:23:53.547Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"6e1aae74-85d2-42a1-a803-d998943e2e69\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"23a3d006-581e-4dee-a717-4ac7d0fd7ab7\",\"firstname\":\"Urs\",\"lastname\":\"van Binsbergen\",\"login\":\"uvanbins\",\"email\":\"urs.vanbinsbergen@zhdk.ch\"}},\"subApps\":{\"borrow\":true,\"admin\":true,\"procure\":false,\"manage\":[{\"name\":\"Ausleihe Toni-Areal\",\"href\":\"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily\"},{\"name\":\"IT-Zentrum\",\"href\":\"/manage/5dd25b58-fa56-5095-bd97-2696d92c2fb1/daily\"},{\"name\":\"ITZ-Software\",\"href\":\"/manage/3977012c-ce0e-501f-889b-8715fdb5d83b/daily\"}]},\"locales\":[{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Castellano\",\"locale\":\"es\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "23a3d006-581e-4dee-a717-4ac7d0fd7ab7"] [:firstname "Urs"] [:lastname "van Binsbergen"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung"] [:__typename :ProcurementSettings])])}
2023-12-02T09:23:53.547Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - auth-entity => {:email "urs.vanbinsbergen@zhdk.ch", :contracts_count 4, :lastname "van Binsbergen", :org_id "244750", :scope_read true, :is_admin true, :authentication-method :session, :login "uvanbins", :scope_system_admin_write true, :scope_write true, :firstname "Urs", :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role "inventory_manager", :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role "customer", :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role "inventory_manager", :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role "customer", :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role "inventory_manager", :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role "customer", :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role "customer", :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role "customer", :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale "de-CH", :inventory_pool_roles_count 8, :scope_admin_read true}
2023-12-02T09:23:53.548Z NX-41294 DEBUG [leihs.procurement.permissions.user:25] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:has_entry true}
2023-12-02T09:23:53.548Z NX-41294 DEBUG [leihs.procurement.permissions.user:106] - (->> [viewer? inspector? admin?] (map (fn* [p1__39304#] (p1__39304# tx auth-entity))) (some true?)) => true
>e> #error {
 :cause ERROR: argument of OR must be type boolean, not type record
  Position: 3174
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: argument of OR must be type boolean, not type record
  Position: 3174
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11849 invoke result_set.clj 944]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 254]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 462]
  [leihs.procurement.resources.request$query_requests invoke request.clj 456]
  [leihs.procurement.resources.requests$get_requests invokeStatic requests.clj 236]
  [leihs.procurement.resources.requests$get_requests invoke requests.clj 224]
  [leihs.procurement.dashboard$get_dashboard invokeStatic dashboard.clj 209]
  [leihs.procurement.dashboard$get_dashboard invoke dashboard.clj 165]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44479 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-12-02T09:23:53.550Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - ERROR: argument of OR must be type boolean, not type record
  Position: 3174
2023-12-02T09:23:53.551Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause ERROR: argument of OR must be type boolean, not type record
  Position: 3174
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: argument of OR must be type boolean, not type record
  Position: 3174
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11841$fn__11849 invoke result_set.clj 944]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 254]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 462]
  [leihs.procurement.resources.request$query_requests invoke request.clj 456]
  [leihs.procurement.resources.requests$get_requests invokeStatic requests.clj 236]
  [leihs.procurement.resources.requests$get_requests invoke requests.clj 224]
  [leihs.procurement.dashboard$get_dashboard invokeStatic dashboard.clj 209]
  [leihs.procurement.dashboard$get_dashboard invoke dashboard.clj 165]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44479 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$execute_nested_selections$fn__17481 invoke executor.clj 197]
  [com.walmartlabs.lacinia.internal_utils$keepv$fn__12187 invoke internal_utils.clj 46]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.internal_utils$keepv invokeStatic internal_utils.clj 45]
  [com.walmartlabs.lacinia.internal_utils$keepv invoke internal_utils.clj 41]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invokeStatic executor.clj 197]
  [com.walmartlabs.lacinia.executor$execute_nested_selections invoke executor.clj 190]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}

>oo>1pure-handler _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 8, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value 6e1aae74-85d2-42a1-a803-d998943e2e69}, leihs-user-session {:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc}}, :remote-addr 127.0.0.1, :start-time 231428278299916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x44713e77 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x3004cd53 next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 6e1aae74-85d2-42a1-a803-d998943e2e69, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7a97f8b6 /127.0.0.1:3230<->/127.0.0.1:53760], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29031bc8 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x372e9e1b leihs.procurement.graphql$handler@372e9e1b], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>o>3pure-handler, result=> {:data #ordered/map ([:budget_periods [#ordered/map ([:id 1a1dab20-c661-4204-a913-28065d570f7c] [:name 2028] [:inspection_start_date 2027-11-01 01:00:00.0] [:end_date 2027-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id dfdd0798-6462-46fc-995f-a7d7233f30fd] [:name 2027] [:inspection_start_date 2026-11-02 01:00:00.0] [:end_date 2026-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 6b689ed8-8148-485a-b1ca-86c1c739503e] [:name 2026] [:inspection_start_date 2025-11-03 01:00:00.0] [:end_date 2025-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b] [:name 2025] [:inspection_start_date 2024-11-04 01:00:00.0] [:end_date 2024-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f] [:name 2024] [:inspection_start_date 2023-10-01 12:00:00.0] [:end_date 2023-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5] [:name 2023] [:inspection_start_date 2022-11-01 01:00:00.0] [:end_date 2022-12-31 12:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 76b66d78-bfe0-4c54-8c92-edbf467af784] [:name 2022] [:inspection_start_date 2021-10-29 12:00:00.0] [:end_date 2021-12-31 12:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 24171a61-aec6-428e-b7ed-7461b3795454] [:name 2021] [:inspection_start_date 2020-10-26 12:00:00.0] [:end_date 2020-12-31 12:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 3b7eab1e-c8b5-512b-9146-91cc295be955] [:name 2020] [:inspection_start_date 2019-11-09 12:00:00.0] [:end_date 2019-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 9fb023db-725d-5881-8838-bae3e970ffd0] [:name 2019] [:inspection_start_date 2018-11-10 01:00:00.0] [:end_date 2018-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d] [:name 2018] [:inspection_start_date 2017-11-04 01:00:00.0] [:end_date 2017-12-31 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id 4f367b79-76cf-5f12-ab7b-535a7430e6da] [:name 2016] [:inspection_start_date 2016-11-01 01:00:00.0] [:end_date 2017-01-30 01:00:00.0] [:__typename :BudgetPeriod]) #ordered/map ([:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1] [:name 2017] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id 519f7a95-9ca7-5256-bf63-142cfc23dc62] [:name Audio- und Videotechnik] [:categories [#ordered/map ([:id 4e48b48c-e1bf-50d7-ab2d-9aa438c638de] [:name Beamer] [:__typename :Category]) #ordered/map ([:id a1727606-c7c8-54a2-aaa1-ceff7a7d4b40] [:name Funk-Strecken] [:__typename :Category]) #ordered/map ([:id 00382e27-a87a-5313-b31b-a369dad6c5f8] [:name Lautsprecher] [:__typename :Category]) #ordered/map ([:id ce5424cc-ce77-5e67-8201-333ec20963eb] [:name Lautsprecherstative] [:__typename :Category]) #ordered/map ([:id ce0812d7-080b-5f49-8530-dd4a821c57b6] [:name Mikrofone] [:__typename :Category]) #ordered/map ([:id 67e5fc60-6fe3-53bb-9495-3669b917038a] [:name Mikrofonstative] [:__typename :Category]) #ordered/map ([:id f94f72e8-ff65-5bad-b1f9-81ddd8fa7c0c] [:name Monitore / Screens] [:__typename :Category]) #ordered/map ([:id 89e4a22f-7d6c-5006-b26a-3ef6f8f19630] [:name Schnittplatz / Mischpult / Regie] [:__typename :Category]) #ordered/map ([:id 1fb59e17-a703-5abc-8a80-fc7a9c20ee1d] [:name Video/Film-Kameras] [:__typename :Category]) #ordered/map ([:id c17698c1-5d5d-51ea-927f-b6ca96431a50] [:name Video/Film-Stative] [:__typename :Category]) #ordered/map ([:id fabe3b8c-58b5-5009-8873-cc3e945a7c0d] [:name Video/Filmobjektive] [:__typename :Category]) #ordered/map ([:id ebb12585-ce23-5cbe-8f4f-41a42d60a656] [:name Zuteilung unbekannt - Audio- und Videotechnik] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 1a047acd-dc98-52c2-99d3-dc6332adc1e0] [:name Bauliche Anpassungen und Mobiliar] [:categories [#ordered/map ([:id 0a082661-cc1c-5b49-baab-f4db926faa7e] [:name Bauprojekte] [:__typename :Category]) #ordered/map ([:id 42cc2d9a-cc45-5d77-85d3-0f21270d7a35] [:name Einrichtungsprojekte] [:__typename :Category]) #ordered/map ([:id 56aaec64-8d65-50b3-bd81-f788d477b927] [:name Mobiliarergänzungen] [:__typename :Category]) #ordered/map ([:id 483ac871-b632-5dcd-9d37-789d65f4c424] [:name Schliessanlagen und Türen] [:__typename :Category]) #ordered/map ([:id 2b3749a2-6a59-5a25-9b9f-32f5e485e635] [:name Signaletik] [:__typename :Category]) #ordered/map ([:id fad911e4-8c69-535c-a138-f3e2544519ba] [:name Vorhänge] [:__typename :Category]) #ordered/map ([:id c3f14f79-931c-52c8-a847-ed77449ce9a6] [:name Zuteilung unbekannt - Bauliche Anpassungen und Mobiliar] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id dda588f4-660c-573c-a2ff-944ae93ad42e] [:name Beleuchtungstechnik] [:categories [#ordered/map ([:id b9e4f492-55e3-57e4-9467-91c81bfe2325] [:name Bühnenlicht] [:__typename :Category]) #ordered/map ([:id a7cca5a4-e265-5f36-b794-1024c8aacc3e] [:name Film-Beleuchtung] [:__typename :Category]) #ordered/map ([:id 79822b89-0edb-588c-b9e5-65b7722ac50b] [:name Kameralicht] [:__typename :Category]) #ordered/map ([:id ab911807-6431-5ca7-890a-3573737bb4d3] [:name Mobiles Raumlicht für Ausstellungen] [:__typename :Category]) #ordered/map ([:id 64c6f8ad-a1b7-530b-946a-ebb1644ac897] [:name Studio-Licht] [:__typename :Category]) #ordered/map ([:id f2bb3f23-bb5b-5855-b03f-0166bd19fc0c] [:name Zuteilung unbekannt - Beleuchtungstechnik] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 2b07eb8a-4174-5257-83eb-920d536cc44a] [:name Betriebseinrichtungen und Fahrzeuge] [:categories [#ordered/map ([:id 5d8639a3-4569-5009-af28-f63f2af5209d] [:name Betriebseinrichtungen] [:__typename :Category]) #ordered/map ([:id b34f1cbb-4ac7-59a0-81f2-3ca7ecc94e71] [:name Fahrzeuge] [:__typename :Category]) #ordered/map ([:id 73e97867-43ea-5bee-b46b-d7c74fbf873b] [:name Hub- und Hebegeräte] [:__typename :Category]) #ordered/map ([:id b6601a86-b5d3-5682-88b6-cff956b00d7b] [:name Zuteilung unbekannt - Betriebseinrichtungen und Fahrzeuge] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id f6827594-33a6-5760-ac41-f94ceefacfab] [:name Bühnentechnik] [:categories [#ordered/map ([:id 455bc6dc-afbd-579d-a621-6d75e0fca9ea] [:name Bühnentechnik] [:__typename :Category]) #ordered/map ([:id 747b6b21-9fad-4a01-acd9-cd8983aed286] [:name Fundus] [:__typename :Category]) #ordered/map ([:id 07a6af37-e127-5f4b-94ec-698a5698d98c] [:name Zuteilung unbekannt - Bühnentechnik] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 517b82ae-2b7e-4822-9aeb-0d4753dec821] [:name Darlehen] [:categories [#ordered/map ([:id 671ab85c-b8c1-4659-9c6e-9ebe2f122a59] [:name Darlehen] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id ca1d97ac-0ac4-597a-8edb-f9c466b1c7da] [:name Fotografie] [:categories [#ordered/map ([:id e1b4cad8-0416-5cf7-9e4a-dde208d0abad] [:name Blitzanlagen] [:__typename :Category]) #ordered/map ([:id 011ff3f3-09fa-59e1-9713-52466786adf8] [:name Fotokameras] [:__typename :Category]) #ordered/map ([:id 54b87eb0-061c-5a97-96ad-e9b6da605184] [:name Fotostative] [:__typename :Category]) #ordered/map ([:id 5858ec5d-5f01-50fb-bc96-4b4766bd7799] [:name Kompakt-Blitze] [:__typename :Category]) #ordered/map ([:id ba5b41a7-4317-5160-9b82-b0931a48aec0] [:name Objektive] [:__typename :Category]) #ordered/map ([:id 9df68a66-4523-5072-aa31-1df9abeaa1c7] [:name Zuteilung unbekannt - Fotografie] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 2ea39047-e663-50d5-9080-838b75883704] [:name IT & Elektronik] [:categories [#ordered/map ([:id f2531d7e-d9ff-5c3e-9e88-6d3a16a89aa1] [:name Desktop] [:__typename :Category]) #ordered/map ([:id 1af3a7f2-b16a-4203-b6ac-f2c7be612d74] [:name IT_Projekte] [:__typename :Category]) #ordered/map ([:id ccab158d-79c7-5c28-a8a2-47cb4925f101] [:name IT-Basisinfrastruktur] [:__typename :Category]) #ordered/map ([:id eb1e7bef-80c6-4958-b16e-35555735ce61] [:name IT-Security] [:__typename :Category]) #ordered/map ([:id 4ecc9e97-2d12-5173-bd8c-781482c842e8] 
>oo>1pure-handler _> request [:name Laptops] [:__typename :Category]) {#ordered/map :leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email urs.vanbinsbergen@zhdk.ch, :contracts_count 4, :lastname van Binsbergen, :org_id 244750, :scope_read true, :is_admin true, :authentication-method :session, :login uvanbins, :scope_system_admin_write true, :scope_write true, :firstname Urs, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-01T15:27:00.957215Z", :id #uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7", :user_session_id #uuid "19f44e3b-805b-451e-8ed2-1969faedc3e1", :scope_system_admin_read true, :access-rights ({:role inventory_manager, :inventory_pool_id ([:id 80226a51-c17a-5fd8-93db-40aef5b03491] [:name Monitore] [:__typename :Category]) #ordered/map ([:id fe602c35-1097-52d0-acd0-40579d295f00] [:name Scanner] [:__typename :Category]) #ordered/map ([:id 56065d53-cd2f-5a39-9b66-532fd83ad2e6] [:name Schnittstellengeräte] [:__typename :Category]) #ordered/map ([:id fc7bc38c-62f3-5576-802f-c874e06ee776] [:name Software] [:__typename :Category]) #ordered/map ([:id 76fdca98-4a2a-5640-bc98-f33059d6ffa0] [:name Tablets] [:__typename :Category]) #ordered/map ([:id 77857566-03d9-58f4-8b0d-290227434aff] [:name Telefon] [:__typename :Category]) #ordered/map ([:id 5059c4fc-d34c-5c9a-9efe-257c7ec6fb6b] [:name Zuteilung unbekannt - IT & Elektronik] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id f6885671-3bf3-56f2-8e92-b5112d0f703f] [:name Musikinstrumente] [:categories [#ordered/map ([:id af3372a1-63a8-52dc-850e-c2ae91c1c078] [:name Musikinstrumente] [:__typename :Category]) #ordered/map ([:id 17a52112-1986-5074-b1d9-0faff29a785b] [:name Zuteilung unbekannt - Musikinstrumente] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id 6c8a0d77-6711-5156-a59a-12425ba01cff] [:name Werkstatt-Technik] [:categories [#ordered/map ([:id 6870a16c-9a71-5e60-b94a-f0b784398fec] [:name Handwerkzeug] [:__typename :Category]) #ordered/map ([:id 771fddcf-b19a-5e6b-8b6f-7266b6922c4f] [:name Maschinen] [:__typename :Category]) #ordered/map ([:id c7ece4a6-2b5c-409f-96ea-e4fd6e8f9792] [:name Sicherheit] [:__typename :Category]) #ordered/map ([:id 3eaad5d5-516a-5610-8caf-342cfdcaac62] [:name Zuteilung unbekannt - Werkstatt-Technik] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id 6e16eaec-ff6f-5850-bcf9-a67038b019e0] [:name DDE] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 7259bd26-7af4-52d0-83e6-9d0be46e3c9d] [:name Design] [:shortname nil] [#uuid "3977012c-ce0e-501f-889b-8715fdb5d83b":__typename :Organization]) #ordered/map (}[:id fe7d2ef9-1d86-50b1-be23-4197ee5002f0] [:name Direktion ] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id a80d7883-9e83-5d93-b7b7-11af0eee9142] [:name DDK] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map {([:id 0fcff067-33c3-5ddf-8c95-2be79425fb58] [:role:name BA Theater] [ :shortname nil] [:__typename :Organization]) #ordered/map customer, :inventory_pool_id ([:id f6d6714c-c7fa-513a-8863-0f8db9899fd2] [:name DDK] #uuid "5863967f-9804-4909-a9b7-92254616d6b2"}[ :shortname nil] [{:__typename :Organization]) #ordered/map :role inventory_manager, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"}( [:id {f57d9be4-e051-4278-89e2-93509b722f1f] :role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} [:name DDK Produktion] {:role [inventory_manager, :inventory_pool_id :shortname #uuid "8bd16d45-056d-5590-bc7f-12849f034351"}nil]  [{:__typename :Organization]) :role #ordered/map customer, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} ({[:role customer:id , 30f4f288-ec31-53e7-beda-57a5fcdbfaac] :inventory_pool_id [#uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"}:name  Direktion] [{:shortname :role nil]customer, :inventory_pool_id  #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), [:user_id :__typename#uuid "23a3d006-581e-4dee-a717-4ac7d0fd7ab7",  :Organization]) :is_system_admin #ordered/map ([true:id,  :external_sign_out_url 4846f9d8-d504-44cf-95d9-23612bb30739] nil, [:language_locale :name de-CH, Disziplin Film]:inventory_pool_roles_count  [8, :shortname :scope_admin_read nil]true},  :cookies [:__typename :Organization]) #ordered/map {leihs-anti-csrf-token ({:value [6e1aae74-85d2-42a1-a803-d998943e2e69}:id , 4b51b317-e746-4db4-b9e6-dfc427a7ba26]leihs-user-session  {[:value 883fc2af-3a55-41ff-b156-b0ce6d5ae1cc:name}},  Disziplin Tanz]:remote-addr  127.0.0.1, [:start-time :shortname nil]231428278214875,  :params [:__typename :Organization]) #ordered/map {}, :settings ([:id f9d45317-e9e3-489e-8f4b-0b7fa944931d]{ :email_sending_enabled [false, :name Disziplin Theater:sessions_max_lifetime_secs ] 432000, [:smtp_default_from_address noreply@zhdk.ch:shortname nil] , [:public_image_caching_enabled true:__typename, :sessions_force_secure  false:Organization]) , #ordered/map :deliver_received_order_notifications false, :external_base_url http://localhost:3200, ([:sessions_force_uniqueness :id false, e9dc753a-0584-55e4-bb9e-e4b86d841ed5]:email_signature Das ZHdK-Ausleihe-Team }, [:tx-next :name Institute Performing Arts + Film] [:shortname nil] [:__typename :Organization]) #ordered/map (#[next.jdbc.default_options.DefaultOptions:id 464c31eb-0ba9-4c52-a7e7-f11b25d7c8d0] [{:name Leitung] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id e7f865cd-c426-5d4e-b8be-f63fa395a5fa] [:connectable :name MA Film] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id f6a2c53d-2b9f-5ae8-a2f3-54e3f70e68ce] [:name NFH Tanz Akademie] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id dee5706d-5163-4259-bf3d-fe72e0c4a338] [:name DFA] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 529a71c7-b268-4661-9ecc-be0ccba3f00f] [:name BA Fine Arts] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 7b2faf21-d842-45b5-a5b0-1c8d590b8418] #object[[:name Direktion] [:shortname nil] com.zaxxer.hikari.HikariDataSource [:__typename :Organization]) #ordered/map ([:id 9c033410-cf0c-423e-ba8a-b07d68375cb9] [:name IFCAR] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id a305c3ae-bca3-429b-8395-b1a727d22a30] [:name MA DFA] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 23939ae1-2288-53cf-9d5b-54aaaa5e52c6] [:name DKM] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id da83d766-f73d-58e7-9299-ac75140812e0] [:name Direktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id d13b189b-319f-53d9-a33d-93450e7da352] [:name Institut für Gegenwartskünste] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 53266f06-6625-5967-9c39-d8e1941d8ae2] [:name DKV] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 2857586f-1ff0-4bc1-93f3-1050852cfe2a] [:name BA Art Education] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 06007991-b592-5d94-9b1e-a9156b393b84] [:name BA Vermittlung] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id a80f1fbb-5071-54c1-8757-a4cfd9b39a70] [:name Direktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 5656e676-663c-5402-9809-91f3f72ff4ad] [:name DKV] [:shortname nil] [:__typename :Organization]) #ordered/map 0x44713e77 (HikariDataSource (HikariPool-1)][, :id 564e258b-ffda-4e57-aa89-f5e1f3aaef8d] :options [:name Forschung Art Eduacation] [:shortname nil] {:builder-fn [:__typename :Organization]) #ordered/map ([:id 9161d8e2-9431-4bf7-8fea-279a6148c941] [:name #object[next.jdbc.result_set$as_unqualified_lower_mapsForschung Cultural Critique]  [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 7839f290-43e7-4957-84de-d075837e33d6] [:name FSP Ästhetik] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 314adc35-57a8-4119-bf8b-8fa9bcbeff9c] [:name FSP Kulturanalyse] [:shortname nil] [:__typename :Organization]) #ordered/map (0x3004cd53 [next.jdbc.result_set$as_unqualified_lower_maps@3004cd53]}:id} , 4f5a58c5-c78e-53d7-a677-52072047952f] [:name FSP Transdisziplinarität] [:shortname nil] [:__typename :Organization]) #ordered/map :query-params-raw ([:id f67c24b6-3518-5b1c-8eef-54857ed7fc5f] [:name MA Art Education] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id bfee2323-2d85-4edb-a946-da54036a9244] [:name MA Cultural Critique] [:shortname nil] [:__typename :Organization]) {#ordered/map }, (:route-params [nil, :id cf8c1737-60b6-58c5-9a66-02f10cb69194]:headers  [:name MA Transdisziplinarität] [:shortname nil] {[:__typename :Organization]) #ordered/map origin (http://localhost:3230, [sec-fetch-site same-origin, :id 1486124f-b72f-4316-8b29-80b0e07d9bda] sec-ch-ua-mobile [?0, :name Museum für Gestaltung] host [localhost:3230, :shortname user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, nil] content-type [application/json, :__typename :Organization]) cookie leihs-anti-csrf-token=6e1aae74-85d2-42a1-a803-d998943e2e69; leihs-user-session=883fc2af-3a55-41ff-b156-b0ce6d5ae1cc, #ordered/map content-length 3972, sec-ch-ua ("Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform ["macOS", :idreferer  http://localhost:3230/procure/requests, 2c17d2e1-8df8-59f6-bfca-ba49aa6b921b]connection  keep-alive, [pragma :nameno-cache,  x-csrf-token Museum für Gestaltung Zürich] 6e1aae74-85d2-42a1-a803-d998943e2e69, [accept :shortname application/json, nil]accept-language  de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest [empty, :__typename accept-encoding:Organization])  gzip, deflate, br, #ordered/map sec-fetch-mode cors, cache-control no-cache}, ([:async-channel :id e84519d5-f877-58b5-9509-de82845342b8] [:name Propädeutikum] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id 15876417-a25e-5cee-9f83-1a382ce6209a] [:name DMU] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id 01f1470d-d97f-5f11-82eb-4ed40069d762] [:name Direktion] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 973fe7c5-2122-5965-9b22-1779f319ec06] [:name DMU] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 188ff0f7-9957-50f0-bfab-1a6303734a8b] [:name Forschung] [:shortname nil] #object[org.httpkit.server.AsyncChannel [:__typename :Organization]) #ordered/map ([:id 51f80cb7-631c-5761-a4c7-ebaee6d0b818] [:name Inst. Computer Music + Sound Technology] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 12e8d4d4-f810-428b-9f46-c35333353593] [:name Institut for Music Research] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 66687f8e-6d83-4962-badb-efcd57700d9e] [:name Jazz & Pop] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 49679535-5619-54b5-bc48-d0692b08c59c] [:name Jazz + Pop] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 28f82510-4a16-5e6a-afd5-7c3ef44c2d8e] [:name Kirchenmusik] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id b3fc46c4-ae41-5905-9715-db6221171368] [:name Klassik I] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 7244df72-7e91-5a66-aeb6-07f52163bc6c] [:name Klassik II] [:shortname nil] 0x3e399e21 [:__typename/127.0.0.1:3230<->/127.0.0.1:53759] , :Organization]) #ordered/map :server-port ([:id af830cd6-8c3c-53db-b1d1-72258a6f33e0] [:name Klassik III] 3230, [:shortname nil] :params-raw [:__typename :Organization]) #ordered/map {}, (:tx [:id e6ff2869-4920-4307-93d1-20906c3e199b] {[:name Komposition und Theorie] [:shortname :datasource nil] [:__typename :Organization]) #ordered/map ([:id 87dc9f2d-ef6d-5c65-bcd4-7d88a3e05743] [:name Musik + Bewegungspädagogik] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 4b3a3192-5d3c-51ae-989b-9dd8b8e8e306] [:name Pre College] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 88e7b28a-5e1a-5aae-8a02-336ab4d8710d] [:name Theorie] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id ab0bbd84-88e0-4355-be74-75d9b1926eb5] [:name Dossiers] [:shortname nil] [:__typename :Organization] #object[[:organizations com.zaxxer.hikari.HikariDataSource [#ordered/map ([:id 74880d9f-4066-46c2-b118-cadb04703e42] [:name Dossier Lehre] [0x29031bc8 :shortname nil] HikariDataSource (db-pool)]}[, :__typename :Organization]) :content-length #ordered/map 3972, (:form-params [:id d3fac247-5472-472e-a0f7-80fce2b19593] {}, [:websocket? :name Dossier Weiterbildung] [:shortname nil] false, [:__typename:query-params  :Organization]) #ordered/map {}, (:content-type application/json, [:form-params-raw :id 8b0809c7-7f96-45e4-b821-0801bf4a41ba] {}, [:name Dossiers] :character-encoding [:shortname utf8nil],  [:uri :__typename /procure/graphql, :Organization]) :server-name localhost, #ordered/map :handler-key (:graphql, [:query-string:id  a5ecbe25-95e5-43d1-ab61-2a1abcad4ba6] nil, [:body :name Forschung] {[:shortname:operationName  nil]RequestsIndexFiltered,  [:variables :__typename :Organization])]]) #ordered/map {(:inspector_priority [:id e64b75d6-af09-5749-aac3-e4e0b9625842] [[:name LOW Rektorat] MANDATORY [MEDIUM], :shortname nil] :onlyOwnRequests [false, :__typename :Organization] :state [:organizations [NEW APPROVED [PARTIALLY_APPROVED #ordered/map DENIED], (:order_status [:id 0a8c0f92-6e14-5b32-8a26-59c8633de2c3][ NOT_PROCESSED IN_PROGRESS PROCURED [ALTERNATIVE_PROCURED NOT_PROCURED]:name,  Rektorat]:search  , [:organizations :shortname nil] [[5656e676-663c-5402-9809-91f3f72ff4ad], :__typename :categories :Organization])]]) [#ordered/map ], :priority ([NORMAL [HIGH], :id :budgetPeriods dc6b0705-5d02-563d-9194-db2ad8f85fef] [1173b482-b9e6-46b4-a5e3-0b021c860e9b][}, :name Services:query ] [query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :shortname :graphql-schema nil] #CompiledSchema<>, [:handler :__typename :Organization] [:organizations [#ordered/map #object[(leihs.procurement.graphql$handler [:id 72039dea-7ec1-5616-afa3-3772b84bed77] [:name Finanzen] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id f4e2fef4-1c52-57d0-b179-1767267c12cb] [:name FM] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 954e3858-15b5-5fc8-9dea-23d4b6af9ad8] [:name Hochschuladministration] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 81b6dd89-f7d8-48ac-8552-f9565ede8141] [:name HR] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 37bbe3df-7553-5d5f-82fa-7e9a2d94951a] [:name ITZ] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 552a8a15-7a48-5205-9aeb-a4b73ef8ca89] [:name TES] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id 1a52b1ea-71ff-4e70-af9e-d3d6480c88d6] [:name Verwaltungsdirektion] [:shortname nil] [:__typename :Organization])]])]])0x372e9e1b }leihs.procurement.graphql$handler@372e9e1b], :multipart-params 
{}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-12-02T09:23:53.572Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "1a1dab20-c661-4204-a913-28065d570f7c"] [:name "2028"] [:inspection_start_date "2027-11-01 01:00:00.0"] [:end_date "2027-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "dfdd0798-6462-46fc-995f-a7d7233f30fd"] [:name "2027"] [:inspection_start_date "2026-11-02 01:00:00.0"] [:end_date "2026-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "6b689ed8-8148-485a-b1ca-86c1c739503e"] [:name "2026"] [:inspection_start_date "2025-11-03 01:00:00.0"] [:end_date "2025-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b"] [:name "2025"] [:inspection_start_date "2024-11-04 01:00:00.0"] [:end_date "2024-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"] [:name "2024"] [:inspection_start_date "2023-10-01 12:00:00.0"] [:end_date "2023-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"] [:name "2023"] [:inspection_start_date "2022-11-01 01:00:00.0"] [:end_date "2022-12-31 12:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "76b66d78-bfe0-4c54-8c92-edbf467af784"] [:name "2022"] [:inspection_start_date "2021-10-29 12:00:00.0"] [:end_date "2021-12-31 12:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "24171a61-aec6-428e-b7ed-7461b3795454"] [:name "2021"] [:inspection_start_date "2020-10-26 12:00:00.0"] [:end_date "2020-12-31 12:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3b7eab1e-c8b5-512b-9146-91cc295be955"] [:name "2020"] [:inspection_start_date "2019-11-09 12:00:00.0"] [:end_date "2019-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "9fb023db-725d-5881-8838-bae3e970ffd0"] [:name "2019"] [:inspection_start_date "2018-11-10 01:00:00.0"] [:end_date "2018-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"] [:name "2018"] [:inspection_start_date "2017-11-04 01:00:00.0"] [:end_date "2017-12-31 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "4f367b79-76cf-5f12-ab7b-535a7430e6da"] [:name "2016"] [:inspection_start_date "2016-11-01 01:00:00.0"] [:end_date "2017-01-30 01:00:00.0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"] [:name "2017"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "519f7a95-9ca7-5256-bf63-142cfc23dc62"] [:name "Audio- und Videotechnik"] [:categories [#ordered/map ([:id "4e48b48c-e1bf-50d7-ab2d-9aa438c638de"] [:name "Beamer"] [:__typename :Category]) #ordered/map ([:id "a1727606-c7c8-54a2-aaa1-ceff7a7d4b40"] [:name "Funk-Strecken"] [:__typename :Category]) #ordered/map ([:id "00382e27-a87a-5313-b31b-a369dad6c5f8"] [:name "Lautsprecher"] [:__typename :Category]) #ordered/map ([:id "ce5424cc-ce77-5e67-8201-333ec20963eb"] [:name "Lautsprecherstative"] [:__typename :Category]) #ordered/map ([:id "ce0812d7-080b-5f49-8530-dd4a821c57b6"] [:name "Mikrofone"] [:__typename :Category]) #ordered/map ([:id "67e5fc60-6fe3-53bb-9495-3669b917038a"] [:name "Mikrofonstative"] [:__typename :Category]) #ordered/map ([:id "f94f72e8-ff65-5bad-b1f9-81ddd8fa7c0c"] [:name "Monitore / Screens"] [:__typename :Category]) #ordered/map ([:id "89e4a22f-7d6c-5006-b26a-3ef6f8f19630"] [:name "Schnittplatz / Mischpult / Regie"] [:__typename :Category]) #ordered/map ([:id "1fb59e17-a703-5abc-8a80-fc7a9c20ee1d"] [:name "Video/Film-Kameras"] [:__typename :Category]) #ordered/map ([:id "c17698c1-5d5d-51ea-927f-b6ca96431a50"] [:name "Video/Film-Stative"] [:__typename :Category]) #ordered/map ([:id "fabe3b8c-58b5-5009-8873-cc3e945a7c0d"] [:name "Video/Filmobjektive"] [:__typename :Category]) #ordered/map ([:id "ebb12585-ce23-5cbe-8f4f-41a42d60a656"] [:name "Zuteilung unbekannt - Audio- und Videotechnik"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "1a047acd-dc98-52c2-99d3-dc6332adc1e0"] [:name "Bauliche Anpassungen und Mobiliar"] [:categories [#ordered/map ([:id "0a082661-cc1c-5b49-baab-f4db926faa7e"] [:name "Bauprojekte"] [:__typename :Category]) #ordered/map ([:id "42cc2d9a-cc45-5d77-85d3-0f21270d7a35"] [:name "Einrichtungsprojekte"] [:__typename :Category]) #ordered/map ([:id "56aaec64-8d65-50b3-bd81-f788d477b927"] [:name "Mobiliarergänzungen"] [:__typename :Category]) #ordered/map ([:id "483ac871-b632-5dcd-9d37-789d65f4c424"] [:name "Schliessanlagen und Türen"] [:__typename :Category]) #ordered/map ([:id "2b3749a2-6a59-5a25-9b9f-32f5e485e635"] [:name "Signaletik"] [:__typename :Category]) #ordered/map ([:id "fad911e4-8c69-535c-a138-f3e2544519ba"] [:name "Vorhänge"] [:__typename :Category]) #ordered/map ([:id "c3f14f79-931c-52c8-a847-ed77449ce9a6"] [:name "Zuteilung unbekannt - Bauliche Anpassungen und Mobiliar"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "dda588f4-660c-573c-a2ff-944ae93ad42e"] [:name "Beleuchtungstechnik"] [:categories [#ordered/map ([:id "b9e4f492-55e3-57e4-9467-91c81bfe2325"] [:name "Bühnenlicht"] [:__typename :Category]) #ordered/map ([:id "a7cca5a4-e265-5f36-b794-1024c8aacc3e"] [:name "Film-Beleuchtung"] [:__typename :Category]) #ordered/map ([:id "79822b89-0edb-588c-b9e5-65b7722ac50b"] [:name "Kameralicht"] [:__typename :Category]) #ordered/map ([:id "ab911807-6431-5ca7-890a-3573737bb4d3"] [:name "Mobiles Raumlicht für Ausstellungen"] [:__typename :Category]) #ordered/map ([:id "64c6f8ad-a1b7-530b-946a-ebb1644ac897"] [:name "Studio-Licht"] [:__typename :Category]) #ordered/map ([:id "f2bb3f23-bb5b-5855-b03f-0166bd19fc0c"] [:name "Zuteilung unbekannt - Beleuchtungstechnik"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "2b07eb8a-4174-5257-83eb-920d536cc44a"] [:name "Betriebseinrichtungen und Fahrzeuge"] [:categories [#ordered/map ([:id "5d8639a3-4569-5009-af28-f63f2af5209d"] [:name "Betriebseinrichtungen"] [:__typename :Category]) #ordered/map ([:id "b34f1cbb-4ac7-59a0-81f2-3ca7ecc94e71"] [:name "Fahrzeuge"] [:__typename :Category]) #ordered/map ([:id "73e97867-43ea-5bee-b46b-d7c74fbf873b"] [:name "Hub- und Hebegeräte"] [:__typename :Category]) #ordered/map ([:id "b6601a86-b5d3-5682-88b6-cff956b00d7b"] [:name "Zuteilung unbekannt - Betriebseinrichtungen und Fahrzeuge"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "f6827594-33a6-5760-ac41-f94ceefacfab"] [:name "Bühnentechnik"] [:categories [#ordered/map ([:id "455bc6dc-afbd-579d-a621-6d75e0fca9ea"] [:name "Bühnentechnik"] [:__typename :Category]) #ordered/map ([:id "747b6b21-9fad-4a01-acd9-cd8983aed286"] [:name "Fundus"] [:__typename :Category]) #ordered/map ([:id "07a6af37-e127-5f4b-94ec-698a5698d98c"] [:name "Zuteilung unbekannt - Bühnentechnik"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "517b82ae-2b7e-4822-9aeb-0d4753dec821"] [:name "Darlehen"] [:categories [#ordered/map ([:id "671ab85c-b8c1-4659-9c6e-9ebe2f122a59"] [:name "Darlehen"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "ca1d97ac-0ac4-597a-8edb-f9c466b1c7da"] [:name "Fotografie"] [:categories [#ordered/map ([:id "e1b4cad8-0416-5cf7-9e4a-dde208d0abad"] [:name "Blitzanlagen"] [:__typename :Category]) #ordered/map ([:id "011ff3f3-09fa-59e1-9713-52466786adf8"] [:name "Fotokameras"] [:__typename :Category]) #ordered/map ([:id "54b87eb0-061c-5a97-96ad-e9b6da605184"] [:name "Fotostative"] [:__typename :Category]) #ordered/map ([:id "5858ec5d-5f01-50fb-bc96-4b4766bd7799"] [:name "Kompakt-Blitze"] [:__typename :Category]) #ordered/map ([:id "ba5b41a7-4317-5160-9b82-b0931a48aec0"] [:name "Objektive"] [:__typename :Category]) #ordered/map ([:id "9df68a66-4523-5072-aa31-1df9abeaa1c7"] [:name "Zuteilung unbekannt - Fotografie"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "2ea39047-e663-50d5-9080-838b75883704"] [:name "IT & Elektronik"] [:categories [#ordered/map ([:id "f2531d7e-d9ff-5c3e-9e88-6d3a16a89aa1"] [:name "Desktop"] [:__typename :Category]) #ordered/map ([:id "1af3a7f2-b16a-4203-b6ac-f2c7be612d74"] [:name "IT_Projekte"] [:__typename :Category]) #ordered/map ([:id "ccab158d-79c7-5c28-a8a2-47cb4925f101"] [:name "IT-Basisinfrastruktur"] [:__typename :Category]) #ordered/map ([:id "eb1e7bef-80c6-4958-b16e-35555735ce61"] [:name "IT-Security"] [:__typename :Category]) #ordered/map ([:id "4ecc9e97-2d12-5173-bd8c-781482c842e8"] [:name "Laptops"] [:__typename :Category]) #ordered/map ([:id "80226a51-c17a-5fd8-93db-40aef5b03491"] [:name "Monitore"] [:__typename :Category]) #ordered/map ([:id "fe602c35-1097-52d0-acd0-40579d295f00"] [:name "Scanner"] [:__typename :Category]) #ordered/map ([:id "56065d53-cd2f-5a39-9b66-532fd83ad2e6"] [:name "Schnittstellengeräte"] [:__typename :Category]) #ordered/map ([:id "fc7bc38c-62f3-5576-802f-c874e06ee776"] [:name "Software"] [:__typename :Category]) #ordered/map ([:id "76fdca98-4a2a-5640-bc98-f33059d6ffa0"] [:name "Tablets"] [:__typename :Category]) #ordered/map ([:id "77857566-03d9-58f4-8b0d-290227434aff"] [:name "Telefon"] [:__typename :Category]) #ordered/map ([:id "5059c4fc-d34c-5c9a-9efe-257c7ec6fb6b"] [:name "Zuteilung unbekannt - IT & Elektronik"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "f6885671-3bf3-56f2-8e92-b5112d0f703f"] [:name "Musikinstrumente"] [:categories [#ordered/map ([:id "af3372a1-63a8-52dc-850e-c2ae91c1c078"] [:name "Musikinstrumente"] [:__typename :Category]) #ordered/map ([:id "17a52112-1986-5074-b1d9-0faff29a785b"] [:name "Zuteilung unbekannt - Musikinstrumente"] [:__typename :Category])]] [:__typename :MainCategory]) #ordered/map ([:id "6c8a0d77-6711-5156-a59a-12425ba01cff"] [:name "Werkstatt-Technik"] [:categories [#ordered/map ([:id "6870a16c-9a71-5e60-b94a-f0b784398fec"] [:name "Handwerkzeug"] [:__typename :Category]) #ordered/map ([:id "771fddcf-b19a-5e6b-8b6f-7266b6922c4f"] [:name "Maschinen"] [:__typename :Category]) #ordered/map ([:id "c7ece4a6-2b5c-409f-96ea-e4fd6e8f9792"] [:name "Sicherheit"] [:__typename :Category]) #ordered/map ([:id "3eaad5d5-516a-5610-8caf-342cfdcaac62"] [:name "Zuteilung unbekannt - Werkstatt-Technik"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "6e16eaec-ff6f-5850-bcf9-a67038b019e0"] [:name "DDE"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "7259bd26-7af4-52d0-83e6-9d0be46e3c9d"] [:name "Design"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "fe7d2ef9-1d86-50b1-be23-4197ee5002f0"] [:name "Direktion"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "a80d7883-9e83-5d93-b7b7-11af0eee9142"] [:name "DDK"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "0fcff067-33c3-5ddf-8c95-2be79425fb58"] [:name "BA Theater"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f6d6714c-c7fa-513a-8863-0f8db9899fd2"] [:name "DDK"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f57d9be4-e051-4278-89e2-93509b722f1f"] [:name "DDK Produktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "30f4f288-ec31-53e7-beda-57a5fcdbfaac"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "4846f9d8-d504-44cf-95d9-23612bb30739"] [:name "Disziplin Film"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "4b51b317-e746-4db4-b9e6-dfc427a7ba26"] [:name "Disziplin Tanz"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f9d45317-e9e3-489e-8f4b-0b7fa944931d"] [:name "Disziplin Theater"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "e9dc753a-0584-55e4-bb9e-e4b86d841ed5"] [:name "Institute Performing Arts + Film"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "464c31eb-0ba9-4c52-a7e7-f11b25d7c8d0"] [:name "Leitung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "e7f865cd-c426-5d4e-b8be-f63fa395a5fa"] [:name "MA Film"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f6a2c53d-2b9f-5ae8-a2f3-54e3f70e68ce"] [:name "NFH Tanz Akademie"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "dee5706d-5163-4259-bf3d-fe72e0c4a338"] [:name "DFA"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "529a71c7-b268-4661-9ecc-be0ccba3f00f"] [:name "BA Fine Arts"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "7b2faf21-d842-45b5-a5b0-1c8d590b8418"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "9c033410-cf0c-423e-ba8a-b07d68375cb9"] [:name "IFCAR"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "a305c3ae-bca3-429b-8395-b1a727d22a30"] [:name "MA DFA"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "23939ae1-2288-53cf-9d5b-54aaaa5e52c6"] [:name "DKM"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "da83d766-f73d-58e7-9299-ac75140812e0"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "d13b189b-319f-53d9-a33d-93450e7da352"] [:name "Institut für Gegenwartskünste"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "53266f06-6625-5967-9c39-d8e1941d8ae2"] [:name "DKV"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "2857586f-1ff0-4bc1-93f3-1050852cfe2a"] [:name "BA Art Education"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "06007991-b592-5d94-9b1e-a9156b393b84"] [:name "BA Vermittlung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "a80f1fbb-5071-54c1-8757-a4cfd9b39a70"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "5656e676-663c-5402-9809-91f3f72ff4ad"] [:name "DKV"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "564e258b-ffda-4e57-aa89-f5e1f3aaef8d"] [:name "Forschung Art Eduacation"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "9161d8e2-9431-4bf7-8fea-279a6148c941"] [:name "Forschung Cultural Critique"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "7839f290-43e7-4957-84de-d075837e33d6"] [:name "FSP Ästhetik"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "314adc35-57a8-4119-bf8b-8fa9bcbeff9c"] [:name "FSP Kulturanalyse"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "4f5a58c5-c78e-53d7-a677-52072047952f"] [:name "FSP Transdisziplinarität"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f67c24b6-3518-5b1c-8eef-54857ed7fc5f"] [:name "MA Art Education"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "bfee2323-2d85-4edb-a946-da54036a9244"] [:name "MA Cultural Critique"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "cf8c1737-60b6-58c5-9a66-02f10cb69194"] [:name "MA Transdisziplinarität"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "1486124f-b72f-4316-8b29-80b0e07d9bda"] [:name "Museum für Gestaltung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "2c17d2e1-8df8-59f6-bfca-ba49aa6b921b"] [:name "Museum für Gestaltung Zürich"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "e84519d5-f877-58b5-9509-de82845342b8"] [:name "Propädeutikum"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "15876417-a25e-5cee-9f83-1a382ce6209a"] [:name "DMU"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "01f1470d-d97f-5f11-82eb-4ed40069d762"] [:name "Direktion"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "973fe7c5-2122-5965-9b22-1779f319ec06"] [:name "DMU"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "188ff0f7-9957-50f0-bfab-1a6303734a8b"] [:name "Forschung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "51f80cb7-631c-5761-a4c7-ebaee6d0b818"] [:name "Inst. Computer Music + Sound Technology"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "12e8d4d4-f810-428b-9f46-c35333353593"] [:name "Institut for Music Research"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "66687f8e-6d83-4962-badb-efcd57700d9e"] [:name "Jazz & Pop"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "49679535-5619-54b5-bc48-d0692b08c59c"] [:name "Jazz + Pop"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "28f82510-4a16-5e6a-afd5-7c3ef44c2d8e"] [:name "Kirchenmusik"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "b3fc46c4-ae41-5905-9715-db6221171368"] [:name "Klassik I"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "7244df72-7e91-5a66-aeb6-07f52163bc6c"] [:name "Klassik II"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "af830cd6-8c3c-53db-b1d1-72258a6f33e0"] [:name "Klassik III"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "e6ff2869-4920-4307-93d1-20906c3e199b"] [:name "Komposition und Theorie"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "87dc9f2d-ef6d-5c65-bcd4-7d88a3e05743"] [:name "Musik + Bewegungspädagogik"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "4b3a3192-5d3c-51ae-989b-9dd8b8e8e306"] [:name "Pre College"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "88e7b28a-5e1a-5aae-8a02-336ab4d8710d"] [:name "Theorie"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "ab0bbd84-88e0-4355-be74-75d9b1926eb5"] [:name "Dossiers"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "74880d9f-4066-46c2-b118-cadb04703e42"] [:name "Dossier Lehre"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "d3fac247-5472-472e-a0f7-80fce2b19593"] [:name "Dossier Weiterbildung"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "8b0809c7-7f96-45e4-b821-0801bf4a41ba"] [:name "Dossiers"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "a5ecbe25-95e5-43d1-ab61-2a1abcad4ba6"] [:name "Forschung"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "e64b75d6-af09-5749-aac3-e4e0b9625842"] [:name "Rektorat"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "0a8c0f92-6e14-5b32-8a26-59c8633de2c3"] [:name "Rektorat"] [:shortname nil] [:__typename :Organization])]]) #ordered/map ([:id "dc6b0705-5d02-563d-9194-db2ad8f85fef"] [:name "Services"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "72039dea-7ec1-5616-afa3-3772b84bed77"] [:name "Finanzen"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "f4e2fef4-1c52-57d0-b179-1767267c12cb"] [:name "FM"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "954e3858-15b5-5fc8-9dea-23d4b6af9ad8"] [:name "Hochschuladministration"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "81b6dd89-f7d8-48ac-8552-f9565ede8141"] [:name "HR"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "37bbe3df-7553-5d5f-82fa-7e9a2d94951a"] [:name "ITZ"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "552a8a15-7a48-5205-9aeb-a4b73ef8ca89"] [:name "TES"] [:shortname nil] [:__typename :Organization]) #ordered/map ([:id "1a52b1ea-71ff-4e70-af9e-d3d6480c88d6"] [:name "Verwaltungsdirektion"] [:shortname nil] [:__typename :Organization])]])]])}

>o>3pure-handler, result=> {:data #ordered/map ([:dashboard nil]), :errors ({:message ERROR: argument of OR must be type boolean, not type record
  Position: 3174, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception PSQLException, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-02T09:23:53.608Z NX-41294 DEBUG [leihs.procurement.graphql:85] - result => {:data #ordered/map ([:dashboard nil]), :errors ({:message "ERROR: argument of OR must be type boolean, not type record\n  Position: 3174", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "PSQLException", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-02T09:23:53.609Z NX-41294 DEBUG [leihs.procurement.graphql:86] - {:data #ordered/map ([:dashboard nil]), :errors ({:message "ERROR: argument of OR must be type boolean, not type record\n  Position: 3174", :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception "PSQLException", :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}

>o> ERROR 4pure-handler, result=> {:data #ordered/map ([:dashboard nil]), :errors ({:message ERROR: argument of OR must be type boolean, not type record
  Position: 3174, :locations [{:line 2, :column 3}], :path [:dashboard], :extensions {:exception PSQLException, :arguments {:inspector_priority $inspector_priority, :organization_id $organizations, :requested_by_auth_user $onlyOwnRequests, :state $state, :order_status $order_status, :search $search, :priority $priority, :budget_period_id $budgetPeriods, :category_id $categories}}})}
2023-12-02T11:05:57.656Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h6m35s315ms).
2023-12-02T11:05:57.666Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h6m35s313ms).
2023-12-02T11:55:27.970Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=49m30s304ms).
2023-12-02T11:55:27.965Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=49m30s316ms).
2023-12-02T12:56:25.271Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h27s291ms).
2023-12-02T12:56:25.275Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h27s290ms).
2023-12-02T13:57:21.596Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h26s306ms).
2023-12-02T13:57:21.601Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h26s307ms).
2023-12-02T14:58:17.972Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h26s352ms).
2023-12-02T14:58:17.969Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h26s349ms).
2023-12-02T15:49:10.819Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=50m22s834ms).
2023-12-02T15:49:10.819Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=50m22s834ms).
2023-12-02T15:59:44.367Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=10m33s547ms).
2023-12-02T15:59:44.367Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=10m33s547ms).
2023-12-02T16:31:46.671Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=32m2s305ms).
2023-12-02T16:31:46.671Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=32m2s305ms).
2023-12-02T17:00:40.771Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=28m54s99ms).
2023-12-02T17:00:40.771Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=28m54s100ms).
2023-12-02T17:06:28.441Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=5m47s670ms).
2023-12-02T17:06:28.441Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=5m47s671ms).
2023-12-02T18:01:19.822Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=54m21s373ms).
2023-12-02T18:01:19.819Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=54m21s373ms).
2023-12-02T18:37:25.867Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=35m36s33ms).
2023-12-02T18:37:25.871Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=35m36s35ms).
2023-12-02T18:56:28.690Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=19m2s818ms).
2023-12-02T18:56:28.690Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=19m2s822ms).
2023-12-02T18:58:27.039Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1m58s350ms).
2023-12-02T18:58:27.042Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1m58s354ms).
2023-12-02T18:59:43.852Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1m16s813ms).
2023-12-02T18:59:43.852Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1m16s809ms).
2023-12-02T20:16:58.985Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h16m45s74ms).
2023-12-02T20:16:58.985Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h16m45s72ms).
2023-12-02T21:24:48.450Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h7m19s451ms).
2023-12-02T21:24:48.453Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h7m19s453ms).
2023-12-02T21:34:40.008Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=9m51s558ms).
2023-12-02T21:34:40.008Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=9m51s554ms).
2023-12-02T22:07:13.153Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=32m33s145ms).
2023-12-02T22:07:13.155Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=32m33s148ms).
2023-12-02T22:35:34.286Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=28m21s133ms).
2023-12-02T22:35:34.286Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=28m21s130ms).
2023-12-02T22:53:17.055Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=17m42s770ms).
2023-12-02T22:53:17.055Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m42s770ms).
2023-12-02T22:59:38.223Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=6m21s167ms).
2023-12-02T22:59:38.223Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=6m21s167ms).
2023-12-02T23:15:46.816Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m8s592ms).
2023-12-02T23:15:46.815Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=16m8s592ms).
2023-12-02T23:17:49.584Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1m32s730ms).
2023-12-02T23:17:49.584Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1m32s731ms).
2023-12-02T23:52:19.352Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=34m29s768ms).
2023-12-02T23:52:19.352Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=34m29s768ms).
2023-12-03T00:36:45.899Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=44m26s547ms).
2023-12-03T00:36:45.899Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=44m26s547ms).
2023-12-03T01:19:38.836Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=42m22s921ms).
2023-12-03T01:19:38.850Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=42m22s928ms).
2023-12-03T01:37:01.675Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m22s825ms).
2023-12-03T01:37:01.675Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=17m22s840ms).
2023-12-03T03:02:49.817Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h25m48s142ms).
2023-12-03T03:02:49.814Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h25m48s138ms).
2023-12-03T04:28:49.205Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h25m59s391ms).
2023-12-03T04:28:49.206Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h25m59s389ms).
2023-12-03T05:00:08.499Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=30m49s264ms).
2023-12-03T05:00:08.499Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=30m49s264ms).
2023-12-03T06:09:56.916Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h9m18s403ms).
2023-12-03T06:09:56.916Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h9m18s401ms).
2023-12-03T06:30:12.046Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=20m15s130ms).
2023-12-03T06:30:12.046Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=20m15s130ms).
2023-12-03T07:05:11.396Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=34m59s350ms).
2023-12-03T07:05:11.395Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=34m59s349ms).
2023-12-03T07:31:08.500Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=25m57s104ms).
2023-12-03T07:31:08.499Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=25m57s103ms).
2023-12-03T07:47:37.287Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m28s788ms).
2023-12-03T07:47:37.287Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=16m28s788ms).
2023-12-03T08:32:04.978Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=44m27s690ms).
2023-12-03T08:32:04.978Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=44m27s691ms).
2023-12-03T09:14:43.156Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=42m8s149ms).
2023-12-03T09:14:43.157Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=42m8s146ms).
2023-12-03T10:42:59.433Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=52m46s7ms).
2023-12-03T10:42:59.420Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=52m46s3ms).
2023-12-03T12:05:53.292Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h22m53s872ms).
2023-12-03T12:05:53.292Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h22m53s858ms).
2023-12-03T12:51:52.911Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=45m59s619ms).
2023-12-03T12:51:52.911Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=45m59s620ms).
2023-12-03T13:09:06.657Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=17m13s747ms).
2023-12-03T13:09:06.657Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m13s745ms).
2023-12-03T13:52:49.639Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=43m42s983ms).
2023-12-03T13:52:49.637Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=43m42s980ms).
2023-12-03T14:53:45.847Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h26s221ms).
2023-12-03T14:53:45.847Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h26s221ms).
2023-12-03T15:54:42.288Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h26s395ms).
2023-12-03T15:54:42.288Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h26s394ms).
2023-12-03T16:55:38.663Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h26s345ms).
2023-12-03T16:55:38.663Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h26s345ms).
2023-12-03T17:45:41.511Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=49m32s835ms).
2023-12-03T17:45:41.511Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=49m32s835ms).
2023-12-03T17:56:36.353Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=10m54s841ms).
2023-12-03T17:56:36.352Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=10m54s840ms).
2023-12-03T18:48:00.214Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=50m53s817ms).
2023-12-03T18:48:00.212Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=50m53s817ms).
2023-12-03T18:58:02.807Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=10m2s592ms).
2023-12-03T18:58:02.807Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=10m2s595ms).
2023-12-03T19:32:37.149Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=34m34s342ms).
2023-12-03T19:32:37.149Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=34m34s342ms).
2023-12-03T19:58:59.382Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=26m22s233ms).
2023-12-03T19:58:59.382Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=26m22s233ms).
2023-12-03T20:34:01.801Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=35m2s419ms).
2023-12-03T20:34:01.801Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=35m2s419ms).
2023-12-03T20:59:55.929Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=25m54s128ms).
2023-12-03T20:59:55.929Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=25m54s128ms).
2023-12-03T21:18:05.745Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=18m9s817ms).
2023-12-03T21:18:05.745Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=18m9s817ms).
2023-12-03T22:00:52.403Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=42m46s657ms).
2023-12-03T22:00:52.403Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=42m46s657ms).
2023-12-03T22:17:34.856Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=16m42s453ms).
2023-12-03T22:17:34.856Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m42s453ms).
2023-12-03T23:01:51.509Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=44m16s654ms).
2023-12-03T23:01:51.509Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=44m16s654ms).
2023-12-04T00:38:50.015Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h36m28s476ms).
2023-12-04T00:38:50.015Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h36m28s474ms).
2023-12-04T01:58:27.802Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h19m37s787ms).
2023-12-04T01:58:27.802Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h19m37s786ms).
2023-12-04T02:55:58.202Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=57m370ms).
2023-12-04T02:55:58.203Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=57m371ms).
2023-12-04T03:48:46.047Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=52m17s814ms).
2023-12-04T03:48:46.047Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=52m17s814ms).
2023-12-04T04:57:03.792Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h8m17s745ms).
2023-12-04T04:57:03.792Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h8m17s745ms).
2023-12-04T05:25:26.605Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=27m52s772ms).
2023-12-04T05:25:26.605Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=27m52s774ms).
2023-12-04T05:29:07.295Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m10s661ms).
2023-12-04T05:29:07.299Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=3m10s660ms).
2023-12-04T05:58:01.291Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=28m53s993ms).
2023-12-04T05:58:01.291Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=28m53s997ms).
2023-12-04T06:58:57.663Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=1h26s355ms).
2023-12-04T06:58:57.678Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=1h26s370ms).
2023-12-04T07:46:02.391Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - db-pool - Thread starvation or clock leap detected (housekeeper delta=46m34s676ms).
2023-12-04T07:46:02.393Z NX-41294 WARN [com.zaxxer.hikari.pool.HikariPool:804] - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=46m34s678ms).
