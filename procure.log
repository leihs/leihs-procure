# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
2023-11-30T19:19:32.633Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-11-30T19:19:33.193Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :debug] [#{"*"} :debug]], :log-level :debug}
2023-11-30T19:19:33.200Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :debug] [#{"*"} :debug]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x11a148f "taoensso.timbre$default_output_fn@11a148f"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x1b1bf446 "taoensso.timbre.appenders.core$println_appender$fn__3459@1b1bf446"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level :debug}
2023-11-30T19:19:33.203Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-11-30T19:19:33.214Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 43931, :repl-port-file ".nrepl-port"}
2023-11-30T19:19:33.216Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  43931 localhost
2023-11-30T19:19:33.233Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-11-30T19:19:33.236Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 43931, :repl-port-file .nrepl-port}
2023-11-30T19:19:33.236Z NX-41294 INFO [leihs.core.shutdown:20] - PID 57482
2023-11-30T19:19:33.256Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-11-30T19:19:33.306Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-11-30T19:19:33.308Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-30T19:19:33.313Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1100] - db-pool - configuration:
2023-11-30T19:19:33.319Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - allowPoolSuspension.............false
2023-11-30T19:19:33.320Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - autoCommit......................true
2023-11-30T19:19:33.320Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - catalog.........................none
2023-11-30T19:19:33.320Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionInitSql...............none
2023-11-30T19:19:33.320Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionTestQuery.............none
2023-11-30T19:19:33.321Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionTimeout...............30000
2023-11-30T19:19:33.321Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSource......................none
2023-11-30T19:19:33.323Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceClassName............."org.postgresql.ds.PGSimpleDataSource"
2023-11-30T19:19:33.323Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceJNDI..................none
2023-11-30T19:19:33.324Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceProperties............{password=<masked>, databaseName=leihs_test, serverName=localhost, portNumber=5415}
2023-11-30T19:19:33.324Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - driverClassName.................none
2023-11-30T19:19:33.324Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - exceptionOverrideClassName......none
2023-11-30T19:19:33.324Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - healthCheckProperties...........{}
2023-11-30T19:19:33.324Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - healthCheckRegistry.............com.codahale.metrics.health.HealthCheckRegistry@4f71a08b
2023-11-30T19:19:33.324Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - idleTimeout.....................60000
2023-11-30T19:19:33.325Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - initializationFailTimeout.......1
2023-11-30T19:19:33.325Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - isolateInternalQueries..........false
2023-11-30T19:19:33.325Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - jdbcUrl.........................none
2023-11-30T19:19:33.325Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - keepaliveTime...................0
2023-11-30T19:19:33.325Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - leakDetectionThreshold..........0
2023-11-30T19:19:33.325Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - maxLifetime.....................3600000
2023-11-30T19:19:33.326Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - maximumPoolSize.................16
2023-11-30T19:19:33.326Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - metricRegistry..................com.codahale.metrics.MetricRegistry@72937149
2023-11-30T19:19:33.326Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - metricsTrackerFactory...........none
2023-11-30T19:19:33.326Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - minimumIdle.....................2
2023-11-30T19:19:33.326Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - password........................<masked>
2023-11-30T19:19:33.326Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - poolName........................"db-pool"
2023-11-30T19:19:33.327Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - readOnly........................false
2023-11-30T19:19:33.327Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - registerMbeans..................false
2023-11-30T19:19:33.327Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - scheduledExecutor...............none
2023-11-30T19:19:33.327Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - schema..........................none
2023-11-30T19:19:33.327Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - threadFactory...................internal
2023-11-30T19:19:33.327Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - transactionIsolation............default
2023-11-30T19:19:33.328Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - username........................"leihs"
2023-11-30T19:19:33.328Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - validationTimeout...............5000
2023-11-30T19:19:33.329Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-11-30T19:19:33.399Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@4b34fe56
2023-11-30T19:19:33.405Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-11-30T19:19:33.405Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 "HikariDataSource (db-pool)"]}
2023-11-30T19:19:33.406Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-11-30T19:19:33.418Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1100] - HikariPool-1 - configuration:
2023-11-30T19:19:33.418Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - allowPoolSuspension.............false
2023-11-30T19:19:33.419Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - autoCommit......................true
2023-11-30T19:19:33.419Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - catalog.........................none
2023-11-30T19:19:33.419Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionInitSql...............none
2023-11-30T19:19:33.419Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionTestQuery.............none
2023-11-30T19:19:33.419Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionTimeout...............30000
2023-11-30T19:19:33.419Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSource......................none
2023-11-30T19:19:33.420Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceClassName.............none
2023-11-30T19:19:33.420Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceJNDI..................none
2023-11-30T19:19:33.420Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceProperties............{password=<masked>}
2023-11-30T19:19:33.420Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - driverClassName.................none
2023-11-30T19:19:33.420Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - exceptionOverrideClassName......none
2023-11-30T19:19:33.420Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - healthCheckProperties...........{}
2023-11-30T19:19:33.420Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - healthCheckRegistry.............none
2023-11-30T19:19:33.421Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - idleTimeout.....................60000
2023-11-30T19:19:33.421Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - initializationFailTimeout.......1
2023-11-30T19:19:33.421Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - isolateInternalQueries..........false
2023-11-30T19:19:33.421Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - jdbcUrl.........................jdbc:postgresql://localhost:5415/leihs_test
2023-11-30T19:19:33.421Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - keepaliveTime...................0
2023-11-30T19:19:33.421Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - leakDetectionThreshold..........0
2023-11-30T19:19:33.422Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - maxLifetime.....................3600000
2023-11-30T19:19:33.422Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - maximumPoolSize.................16
2023-11-30T19:19:33.422Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - metricRegistry..................none
2023-11-30T19:19:33.422Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - metricsTrackerFactory...........none
2023-11-30T19:19:33.422Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - minimumIdle.....................2
2023-11-30T19:19:33.423Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - password........................<masked>
2023-11-30T19:19:33.423Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - poolName........................"HikariPool-1"
2023-11-30T19:19:33.423Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - readOnly........................false
2023-11-30T19:19:33.423Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - registerMbeans..................false
2023-11-30T19:19:33.423Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - scheduledExecutor...............none
2023-11-30T19:19:33.423Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - schema..........................none
2023-11-30T19:19:33.423Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - threadFactory...................internal
2023-11-30T19:19:33.424Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - transactionIsolation............default
2023-11-30T19:19:33.424Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - username........................"leihs"
2023-11-30T19:19:33.424Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - validationTimeout...............5000
2023-11-30T19:19:33.424Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-11-30T19:19:33.425Z NX-41294 DEBUG [com.zaxxer.hikari.util.DriverDataSource:107] - Loaded driver with class name org.postgresql.Driver for jdbcUrl=jdbc:postgresql://localhost:5415/leihs_test
2023-11-30T19:19:33.434Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@38af11ca
2023-11-30T19:19:33.435Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-11-30T19:19:33.440Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 "next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9"]}}
2023-11-30T19:19:33.447Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0xf49e46d "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0xa4de09f "java.util.concurrent.ThreadPoolExecutor@a4de09f[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-11-30T19:19:33.458Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
2023-11-30T19:19:33.510Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=1, active=0, idle=1, waiting=0)
2023-11-30T19:19:33.511Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=1, active=0, idle=1, waiting=0)
2023-11-30T19:19:33.518Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:738] - db-pool - Added connection org.postgresql.jdbc.PgConnection@40bd3054
2023-11-30T19:19:33.531Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After adding stats (total=2, active=0, idle=2, waiting=0)
2023-11-30T19:19:33.539Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=1, active=0, idle=1, waiting=0)
2023-11-30T19:19:33.539Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=1, active=0, idle=1, waiting=0)
2023-11-30T19:19:33.549Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:738] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@4d9e1fe
2023-11-30T19:19:33.562Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After adding stats (total=2, active=0, idle=2, waiting=0)
2023-11-30T19:19:38.024Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x43f59742 HikariProxyPreparedStatement@1140168514 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-11-30T19:19:38.024Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.027Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x43f59742 HikariProxyPreparedStatement@1140168514 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-11-30T19:19:38.027Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-11-30T19:19:38.029Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x43f59742 HikariProxyPreparedStatement@1140168514 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-11-30T19:19:38.030Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-11-30T19:19:38.031Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x43f59742 HikariProxyPreparedStatement@1140168514 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-11-30T19:19:38.032Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-11-30T19:19:38.045Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [jimmie@goyette.com #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 1]
2023-11-30T19:19:38.053Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar jimmie@goyette.com]
2023-11-30T19:19:38.053Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  jimmie@goyette.com
2023-11-30T19:19:38.053Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Procurement #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 2]
2023-11-30T19:19:38.054Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Procurement]
2023-11-30T19:19:38.054Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Procurement
2023-11-30T19:19:38.054Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 3]
2023-11-30T19:19:38.054Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.055Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.055Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Admin #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 6]
2023-11-30T19:19:38.055Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Admin]
2023-11-30T19:19:38.055Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Admin
2023-11-30T19:19:38.055Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 10]
2023-11-30T19:19:38.056Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.056Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.057Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 11]
2023-11-30T19:19:38.058Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.058Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.058Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 12]
2023-11-30T19:19:38.058Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.059Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.059Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "ee976158-523f-44e7-af58-f170c1d25e0c" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 13]
2023-11-30T19:19:38.059Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"]
2023-11-30T19:19:38.059Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"
2023-11-30T19:19:38.060Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-30T12:13:11.370422000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9dd6e7f org.postgresql.jdbc.PgResultSetMetaData@9dd6e7f] 14]
2023-11-30T19:19:38.060Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-30T12:13:11.370422000-00:00"]
2023-11-30T19:19:38.062Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-30T12:13:11.370422Z"
2023-11-30T19:19:38.064Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xdfd1f7c HikariProxyPreparedStatement@234692476 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.064Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44347 0x4bc04637 leihs.core.locale$wrap$fn__44347@4bc04637]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134498615593750, :params {:return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {:return-to /procure}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6da29d9b /127.0.0.1:3230<->/127.0.0.1:61095], :server-port 3230, :params-raw {:return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x24933d5d compojure.core$routes$fn__27950@24933d5d], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in
2023-11-30T19:19:38.072Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => true
2023-11-30T19:19:38.074Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x233a4d1e org.postgresql.jdbc.PgResultSetMetaData@233a4d1e] 1]
2023-11-30T19:19:38.077Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.077Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.077Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x233a4d1e org.postgresql.jdbc.PgResultSetMetaData@233a4d1e] 2]
2023-11-30T19:19:38.077Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.078Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.078Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x233a4d1e org.postgresql.jdbc.PgResultSetMetaData@233a4d1e] 1]
2023-11-30T19:19:38.078Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.078Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.078Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x233a4d1e org.postgresql.jdbc.PgResultSetMetaData@233a4d1e] 2]
2023-11-30T19:19:38.078Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.078Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.079Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x233a4d1e org.postgresql.jdbc.PgResultSetMetaData@233a4d1e] 1]
2023-11-30T19:19:38.079Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.079Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.079Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x233a4d1e org.postgresql.jdbc.PgResultSetMetaData@233a4d1e] 2]
2023-11-30T19:19:38.079Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.080Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.080Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x233a4d1e org.postgresql.jdbc.PgResultSetMetaData@233a4d1e] 1]
2023-11-30T19:19:38.080Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.080Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.081Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x233a4d1e org.postgresql.jdbc.PgResultSetMetaData@233a4d1e] 2]
2023-11-30T19:19:38.081Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.081Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.082Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x69481c06 org.postgresql.jdbc.PgResultSetMetaData@69481c06] 1]
2023-11-30T19:19:38.083Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.083Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.083Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x69481c06 org.postgresql.jdbc.PgResultSetMetaData@69481c06] 2]
2023-11-30T19:19:38.083Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.083Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.083Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x69481c06 org.postgresql.jdbc.PgResultSetMetaData@69481c06] 1]
2023-11-30T19:19:38.084Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.084Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.084Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x69481c06 org.postgresql.jdbc.PgResultSetMetaData@69481c06] 2]
2023-11-30T19:19:38.084Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.084Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.084Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x69481c06 org.postgresql.jdbc.PgResultSetMetaData@69481c06] 1]
2023-11-30T19:19:38.085Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.085Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.085Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x69481c06 org.postgresql.jdbc.PgResultSetMetaData@69481c06] 2]
2023-11-30T19:19:38.085Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.085Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.085Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x69481c06 org.postgresql.jdbc.PgResultSetMetaData@69481c06] 1]
2023-11-30T19:19:38.085Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.086Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.086Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x69481c06 org.postgresql.jdbc.PgResultSetMetaData@69481c06] 2]
2023-11-30T19:19:38.086Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.086Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.090Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 302, :headers {"Location" "/procure"}, :body ""}
2023-11-30T19:19:38.111Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x74fcc112 HikariProxyPreparedStatement@1962721554 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-11-30T19:19:38.111Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.114Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x74fcc112 HikariProxyPreparedStatement@1962721554 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-11-30T19:19:38.114Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-11-30T19:19:38.116Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x74fcc112 HikariProxyPreparedStatement@1962721554 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-11-30T19:19:38.116Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-11-30T19:19:38.117Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x74fcc112 HikariProxyPreparedStatement@1962721554 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-11-30T19:19:38.118Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-11-30T19:19:38.120Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [jimmie@goyette.com #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 1]
2023-11-30T19:19:38.120Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar jimmie@goyette.com]
2023-11-30T19:19:38.121Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  jimmie@goyette.com
2023-11-30T19:19:38.121Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Procurement #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 2]
2023-11-30T19:19:38.121Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Procurement]
2023-11-30T19:19:38.121Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Procurement
2023-11-30T19:19:38.121Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 3]
2023-11-30T19:19:38.121Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.121Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Admin #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 6]
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Admin]
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Admin
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 10]
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 11]
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.122Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.123Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 12]
2023-11-30T19:19:38.123Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.123Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.123Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "ee976158-523f-44e7-af58-f170c1d25e0c" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 13]
2023-11-30T19:19:38.123Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"]
2023-11-30T19:19:38.123Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"
2023-11-30T19:19:38.124Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-30T12:13:11.370422000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a05c2ab org.postgresql.jdbc.PgResultSetMetaData@4a05c2ab] 14]
2023-11-30T19:19:38.124Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-30T12:13:11.370422000-00:00"]
2023-11-30T19:19:38.124Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-30T12:13:11.370422Z"
2023-11-30T19:19:38.125Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x15d76565 HikariProxyPreparedStatement@366437733 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.125Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44347 0x4bc04637 leihs.core.locale$wrap$fn__44347@4bc04637]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134498766530208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4dc031f2 /127.0.0.1:3230<->/127.0.0.1:61095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x74d31510 leihs.procurement.backend.html$not_found_handler@74d31510], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
2023-11-30T19:19:38.128Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-30T19:19:38.129Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.130Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x198504ae HikariProxyPreparedStatement@428147886 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.130Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.132Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.133Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x4b01f4ee HikariProxyPreparedStatement@1258419438 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.133Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.134Z NX-41294 DEBUG [leihs.procurement.permissions.user:52] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_viewers) (sql/merge-where [:= :procurement_category_viewers.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_viewers.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.137Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6a916186 HikariProxyPreparedStatement@1787912582 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.137Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.139Z NX-41294 DEBUG [leihs.procurement.permissions.user:72] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.140Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5559b4b6 HikariProxyPreparedStatement@1431942326 wrapping SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.140Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.141Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39360#] (p1__39360# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-11-30T19:19:38.141Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x7c8261df org.postgresql.jdbc.PgResultSetMetaData@7c8261df] 1]
2023-11-30T19:19:38.142Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.142Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.142Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x7c8261df org.postgresql.jdbc.PgResultSetMetaData@7c8261df] 2]
2023-11-30T19:19:38.142Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.142Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.143Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x7c8261df org.postgresql.jdbc.PgResultSetMetaData@7c8261df] 1]
2023-11-30T19:19:38.143Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.143Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.143Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x7c8261df org.postgresql.jdbc.PgResultSetMetaData@7c8261df] 2]
2023-11-30T19:19:38.143Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.143Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.143Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x7c8261df org.postgresql.jdbc.PgResultSetMetaData@7c8261df] 1]
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x7c8261df org.postgresql.jdbc.PgResultSetMetaData@7c8261df] 2]
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x7c8261df org.postgresql.jdbc.PgResultSetMetaData@7c8261df] 1]
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.144Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x7c8261df org.postgresql.jdbc.PgResultSetMetaData@7c8261df] 2]
2023-11-30T19:19:38.145Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.145Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.147Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x59bb9013 org.postgresql.jdbc.PgResultSetMetaData@59bb9013] 1]
2023-11-30T19:19:38.148Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.148Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.148Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x59bb9013 org.postgresql.jdbc.PgResultSetMetaData@59bb9013] 2]
2023-11-30T19:19:38.149Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.149Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.149Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x59bb9013 org.postgresql.jdbc.PgResultSetMetaData@59bb9013] 1]
2023-11-30T19:19:38.149Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.149Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.149Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x59bb9013 org.postgresql.jdbc.PgResultSetMetaData@59bb9013] 2]
2023-11-30T19:19:38.149Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.149Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.150Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x59bb9013 org.postgresql.jdbc.PgResultSetMetaData@59bb9013] 1]
2023-11-30T19:19:38.150Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.150Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.150Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x59bb9013 org.postgresql.jdbc.PgResultSetMetaData@59bb9013] 2]
2023-11-30T19:19:38.150Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.150Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.150Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x59bb9013 org.postgresql.jdbc.PgResultSetMetaData@59bb9013] 1]
2023-11-30T19:19:38.150Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.151Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.151Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x59bb9013 org.postgresql.jdbc.PgResultSetMetaData@59bb9013] 2]
2023-11-30T19:19:38.151Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.151Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.154Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:status 404, :headers {"Content-Length" "2299", "Last-Modified" "Wed, 29 Nov 2023 08:52:54 GMT", "Content-Type" "text/html"}, :body #object[java.io.File 0x774ac555 "/Users/mradl/repos/leihs/procure/server/resources/public/procure/client/index.html"]}
2023-11-30T19:19:38.399Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6f14c1ee HikariProxyPreparedStatement@1863631342 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-11-30T19:19:38.399Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.400Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6f14c1ee HikariProxyPreparedStatement@1863631342 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-11-30T19:19:38.401Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-11-30T19:19:38.401Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6f14c1ee HikariProxyPreparedStatement@1863631342 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-11-30T19:19:38.401Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-11-30T19:19:38.402Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6f14c1ee HikariProxyPreparedStatement@1863631342 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-11-30T19:19:38.402Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-11-30T19:19:38.405Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [jimmie@goyette.com #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 1]
2023-11-30T19:19:38.405Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar jimmie@goyette.com]
2023-11-30T19:19:38.405Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  jimmie@goyette.com
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Procurement #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 2]
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Procurement]
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Procurement
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 3]
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Admin #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 6]
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Admin]
2023-11-30T19:19:38.406Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Admin
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 10]
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 11]
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 12]
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.407Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.408Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "ee976158-523f-44e7-af58-f170c1d25e0c" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 13]
2023-11-30T19:19:38.408Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"]
2023-11-30T19:19:38.408Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"
2023-11-30T19:19:38.408Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-30T12:13:11.370422000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f09e99a org.postgresql.jdbc.PgResultSetMetaData@6f09e99a] 14]
2023-11-30T19:19:38.408Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-30T12:13:11.370422000-00:00"]
2023-11-30T19:19:38.408Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-30T12:13:11.370422Z"
2023-11-30T19:19:38.409Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x41619f47 HikariProxyPreparedStatement@1096916807 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.409Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44347 0x4bc04637 leihs.core.locale$wrap$fn__44347@4bc04637]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134499015845458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7a5c7c53 /127.0.0.1:3230<->/127.0.0.1:61095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 leihs.procurement.graphql$handler@6e6c6994], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-11-30T19:19:38.412Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-30T19:19:38.412Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.414Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x32a96f9b HikariProxyPreparedStatement@849964955 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.414Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.415Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.415Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xef2090 HikariProxyPreparedStatement@15671440 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.415Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.416Z NX-41294 DEBUG [leihs.procurement.permissions.user:52] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_viewers) (sql/merge-where [:= :procurement_category_viewers.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_viewers.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.416Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x63c1285f HikariProxyPreparedStatement@1673603167 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.416Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.417Z NX-41294 DEBUG [leihs.procurement.permissions.user:72] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.417Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5dac60e1 HikariProxyPreparedStatement@1571578081 wrapping SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.417Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.417Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39360#] (p1__39360# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-11-30T19:19:38.418Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x74f4d1b7 org.postgresql.jdbc.PgResultSetMetaData@74f4d1b7] 1]
2023-11-30T19:19:38.418Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.418Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.418Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x74f4d1b7 org.postgresql.jdbc.PgResultSetMetaData@74f4d1b7] 2]
2023-11-30T19:19:38.418Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x74f4d1b7 org.postgresql.jdbc.PgResultSetMetaData@74f4d1b7] 1]
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x74f4d1b7 org.postgresql.jdbc.PgResultSetMetaData@74f4d1b7] 2]
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x74f4d1b7 org.postgresql.jdbc.PgResultSetMetaData@74f4d1b7] 1]
2023-11-30T19:19:38.419Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.420Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.420Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x74f4d1b7 org.postgresql.jdbc.PgResultSetMetaData@74f4d1b7] 2]
2023-11-30T19:19:38.420Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.420Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.420Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x74f4d1b7 org.postgresql.jdbc.PgResultSetMetaData@74f4d1b7] 1]
2023-11-30T19:19:38.420Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.420Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.420Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x74f4d1b7 org.postgresql.jdbc.PgResultSetMetaData@74f4d1b7] 2]
2023-11-30T19:19:38.421Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.421Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.421Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x29832104 org.postgresql.jdbc.PgResultSetMetaData@29832104] 1]
2023-11-30T19:19:38.422Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.422Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.422Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x29832104 org.postgresql.jdbc.PgResultSetMetaData@29832104] 2]
2023-11-30T19:19:38.422Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.422Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.422Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x29832104 org.postgresql.jdbc.PgResultSetMetaData@29832104] 1]
2023-11-30T19:19:38.422Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.422Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x29832104 org.postgresql.jdbc.PgResultSetMetaData@29832104] 2]
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x29832104 org.postgresql.jdbc.PgResultSetMetaData@29832104] 1]
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x29832104 org.postgresql.jdbc.PgResultSetMetaData@29832104] 2]
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.423Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x29832104 org.postgresql.jdbc.PgResultSetMetaData@29832104] 1]
2023-11-30T19:19:38.424Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.424Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.424Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x29832104 org.postgresql.jdbc.PgResultSetMetaData@29832104] 2]
2023-11-30T19:19:38.424Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.424Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH

>>>exec-query::variables {}
2023-11-30T19:19:38.428Z NX-41294 DEBUG [leihs.procurement.graphql:48] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-11-30T19:19:38.429Z NX-41294 DEBUG [leihs.procurement.graphql:49] - (-> request :body :variables) => {}
2023-11-30T19:19:38.430Z NX-41294 DEBUG [leihs.procurement.graphql:52] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "jimmie@goyette.com", :contracts_count 0, :lastname "Admin", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Procurement", :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"Idea-d8c89f6f" {:value "5d06a449-7aaa-4285-b65a-53c2ae3cb299"}, "leihs-anti-csrf-token" {:value "65184e75-5146-4915-8494-09445d034d15"}, "leihs-user-session" {:value "5f135ec7-f555-4255-80a4-6dc08b1a591c"}}, :remote-addr "127.0.0.1", :start-time 134499015845458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 "next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c", "content-length" "502", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure", "connection" "keep-alive", "pragma" "no-cache", "x-csrf-token" "65184e75-5146-4915-8494-09445d034d15", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors", "cache-control" "no-cache"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7a5c7c53 "/127.0.0.1:3230<->/127.0.0.1:61095"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 "leihs.procurement.graphql$handler@6e6c6994"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-11-30T19:19:38.442Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7614a0d4 HikariProxyPreparedStatement@1981063380 wrapping SELECT users.id, users.firstname, users.lastname FROM users  WHERE users.id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.442Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.443Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0xb1fe1bf org.postgresql.jdbc.PgResultSetMetaData@b1fe1bf] 1]
2023-11-30T19:19:38.443Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.443Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.443Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Procurement #object[org.postgresql.jdbc.PgResultSetMetaData 0xb1fe1bf org.postgresql.jdbc.PgResultSetMetaData@b1fe1bf] 2]
2023-11-30T19:19:38.443Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Procurement]
2023-11-30T19:19:38.443Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Procurement
2023-11-30T19:19:38.443Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Admin #object[org.postgresql.jdbc.PgResultSetMetaData 0xb1fe1bf org.postgresql.jdbc.PgResultSetMetaData@b1fe1bf] 3]
2023-11-30T19:19:38.444Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Admin]
2023-11-30T19:19:38.444Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Admin
2023-11-30T19:19:38.445Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x4c70c04f HikariProxyPreparedStatement@1282457679 wrapping SELECT procurement_users_filters.* FROM procurement_users_filters  WHERE procurement_users_filters.user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.445Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.446Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x5fd190b org.postgresql.jdbc.PgResultSetMetaData@5fd190b] 1]
2023-11-30T19:19:38.446Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.446Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.446Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x5fd190b org.postgresql.jdbc.PgResultSetMetaData@5fd190b] 2]
2023-11-30T19:19:38.446Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x5fd190b org.postgresql.jdbc.PgResultSetMetaData@5fd190b] 1]
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x5fd190b org.postgresql.jdbc.PgResultSetMetaData@5fd190b] 2]
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x5fd190b org.postgresql.jdbc.PgResultSetMetaData@5fd190b] 1]
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.447Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.448Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x5fd190b org.postgresql.jdbc.PgResultSetMetaData@5fd190b] 2]
2023-11-30T19:19:38.448Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.448Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.448Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x5fd190b org.postgresql.jdbc.PgResultSetMetaData@5fd190b] 1]
2023-11-30T19:19:38.448Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.449Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.449Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x5fd190b org.postgresql.jdbc.PgResultSetMetaData@5fd190b] 2]
2023-11-30T19:19:38.449Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.449Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.450Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a6f13ad org.postgresql.jdbc.PgResultSetMetaData@4a6f13ad] 1]
2023-11-30T19:19:38.450Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.450Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.450Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a6f13ad org.postgresql.jdbc.PgResultSetMetaData@4a6f13ad] 2]
2023-11-30T19:19:38.450Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.450Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.451Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a6f13ad org.postgresql.jdbc.PgResultSetMetaData@4a6f13ad] 1]
2023-11-30T19:19:38.451Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.451Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.451Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a6f13ad org.postgresql.jdbc.PgResultSetMetaData@4a6f13ad] 2]
2023-11-30T19:19:38.451Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.451Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.451Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a6f13ad org.postgresql.jdbc.PgResultSetMetaData@4a6f13ad] 1]
2023-11-30T19:19:38.452Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.452Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.452Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a6f13ad org.postgresql.jdbc.PgResultSetMetaData@4a6f13ad] 2]
2023-11-30T19:19:38.452Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.452Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.453Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a6f13ad org.postgresql.jdbc.PgResultSetMetaData@4a6f13ad] 1]
2023-11-30T19:19:38.453Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.453Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.453Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x4a6f13ad org.postgresql.jdbc.PgResultSetMetaData@4a6f13ad] 2]
2023-11-30T19:19:38.453Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.453Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.485Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.486Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x652310ed HikariProxyPreparedStatement@1696796909 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.486Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.487Z NX-41294 DEBUG [leihs.procurement.permissions.user:72] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.487Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x4ac1fa06 HikariProxyPreparedStatement@1254226438 wrapping SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.488Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.489Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7c10641a HikariProxyPreparedStatement@2081448986 wrapping SELECT procurement_categories.* FROM procurement_categories INNER JOIN procurement_category_inspectors ON procurement_categories.id = procurement_category_inspectors.category_id WHERE procurement_category_inspectors.user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.489Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.490Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x559cc69 HikariProxyPreparedStatement@89771113 wrapping SELECT procurement_categories.* FROM procurement_categories INNER JOIN procurement_category_viewers ON procurement_categories.id = procurement_category_viewers.category_id WHERE procurement_category_viewers.user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.490Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.493Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x2014a013 org.postgresql.jdbc.PgResultSetMetaData@2014a013] 1]
2023-11-30T19:19:38.496Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int4 0]
2023-11-30T19:19:38.496Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.496Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.587049000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2014a013 org.postgresql.jdbc.PgResultSetMetaData@2014a013] 2]
2023-11-30T19:19:38.497Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.587049000-00:00"]
2023-11-30T19:19:38.497Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.587049Z"
2023-11-30T19:19:38.497Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.587049000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2014a013 org.postgresql.jdbc.PgResultSetMetaData@2014a013] 3]
2023-11-30T19:19:38.497Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.587049000-00:00"]
2023-11-30T19:19:38.497Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.587049Z"
2023-11-30T19:19:38.497Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [http://hartmann.io/rolf #object[org.postgresql.jdbc.PgResultSetMetaData 0x2014a013 org.postgresql.jdbc.PgResultSetMetaData@2014a013] 4]
2023-11-30T19:19:38.497Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar http://hartmann.io/rolf]
2023-11-30T19:19:38.498Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  http://hartmann.io/rolf
2023-11-30T19:19:38.500Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#object[org.postgresql.util.PGobject 0x3f7ea091 ["Eum architecto minus magnam."]] #object[org.postgresql.jdbc.PgResultSetMetaData 0x2014a013 org.postgresql.jdbc.PgResultSetMetaData@2014a013] 5]
2023-11-30T19:19:38.500Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:jsonb #object[org.postgresql.util.PGobject 0x3f7ea091 ["Eum architecto minus magnam."]]]
2023-11-30T19:19:38.500Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  [Eum architecto minus magnam.]

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134499015845458, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7a5c7c53 /127.0.0.1:3230<->/127.0.0.1:61095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 leihs.procurement.graphql$handler@6e6c6994], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>o>3pure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"65184e75-5146-4915-8494-09445d034d15","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"e68ca036-dced-4666-b9e9-a6b55119f013","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id e68ca036-dced-4666-b9e9-a6b55119f013] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-11-30T19:19:38.504Z NX-41294 DEBUG [leihs.procurement.graphql:74] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"65184e75-5146-4915-8494-09445d034d15\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"e68ca036-dced-4666-b9e9-a6b55119f013\",\"firstname\":\"Procurement\",\"lastname\":\"Admin\",\"login\":null,\"email\":\"jimmie@goyette.com\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "e68ca036-dced-4666-b9e9-a6b55119f013"] [:firstname "Procurement"] [:lastname "Admin"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-11-30T19:19:38.504Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"65184e75-5146-4915-8494-09445d034d15\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"e68ca036-dced-4666-b9e9-a6b55119f013\",\"firstname\":\"Procurement\",\"lastname\":\"Admin\",\"login\":null,\"email\":\"jimmie@goyette.com\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "e68ca036-dced-4666-b9e9-a6b55119f013"] [:firstname "Procurement"] [:lastname "Admin"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
2023-11-30T19:19:38.563Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2bc2bbcd HikariProxyPreparedStatement@734182349 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-11-30T19:19:38.563Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.568Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2bc2bbcd HikariProxyPreparedStatement@734182349 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-11-30T19:19:38.568Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-11-30T19:19:38.569Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2bc2bbcd HikariProxyPreparedStatement@734182349 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-11-30T19:19:38.569Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-11-30T19:19:38.571Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5bd27df0 HikariProxyPreparedStatement@1540521456 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-11-30T19:19:38.571Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2bc2bbcd HikariProxyPreparedStatement@734182349 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-11-30T19:19:38.572Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-11-30T19:19:38.572Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.574Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5bd27df0 HikariProxyPreparedStatement@1540521456 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-11-30T19:19:38.574Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [jimmie@goyette.com #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 1]
2023-11-30T19:19:38.574Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar jimmie@goyette.com]
2023-11-30T19:19:38.574Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  jimmie@goyette.com
2023-11-30T19:19:38.575Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Procurement #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 2]
2023-11-30T19:19:38.575Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Procurement]
2023-11-30T19:19:38.575Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-11-30T19:19:38.575Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Procurement
2023-11-30T19:19:38.575Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 3]
2023-11-30T19:19:38.575Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.575Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.576Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Admin #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 6]
2023-11-30T19:19:38.576Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5bd27df0 HikariProxyPreparedStatement@1540521456 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-11-30T19:19:38.576Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Admin]
2023-11-30T19:19:38.576Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-11-30T19:19:38.576Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Admin
2023-11-30T19:19:38.577Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 10]
2023-11-30T19:19:38.577Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.577Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.578Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 11]
2023-11-30T19:19:38.578Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.578Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 12]
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5bd27df0 HikariProxyPreparedStatement@1540521456 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "ee976158-523f-44e7-af58-f170c1d25e0c" #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 13]
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"]
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-30T12:13:11.370422000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x74da11df org.postgresql.jdbc.PgResultSetMetaData@74da11df] 14]
2023-11-30T19:19:38.579Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-30T12:13:11.370422000-00:00"]
2023-11-30T19:19:38.580Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-30T12:13:11.370422Z"
2023-11-30T19:19:38.582Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6c3195bd HikariProxyPreparedStatement@1815188925 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.583Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44347 0x4bc04637 leihs.core.locale$wrap$fn__44347@4bc04637]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134499197740750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6581b360 /127.0.0.1:3230<->/127.0.0.1:61104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 leihs.procurement.graphql$handler@6e6c6994], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-11-30T19:19:38.585Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-30T19:19:38.585Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.587Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x47842405 HikariProxyPreparedStatement@1199842309 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.587Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.588Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.590Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [jimmie@goyette.com #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 1]
2023-11-30T19:19:38.590Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6fdb5c62 HikariProxyPreparedStatement@1876647010 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.590Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.591Z NX-41294 DEBUG [leihs.procurement.permissions.user:52] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_viewers) (sql/merge-where [:= :procurement_category_viewers.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_viewers.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.591Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6b21b242 HikariProxyPreparedStatement@1797370434 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.591Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.592Z NX-41294 DEBUG [leihs.procurement.permissions.user:72] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.593Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7eeb10a HikariProxyPreparedStatement@133083402 wrapping SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.593Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.593Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39360#] (p1__39360# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-11-30T19:19:38.594Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x78db9342 org.postgresql.jdbc.PgResultSetMetaData@78db9342] 1]
2023-11-30T19:19:38.595Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.595Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.595Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x78db9342 org.postgresql.jdbc.PgResultSetMetaData@78db9342] 2]
2023-11-30T19:19:38.595Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.595Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.595Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x78db9342 org.postgresql.jdbc.PgResultSetMetaData@78db9342] 1]
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x78db9342 org.postgresql.jdbc.PgResultSetMetaData@78db9342] 2]
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar jimmie@goyette.com]
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  jimmie@goyette.com
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x78db9342 org.postgresql.jdbc.PgResultSetMetaData@78db9342] 1]
2023-11-30T19:19:38.596Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Procurement #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 2]
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Procurement]
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Procurement
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x78db9342 org.postgresql.jdbc.PgResultSetMetaData@78db9342] 2]
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 3]
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.597Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x78db9342 org.postgresql.jdbc.PgResultSetMetaData@78db9342] 1]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Admin #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 6]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Admin]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Admin
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x78db9342 org.postgresql.jdbc.PgResultSetMetaData@78db9342] 2]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 10]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 11]
2023-11-30T19:19:38.598Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.599Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.600Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 12]
2023-11-30T19:19:38.600Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.600Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.600Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "ee976158-523f-44e7-af58-f170c1d25e0c" #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 13]
2023-11-30T19:19:38.601Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5a41ec53 HikariProxyPreparedStatement@1514269779 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-11-30T19:19:38.601Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"]
2023-11-30T19:19:38.601Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.601Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"
2023-11-30T19:19:38.601Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-30T12:13:11.370422000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0xd8d6dd7 org.postgresql.jdbc.PgResultSetMetaData@d8d6dd7] 14]
2023-11-30T19:19:38.601Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-30T12:13:11.370422000-00:00"]
2023-11-30T19:19:38.601Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-30T12:13:11.370422Z"
2023-11-30T19:19:38.602Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5a41ec53 HikariProxyPreparedStatement@1514269779 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-11-30T19:19:38.602Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:335] - db-pool - Add connection elided, waiting=1, adders pending/running=2
2023-11-30T19:19:38.602Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-11-30T19:19:38.603Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x5bbbef45 org.postgresql.jdbc.PgResultSetMetaData@5bbbef45] 1]
2023-11-30T19:19:38.603Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5a41ec53 HikariProxyPreparedStatement@1514269779 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-11-30T19:19:38.604Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:738] - db-pool - Added connection org.postgresql.jdbc.PgConnection@34c67186
2023-11-30T19:19:38.604Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-11-30T19:19:38.606Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2a2cdf04 HikariProxyPreparedStatement@707583748 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.606Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.606Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5a41ec53 HikariProxyPreparedStatement@1514269779 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-11-30T19:19:38.606Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-11-30T19:19:38.606Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.607Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.607Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x5bbbef45 org.postgresql.jdbc.PgResultSetMetaData@5bbbef45] 2]
2023-11-30T19:19:38.607Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.607Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.607Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x5bbbef45 org.postgresql.jdbc.PgResultSetMetaData@5bbbef45] 1]
2023-11-30T19:19:38.607Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.607Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.607Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x5bbbef45 org.postgresql.jdbc.PgResultSetMetaData@5bbbef45] 2]
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x5bbbef45 org.postgresql.jdbc.PgResultSetMetaData@5bbbef45] 1]
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x5bbbef45 org.postgresql.jdbc.PgResultSetMetaData@5bbbef45] 2]
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.608Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x5bbbef45 org.postgresql.jdbc.PgResultSetMetaData@5bbbef45] 1]
2023-11-30T19:19:38.609Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.609Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.609Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x5bbbef45 org.postgresql.jdbc.PgResultSetMetaData@5bbbef45] 2]
2023-11-30T19:19:38.609Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [jimmie@goyette.com #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 1]
2023-11-30T19:19:38.609Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.609Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.610Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar jimmie@goyette.com]
2023-11-30T19:19:38.610Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  jimmie@goyette.com
2023-11-30T19:19:38.611Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Procurement #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 2]
2023-11-30T19:19:38.612Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Procurement]
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {2023-11-30T19:19:38.612Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Procurement
:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44347 0x4bc04637 leihs.core.locale$wrap$fn__44347@4bc04637]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134499197511250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d27f63c /127.0.0.1:3230<->/127.0.0.1:61096], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema 2023-11-30T19:19:38.613Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 3]
#CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 leihs.procurement.graphql$handler@6e6c6994], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-11-30T19:19:38.613Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.613Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-30T19:19:38.613Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.613Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Admin #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 6]
2023-11-30T19:19:38.613Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.613Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Admin]
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Admin

>>>exec-query::variables {}
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 10]
2023-11-30T19:19:38.614Z NX-41294 DEBUG [leihs.procurement.graphql:48] - query-string => query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}

2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.614Z NX-41294 DEBUG [leihs.procurement.graphql:49] - (-> request :body :variables) => {}
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 11]
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.614Z NX-41294 DEBUG [leihs.procurement.graphql:52] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "jimmie@goyette.com", :contracts_count 0, :lastname "Admin", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Procurement", :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"Idea-d8c89f6f" {:value "5d06a449-7aaa-4285-b65a-53c2ae3cb299"}, "leihs-anti-csrf-token" {:value "65184e75-5146-4915-8494-09445d034d15"}, "leihs-user-session" {:value "5f135ec7-f555-4255-80a4-6dc08b1a591c"}}, :remote-addr "127.0.0.1", :start-time 134499197740750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 "next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c", "content-length" "502", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "pragma" "no-cache", "x-csrf-token" "65184e75-5146-4915-8494-09445d034d15", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors", "cache-control" "no-cache"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6581b360 "/127.0.0.1:3230<->/127.0.0.1:61104"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 "HikariDataSource (db-pool)"]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "me", :variables {}, :query "query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 "leihs.procurement.graphql$handler@6e6c6994"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 12]
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.615Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.614Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6acb970f HikariProxyPreparedStatement@1791727375 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.615Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "ee976158-523f-44e7-af58-f170c1d25e0c" #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 13]
2023-11-30T19:19:38.615Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.615Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"]
2023-11-30T19:19:38.615Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "ee976158-523f-44e7-af58-f170c1d25e0c"
2023-11-30T19:19:38.615Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-30T12:13:11.370422000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x3a0f4bcc org.postgresql.jdbc.PgResultSetMetaData@3a0f4bcc] 14]
2023-11-30T19:19:38.615Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-30T12:13:11.370422000-00:00"]
2023-11-30T19:19:38.615Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-30T12:13:11.370422Z"
2023-11-30T19:19:38.616Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.616Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xb5c86dc HikariProxyPreparedStatement@190613212 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.616Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2413632 HikariProxyPreparedStatement@37828146 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.616Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.617Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.617Z NX-41294 DEBUG [leihs.procurement.permissions.user:52] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_viewers) (sql/merge-where [:= :procurement_category_viewers.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_viewers.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.617Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x637335ae HikariProxyPreparedStatement@1668494766 wrapping SELECT users.id, users.firstname, users.lastname FROM users  WHERE users.id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.617Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44347 0x4bc04637 leihs.core.locale$wrap$fn__44347@4bc04637]

>> authorize::request > {:authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134499191274208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 2023-11-30T19:19:38.618Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x36aabc1f HikariProxyPreparedStatement@917158943 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result ] 1]  type:  java.util.UUID
0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 4019, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d3f69a0 /127.0.0.1:3230<->/127.0.0.1:61095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 4019, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 leihs.procurement.graphql$handler@6e6c6994], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-11-30T19:19:38.618Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.618Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[org.postgresql.jdbc.PgResultSetMetaData 0x5979f939 org.postgresql.jdbc.PgResultSetMetaData@5979f939] 1]
2023-11-30T19:19:38.618Z NX-41294 DEBUG [leihs.procurement.authorization:135] - (skip? (:handler-key request)) => nil
2023-11-30T19:19:38.618Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.619Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.619Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.619Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Procurement #object[org.postgresql.jdbc.PgResultSetMetaData 0x5979f939 org.postgresql.jdbc.PgResultSetMetaData@5979f939] 2]
2023-11-30T19:19:38.619Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Procurement]
2023-11-30T19:19:38.619Z NX-41294 DEBUG [leihs.procurement.permissions.user:72] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.619Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Procurement
2023-11-30T19:19:38.619Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Admin #object[org.postgresql.jdbc.PgResultSetMetaData 0x5979f939 org.postgresql.jdbc.PgResultSetMetaData@5979f939] 3]
2023-11-30T19:19:38.619Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Admin]
2023-11-30T19:19:38.619Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Admin
2023-11-30T19:19:38.620Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x536d4fe6 HikariProxyPreparedStatement@1399672806 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.620Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.620Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x57b671a5 HikariProxyPreparedStatement@1471574437 wrapping SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.620Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.620Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.620Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x3b02e344 HikariProxyPreparedStatement@990044996 wrapping SELECT procurement_users_filters.* FROM procurement_users_filters  WHERE procurement_users_filters.user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.621Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.621Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39360#] (p1__39360# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-11-30T19:19:38.621Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:738] - db-pool - Added connection org.postgresql.jdbc.PgConnection@4a0dabec
2023-11-30T19:19:38.622Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x5e451fdf org.postgresql.jdbc.PgResultSetMetaData@5e451fdf] 1]
2023-11-30T19:19:38.622Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x422bc963 HikariProxyPreparedStatement@1110165859 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.622Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.622Z NX-41294 DEBUG [leihs.procurement.permissions.user:52] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_viewers) (sql/merge-where [:= :procurement_category_viewers.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_viewers.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.622Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x15fe1a71 org.postgresql.jdbc.PgResultSetMetaData@15fe1a71] 1]
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x55af7594 HikariProxyPreparedStatement@1437562260 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x15fe1a71 org.postgresql.jdbc.PgResultSetMetaData@15fe1a71] 2]
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x15fe1a71 org.postgresql.jdbc.PgResultSetMetaData@15fe1a71] 1]
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.623Z NX-41294 DEBUG [leihs.procurement.permissions.user:72] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x15fe1a71 org.postgresql.jdbc.PgResultSetMetaData@15fe1a71] 2]
2023-11-30T19:19:38.623Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x4e7df793 HikariProxyPreparedStatement@1316878227 wrapping SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x15fe1a71 org.postgresql.jdbc.PgResultSetMetaData@15fe1a71] 1]
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x5e451fdf org.postgresql.jdbc.PgResultSetMetaData@5e451fdf] 2]
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.624Z NX-41294 DEBUG [leihs.procurement.authorization:136] - (->> [user-perms/admin? user-perms/inspector? user-perms/viewer? user-perms/requester?] (map (fn* [p1__39360#] (p1__39360# (:tx request) (:authenticated-entity request)))) (some true?)) => true
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x5e451fdf org.postgresql.jdbc.PgResultSetMetaData@5e451fdf] 1]
2023-11-30T19:19:38.624Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x15fe1a71 org.postgresql.jdbc.PgResultSetMetaData@15fe1a71] 2]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x180c8ffc org.postgresql.jdbc.PgResultSetMetaData@180c8ffc] 1]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x5e451fdf org.postgresql.jdbc.PgResultSetMetaData@5e451fdf] 2]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x15fe1a71 org.postgresql.jdbc.PgResultSetMetaData@15fe1a71] 1]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x180c8ffc org.postgresql.jdbc.PgResultSetMetaData@180c8ffc] 2]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x5e451fdf org.postgresql.jdbc.PgResultSetMetaData@5e451fdf] 1]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x15fe1a71 org.postgresql.jdbc.PgResultSetMetaData@15fe1a71] 2]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.625Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x5e451fdf org.postgresql.jdbc.PgResultSetMetaData@5e451fdf] 2]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x180c8ffc org.postgresql.jdbc.PgResultSetMetaData@180c8ffc] 1]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x180c8ffc org.postgresql.jdbc.PgResultSetMetaData@180c8ffc] 2]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x5e451fdf org.postgresql.jdbc.PgResultSetMetaData@5e451fdf] 1]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x39ac10dc org.postgresql.jdbc.PgResultSetMetaData@39ac10dc] 1]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x5e451fdf org.postgresql.jdbc.PgResultSetMetaData@5e451fdf] 2]
2023-11-30T19:19:38.626Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.627Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x180c8ffc org.postgresql.jdbc.PgResultSetMetaData@180c8ffc] 1]
2023-11-30T19:19:38.627Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.627Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.627Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.627Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x39ac10dc org.postgresql.jdbc.PgResultSetMetaData@39ac10dc] 2]
2023-11-30T19:19:38.628Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x180c8ffc org.postgresql.jdbc.PgResultSetMetaData@180c8ffc] 2]
2023-11-30T19:19:38.628Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.628Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x180c8ffc org.postgresql.jdbc.PgResultSetMetaData@180c8ffc] 1]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x39ac10dc org.postgresql.jdbc.PgResultSetMetaData@39ac10dc] 1]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x45444c2d org.postgresql.jdbc.PgResultSetMetaData@45444c2d] 1]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x180c8ffc org.postgresql.jdbc.PgResultSetMetaData@180c8ffc] 2]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x39ac10dc org.postgresql.jdbc.PgResultSetMetaData@39ac10dc] 2]
2023-11-30T19:19:38.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x45444c2d org.postgresql.jdbc.PgResultSetMetaData@45444c2d] 2]
2023-11-30T19:19:38.630Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.630Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.630Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.630Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.630Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.630Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x39ac10dc org.postgresql.jdbc.PgResultSetMetaData@39ac10dc] 1]
2023-11-30T19:19:38.630Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.630Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.631Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x45444c2d org.postgresql.jdbc.PgResultSetMetaData@45444c2d] 1]
2023-11-30T19:19:38.631Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.631Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.631Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x39ac10dc org.postgresql.jdbc.PgResultSetMetaData@39ac10dc] 2]
2023-11-30T19:19:38.631Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.631Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.632Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (UK) #object[org.postgresql.jdbc.PgResultSetMetaData 0x46863c54 org.postgresql.jdbc.PgResultSetMetaData@46863c54] 1]
2023-11-30T19:19:38.632Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x45444c2d org.postgresql.jdbc.PgResultSetMetaData@45444c2d] 2]
2023-11-30T19:19:38.631Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.633Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (UK)]
2023-11-30T19:19:38.633Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.633Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x39ac10dc org.postgresql.jdbc.PgResultSetMetaData@39ac10dc] 1]
2023-11-30T19:19:38.633Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (UK)
2023-11-30T19:19:38.633Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.633Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-GB #object[org.postgresql.jdbc.PgResultSetMetaData 0x46863c54 org.postgresql.jdbc.PgResultSetMetaData@46863c54] 2]
2023-11-30T19:19:38.633Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x45444c2d org.postgresql.jdbc.PgResultSetMetaData@45444c2d] 1]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-GB]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x39ac10dc org.postgresql.jdbc.PgResultSetMetaData@39ac10dc] 2]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-GB
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [English (US) #object[org.postgresql.jdbc.PgResultSetMetaData 0x46863c54 org.postgresql.jdbc.PgResultSetMetaData@46863c54] 1]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar English (US)]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x45444c2d org.postgresql.jdbc.PgResultSetMetaData@45444c2d] 2]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  English (US)
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.634Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [en-US #object[org.postgresql.jdbc.PgResultSetMetaData 0x46863c54 org.postgresql.jdbc.PgResultSetMetaData@46863c54] 2]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar en-US]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x45444c2d org.postgresql.jdbc.PgResultSetMetaData@45444c2d] 1]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  en-US
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Deutsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x46863c54 org.postgresql.jdbc.PgResultSetMetaData@46863c54] 1]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Deutsch]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Deutsch
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [de-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x46863c54 org.postgresql.jdbc.PgResultSetMetaData@46863c54] 2]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x45444c2d org.postgresql.jdbc.PgResultSetMetaData@45444c2d] 2]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar de-CH]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  de-CH
2023-11-30T19:19:38.635Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.636Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Züritüütsch #object[org.postgresql.jdbc.PgResultSetMetaData 0x46863c54 org.postgresql.jdbc.PgResultSetMetaData@46863c54] 1]
2023-11-30T19:19:38.636Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Züritüütsch]
2023-11-30T19:19:38.636Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Züritüütsch
2023-11-30T19:19:38.636Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [gsw-CH #object[org.postgresql.jdbc.PgResultSetMetaData 0x46863c54 org.postgresql.jdbc.PgResultSetMetaData@46863c54] 2]
2023-11-30T19:19:38.636Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar gsw-CH]
2023-11-30T19:19:38.637Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  gsw-CH
2023-11-30T19:19:38.640Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:738] - db-pool - Added connection org.postgresql.jdbc.PgConnection@1f2e5fe3

>>>exec-query::variables {}
2023-11-30T19:19:38.646Z NX-41294 DEBUG [leihs.procurement.graphql:48] - query-string => query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}

2023-11-30T19:19:38.646Z NX-41294 DEBUG [leihs.procurement.graphql:49] - (-> request :body :variables) => {}
2023-11-30T19:19:38.647Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.646Z NX-41294 DEBUG [leihs.procurement.graphql:52] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "jimmie@goyette.com", :contracts_count 0, :lastname "Admin", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Procurement", :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"Idea-d8c89f6f" {:value "5d06a449-7aaa-4285-b65a-53c2ae3cb299"}, "leihs-anti-csrf-token" {:value "65184e75-5146-4915-8494-09445d034d15"}, "leihs-user-session" {:value "5f135ec7-f555-4255-80a4-6dc08b1a591c"}}, :remote-addr "127.0.0.1", :start-time 134499197511250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 "next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c", "content-length" "534", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "pragma" "no-cache", "x-csrf-token" "65184e75-5146-4915-8494-09445d034d15", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors", "cache-control" "no-cache"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d27f63c "/127.0.0.1:3230<->/127.0.0.1:61096"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 "HikariDataSource (db-pool)"]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestFilters", :variables {}, :query "query RequestFilters {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  organizations(root_only: true) {\n    ...OrgProps\n    organizations {\n      ...OrgProps\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment OrgProps on Organization {\n  id\n  name\n  shortname\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 "leihs.procurement.graphql$handler@6e6c6994"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-11-30T19:19:38.653Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x557c2193 HikariProxyPreparedStatement@1434198419 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.653Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.658Z NX-41294 DEBUG [leihs.procurement.permissions.user:72] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.659Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x3a1b0905 HikariProxyPreparedStatement@974850309 wrapping SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.659Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.661Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x55c2b3d1 HikariProxyPreparedStatement@1438823377 wrapping SELECT procurement_categories.* FROM procurement_categories INNER JOIN procurement_category_inspectors ON procurement_categories.id = procurement_category_inspectors.category_id WHERE procurement_category_inspectors.user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.661Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"

>>>exec-query::variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}
2023-11-30T19:19:38.662Z NX-41294 DEBUG [leihs.procurement.graphql:48] - query-string => query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

2023-11-30T19:19:38.662Z NX-41294 DEBUG [leihs.procurement.graphql:49] - (-> request :body :variables) => {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["fb664326-a8ef-4556-af02-07d3127cd9ec"], :categories ["7d5ba731-edd9-41ba-8773-7337d24c2327"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]}
2023-11-30T19:19:38.662Z NX-41294 DEBUG [leihs.procurement.graphql:52] - {:request request} => {:request {:leihs-user-language {:name "English (UK)", :locale "en-GB", :default true, :active true}, :authenticated-entity {:email "jimmie@goyette.com", :contracts_count 0, :lastname "Admin", :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname "Procurement", :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {"Idea-d8c89f6f" {:value "5d06a449-7aaa-4285-b65a-53c2ae3cb299"}, "leihs-anti-csrf-token" {:value "65184e75-5146-4915-8494-09445d034d15"}, "leihs-user-session" {:value "5f135ec7-f555-4255-80a4-6dc08b1a591c"}}, :remote-addr "127.0.0.1", :start-time 134499191274208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address "your.lending.desk@example.com", :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature "Cheers,"}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 "next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9"]}}, :query-params-raw {}, :route-params nil, :headers {"origin" "http://localhost:3230", "sec-fetch-site" "same-origin", "sec-ch-ua-mobile" "?0", "host" "localhost:3230", "user-agent" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "content-type" "application/json", "cookie" "Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c", "content-length" "4019", "sec-ch-ua" "\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"", "sec-ch-ua-platform" "\"macOS\"", "referer" "http://localhost:3230/procure/requests", "connection" "keep-alive", "pragma" "no-cache", "x-csrf-token" "65184e75-5146-4915-8494-09445d034d15", "accept" "application/json", "accept-language" "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7", "sec-fetch-dest" "empty", "accept-encoding" "gzip, deflate, br", "sec-fetch-mode" "cors", "cache-control" "no-cache"}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d3f69a0 "/127.0.0.1:3230<->/127.0.0.1:61095"], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 "HikariDataSource (db-pool)"]}, :content-length 4019, :form-params {}, :websocket? false, :query-params {}, :content-type "application/json", :form-params-raw {}, :character-encoding "utf8", :uri "/procure/graphql", :server-name "localhost", :handler-key :graphql, :query-string nil, :body {:operationName "RequestsIndexFiltered", :variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["fb664326-a8ef-4556-af02-07d3127cd9ec"], :categories ["7d5ba731-edd9-41ba-8773-7337d24c2327"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]}, :query "query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {\n  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {\n    cacheKey\n    total_count\n    budget_periods {\n      id\n      cacheKey\n      name\n      inspection_start_date\n      end_date\n      total_price_cents\n      main_categories {\n        id\n        cacheKey\n        name\n        image_url\n        total_price_cents\n        categories {\n          id\n          cacheKey\n          name\n          total_price_cents\n          requests {\n            ...RequestFieldsForIndex\n            total_price_cents\n            actionPermissions {\n              edit\n              __typename\n            }\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n"}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 "leihs.procurement.graphql$handler@6e6c6994"], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}}
2023-11-30T19:19:38.665Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xd4e01ec HikariProxyPreparedStatement@223216108 wrapping SELECT procurement_categories.* FROM procurement_categories INNER JOIN procurement_category_viewers ON procurement_categories.id = procurement_category_viewers.category_id WHERE procurement_category_viewers.user_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.666Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.668Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x7b8e69ba org.postgresql.jdbc.PgResultSetMetaData@7b8e69ba] 1]
2023-11-30T19:19:38.668Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4cea3d3d org.postgresql.jdbc.PgResultSetMetaData@4cea3d3d] 1]
2023-11-30T19:19:38.671Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int4 0]
2023-11-30T19:19:38.671Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.674Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.587049000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x7b8e69ba org.postgresql.jdbc.PgResultSetMetaData@7b8e69ba] 2]
2023-11-30T19:19:38.674Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]
2023-11-30T19:19:38.674Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.587049000-00:00"]
2023-11-30T19:19:38.674Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.674Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Budget-Period-Past #object[org.postgresql.jdbc.PgResultSetMetaData 0x4cea3d3d org.postgresql.jdbc.PgResultSetMetaData@4cea3d3d] 2]
2023-11-30T19:19:38.674Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.587049Z"
2023-11-30T19:19:38.674Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Budget-Period-Past]
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.587049000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x7b8e69ba org.postgresql.jdbc.PgResultSetMetaData@7b8e69ba] 3]
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Budget-Period-Past
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.587049000-00:00"]
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-08-23T22:00:00.000000000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4cea3d3d org.postgresql.jdbc.PgResultSetMetaData@4cea3d3d] 3]
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.587049Z"
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-08-23T22:00:00.000000000-00:00"]
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [http://hartmann.io/rolf #object[org.postgresql.jdbc.PgResultSetMetaData 0x7b8e69ba org.postgresql.jdbc.PgResultSetMetaData@7b8e69ba] 4]
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-08-23T22:00:00Z"
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar http://hartmann.io/rolf]
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-22T23:00:00.000000000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4cea3d3d org.postgresql.jdbc.PgResultSetMetaData@4cea3d3d] 4]
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  http://hartmann.io/rolf
2023-11-30T19:19:38.675Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-22T23:00:00.000000000-00:00"]
2023-11-30T19:19:38.676Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-22T23:00:00Z"
2023-11-30T19:19:38.676Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.605131000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4cea3d3d org.postgresql.jdbc.PgResultSetMetaData@4cea3d3d] 5]
2023-11-30T19:19:38.676Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.605131000-00:00"]
2023-11-30T19:19:38.676Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.605131Z"
2023-11-30T19:19:38.676Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.605131000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4cea3d3d org.postgresql.jdbc.PgResultSetMetaData@4cea3d3d] 6]
2023-11-30T19:19:38.676Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.605131000-00:00"]
2023-11-30T19:19:38.676Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.605131Z"
2023-11-30T19:19:38.678Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#object[org.postgresql.util.PGobject 0x774f35bc ["Eum architecto minus magnam."]] #object[org.postgresql.jdbc.PgResultSetMetaData 0x7b8e69ba org.postgresql.jdbc.PgResultSetMetaData@7b8e69ba] 5]
2023-11-30T19:19:38.678Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:jsonb #object[org.postgresql.util.PGobject 0x774f35bc ["Eum architecto minus magnam."]]]
2023-11-30T19:19:38.678Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  [Eum architecto minus magnam.]

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134499197740750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6581b360 /127.0.0.1:3230<->/127.0.0.1:61104], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 leihs.procurement.graphql$handler@6e6c6994], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}


>o>3pure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"65184e75-5146-4915-8494-09445d034d15","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"e68ca036-dced-4666-b9e9-a6b55119f013","firstname":"Procurement","lastname":"Admin","login":null,"email":"jimmie@goyette.com"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id e68ca036-dced-4666-b9e9-a6b55119f013] [:firstname Procurement] [:lastname Admin] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url http://hartmann.io/rolf] [:__typename :ProcurementSettings])])}
2023-11-30T19:19:38.679Z NX-41294 DEBUG [leihs.procurement.graphql:74] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"65184e75-5146-4915-8494-09445d034d15\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"e68ca036-dced-4666-b9e9-a6b55119f013\",\"firstname\":\"Procurement\",\"lastname\":\"Admin\",\"login\":null,\"email\":\"jimmie@goyette.com\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "e68ca036-dced-4666-b9e9-a6b55119f013"] [:firstname "Procurement"] [:lastname "Admin"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}
2023-11-30T19:19:38.679Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"65184e75-5146-4915-8494-09445d034d15\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"e68ca036-dced-4666-b9e9-a6b55119f013\",\"firstname\":\"Procurement\",\"lastname\":\"Admin\",\"login\":null,\"email\":\"jimmie@goyette.com\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "e68ca036-dced-4666-b9e9-a6b55119f013"] [:firstname "Procurement"] [:lastname "Admin"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "http://hartmann.io/rolf"] [:__typename :ProcurementSettings])])}}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [fb664326-a8ef-4556-af02-07d3127cd9ec], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [8b8fe440-cae5-4bf9-8048-d0ec2399faa1], :category_id [7d5ba731-edd9-41ba-8773-7337d24c2327]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories  ORDER BY procurement_main_categories.name ASC]
2023-11-30T19:19:38.681Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6ffb8be2 org.postgresql.jdbc.PgResultSetMetaData@6ffb8be2] 1]
2023-11-30T19:19:38.681Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[org.postgresql.jdbc.PgResultSetMetaData 0x735d3d46 org.postgresql.jdbc.PgResultSetMetaData@735d3d46] 1]
2023-11-30T19:19:38.683Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"]
2023-11-30T19:19:38.683Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
2023-11-30T19:19:38.684Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Main Category MC1 #object[org.postgresql.jdbc.PgResultSetMetaData 0x735d3d46 org.postgresql.jdbc.PgResultSetMetaData@735d3d46] 2]
2023-11-30T19:19:38.684Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Main Category MC1]
2023-11-30T19:19:38.684Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Main Category MC1
>>mainCats ({:id #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", :name Main Category MC1})
2023-11-30T19:19:38.683Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"]
2023-11-30T19:19:38.684Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
2023-11-30T19:19:38.684Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Main Category MC1 #object[org.postgresql.jdbc.PgResultSetMetaData 0x6ffb8be2 org.postgresql.jdbc.PgResultSetMetaData@6ffb8be2] 2]
2023-11-30T19:19:38.685Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Main Category MC1]
2023-11-30T19:19:38.685Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Main Category MC1
2023-11-30T19:19:38.685Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 8b8fe440-cae5-4bf9-8048-d0ec2399faa1 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1a9bbd8d HikariProxyPreparedStatement@446414221 wrapping SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC] 1]  type:  java.lang.String
2023-11-30T19:19:38.686Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.686Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x4459a297 HikariProxyPreparedStatement@1146725015 wrapping SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.687Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
2023-11-30T19:19:38.688Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4bc9d3f9 org.postgresql.jdbc.PgResultSetMetaData@4bc9d3f9] 1]
2023-11-30T19:19:38.688Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x47bd4336 HikariProxyPreparedStatement@1203585846 wrapping SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC] 1]  type:  java.util.UUID
2023-11-30T19:19:38.688Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
2023-11-30T19:19:38.689Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "7d5ba731-edd9-41ba-8773-7337d24c2327" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4390d3f8 org.postgresql.jdbc.PgResultSetMetaData@4390d3f8] 1]
2023-11-30T19:19:38.690Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]
2023-11-30T19:19:38.691Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Budget-Period-Past #object[org.postgresql.jdbc.PgResultSetMetaData 0x4bc9d3f9 org.postgresql.jdbc.PgResultSetMetaData@4bc9d3f9] 2]
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Budget-Period-Past]
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"]
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Budget-Period-Past
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-08-23T22:00:00.000000000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4bc9d3f9 org.postgresql.jdbc.PgResultSetMetaData@4bc9d3f9] 3]
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-08-23T22:00:00.000000000-00:00"]
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Category C1 #object[org.postgresql.jdbc.PgResultSetMetaData 0x4390d3f8 org.postgresql.jdbc.PgResultSetMetaData@4390d3f8] 2]
2023-11-30T19:19:38.692Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Category C1]
2023-11-30T19:19:38.693Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-08-23T22:00:00Z"
2023-11-30T19:19:38.693Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Category C1
2023-11-30T19:19:38.693Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4390d3f8 org.postgresql.jdbc.PgResultSetMetaData@4390d3f8] 3]
2023-11-30T19:19:38.693Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-22T23:00:00.000000000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4bc9d3f9 org.postgresql.jdbc.PgResultSetMetaData@4bc9d3f9] 4]
2023-11-30T19:19:38.693Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"]
2023-11-30T19:19:38.693Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-22T23:00:00.000000000-00:00"]
2023-11-30T19:19:38.693Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
2023-11-30T19:19:38.694Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-22T23:00:00Z"
2023-11-30T19:19:38.694Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.605131000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4bc9d3f9 org.postgresql.jdbc.PgResultSetMetaData@4bc9d3f9] 5]
2023-11-30T19:19:38.694Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.605131000-00:00"]
2023-11-30T19:19:38.694Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.605131Z"
2023-11-30T19:19:38.694Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.605131000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4bc9d3f9 org.postgresql.jdbc.PgResultSetMetaData@4bc9d3f9] 6]
2023-11-30T19:19:38.695Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.605131000-00:00"]
2023-11-30T19:19:38.695Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.605131Z"
>>resultA0-bps-original ({:id #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1", :name Budget-Period-Past, :inspection_start_date #time/instant "2023-08-23T22:00:00Z", :end_date #time/instant "2023-11-22T23:00:00Z", :created_at #time/instant "2023-11-24T19:25:51.605131Z", :updated_at #time/instant "2023-11-24T19:25:51.605131Z"})
>>queryA1 [SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC 8b8fe440-cae5-4bf9-8048-d0ec2399faa1]
2023-11-30T19:19:38.696Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 8b8fe440-cae5-4bf9-8048-d0ec2399faa1 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x65607fdd HikariProxyPreparedStatement@1700823005 wrapping SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE (procurement_budget_periods.id in (?)) ORDER BY end_date DESC] 1]  type:  java.lang.String
2023-11-30T19:19:38.696Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.697Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" #object[org.postgresql.jdbc.PgResultSetMetaData 0x123ccfe3 org.postgresql.jdbc.PgResultSetMetaData@123ccfe3] 1]
2023-11-30T19:19:38.697Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9e8e1e8 org.postgresql.jdbc.PgResultSetMetaData@9e8e1e8] 1]
2023-11-30T19:19:38.697Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]
2023-11-30T19:19:38.697Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.697Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Budget-Period-Past #object[org.postgresql.jdbc.PgResultSetMetaData 0x123ccfe3 org.postgresql.jdbc.PgResultSetMetaData@123ccfe3] 2]
2023-11-30T19:19:38.698Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Budget-Period-Past]
2023-11-30T19:19:38.698Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Budget-Period-Past
2023-11-30T19:19:38.698Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-08-23T22:00:00.000000000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x123ccfe3 org.postgresql.jdbc.PgResultSetMetaData@123ccfe3] 3]
2023-11-30T19:19:38.698Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-08-23T22:00:00.000000000-00:00"]
2023-11-30T19:19:38.699Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-08-23T22:00:00Z"
2023-11-30T19:19:38.699Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-22T23:00:00.000000000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x123ccfe3 org.postgresql.jdbc.PgResultSetMetaData@123ccfe3] 4]
2023-11-30T19:19:38.699Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-22T23:00:00.000000000-00:00"]
2023-11-30T19:19:38.699Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-22T23:00:00Z"
2023-11-30T19:19:38.700Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.605131000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x123ccfe3 org.postgresql.jdbc.PgResultSetMetaData@123ccfe3] 5]
2023-11-30T19:19:38.700Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"]
2023-11-30T19:19:38.700Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.605131000-00:00"]
2023-11-30T19:19:38.700Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"
2023-11-30T19:19:38.700Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.605131Z"
2023-11-30T19:19:38.700Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Home, Jewelry & Computers #object[org.postgresql.jdbc.PgResultSetMetaData 0x9e8e1e8 org.postgresql.jdbc.PgResultSetMetaData@9e8e1e8] 2]
2023-11-30T19:19:38.700Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.605131000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x123ccfe3 org.postgresql.jdbc.PgResultSetMetaData@123ccfe3] 6]
2023-11-30T19:19:38.700Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Home, Jewelry & Computers]
2023-11-30T19:19:38.701Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.605131000-00:00"]
2023-11-30T19:19:38.701Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Home, Jewelry & Computers
2023-11-30T19:19:38.701Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.605131Z"
>>resultA1 ({:id #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1", :name Budget-Period-Past, :inspection_start_date #time/instant "2023-08-23T22:00:00Z", :end_date #time/instant "2023-11-22T23:00:00Z", :created_at #time/instant "2023-11-24T19:25:51.605131Z", :updated_at #time/instant "2023-11-24T19:25:51.605131Z"})
>>resultA1-2 ({:id #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1", :name Budget-Period-Past, :inspection_start_date #time/instant "2023-08-23T22:00:00Z", :end_date #time/instant "2023-11-22T23:00:00Z", :created_at #time/instant "2023-11-24T19:25:51.605131Z", :updated_at #time/instant "2023-11-24T19:25:51.605131Z"})
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [fb664326-a8ef-4556-af02-07d3127cd9ec], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [8b8fe440-cae5-4bf9-8048-d0ec2399faa1], :category_id [7d5ba731-edd9-41ba-8773-7337d24c2327]} nil
2023-11-30T19:19:38.701Z NX-41294 DEBUG [leihs.procurement.resources.requests:140] - arguments => {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id ["fb664326-a8ef-4556-af02-07d3127cd9ec"], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id ["8b8fe440-cae5-4bf9-8048-d0ec2399faa1"], :category_id ["7d5ba731-edd9-41ba-8773-7337d24c2327"]}
2023-11-30T19:19:38.702Z NX-41294 DEBUG [leihs.procurement.resources.requests:141] - value => nil
>get-requests>> ???
>o> 1-After requests-query-map:
2023-11-30T19:19:38.703Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x30d982a2 HikariProxyPreparedStatement@819561122 wrapping SELECT procurement_organizations.* FROM procurement_organizations  WHERE procurement_organizations.parent_id = ? ORDER BY procurement_organizations.name ASC] 1]  type:  java.util.UUID
2023-11-30T19:19:38.703Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"
2023-11-30T19:19:38.703Z NX-41294 DEBUG [leihs.procurement.permissions.user:52] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_viewers) (sql/merge-where [:= :procurement_category_viewers.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_viewers.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "fb664326-a8ef-4556-af02-07d3127cd9ec" #object[org.postgresql.jdbc.PgResultSetMetaData 0x239bba5b org.postgresql.jdbc.PgResultSetMetaData@239bba5b] 1]
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x65347739 HikariProxyPreparedStatement@1697937209 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "fb664326-a8ef-4556-af02-07d3127cd9ec"]
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "fb664326-a8ef-4556-af02-07d3127cd9ec"
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Beauty & Kids #object[org.postgresql.jdbc.PgResultSetMetaData 0x239bba5b org.postgresql.jdbc.PgResultSetMetaData@239bba5b] 2]
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Beauty & Kids]
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Beauty & Kids
2023-11-30T19:19:38.704Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9" #object[org.postgresql.jdbc.PgResultSetMetaData 0x239bba5b org.postgresql.jdbc.PgResultSetMetaData@239bba5b] 4]
2023-11-30T19:19:38.704Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.705Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"]
2023-11-30T19:19:38.705Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"
2023-11-30T19:19:38.705Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x225a8e37 HikariProxyPreparedStatement@576359991 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.705Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134499197511250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d27f63c /127.0.0.1:3230<->/127.0.0.1:61096], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, 2023-11-30T19:19:38.705Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
:handler #object[leihs.procurement.graphql$handler 0x6e6c6994 leihs.procurement.graphql$handler@6e6c6994], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}


>o>3pure-handler, result=> {:data #ordered/map ([:budget_periods [#ordered/map ([:id 8b8fe440-cae5-4bf9-8048-d0ec2399faa1] [:name Budget-Period-Past] [:inspection_start_date 2023-08-23T22:00:00Z] [:end_date 2023-11-22T23:00:00Z] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id d2907cbd-98d0-48b7-ab9a-f06803e5cabb] [:name Main Category MC1] [:categories [#ordered/map ([:id 7d5ba731-edd9-41ba-8773-7337d24c2327] [:name Category C1] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9] [:name Home, Jewelry & Computers] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id fb664326-a8ef-4556-af02-07d3127cd9ec] [:name Beauty & Kids] [:shortname nil] [:__typename :Organization])]])]])}
2023-11-30T19:19:38.706Z NX-41294 DEBUG [leihs.procurement.graphql:74] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"] [:name "Budget-Period-Past"] [:inspection_start_date "2023-08-23T22:00:00Z"] [:end_date "2023-11-22T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"] [:name "Main Category MC1"] [:categories [#ordered/map ([:id "7d5ba731-edd9-41ba-8773-7337d24c2327"] [:name "Category C1"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"] [:name "Home, Jewelry & Computers"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "fb664326-a8ef-4556-af02-07d3127cd9ec"] [:name "Beauty & Kids"] [:shortname nil] [:__typename :Organization])]])]])}
2023-11-30T19:19:38.706Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1ae9aa32 HikariProxyPreparedStatement@451521074 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.706Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:budget_periods [#ordered/map ([:id "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"] [:name "Budget-Period-Past"] [:inspection_start_date "2023-08-23T22:00:00Z"] [:end_date "2023-11-22T23:00:00Z"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"] [:name "Main Category MC1"] [:categories [#ordered/map ([:id "7d5ba731-edd9-41ba-8773-7337d24c2327"] [:name "Category C1"] [:__typename :Category])]] [:__typename :MainCategory])]] [:organizations [#ordered/map ([:id "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"] [:name "Home, Jewelry & Computers"] [:shortname nil] [:__typename :Organization] [:organizations [#ordered/map ([:id "fb664326-a8ef-4556-af02-07d3127cd9ec"] [:name "Beauty & Kids"] [:shortname nil] [:__typename :Organization])]])]])}, :status 409, :message "should not be handled"}
2023-11-30T19:19:38.706Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.707Z NX-41294 DEBUG [leihs.procurement.permissions.user:85] - (->> [viewer? inspector? admin?] (map (fn* [p1__39301#] (p1__39301# tx auth-entity))) (some true?)) => true
2023-11-30T19:19:38.708Z NX-41294 DEBUG [leihs.procurement.resources.requests:64] - (user-perms/advanced? tx (:authenticated-entity rrequest)) => true
>o> state-sql #sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED]
>o> class honeysql.types.SqlCall
>o> state-sql _> formatted [CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED]
2023-11-30T19:19:38.711Z NX-41294 DEBUG [leihs.procurement.resources.request:142] - result => #sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"]
2023-11-30T19:19:38.711Z NX-41294 DEBUG [leihs.procurement.resources.request:166] - (-> requests-base-query (sql/merge-select [(state-sql advanced-user?) :state]) (sql/merge-join :procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
2023-11-30T19:19:38.713Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> tbl :models
>o> nest-key :model
2023-11-30T19:19:38.714Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> tbl :procurement_templates
>o> nest-key :template
2023-11-30T19:19:38.715Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :suppliers
>o> nest-key :supplier
2023-11-30T19:19:38.731Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> sqlmap {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> tbl :users
>o> nest-key :user
2023-11-30T19:19:38.731Z NX-41294 DEBUG [leihs.procurement.utils.sql:77] - (helpers/merge-select sqlmap [(types/call :row_to_json tbl) nest-key]) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
2023-11-30T19:19:38.731Z NX-41294 DEBUG [leihs.procurement.resources.requests:66] - (-> (request/requests-base-query-with-state advanced-user?) request-helpers/join-and-nest-associated-resources) => {:select (#sql/raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*" [#sql/call [:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED"] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category" [#sql/call [:row_to_json :models] :model] #sql/raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization" [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room" [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by (#sql/raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id])}
>o> 2-After apply-scope: {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:and [:in :procurement_requests.category_id [7d5ba731-edd9-41ba-8773-7337d24c2327]] [:in :procurement_requests.budget_period_id [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]] [:in :procurement_requests.organization_id [fb664326-a8ef-4556-af02-07d3127cd9ec]] [:in :procurement_requests.priority (normal high)] [:in :procurement_requests.inspector_priority (low medium high mandatory)] [:or [:= :procurement_requests.approved_quantity nil] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] [:= :procurement_requests.approved_quantity 0]] [:in :procurement_requests.order_status (#sql/call [:cast not_processed :order_status_enum] #sql/call [:cast in_progress :order_status_enum] #sql/call [:cast procured :order_status_enum] #sql/call [:cast alternative_procured :order_status_enum] #sql/call [:cast not_procured :order_status_enum])]]}
2023-11-30T19:19:38.733Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.734Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1dae8a2d HikariProxyPreparedStatement@497977901 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.734Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
>o> 3-After sql-format: {:select (#sql/raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.* [#sql/call [:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED] :state] [#sql/call [:row_to_json :procurement_budget_periods_2] :budget_period] #sql/raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category [#sql/call [:row_to_json :models] :model] #sql/raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization [#sql/call [:row_to_json :procurement_templates] :template] #sql/raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room [#sql/call [:row_to_json :suppliers] :supplier] [#sql/call [:row_to_json :users] :user]), :from (:procurement_requests), :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id]), :order-by (#sql/raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))), :join (:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select (:* [#sql/call [:> :current_date :end_date] :is_past]), :from (:procurement_budget_periods)} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]), :where [:and [:in :procurement_requests.category_id [7d5ba731-edd9-41ba-8773-7337d24c2327]] [:in :procurement_requests.budget_period_id [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]] [:in :procurement_requests.organization_id [fb664326-a8ef-4556-af02-07d3127cd9ec]] [:in :procurement_requests.priority (normal high)] [:in :procurement_requests.inspector_priority (low medium high mandatory)] [:or [:= :procurement_requests.approved_quantity nil] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] [:= :procurement_requests.approved_quantity 0]] [:in :procurement_requests.order_status (#sql/call [:cast not_processed :order_status_enum] #sql/call [:cast in_progress :order_status_enum] #sql/call [:cast procured :order_status_enum] #sql/call [:cast alternative_procured :order_status_enum] #sql/call [:cast not_procured :order_status_enum])]]}
2023-11-30T19:19:38.737Z NX-41294 DEBUG [leihs.procurement.resources.requests:170] - query => ["SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))" "NEW" "APPROVED" 0 "PARTIALLY_APPROVED" 0 "DENIED" "7d5ba731-edd9-41ba-8773-7337d24c2327" "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" "fb664326-a8ef-4556-af02-07d3127cd9ec" "normal" "high" "low" "medium" "high" "mandatory" 0 0 "not_processed" "in_progress" "procured" "alternative_procured" "not_procured"]
2023-11-30T19:19:38.738Z NX-41294 DEBUG [leihs.procurement.resources.requests:172] - query => ["SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))" "NEW" "APPROVED" 0 "PARTIALLY_APPROVED" 0 "DENIED" "7d5ba731-edd9-41ba-8773-7337d24c2327" "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" "fb664326-a8ef-4556-af02-07d3127cd9ec" "normal" "high" "low" "medium" "high" "mandatory" 0 0 "not_processed" "in_progress" "procured" "alternative_procured" "not_procured"]
>>broken-query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 7d5ba731-edd9-41ba-8773-7337d24c2327 8b8fe440-cae5-4bf9-8048-d0ec2399faa1 fb664326-a8ef-4556-af02-07d3127cd9ec normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured]
2023-11-30T19:19:38.739Z NX-41294 DEBUG [leihs.procurement.permissions.user:52] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_viewers) (sql/merge-where [:= :procurement_category_viewers.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_viewers.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.740Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x3dc399c4 HikariProxyPreparedStatement@1036229060 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.741Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.747Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.748Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x4d636eaf HikariProxyPreparedStatement@1298362031 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.748Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.749Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => ["SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result " #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.750Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5ff8728a HikariProxyPreparedStatement@1610117770 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.750Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.750Z NX-41294 DEBUG [leihs.procurement.permissions.user:85] - (->> [viewer? inspector? admin?] (map (fn* [p1__39301#] (p1__39301# tx auth-entity))) (some true?)) => true
2023-11-30T19:19:38.753Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text NEW #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 1]  type:  java.lang.String
2023-11-30T19:19:38.753Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  NEW
2023-11-30T19:19:38.754Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text APPROVED #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 2]  type:  java.lang.String
2023-11-30T19:19:38.754Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  APPROVED
2023-11-30T19:19:38.755Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 3]  type:  java.lang.Long
2023-11-30T19:19:38.755Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.756Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text PARTIALLY_APPROVED #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 4]  type:  java.lang.String
2023-11-30T19:19:38.756Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  PARTIALLY_APPROVED
2023-11-30T19:19:38.757Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = ? THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 5]  type:  java.lang.Long
2023-11-30T19:19:38.758Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.758Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text DENIED #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN ? END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 6]  type:  java.lang.String
2023-11-30T19:19:38.758Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  DENIED
2023-11-30T19:19:38.759Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 7d5ba731-edd9-41ba-8773-7337d24c2327 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in (?)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 7]  type:  java.lang.String
2023-11-30T19:19:38.760Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"
2023-11-30T19:19:38.761Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 8b8fe440-cae5-4bf9-8048-d0ec2399faa1 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in (?)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 8]  type:  java.lang.String
2023-11-30T19:19:38.762Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.763Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid fb664326-a8ef-4556-af02-07d3127cd9ec #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in (?)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 9]  type:  java.lang.String
2023-11-30T19:19:38.763Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "fb664326-a8ef-4556-af02-07d3127cd9ec"
2023-11-30T19:19:38.764Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:varchar normal #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in (?, ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 10]  type:  java.lang.String
2023-11-30T19:19:38.765Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  normal
2023-11-30T19:19:38.766Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:varchar high #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', ?)) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 11]  type:  java.lang.String
2023-11-30T19:19:38.767Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  high
2023-11-30T19:19:38.768Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:varchar low #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in (?, ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 12]  type:  java.lang.String
2023-11-30T19:19:38.768Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  low
2023-11-30T19:19:38.769Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:varchar medium #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', ?, ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 13]  type:  java.lang.String
2023-11-30T19:19:38.769Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  medium
2023-11-30T19:19:38.771Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:varchar high #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', ?, ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 14]  type:  java.lang.String
2023-11-30T19:19:38.771Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  high
2023-11-30T19:19:38.772Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:varchar mandatory #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', 'high', ?)) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 15]  type:  java.lang.String
2023-11-30T19:19:38.772Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  mandatory
2023-11-30T19:19:38.773Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', 'high', 'mandatory')) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > ?) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 16]  type:  java.lang.Long
2023-11-30T19:19:38.773Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.773Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', 'high', 'mandatory')) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) OR procurement_requests.approved_quantity = ?) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 17]  type:  java.lang.Long
2023-11-30T19:19:38.774Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-11-30T19:19:38.775Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:order_status_enum not_processed #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', 'high', 'mandatory')) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) OR procurement_requests.approved_quantity = 0) AND (procurement_requests.order_status in (CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 18]  type:  java.lang.String
2023-11-30T19:19:38.775Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  not_processed
2023-11-30T19:19:38.776Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:order_status_enum in_progress #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', 'high', 'mandatory')) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) OR procurement_requests.approved_quantity = 0) AND (procurement_requests.order_status in (CAST('not_processed' AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 19]  type:  java.lang.String
2023-11-30T19:19:38.776Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  in_progress
2023-11-30T19:19:38.777Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:order_status_enum procured #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', 'high', 'mandatory')) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) OR procurement_requests.approved_quantity = 0) AND (procurement_requests.order_status in (CAST('not_processed' AS order_status_enum), CAST('in_progress' AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 20]  type:  java.lang.String
2023-11-30T19:19:38.777Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  procured
2023-11-30T19:19:38.778Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:order_status_enum alternative_procured #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', 'high', 'mandatory')) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) OR procurement_requests.approved_quantity = 0) AND (procurement_requests.order_status in (CAST('not_processed' AS order_status_enum), CAST('in_progress' AS order_status_enum), CAST('procured' AS order_status_enum), CAST(? AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 21]  type:  java.lang.String
2023-11-30T19:19:38.778Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  alternative_procured
2023-11-30T19:19:38.779Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:order_status_enum not_procured #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x8e8d5ce HikariProxyPreparedStatement@149476814 wrapping SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, CASE WHEN procurement_requests.approved_quantity IS NULL THEN 'NEW' WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN 'APPROVED' WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) THEN 'PARTIALLY_APPROVED' WHEN procurement_requests.approved_quantity = 0 THEN 'DENIED' END AS state, row_to_json(procurement_budget_periods_2) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, row_to_json(models) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, row_to_json(procurement_templates) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, row_to_json(suppliers) AS supplier, row_to_json(users) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id WHERE ((procurement_requests.category_id in ('7d5ba731-edd9-41ba-8773-7337d24c2327'::uuid)) AND (procurement_requests.budget_period_id in ('8b8fe440-cae5-4bf9-8048-d0ec2399faa1'::uuid)) AND (procurement_requests.organization_id in ('fb664326-a8ef-4556-af02-07d3127cd9ec'::uuid)) AND (procurement_requests.priority in ('normal', 'high')) AND (procurement_requests.inspector_priority in ('low', 'medium', 'high', 'mandatory')) AND (procurement_requests.approved_quantity IS NULL OR procurement_requests.approved_quantity >= procurement_requests.requested_quantity OR (procurement_requests.approved_quantity < procurement_requests.requested_quantity AND procurement_requests.approved_quantity > 0) OR procurement_requests.approved_quantity = 0) AND (procurement_requests.order_status in (CAST('not_processed' AS order_status_enum), CAST('in_progress' AS order_status_enum), CAST('procured' AS order_status_enum), CAST('alternative_procured' AS order_status_enum), CAST(? AS order_status_enum)))) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))] 22]  type:  java.lang.String
2023-11-30T19:19:38.779Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  not_procured
2023-11-30T19:19:38.787Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 1]
2023-11-30T19:19:38.792Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"]
2023-11-30T19:19:38.792Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"
2023-11-30T19:19:38.792Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 2]
2023-11-30T19:19:38.792Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "7d5ba731-edd9-41ba-8773-7337d24c2327" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 3]
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"]
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "2187a76b-557a-4775-9a1e-778142161819" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 4]
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "2187a76b-557a-4775-9a1e-778142161819"]
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "2187a76b-557a-4775-9a1e-778142161819"
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "fb664326-a8ef-4556-af02-07d3127cd9ec" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 5]
2023-11-30T19:19:38.793Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "fb664326-a8ef-4556-af02-07d3127cd9ec"]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "fb664326-a8ef-4556-af02-07d3127cd9ec"
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Mediocre Aluminum Shoes #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 9]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Mediocre Aluminum Shoes]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Mediocre Aluminum Shoes
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [1 #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 11]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int4 1]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  1
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 14]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [CHF #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 15]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar CHF]
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  CHF
2023-11-30T19:19:38.794Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [normal #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 16]
2023-11-30T19:19:38.795Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar normal]
2023-11-30T19:19:38.795Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  normal
2023-11-30T19:19:38.795Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Corporis commodi provident nam. #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 20]
2023-11-30T19:19:38.795Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Corporis commodi provident nam.]
2023-11-30T19:19:38.795Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Corporis commodi provident nam.
2023-11-30T19:19:38.795Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.635215000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 22]
2023-11-30T19:19:38.795Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.635215000-00:00"]
2023-11-30T19:19:38.795Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.635215Z"
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [medium #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 23]
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar medium]
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  medium
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "64bfb152-ea6c-42da-98c6-325afeb462bc" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 24]
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "64bfb152-ea6c-42da-98c6-325afeb462bc"]
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "64bfb152-ea6c-42da-98c6-325afeb462bc"
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.635215000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 25]
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.635215000-00:00"]
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.635215Z"
2023-11-30T19:19:38.796Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [aquisition #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 26]
2023-11-30T19:19:38.797Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar aquisition]
2023-11-30T19:19:38.797Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  aquisition
2023-11-30T19:19:38.797Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Budget-Period-Past.001 #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 28]
2023-11-30T19:19:38.797Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Budget-Period-Past.001]
2023-11-30T19:19:38.797Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Budget-Period-Past.001
2023-11-30T19:19:38.798Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [not_processed #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 29]
2023-11-30T19:19:38.799Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:order_status_enum not_processed]
2023-11-30T19:19:38.799Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  not_processed
2023-11-30T19:19:38.799Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [NEW #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 31]
2023-11-30T19:19:38.799Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar NEW]
2023-11-30T19:19:38.799Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  NEW
2023-11-30T19:19:38.799Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#object[org.postgresql.util.PGobject 0x7028808 {"id":"8b8fe440-cae5-4bf9-8048-d0ec2399faa1","name":"Budget-Period-Past","inspection_start_date":"2023-08-24T00:00:00+02:00","end_date":"2023-11-23T00:00:00+01:00","created_at":"2023-11-24T20:25:51.605131","updated_at":"2023-11-24T20:25:51.605131","is_past":true}] #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 32]
2023-11-30T19:19:38.799Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:json #object[org.postgresql.util.PGobject 0x7028808 {"id":"8b8fe440-cae5-4bf9-8048-d0ec2399faa1","name":"Budget-Period-Past","inspection_start_date":"2023-08-24T00:00:00+02:00","end_date":"2023-11-23T00:00:00+01:00","created_at":"2023-11-24T20:25:51.605131","updated_at":"2023-11-24T20:25:51.605131","is_past":true}]]
2023-11-30T19:19:38.799Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  {:id 8b8fe440-cae5-4bf9-8048-d0ec2399faa1, :name Budget-Period-Past, :inspection_start_date 2023-08-24T00:00:00+02:00, :end_date 2023-11-23T00:00:00+01:00, :created_at 2023-11-24T20:25:51.605131, :updated_at 2023-11-24T20:25:51.605131, :is_past true}
2023-11-30T19:19:38.800Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#object[org.postgresql.util.PGobject 0x713de8f0 {"id": "7d5ba731-edd9-41ba-8773-7337d24c2327", "name": "Category C1", "cost_center": null, "main_category": {"id": "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", "name": "Main Category MC1"}, "main_category_id": "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", "procurement_account": null, "general_ledger_account": null}] #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 33]
2023-11-30T19:19:38.800Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:jsonb #object[org.postgresql.util.PGobject 0x713de8f0 {"id": "7d5ba731-edd9-41ba-8773-7337d24c2327", "name": "Category C1", "cost_center": null, "main_category": {"id": "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", "name": "Main Category MC1"}, "main_category_id": "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", "procurement_account": null, "general_ledger_account": null}]]
2023-11-30T19:19:38.800Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  {:id 7d5ba731-edd9-41ba-8773-7337d24c2327, :name Category C1, :cost_center nil, :main_category {:id d2907cbd-98d0-48b7-ab9a-f06803e5cabb, :name Main Category MC1}, :main_category_id d2907cbd-98d0-48b7-ab9a-f06803e5cabb, :procurement_account nil, :general_ledger_account nil}
2023-11-30T19:19:38.800Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#object[org.postgresql.util.PGobject 0x163e152e {"id": "fb664326-a8ef-4556-af02-07d3127cd9ec", "name": "Beauty & Kids", "parent_id": "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9", "shortname": null, "department": {"id": "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9", "name": "Home, Jewelry & Computers", "parent_id": null, "shortname": null}}] #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 35]
2023-11-30T19:19:38.800Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:jsonb #object[org.postgresql.util.PGobject 0x163e152e {"id": "fb664326-a8ef-4556-af02-07d3127cd9ec", "name": "Beauty & Kids", "parent_id": "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9", "shortname": null, "department": {"id": "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9", "name": "Home, Jewelry & Computers", "parent_id": null, "shortname": null}}]]
2023-11-30T19:19:38.800Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  {:id fb664326-a8ef-4556-af02-07d3127cd9ec, :name Beauty & Kids, :parent_id d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9, :shortname nil, :department {:id d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9, :name Home, Jewelry & Computers, :parent_id nil, :shortname nil}}
2023-11-30T19:19:38.801Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#object[org.postgresql.util.PGobject 0x2e680616 {"id": "64bfb152-ea6c-42da-98c6-325afeb462bc", "name": "reception room", "general": false, "building": {"id": "3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c", "code": null, "name": "9594 Beer Extension"}, "building_id": "3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c", "description": null}] #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 37]
2023-11-30T19:19:38.801Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:jsonb #object[org.postgresql.util.PGobject 0x2e680616 {"id": "64bfb152-ea6c-42da-98c6-325afeb462bc", "name": "reception room", "general": false, "building": {"id": "3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c", "code": null, "name": "9594 Beer Extension"}, "building_id": "3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c", "description": null}]]
2023-11-30T19:19:38.801Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  {:id 64bfb152-ea6c-42da-98c6-325afeb462bc, :name reception room, :general false, :building {:id 3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c, :code nil, :name 9594 Beer Extension}, :building_id 3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c, :description nil}
2023-11-30T19:19:38.801Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#object[org.postgresql.util.PGobject 0x699a88f2 {"id":"2187a76b-557a-4775-9a1e-778142161819","login":null,"firstname":"Lynsey","lastname":"Kertzmann","phone":null,"org_id":null,"email":"chanda@ortiz.net","badge_id":null,"address":null,"city":null,"zip":null,"country":null,"settings":null,"delegator_user_id":null,"created_at":"2023-11-24T20:25:51.614964+01:00","updated_at":"2023-11-24T20:25:51.614964+01:00","account_enabled":true,"password_sign_in_enabled":true,"url":null,"img256_url":null,"img32_url":null,"img_digest":null,"is_admin":false,"extended_info":null,"searchable":"Lynsey Kertzmann chanda@ortiz.net    Kertzmann Lynsey","secondary_email":null,"language_locale":null,"admin_protected":false,"is_system_admin":false,"pool_protected":false,"system_admin_protected":false,"organization":"local","account_disabled_at":null,"last_sign_in_at":null}] #object[org.postgresql.jdbc.PgResultSetMetaData 0x1218fb1e org.postgresql.jdbc.PgResultSetMetaData@1218fb1e] 39]
2023-11-30T19:19:38.801Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:json #object[org.postgresql.util.PGobject 0x699a88f2 {"id":"2187a76b-557a-4775-9a1e-778142161819","login":null,"firstname":"Lynsey","lastname":"Kertzmann","phone":null,"org_id":null,"email":"chanda@ortiz.net","badge_id":null,"address":null,"city":null,"zip":null,"country":null,"settings":null,"delegator_user_id":null,"created_at":"2023-11-24T20:25:51.614964+01:00","updated_at":"2023-11-24T20:25:51.614964+01:00","account_enabled":true,"password_sign_in_enabled":true,"url":null,"img256_url":null,"img32_url":null,"img_digest":null,"is_admin":false,"extended_info":null,"searchable":"Lynsey Kertzmann chanda@ortiz.net    Kertzmann Lynsey","secondary_email":null,"language_locale":null,"admin_protected":false,"is_system_admin":false,"pool_protected":false,"system_admin_protected":false,"organization":"local","account_disabled_at":null,"last_sign_in_at":null}]]
2023-11-30T19:19:38.801Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  {:system_admin_protected false, :address nil, :email chanda@ortiz.net, :pool_protected false, :last_sign_in_at nil, :img32_url nil, :account_enabled true, :lastname Kertzmann, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Lynsey Kertzmann chanda@ortiz.net    Kertzmann Lynsey, :updated_at 2023-11-24T20:25:51.614964+01:00, :firstname Lynsey, :zip nil, :id 2187a76b-557a-4775-9a1e-778142161819, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-11-24T20:25:51.614964+01:00, :admin_protected false}
>>requestsB2 (2023-11-30T19:19:38.805Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 8b8fe440-cae5-4bf9-8048-d0ec2399faa1 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x377a8d37 HikariProxyPreparedStatement@930778423 wrapping SELECT procurement_budget_periods.* FROM procurement_budget_periods  WHERE procurement_budget_periods.id = ?] 1]  type:  java.lang.String
2023-11-30T19:19:38.805Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.805Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f1214eb org.postgresql.jdbc.PgResultSetMetaData@6f1214eb] 1]
2023-11-30T19:19:38.806Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]
2023-11-30T19:19:38.806Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"
2023-11-30T19:19:38.806Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Budget-Period-Past #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f1214eb org.postgresql.jdbc.PgResultSetMetaData@6f1214eb] 2]
2023-11-30T19:19:38.806Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Budget-Period-Past]
2023-11-30T19:19:38.806Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Budget-Period-Past
2023-11-30T19:19:38.806Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-08-23T22:00:00.000000000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f1214eb org.postgresql.jdbc.PgResultSetMetaData@6f1214eb] 3]
2023-11-30T19:19:38.806Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-08-23T22:00:00.000000000-00:00"]
2023-11-30T19:19:38.806Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-08-23T22:00:00Z"
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-22T23:00:00.000000000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f1214eb org.postgresql.jdbc.PgResultSetMetaData@6f1214eb] 4]
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-11-22T23:00:00.000000000-00:00"]
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-22T23:00:00Z"
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.605131000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f1214eb org.postgresql.jdbc.PgResultSetMetaData@6f1214eb] 5]
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.605131000-00:00"]
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.605131Z"
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-11-24T19:25:51.605131000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6f1214eb org.postgresql.jdbc.PgResultSetMetaData@6f1214eb] 6]
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamp #inst "2023-11-24T19:25:51.605131000-00:00"]
2023-11-30T19:19:38.807Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-11-24T19:25:51.605131Z"
2023-11-30T19:19:38.808Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 7d5ba731-edd9-41ba-8773-7337d24c2327 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x29c75a90 HikariProxyPreparedStatement@700930704 wrapping SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.id = ?] 1]  type:  java.lang.String
2023-11-30T19:19:38.809Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"
2023-11-30T19:19:38.809Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "7d5ba731-edd9-41ba-8773-7337d24c2327" #object[org.postgresql.jdbc.PgResultSetMetaData 0x382869b2 org.postgresql.jdbc.PgResultSetMetaData@382869b2] 1]
2023-11-30T19:19:38.814Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"]
2023-11-30T19:19:38.815Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"
2023-11-30T19:19:38.816Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Category C1 #object[org.postgresql.jdbc.PgResultSetMetaData 0x382869b2 org.postgresql.jdbc.PgResultSetMetaData@382869b2] 2]
2023-11-30T19:19:38.816Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Category C1]
2023-11-30T19:19:38.816Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Category C1
2023-11-30T19:19:38.816Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[org.postgresql.jdbc.PgResultSetMetaData 0x382869b2 org.postgresql.jdbc.PgResultSetMetaData@382869b2] 3]
2023-11-30T19:19:38.816Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"]
2023-11-30T19:19:38.816Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
2023-11-30T19:19:38.817Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 2187a76b-557a-4775-9a1e-778142161819 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x4d3355f HikariProxyPreparedStatement@80950623 wrapping SELECT users.id, users.firstname, users.lastname FROM users  WHERE users.id = ?] 1]  type:  java.lang.String
2023-11-30T19:19:38.817Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "2187a76b-557a-4775-9a1e-778142161819"
2023-11-30T19:19:38.818Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "2187a76b-557a-4775-9a1e-778142161819" #object[org.postgresql.jdbc.PgResultSetMetaData 0x71314ffa org.postgresql.jdbc.PgResultSetMetaData@71314ffa] 1]
2023-11-30T19:19:38.818Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "2187a76b-557a-4775-9a1e-778142161819"]
2023-11-30T19:19:38.818Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "2187a76b-557a-4775-9a1e-778142161819"
2023-11-30T19:19:38.818Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Lynsey #object[org.postgresql.jdbc.PgResultSetMetaData 0x71314ffa org.postgresql.jdbc.PgResultSetMetaData@71314ffa] 2]
2023-11-30T19:19:38.818Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Lynsey]
2023-11-30T19:19:38.818Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Lynsey
2023-11-30T19:19:38.818Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kertzmann #object[org.postgresql.jdbc.PgResultSetMetaData 0x71314ffa org.postgresql.jdbc.PgResultSetMetaData@71314ffa] 3]
2023-11-30T19:19:38.819Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kertzmann]
2023-11-30T19:19:38.819Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kertzmann
2023-11-30T19:19:38.819Z NX-41294 DEBUG [leihs.procurement.permissions.user:72] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_requesters_organizations) (sql/where [:= :procurement_requesters_organizations.user_id (:user_id auth-entity)]))) :result]) sql/format) => [SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.820Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xef300a2 HikariProxyPreparedStatement@250806434 wrapping SELECT exists((SELECT TRUE FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.820Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.821Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => [SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.821Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1899ec81 HikariProxyPreparedStatement@412740737 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.821Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.822Z NX-41294 DEBUG [leihs.procurement.permissions.user:15] - (-> (sql/select [(sql/call :exists (-> (sql/select true) (sql/from :procurement_admins) (sql/where [:= :procurement_admins.user_id (:user_id auth-entity)]))) :result]) sql/format) => [SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"]
2023-11-30T19:19:38.822Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2b691ce3 HikariProxyPreparedStatement@728308963 wrapping SELECT exists((SELECT TRUE FROM procurement_admins WHERE procurement_admins.user_id = ?)) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.822Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.824Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:date 2023-11-23 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x22eac9c6 HikariProxyPreparedStatement@585812422 wrapping SELECT current_date > CAST(? AS date) AS result ] 1]  type:  java.lang.String
2023-11-30T19:19:38.824Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  2023-11-23
2023-11-30T19:19:38.825Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:date 2023-08-24 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x53b6c0a8 HikariProxyPreparedStatement@1404485800 wrapping SELECT current_date < CAST(? AS date) AS result ] 1]  type:  java.lang.String
2023-11-30T19:19:38.825Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  2023-08-24
2023-11-30T19:19:38.826Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:date 2023-08-24 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1d8d12d8 HikariProxyPreparedStatement@495784664 wrapping SELECT (current_date >= CAST(? AS date) and current_date < CAST(? AS date)) AS result ] 1]  type:  java.lang.String
2023-11-30T19:19:38.826Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  2023-08-24
2023-11-30T19:19:38.827Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:date 2023-11-23 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1d8d12d8 HikariProxyPreparedStatement@495784664 wrapping SELECT (current_date >= CAST('2023-08-24' AS date) and current_date < CAST(? AS date)) AS result ] 2]  type:  java.lang.String
2023-11-30T19:19:38.827Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  2023-11-23
2023-11-30T19:19:38.827Z NX-41294 DEBUG [leihs.procurement.permissions.user:31] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_inspectors) (sql/merge-where [:= :procurement_category_inspectors.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_inspectors.category_id c-id]))) :result]) sql/format) => [SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = ? AND procurement_category_inspectors.category_id = ?))) AS result  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" 7d5ba731-edd9-41ba-8773-7337d24c2327]
2023-11-30T19:19:38.828Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x3dad2321 HikariProxyPreparedStatement@1034756897 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = ? AND procurement_category_inspectors.category_id = ?))) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.828Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.828Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 7d5ba731-edd9-41ba-8773-7337d24c2327 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x3dad2321 HikariProxyPreparedStatement@1034756897 wrapping SELECT exists((SELECT TRUE FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = 'e68ca036-dced-4666-b9e9-a6b55119f013'::uuid AND procurement_category_inspectors.category_id = ?))) AS result ] 2]  type:  java.lang.String
2023-11-30T19:19:38.828Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"
2023-11-30T19:19:38.829Z NX-41294 DEBUG [leihs.procurement.permissions.user:52] - (-> (sql/select [(sql/call :exists (cond-> (-> (sql/select true) (sql/from :procurement_category_viewers) (sql/merge-where [:= :procurement_category_viewers.user_id (:user_id auth-entity)])) c-id (sql/merge-where [:= :procurement_category_viewers.category_id c-id]))) :result]) sql/format) => [SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = ? AND procurement_category_viewers.category_id = ?))) AS result  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" 7d5ba731-edd9-41ba-8773-7337d24c2327]
2023-11-30T19:19:38.829Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "e68ca036-dced-4666-b9e9-a6b55119f013" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2b959f35 HikariProxyPreparedStatement@731225909 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = ? AND procurement_category_viewers.category_id = ?))) AS result ] 1]  type:  java.util.UUID
2023-11-30T19:19:38.830Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "e68ca036-dced-4666-b9e9-a6b55119f013"
2023-11-30T19:19:38.830Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid 7d5ba731-edd9-41ba-8773-7337d24c2327 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2b959f35 HikariProxyPreparedStatement@731225909 wrapping SELECT exists((SELECT TRUE FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = 'e68ca036-dced-4666-b9e9-a6b55119f013'::uuid AND procurement_category_viewers.category_id = ?))) AS result ] 2]  type:  java.lang.String
2023-11-30T19:19:38.830Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"
2023-11-30T19:19:38.832Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid abae04c5-d767-425e-acc2-7ce04df645d1 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x12a05c2c HikariProxyPreparedStatement@312499244 wrapping SELECT rooms.* FROM rooms  WHERE (rooms.general = TRUE AND rooms.building_id = ?) ORDER BY general DESC, name ASC] 1]  type:  java.lang.String
2023-11-30T19:19:38.832Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "abae04c5-d767-425e-acc2-7ce04df645d1"
2023-11-30T19:19:38.833Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "b8927fd2-014c-48c2-b095-fa1d5620debe" #object[org.postgresql.jdbc.PgResultSetMetaData 0x329e0d3d org.postgresql.jdbc.PgResultSetMetaData@329e0d3d] 1]
2023-11-30T19:19:38.836Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe"]
2023-11-30T19:19:38.836Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe"
2023-11-30T19:19:38.836Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [general room #object[org.postgresql.jdbc.PgResultSetMetaData 0x329e0d3d org.postgresql.jdbc.PgResultSetMetaData@329e0d3d] 2]
2023-11-30T19:19:38.836Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar general room]
2023-11-30T19:19:38.836Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  general room
2023-11-30T19:19:38.837Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "abae04c5-d767-425e-acc2-7ce04df645d1" #object[org.postgresql.jdbc.PgResultSetMetaData 0x329e0d3d org.postgresql.jdbc.PgResultSetMetaData@329e0d3d] 4]
2023-11-30T19:19:38.837Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "abae04c5-d767-425e-acc2-7ce04df645d1"]
2023-11-30T19:19:38.837Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "abae04c5-d767-425e-acc2-7ce04df645d1"
2023-11-30T19:19:38.838Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid abae04c5-d767-425e-acc2-7ce04df645d1 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6c166461 HikariProxyPreparedStatement@1813406817 wrapping SELECT buildings.* FROM buildings  WHERE buildings.id = ?] 1]  type:  java.lang.String
2023-11-30T19:19:38.838Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "abae04c5-d767-425e-acc2-7ce04df645d1"
2023-11-30T19:19:38.838Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "abae04c5-d767-425e-acc2-7ce04df645d1" #object[org.postgresql.jdbc.PgResultSetMetaData 0x1a00a7eb org.postgresql.jdbc.PgResultSetMetaData@1a00a7eb] 1]
2023-11-30T19:19:38.841Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "abae04c5-d767-425e-acc2-7ce04df645d1"]
2023-11-30T19:19:38.841Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "abae04c5-d767-425e-acc2-7ce04df645d1"
2023-11-30T19:19:38.841Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [general building #object[org.postgresql.jdbc.PgResultSetMetaData 0x1a00a7eb org.postgresql.jdbc.PgResultSetMetaData@1a00a7eb] 2]
2023-11-30T19:19:38.841Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar general building]
2023-11-30T19:19:38.841Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  general building
{:category {:read true, :write false, :default {:id #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327", :name Category C1, :main_category_id #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 7d5ba731-edd9-41ba-8773-7337d24c2327, :name Category C1, :cost_center nil, :main_category {:id d2907cbd-98d0-48b7-ab9a-f06803e5cabb, :name Main Category MC1}, :main_category_id d2907cbd-98d0-48b7-ab9a-f06803e5cabb, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :supplier {:read true, :write false, :default nil, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :motivation {:read true, :write false, :required true, :value Corporis commodi provident nam., :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :accounting_type {:read true, :write false, :default aquisition, :required true, :value aquisition, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :actionPermissions {:edit true, :delete false, :moveBudgetPeriod false, :moveCategory false}, :article_number {:read true, :write false, :default nil, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :inspector_priority {:read true, :write false, :default MEDIUM, :required true, :value :MEDIUM, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :price_cents {:read true, :write false, :default 0, :required true, :value 0, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :budget_period {:read true, :write false, :default {:id #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1", :name Budget-Period-Past, :inspection_start_date #time/instant "2023-08-23T22:00:00Z", :end_date #time/instant "2023-11-22T23:00:00Z", :created_at #time/instant "2023-11-24T19:25:51.605131Z", :updated_at #time/instant "2023-11-24T19:25:51.605131Z"}, :required true, :value {:id 8b8fe440-cae5-4bf9-8048-d0ec2399faa1, :name Budget-Period-Past, :inspection_start_date 2023-08-24T00:00:00+02:00, :end_date 2023-11-23T00:00:00+01:00, :created_at 2023-11-24T20:25:51.605131, :updated_at 2023-11-24T20:25:51.605131, :is_past true}, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :article_name {:read true, :write false, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :replacement {:read true, :write false, :default nil, :required true, :value true, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :attachments {:read true, :write false, :required false, :value :unqueried, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :DELETE false, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :state :NEW, :organization {:value {:id fb664326-a8ef-4556-af02-07d3127cd9ec, :name Beauty & Kids, :parent_id d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9, :shortname nil, :department {:id d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9, :name Home, Jewelry & Computers, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :supplier_name {:read true, :write false, :default nil, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :requested_quantity {:read true, :write false, :required true, :value 1, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :general_ledger_account {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :updated_at {:value #time/instant "2023-11-24T19:25:51.635215Z", :read false, :write false, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :priority {:read true, :write false, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :procurement_account {:read true, :write false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :room {:read true, :write false, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 64bfb152-ea6c-42da-98c6-325afeb462bc, :name reception room, :general false, :building {:id 3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c, :code nil, :name 9594 Beer Extension}, :building_id 3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c, :description nil}, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :inspection_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :approved_quantity {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :order_quantity {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :cost_center {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :user {:read true, :write false, :required true, :default {:id #uuid "2187a76b-557a-4775-9a1e-778142161819", :firstname Lynsey, :lastname Kertzmann}, :value {:system_admin_protected false, :address nil, :email chanda@ortiz.net, :pool_protected false, :last_sign_in_at nil, :img32_url nil, :account_enabled true, :lastname Kertzmann, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Lynsey Kertzmann chanda@ortiz.net    Kertzmann Lynsey, :updated_at 2023-11-24T20:25:51.614964+01:00, :firstname Lynsey, :zip nil, :id 2187a76b-557a-4775-9a1e-778142161819, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-11-24T20:25:51.614964+01:00, :admin_protected false}, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :receiver {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :internal_order_number {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :created_at {:value #time/instant "2023-11-24T19:25:51.635215Z", :read false, :write false, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :order_comment {:read true, :write true, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :short_id Budget-Period-Past.001, :model {:read true, :write false, :default nil, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}})
>>dashboard-cache-keyB2 {:id 1608672852}

>o> final-result (2023-11-30T19:19:38.844Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x32def23b HikariProxyPreparedStatement@853471803 wrapping SELECT procurement_categories.* FROM procurement_categories  WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC] 1]  type:  java.util.UUID
2023-11-30T19:19:38.844Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "7d5ba731-edd9-41ba-8773-7337d24c2327" #object[org.postgresql.jdbc.PgResultSetMetaData 0x7f364e61 org.postgresql.jdbc.PgResultSetMetaData@7f364e61] 1]
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"]
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327"
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Category C1 #object[org.postgresql.jdbc.PgResultSetMetaData 0x7f364e61 org.postgresql.jdbc.PgResultSetMetaData@7f364e61] 2]
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Category C1]
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Category C1
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[org.postgresql.jdbc.PgResultSetMetaData 0x7f364e61 org.postgresql.jdbc.PgResultSetMetaData@7f364e61] 3]
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"]
2023-11-30T19:19:38.845Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
2023-11-30T19:19:38.846Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x48cd24be HikariProxyPreparedStatement@1221403838 wrapping SELECT procurement_images.* FROM procurement_images  WHERE procurement_images.main_category_id = ?] 1]  type:  java.util.UUID
2023-11-30T19:19:38.846Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"
{:main_categories ({:id #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", :name Main Category MC1, :categories ({:main_category_id #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", :name Category C1, :requests ({:category {:read true, :write false, :default {:id #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327", :name Category C1, :main_category_id #uuid "d2907cbd-98d0-48b7-ab9a-f06803e5cabb", :general_ledger_account nil, :cost_center nil, :procurement_account nil}, :required true, :value {:id 7d5ba731-edd9-41ba-8773-7337d24c2327, :name Category C1, :cost_center nil, :main_category {:id d2907cbd-98d0-48b7-ab9a-f06803e5cabb, :name Main Category MC1}, :main_category_id d2907cbd-98d0-48b7-ab9a-f06803e5cabb, :procurement_account nil, :general_ledger_account nil}, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :supplier {:read true, :write false, :default nil, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :motivation {:read true, :write false, :required true, :value Corporis commodi provident nam., :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :accounting_type {:read true, :write false, :default aquisition, :required true, :value aquisition, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :actionPermissions {:edit true, :delete false, :moveBudgetPeriod false, :moveCategory false}, :article_number {:read true, :write false, :default nil, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :inspector_priority {:read true, :write false, :default MEDIUM, :required true, :value :MEDIUM, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :price_cents {:read true, :write false, :default 0, :required true, :value 0, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :budget_period {:read true, :write false, :default {:id #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1", :name Budget-Period-Past, :inspection_start_date #time/instant "2023-08-23T22:00:00Z", :end_date #time/instant "2023-11-22T23:00:00Z", :created_at #time/instant "2023-11-24T19:25:51.605131Z", :updated_at #time/instant "2023-11-24T19:25:51.605131Z"}, :required true, :value {:id 8b8fe440-cae5-4bf9-8048-d0ec2399faa1, :name Budget-Period-Past, :inspection_start_date 2023-08-24T00:00:00+02:00, :end_date 2023-11-23T00:00:00+01:00, :created_at 2023-11-24T20:25:51.605131, :updated_at 2023-11-24T20:25:51.605131, :is_past true}, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :article_name {:read true, :write false, :default nil, :required true, :value Mediocre Aluminum Shoes, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :replacement {:read true, :write false, :default nil, :required true, :value true, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :attachments {:read true, :write false, :required false, :value :unqueried, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :DELETE false, :template {:read true, :write false, :default nil, :required true, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :state :NEW, :organization {:value {:id fb664326-a8ef-4556-af02-07d3127cd9ec, :name Beauty & Kids, :parent_id d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9, :shortname nil, :department {:id d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9, :name Home, Jewelry & Computers, :parent_id nil, :shortname nil}}, :read false, :write false, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :supplier_name {:read true, :write false, :default nil, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :order_status {:read true, :write true, :default NOT_PROCURED, :required true, :value :NOT_PROCESSED, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :requested_quantity {:read true, :write false, :required true, :value 1, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :general_ledger_account {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :updated_at {:value #time/instant "2023-11-24T19:25:51.635215Z", :read false, :write false, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :priority {:read true, :write false, :default NORMAL, :required true, :value :NORMAL, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11", :total_price_cents 0, :price_currency {:read true, :write false, :default CHF, :required true, :value CHF, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :procurement_account {:read true, :write false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :room {:read true, :write false, :default {:id #uuid "b8927fd2-014c-48c2-b095-fa1d5620debe", :name general room, :description nil, :building_id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :general true, :building {:id #uuid "abae04c5-d767-425e-acc2-7ce04df645d1", :name general building, :code nil}}, :required true, :value {:id 64bfb152-ea6c-42da-98c6-325afeb462bc, :name reception room, :general false, :building {:id 3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c, :code nil, :name 9594 Beer Extension}, :building_id 3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c, :description nil}, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :inspection_comment {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :approved_quantity {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :order_quantity {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :cost_center {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :user {:read true, :write false, :required true, :default {:id #uuid "2187a76b-557a-4775-9a1e-778142161819", :firstname Lynsey, :lastname Kertzmann}, :value {:system_admin_protected false, :address nil, :email chanda@ortiz.net, :pool_protected false, :last_sign_in_at nil, :img32_url nil, :account_enabled true, :lastname Kertzmann, :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization local, :login nil, :searchable Lynsey Kertzmann chanda@ortiz.net    Kertzmann Lynsey, :updated_at 2023-11-24T20:25:51.614964+01:00, :firstname Lynsey, :zip nil, :id 2187a76b-557a-4775-9a1e-778142161819, :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at 2023-11-24T20:25:51.614964+01:00, :admin_protected false}, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :receiver {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :internal_order_number {:read true, :write false, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :created_at {:value #time/instant "2023-11-24T19:25:51.635215Z", :read false, :write false, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :order_comment {:read true, :write true, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}, :short_id Budget-Period-Past.001, :model {:read true, :write false, :default nil, :required false, :value nil, :request-id #uuid "40284a6b-cf5e-41c1-af6c-dc423894ee11"}}), :general_ledger_account nil, :id #uuid "7d5ba731-edd9-41ba-8773-7337d24c2327", :total_price_cents 0, :procurement_account nil, :cacheKey 1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb_7d5ba731-edd9-41ba-8773-7337d24c2327, :cost_center nil}), :total_price_cents 0, :cacheKey 1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb}), :name Budget-Period-Past, :updated_at #time/instant "2023-11-24T19:25:51.605131Z", :inspection_start_date #time/instant "2023-08-23T22:00:00Z", :end_date #time/instant "2023-11-22T23:00:00Z", :id #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1", :total_price_cents 0, :cacheKey 1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1, :created_at #time/instant "2023-11-24T19:25:51.605131Z"}) 


>o> final-result (json) [{"main_categories":[{"id":"d2907cbd-98d0-48b7-ab9a-f06803e5cabb","name":"Main Category MC1","categories":[{"main_category_id":"d2907cbd-98d0-48b7-ab9a-f06803e5cabb","name":"Category C1","requests":[{"category":{"read":true,"write":false,"default":{"id":"7d5ba731-edd9-41ba-8773-7337d24c2327","name":"Category C1","main_category_id":"d2907cbd-98d0-48b7-ab9a-f06803e5cabb","general_ledger_account":null,"cost_center":null,"procurement_account":null},"required":true,"value":{"id":"7d5ba731-edd9-41ba-8773-7337d24c2327","name":"Category C1","cost_center":null,"main_category":{"id":"d2907cbd-98d0-48b7-ab9a-f06803e5cabb","name":"Main Category MC1"},"main_category_id":"d2907cbd-98d0-48b7-ab9a-f06803e5cabb","procurement_account":null,"general_ledger_account":null},"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"supplier":{"read":true,"write":false,"default":null,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"motivation":{"read":true,"write":false,"required":true,"value":"Corporis commodi provident nam.","request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"accounting_type":{"read":true,"write":false,"default":"aquisition","required":true,"value":"aquisition","request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"actionPermissions":{"edit":true,"delete":false,"moveBudgetPeriod":false,"moveCategory":false},"article_number":{"read":true,"write":false,"default":null,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"inspector_priority":{"read":true,"write":false,"default":"MEDIUM","required":true,"value":"MEDIUM","request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"price_cents":{"read":true,"write":false,"default":0,"required":true,"value":0,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"budget_period":{"read":true,"write":false,"default":{"id":"8b8fe440-cae5-4bf9-8048-d0ec2399faa1","name":"Budget-Period-Past","inspection_start_date":"2023-08-23T22:00:00Z","end_date":"2023-11-22T23:00:00Z","created_at":"2023-11-24T19:25:51.605131Z","updated_at":"2023-11-24T19:25:51.605131Z"},"required":true,"value":{"id":"8b8fe440-cae5-4bf9-8048-d0ec2399faa1","name":"Budget-Period-Past","inspection_start_date":"2023-08-24T00:00:00+02:00","end_date":"2023-11-23T00:00:00+01:00","created_at":"2023-11-24T20:25:51.605131","updated_at":"2023-11-24T20:25:51.605131","is_past":true},"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"article_name":{"read":true,"write":false,"default":null,"required":true,"value":"Mediocre Aluminum Shoes","request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"replacement":{"read":true,"write":false,"default":null,"required":true,"value":true,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"attachments":{"read":true,"write":false,"required":false,"value":"unqueried","request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"DELETE":false,"template":{"read":true,"write":false,"default":null,"required":true,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"state":"NEW","organization":{"value":{"id":"fb664326-a8ef-4556-af02-07d3127cd9ec","name":"Beauty & Kids","parent_id":"d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9","shortname":null,"department":{"id":"d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9","name":"Home, Jewelry & Computers","parent_id":null,"shortname":null}},"read":false,"write":false,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"supplier_name":{"read":true,"write":false,"default":null,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"order_status":{"read":true,"write":true,"default":"NOT_PROCURED","required":true,"value":"NOT_PROCESSED","request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"requested_quantity":{"read":true,"write":false,"required":true,"value":1,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"general_ledger_account":{"read":true,"write":false,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"updated_at":{"value":"2023-11-24T19:25:51.635215Z","read":false,"write":false,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"priority":{"read":true,"write":false,"default":"NORMAL","required":true,"value":"NORMAL","request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"id":"40284a6b-cf5e-41c1-af6c-dc423894ee11","total_price_cents":0,"price_currency":{"read":true,"write":false,"default":"CHF","required":true,"value":"CHF","request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"procurement_account":{"read":true,"write":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"room":{"read":true,"write":false,"default":{"id":"b8927fd2-014c-48c2-b095-fa1d5620debe","name":"general room","description":null,"building_id":"abae04c5-d767-425e-acc2-7ce04df645d1","general":true,"building":{"id":"abae04c5-d767-425e-acc2-7ce04df645d1","name":"general building","code":null}},"required":true,"value":{"id":"64bfb152-ea6c-42da-98c6-325afeb462bc","name":"reception room","general":false,"building":{"id":"3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c","code":null,"name":"9594 Beer Extension"},"building_id":"3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c","description":null},"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"inspection_comment":{"read":true,"write":false,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"approved_quantity":{"read":true,"write":false,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"order_quantity":{"read":true,"write":false,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"cost_center":{"read":true,"write":false,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"user":{"read":true,"write":false,"required":true,"default":{"id":"2187a76b-557a-4775-9a1e-778142161819","firstname":"Lynsey","lastname":"Kertzmann"},"value":{"system_admin_protected":false,"address":null,"email":"chanda@ortiz.net","pool_protected":false,"last_sign_in_at":null,"img32_url":null,"account_enabled":true,"lastname":"Kertzmann","phone":null,"img_digest":null,"org_id":null,"extended_info":null,"secondary_email":null,"city":null,"settings":null,"is_admin":false,"organization":"local","login":null,"searchable":"Lynsey Kertzmann chanda@ortiz.net    Kertzmann Lynsey","updated_at":"2023-11-24T20:25:51.614964+01:00","firstname":"Lynsey","zip":null,"id":"2187a76b-557a-4775-9a1e-778142161819","url":null,"password_sign_in_enabled":true,"account_disabled_at":null,"is_system_admin":false,"badge_id":null,"language_locale":null,"img256_url":null,"country":null,"delegator_user_id":null,"created_at":"2023-11-24T20:25:51.614964+01:00","admin_protected":false},"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"receiver":{"read":true,"write":false,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"internal_order_number":{"read":true,"write":false,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"created_at":{"value":"2023-11-24T19:25:51.635215Z","read":false,"write":false,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"order_comment":{"read":true,"write":true,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"},"short_id":"Budget-Period-Past.001","model":{"read":true,"write":false,"default":null,"required":false,"value":null,"request-id":"40284a6b-cf5e-41c1-af6c-dc423894ee11"}}],"general_ledger_account":null,"id":"7d5ba731-edd9-41ba-8773-7337d24c2327","total_price_cents":0,"procurement_account":null,"cacheKey":"1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb_7d5ba731-edd9-41ba-8773-7337d24c2327","cost_center":null}],"total_price_cents":0,"cacheKey":"1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb"}],"name":"Budget-Period-Past","updated_at":"2023-11-24T19:25:51.605131Z","inspection_start_date":"2023-08-23T22:00:00Z","end_date":"2023-11-22T23:00:00Z","id":"8b8fe440-cae5-4bf9-8048-d0ec2399faa1","total_price_cents":0,"cacheKey":"1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1","created_at":"2023-11-24T19:25:51.605131Z"}] 


>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email jimmie@goyette.com, :contracts_count 0, :lastname Admin, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Procurement, :scope_admin_write false, :user_session_created_at #time/instant "2023-11-30T12:13:11.370422Z", :id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :user_session_id #uuid "ee976158-523f-44e7-af58-f170c1d25e0c", :scope_system_admin_read false, :access-rights (), :user_id #uuid "e68ca036-dced-4666-b9e9-a6b55119f013", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 134499191274208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x1b18e2d9 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x2276bfa9 next.jdbc.result_set$as_unqualified_lower_maps@2276bfa9]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 4019, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3d3f69a0 /127.0.0.1:3230<->/127.0.0.1:61095], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3a8b7b67 HikariDataSource (db-pool)]}, :content-length 4019, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x6e6c6994 leihs.procurement.graphql$handler@6e6c6994], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>o>2pure-handler _> query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}


>o>3pure-handler, result=> {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey 1608672852] [:total_count 1] [:budget_periods [#ordered/map ([:id 8b8fe440-cae5-4bf9-8048-d0ec2399faa1] [:cacheKey 1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1] [:name Budget-Period-Past] [:inspection_start_date 2023-08-23T22:00:00Z] [:end_date 2023-11-22T23:00:00Z] [:total_price_cents 0] [:main_categories [#ordered/map ([:id d2907cbd-98d0-48b7-ab9a-f06803e5cabb] [:cacheKey 1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb] [:name Main Category MC1] [:image_url nil] [:total_price_cents 0] [:categories [#ordered/map ([:id 7d5ba731-edd9-41ba-8773-7337d24c2327] [:cacheKey 1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb_7d5ba731-edd9-41ba-8773-7337d24c2327] [:name Category C1] [:total_price_cents 0] [:requests [#ordered/map ([:id 40284a6b-cf5e-41c1-af6c-dc423894ee11] [:short_id Budget-Period-Past.001] [:user #ordered/map ([:value #ordered/map ([:id 2187a76b-557a-4775-9a1e-778142161819] [:firstname Lynsey] [:lastname Kertzmann] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id 7d5ba731-edd9-41ba-8773-7337d24c2327] [:name Category C1] [:main_category #ordered/map ([:id d2907cbd-98d0-48b7-ab9a-f06803e5cabb] [:name Main Category MC1] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name Budget-Period-Past] [:id 8b8fe440-cae5-4bf9-8048-d0ec2399faa1] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mediocre Aluminum Shoes] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id fb664326-a8ef-4556-af02-07d3127cd9ec] [:name Beauty & Kids] [:shortname nil] [:department #ordered/map ([:id d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9] [:name Home, Jewelry & Computers] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value CHF] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id 64bfb152-ea6c-42da-98c6-325afeb462bc] [:name reception room] [:building #ordered/map ([:id 3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c] [:name 9594 Beer Extension] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value Corporis commodi provident nam.] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents 0] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-11-30T19:19:38.853Z NX-41294 DEBUG [leihs.procurement.graphql:74] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1608672852"] [:total_count 1] [:budget_periods [#ordered/map ([:id "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"] [:cacheKey "1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1"] [:name "Budget-Period-Past"] [:inspection_start_date "2023-08-23T22:00:00Z"] [:end_date "2023-11-22T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"] [:cacheKey "1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb"] [:name "Main Category MC1"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "7d5ba731-edd9-41ba-8773-7337d24c2327"] [:cacheKey "1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb_7d5ba731-edd9-41ba-8773-7337d24c2327"] [:name "Category C1"] [:total_price_cents "0"] [:requests [#ordered/map ([:id "40284a6b-cf5e-41c1-af6c-dc423894ee11"] [:short_id "Budget-Period-Past.001"] [:user #ordered/map ([:value #ordered/map ([:id "2187a76b-557a-4775-9a1e-778142161819"] [:firstname "Lynsey"] [:lastname "Kertzmann"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id "7d5ba731-edd9-41ba-8773-7337d24c2327"] [:name "Category C1"] [:main_category #ordered/map ([:id "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"] [:name "Main Category MC1"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name "Budget-Period-Past"] [:id "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "fb664326-a8ef-4556-af02-07d3127cd9ec"] [:name "Beauty & Kids"] [:shortname nil] [:department #ordered/map ([:id "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"] [:name "Home, Jewelry & Computers"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "64bfb152-ea6c-42da-98c6-325afeb462bc"] [:name "reception room"] [:building #ordered/map ([:id "3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c"] [:name "9594 Beer Extension"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "Corporis commodi provident nam."] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value "aquisition"] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "0"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}
2023-11-30T19:19:38.854Z NX-41294 DEBUG [leihs.procurement.authorization:150] - (authorize handler request) => {:body {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1608672852"] [:total_count 1] [:budget_periods [#ordered/map ([:id "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"] [:cacheKey "1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1"] [:name "Budget-Period-Past"] [:inspection_start_date "2023-08-23T22:00:00Z"] [:end_date "2023-11-22T23:00:00Z"] [:total_price_cents "0"] [:main_categories [#ordered/map ([:id "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"] [:cacheKey "1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb"] [:name "Main Category MC1"] [:image_url nil] [:total_price_cents "0"] [:categories [#ordered/map ([:id "7d5ba731-edd9-41ba-8773-7337d24c2327"] [:cacheKey "1608672852_8b8fe440-cae5-4bf9-8048-d0ec2399faa1_d2907cbd-98d0-48b7-ab9a-f06803e5cabb_7d5ba731-edd9-41ba-8773-7337d24c2327"] [:name "Category C1"] [:total_price_cents "0"] [:requests [#ordered/map ([:id "40284a6b-cf5e-41c1-af6c-dc423894ee11"] [:short_id "Budget-Period-Past.001"] [:user #ordered/map ([:value #ordered/map ([:id "2187a76b-557a-4775-9a1e-778142161819"] [:firstname "Lynsey"] [:lastname "Kertzmann"] [:__typename :User])] [:__typename :RequestFieldUser])] [:category #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:id "7d5ba731-edd9-41ba-8773-7337d24c2327"] [:name "Category C1"] [:main_category #ordered/map ([:id "d2907cbd-98d0-48b7-ab9a-f06803e5cabb"] [:name "Main Category MC1"] [:__typename :MainCategory])] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write false] [:required true] [:value #ordered/map ([:name "Budget-Period-Past"] [:id "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mediocre Aluminum Shoes"] [:__typename :RequestFieldString])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:organization #ordered/map ([:value #ordered/map ([:id "fb664326-a8ef-4556-af02-07d3127cd9ec"] [:name "Beauty & Kids"] [:shortname nil] [:department #ordered/map ([:id "d6f9842f-4a7f-45ed-8ac5-c708cd6f8ca9"] [:name "Home, Jewelry & Computers"] [:__typename :Organization])] [:__typename :Organization])] [:__typename :RequestFieldOrganization])] [:price_cents #ordered/map ([:value 0] [:__typename :RequestFieldInt])] [:price_currency #ordered/map ([:value "CHF"] [:__typename :RequestFieldString])] [:requested_quantity #ordered/map ([:read true] [:value 1] [:__typename :RequestFieldInt])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt])] [:replacement #ordered/map ([:value true] [:__typename :RequestFieldBoolean])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority])] [:state :NEW] [:article_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier])] [:supplier_name #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:room #ordered/map ([:value #ordered/map ([:id "64bfb152-ea6c-42da-98c6-325afeb462bc"] [:name "reception room"] [:building #ordered/map ([:id "3eaa2152-ebd3-4b7c-b370-f107fa7b4d7c"] [:name "9594 Beer Extension"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom])] [:motivation #ordered/map ([:value "Corporis commodi provident nam."] [:__typename :RequestFieldString])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority])] [:accounting_type #ordered/map ([:value "aquisition"] [:__typename :RequestFieldString])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:order_status #ordered/map ([:value :NOT_PROCESSED] [:__typename :RequestFieldOrderStatus])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString])] [:__typename :Request] [:total_price_cents "0"] [:actionPermissions #ordered/map ([:edit true] [:__typename :RequestActionPermissions])])]] [:__typename :Category])]] [:__typename :MainCategory])]] [:__typename :BudgetPeriod])]] [:__typename :Dashboard])])}, :status 202}
2023-11-30T19:20:03.518Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=5, active=0, idle=5, waiting=0)
2023-11-30T19:20:03.519Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=5, active=0, idle=5, waiting=0)
2023-11-30T19:20:03.519Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - db-pool - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-11-30T19:20:03.544Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-11-30T19:20:03.545Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-11-30T19:20:03.546Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-11-30T19:20:33.525Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=5, active=0, idle=5, waiting=0)
2023-11-30T19:20:33.536Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=5, active=0, idle=5, waiting=0)
2023-11-30T19:20:33.536Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - db-pool - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-11-30T19:20:33.550Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-11-30T19:20:33.551Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-11-30T19:20:33.551Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
