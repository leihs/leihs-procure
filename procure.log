# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
>o> templates::templates-base-query ERROR?
2023-12-09T05:33:40.525Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-09T05:33:41.104Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-09T05:33:41.111Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x4ea23481 "taoensso.timbre$default_output_fn@4ea23481"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x6d0fc5ad "taoensso.timbre.appenders.core$println_appender$fn__3459@6d0fc5ad"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-09T05:33:41.113Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-09T05:33:41.126Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 30453, :repl-port-file ".nrepl-port"}
2023-12-09T05:33:41.128Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  30453 localhost
2023-12-09T05:33:41.150Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-09T05:33:41.153Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 30453, :repl-port-file .nrepl-port}
2023-12-09T05:33:41.154Z NX-41294 INFO [leihs.core.shutdown:20] - PID 71298
2023-12-09T05:33:41.166Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-09T05:33:41.229Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-09T05:33:41.231Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-09T05:33:41.237Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-09T05:33:41.310Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@551a8b2
2023-12-09T05:33:41.317Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-09T05:33:41.317Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 "HikariDataSource (db-pool)"]}
2023-12-09T05:33:41.318Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-09T05:33:41.331Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-09T05:33:41.341Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1f69d6b1
2023-12-09T05:33:41.341Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-09T05:33:41.347Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb "next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb"]}}
2023-12-09T05:33:41.353Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x6f5fad44 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x215a5be4 "java.util.concurrent.ThreadPoolExecutor@215a5be4[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-09T05:33:41.364Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44753 0x6a9e3b1e leihs.core.locale$wrap$fn__44753@6a9e3b1e]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207516990271041, :params {:budgetPeriod c1df486d-54a1-41b9-8f47-7e77955184cb, :template 21930396-9db0-42aa-ad2b-b68bb9baca93}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {:budgetPeriod c1df486d-54a1-41b9-8f47-7e77955184cb, :template 21930396-9db0-42aa-ad2b-b68bb9baca93}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x8241933 /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {:budgetPeriod c1df486d-54a1-41b9-8f47-7e77955184cb, :template 21930396-9db0-42aa-ad2b-b68bb9baca93}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:budgetPeriod c1df486d-54a1-41b9-8f47-7e77955184cb, :template 21930396-9db0-42aa-ad2b-b68bb9baca93}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/requests/new, :server-name localhost, :handler-key :not-found, :query-string budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0xe159f80 leihs.procurement.backend.html$not_found_handler@e159f80], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.422Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.427Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>myprint>  inspector true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.431Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.433Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.435Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.436Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.437Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.438Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  68939ac2-a15f-47e1-9607-a44e6e99afaf

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44753 0x6a9e3b1e leihs.core.locale$wrap$fn__44753@6a9e3b1e]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517316324750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x62a5ce49 /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.709Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.710Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>myprint>  inspector true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.711Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.712Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.712Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.713Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.714Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.715Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  68939ac2-a15f-47e1-9607-a44e6e99afaf

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T05:33:44.721Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "770acc88-a672-45da-bfd6-13ab78c28714"
2023-12-09T05:33:44.731Z NX-41294 DEBUG [leihs.procurement.resources.user:80] - id => #uuid "770acc88-a672-45da-bfd6-13ab78c28714"
>o> >tocheck>
2023-12-09T05:33:44.732Z NX-41294 DEBUG [leihs.procurement.resources.user:?] - (sql-format (sql/where user-base-query [:= :id [:cast id :uuid]])) => ["SELECT id, firstname, lastname FROM users WHERE id = CAST(? AS UUID)" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>>>2 {:id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :firstname Dawna, :lastname Kemmer}
>>oida>> #uuid "770acc88-a672-45da-bfd6-13ab78c28714"
2023-12-09T05:33:44.736Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.759Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.760Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517316324750, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x62a5ce49 /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-09T02:57:13.819479Z","id":"770acc88-a672-45da-bfd6-13ab78c28714","user_session_id":"62f56d2a-3b3d-443a-9e2b-4e0026e0aac1","scope_system_admin_read":false,"access-rights":[],"user_id":"770acc88-a672-45da-bfd6-13ab78c28714","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"68939ac2-a15f-47e1-9607-a44e6e99afaf"},"leihs-user-session":{"value":"19ea7ed7-0ca3-4a69-b588-2303ecf67edb"}},"remote-addr":"127.0.0.1","start-time":207517316324750,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb","content-length":"502","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"68939ac2-a15f-47e1-9607-a44e6e99afaf","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"68939ac2-a15f-47e1-9607-a44e6e99afaf","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"770acc88-a672-45da-bfd6-13ab78c28714","firstname":"Dawna","lastname":"Kemmer","login":null,"email":"amelia@rosenbaum.name"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id 770acc88-a672-45da-bfd6-13ab78c28714] [:firstname Dawna] [:lastname Kemmer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-09T05:33:44.772Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"68939ac2-a15f-47e1-9607-a44e6e99afaf\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"770acc88-a672-45da-bfd6-13ab78c28714\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "770acc88-a672-45da-bfd6-13ab78c28714"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44753 0x6a9e3b1e leihs.core.locale$wrap$fn__44753@6a9e3b1e]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517464010833, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 669, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x9ed38dd /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 669, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestPreselectionQuery, :variables {}, :query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.805Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.806Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>myprint>  inspector true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.807Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.808Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.809Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.810Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.811Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.812Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  68939ac2-a15f-47e1-9607-a44e6e99afaf

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T05:33:44.817Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>debug 2
>debug 3
2023-12-09T05:33:44.824Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql-format main-categories-base-query) => ["SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC"]
>debug 4
>debug 5 {:id #uuid "d4a4f93c-8619-4044-a409-844fe98d78d1", :name Geisha}
>debug 5a id #uuid "d4a4f93c-8619-4044-a409-844fe98d78d1"
2023-12-09T05:33:44.826Z NX-41294 DEBUG [leihs.procurement.resources.main-categories:?] - (sql-format (image/image-query-for-main-category (:id mc))) => ["SELECT procurement_images.* FROM procurement_images WHERE procurement_images.main_category_id = CAST(? AS UUID)" #uuid "d4a4f93c-8619-4044-a409-844fe98d78d1"]
>debug 5b nil
2023-12-09T05:33:44.827Z NX-41294 DEBUG [leihs.procurement.resources.categories:?] - (sql-format (sql/where categories-base-query [:= :procurement_categories.main_category_id main-cat-id])) => ["SELECT procurement_categories.* FROM procurement_categories WHERE procurement_categories.main_category_id = ? ORDER BY procurement_categories.name ASC" #uuid "d4a4f93c-8619-4044-a409-844fe98d78d1"]
>oo> templates::get-templates2 _> HERE value contains :id??) nil nil
>oo> templates::get-templates1a ?broken-base-query? {:select [:procurement_templates.*], :from [:procurement_templates], :left-join [:models [:= :models.id :procurement_templates.model_id]], :order-by [[[:concat ([:lower [:coalesce :procurement_templates.article_name ]] [:lower [:coalesce :models.product ]] [:lower [:coalesce :models.version ]])]]]}
>oo> templates::get-templates1b ?broken-base-query? [SELECT procurement_templates.* FROM procurement_templates LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY CONCAT((LOWER(COALESCE(procurement_templates.article_name, ?)), LOWER(COALESCE(models.product, ?)), LOWER(COALESCE(models.version, ?)))) ASC   ]
>oo> templates::get-templates1c [SELECT procurement_templates.* FROM procurement_templates LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY CONCAT((LOWER(COALESCE(procurement_templates.article_name, ?)), LOWER(COALESCE(models.product, ?)), LOWER(COALESCE(models.version, ?)))) ASC   ]
2023-12-09T05:33:44.830Z NX-41294 DEBUG [leihs.procurement.resources.templates:?] - (sql-format query) => ["SELECT procurement_templates.* FROM procurement_templates LEFT JOIN models ON models.id = procurement_templates.model_id ORDER BY CONCAT((LOWER(COALESCE(procurement_templates.article_name, ?)), LOWER(COALESCE(models.product, ?)), LOWER(COALESCE(models.version, ?)))) ASC" "" "" ""]
2023-12-09T05:33:44.835Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-09T05:33:44.835Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil

>o> NPE?? model::get-model-by-id id nil
2023-12-09T05:33:44.837Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-09T05:33:44.837Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models WHERE models.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.838Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (jdbc/execute-one! tx (spy (model-query id))) => nil
2023-12-09T05:33:44.839Z NX-41294 DEBUG [leihs.procurement.resources.supplier:36] - (-> context :request :tx) => {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 "HikariDataSource (db-pool)"]}
2023-12-09T05:33:44.840Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (-> context :request :tx-next) => #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb "next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb"]}}
2023-12-09T05:33:44.840Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - value => {:article_number "Mate 9", :price_cents 8, :article_name "Galaxy S1", :is_archived true, :supplier_name "Sony", :model_id nil, :supplier_id nil, :id #uuid "e408a6f3-677b-4e85-82f1-524652d22b39", :price_currency "USD", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.840Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - (:value (spy value)) => nil
2023-12-09T05:33:44.840Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - value => {:article_number "Mate 9", :price_cents 8, :article_name "Galaxy S1", :is_archived true, :supplier_name "Sony", :model_id nil, :supplier_id nil, :id #uuid "e408a6f3-677b-4e85-82f1-524652d22b39", :price_currency "USD", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.841Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - (:supplier_id (spy value)) => nil
>o> tocheck suppliers.id= nil
2023-12-09T05:33:44.842Z NX-41294 DEBUG [leihs.procurement.resources.supplier:23] - id => nil
2023-12-09T05:33:44.842Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql-format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers WHERE suppliers.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.843Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (get-supplier-by-id (spy (-> context :request :tx-next)) (or (spy (:value (spy value))) (spy (:supplier_id (spy value))))) => nil
2023-12-09T05:33:44.844Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-09T05:33:44.845Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil

>o> NPE?? model::get-model-by-id id nil
2023-12-09T05:33:44.845Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-09T05:33:44.845Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models WHERE models.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.846Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (jdbc/execute-one! tx (spy (model-query id))) => nil
2023-12-09T05:33:44.846Z NX-41294 DEBUG [leihs.procurement.resources.supplier:36] - (-> context :request :tx) => {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 "HikariDataSource (db-pool)"]}
2023-12-09T05:33:44.846Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (-> context :request :tx-next) => #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb "next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb"]}}
2023-12-09T05:33:44.846Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - value => {:article_number "OnePlus 5T", :price_cents 83, :article_name "Galaxy S9", :is_archived true, :supplier_name "Panasonic", :model_id nil, :supplier_id nil, :id #uuid "838ee787-7d62-4292-857c-79642b39f779", :price_currency "PLN", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.846Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - (:value (spy value)) => nil
2023-12-09T05:33:44.846Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - value => {:article_number "OnePlus 5T", :price_cents 83, :article_name "Galaxy S9", :is_archived true, :supplier_name "Panasonic", :model_id nil, :supplier_id nil, :id #uuid "838ee787-7d62-4292-857c-79642b39f779", :price_currency "PLN", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.847Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - (:supplier_id (spy value)) => nil
>o> tocheck suppliers.id= nil
2023-12-09T05:33:44.847Z NX-41294 DEBUG [leihs.procurement.resources.supplier:23] - id => nil
2023-12-09T05:33:44.847Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql-format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers WHERE suppliers.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.847Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (get-supplier-by-id (spy (-> context :request :tx-next)) (or (spy (:value (spy value))) (spy (:supplier_id (spy value))))) => nil
2023-12-09T05:33:44.848Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-09T05:33:44.849Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil

>o> NPE?? model::get-model-by-id id nil
2023-12-09T05:33:44.849Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-09T05:33:44.850Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models WHERE models.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.850Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (jdbc/execute-one! tx (spy (model-query id))) => nil
2023-12-09T05:33:44.851Z NX-41294 DEBUG [leihs.procurement.resources.supplier:36] - (-> context :request :tx) => {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 "HikariDataSource (db-pool)"]}
2023-12-09T05:33:44.851Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (-> context :request :tx-next) => #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb "next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb"]}}
2023-12-09T05:33:44.851Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - value => {:article_number "iPhone 5S", :price_cents 53, :article_name "Mi 8", :is_archived false, :supplier_name "Polaroid", :model_id nil, :supplier_id nil, :id #uuid "21930396-9db0-42aa-ad2b-b68bb9baca93", :price_currency "CAD", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.851Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - (:value (spy value)) => nil
2023-12-09T05:33:44.851Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - value => {:article_number "iPhone 5S", :price_cents 53, :article_name "Mi 8", :is_archived false, :supplier_name "Polaroid", :model_id nil, :supplier_id nil, :id #uuid "21930396-9db0-42aa-ad2b-b68bb9baca93", :price_currency "CAD", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.851Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - (:supplier_id (spy value)) => nil
>o> tocheck suppliers.id= nil
2023-12-09T05:33:44.851Z NX-41294 DEBUG [leihs.procurement.resources.supplier:23] - id => nil
2023-12-09T05:33:44.851Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql-format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers WHERE suppliers.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.852Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (get-supplier-by-id (spy (-> context :request :tx-next)) (or (spy (:value (spy value))) (spy (:supplier_id (spy value))))) => nil
2023-12-09T05:33:44.853Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-09T05:33:44.853Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil

>o> NPE?? model::get-model-by-id id nil
2023-12-09T05:33:44.853Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-09T05:33:44.854Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models WHERE models.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.854Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (jdbc/execute-one! tx (spy (model-query id))) => nil
2023-12-09T05:33:44.854Z NX-41294 DEBUG [leihs.procurement.resources.supplier:36] - (-> context :request :tx) => {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 "HikariDataSource (db-pool)"]}
2023-12-09T05:33:44.854Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (-> context :request :tx-next) => #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb "next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb"]}}
2023-12-09T05:33:44.855Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - value => {:article_number "Galaxy S7", :price_cents 80, :article_name "Pocophone F1", :is_archived true, :supplier_name "Benq", :model_id nil, :supplier_id nil, :id #uuid "7ee940d5-7234-4308-8c7f-722fee3718d3", :price_currency "INR", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.855Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - (:value (spy value)) => nil
2023-12-09T05:33:44.855Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - value => {:article_number "Galaxy S7", :price_cents 80, :article_name "Pocophone F1", :is_archived true, :supplier_name "Benq", :model_id nil, :supplier_id nil, :id #uuid "7ee940d5-7234-4308-8c7f-722fee3718d3", :price_currency "INR", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.855Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - (:supplier_id (spy value)) => nil
>o> tocheck suppliers.id= nil
2023-12-09T05:33:44.855Z NX-41294 DEBUG [leihs.procurement.resources.supplier:23] - id => nil
2023-12-09T05:33:44.855Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql-format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers WHERE suppliers.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.856Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (get-supplier-by-id (spy (-> context :request :tx-next)) (or (spy (:value (spy value))) (spy (:supplier_id (spy value))))) => nil
2023-12-09T05:33:44.856Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-09T05:33:44.856Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil

>o> NPE?? model::get-model-by-id id nil
2023-12-09T05:33:44.857Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-09T05:33:44.857Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models WHERE models.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.858Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (jdbc/execute-one! tx (spy (model-query id))) => nil
2023-12-09T05:33:44.858Z NX-41294 DEBUG [leihs.procurement.resources.supplier:36] - (-> context :request :tx) => {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 "HikariDataSource (db-pool)"]}
2023-12-09T05:33:44.858Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (-> context :request :tx-next) => #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb "next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb"]}}
2023-12-09T05:33:44.858Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - value => {:article_number "Galaxy S7 Edge", :price_cents 9, :article_name "Redmi Note 6 Pro", :is_archived true, :supplier_name "Leica", :model_id nil, :supplier_id nil, :id #uuid "5fb007e9-cb17-4f1f-ae91-6d9c5b0987e4", :price_currency "TJS", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.859Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - (:value (spy value)) => nil
2023-12-09T05:33:44.859Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - value => {:article_number "Galaxy S7 Edge", :price_cents 9, :article_name "Redmi Note 6 Pro", :is_archived true, :supplier_name "Leica", :model_id nil, :supplier_id nil, :id #uuid "5fb007e9-cb17-4f1f-ae91-6d9c5b0987e4", :price_currency "TJS", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.859Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - (:supplier_id (spy value)) => nil
>o> tocheck suppliers.id= nil
2023-12-09T05:33:44.859Z NX-41294 DEBUG [leihs.procurement.resources.supplier:23] - id => nil
2023-12-09T05:33:44.859Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql-format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers WHERE suppliers.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.860Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (get-supplier-by-id (spy (-> context :request :tx-next)) (or (spy (:value (spy value))) (spy (:supplier_id (spy value))))) => nil
2023-12-09T05:33:44.861Z NX-41294 DEBUG [leihs.procurement.resources.model:36] - (:value value) => nil
2023-12-09T05:33:44.861Z NX-41294 DEBUG [leihs.procurement.resources.model:37] - (:model_id value) => nil

>o> NPE?? model::get-model-by-id id nil
2023-12-09T05:33:44.861Z NX-41294 DEBUG [leihs.procurement.resources.model:26] - id => nil
2023-12-09T05:33:44.861Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (model-query id) => ["SELECT models.* FROM models WHERE models.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.861Z NX-41294 DEBUG [leihs.procurement.resources.model:29] - (jdbc/execute-one! tx (spy (model-query id))) => nil
2023-12-09T05:33:44.862Z NX-41294 DEBUG [leihs.procurement.resources.supplier:36] - (-> context :request :tx) => {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 "HikariDataSource (db-pool)"]}
2023-12-09T05:33:44.862Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (-> context :request :tx-next) => #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb "next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb"]}}
2023-12-09T05:33:44.862Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - value => {:article_number "fdsa", :price_cents -500, :article_name "fda", :is_archived false, :supplier_name "fdasfdsafd", :model_id nil, :supplier_id nil, :id #uuid "893c6e5a-4a7e-4ded-b55c-e134285b8377", :price_currency "CHF", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.862Z NX-41294 DEBUG [leihs.procurement.resources.supplier:43] - (:value (spy value)) => nil
2023-12-09T05:33:44.862Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - value => {:article_number "fdsa", :price_cents -500, :article_name "fda", :is_archived false, :supplier_name "fdasfdsafd", :model_id nil, :supplier_id nil, :id #uuid "893c6e5a-4a7e-4ded-b55c-e134285b8377", :price_currency "CHF", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.862Z NX-41294 DEBUG [leihs.procurement.resources.supplier:44] - (:supplier_id (spy value)) => nil
>o> tocheck suppliers.id= nil
2023-12-09T05:33:44.862Z NX-41294 DEBUG [leihs.procurement.resources.supplier:23] - id => nil
2023-12-09T05:33:44.863Z NX-41294 DEBUG [leihs.procurement.resources.supplier:?] - (sql-format (sql/where (sql/from (sql/select :suppliers.*) :suppliers) [:= :suppliers.id [:cast (spy id) :uuid]])) => ["SELECT suppliers.* FROM suppliers WHERE suppliers.id = CAST(NULL AS UUID)"]
2023-12-09T05:33:44.863Z NX-41294 DEBUG [leihs.procurement.resources.supplier:40] - (get-supplier-by-id (spy (-> context :request :tx-next)) (or (spy (:value (spy value))) (spy (:supplier_id (spy value))))) => nil

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517464010833, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 669, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x9ed38dd /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 669, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestPreselectionQuery, :variables {}, :query query newRequestPreselectionQuery {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    image_url
    categories {
      id
      name
      __typename
    }
    __typename
  }
  templates {
    id
    category {
      id
      __typename
    }
    is_archived
    article_name
    article_number
    model {
      id
      product
      version
      __typename
    }
    price_cents
    price_currency
    supplier {
      id
      __typename
    }
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-09T02:57:13.819479Z","id":"770acc88-a672-45da-bfd6-13ab78c28714","user_session_id":"62f56d2a-3b3d-443a-9e2b-4e0026e0aac1","scope_system_admin_read":false,"access-rights":[],"user_id":"770acc88-a672-45da-bfd6-13ab78c28714","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"68939ac2-a15f-47e1-9607-a44e6e99afaf"},"leihs-user-session":{"value":"19ea7ed7-0ca3-4a69-b588-2303ecf67edb"}},"remote-addr":"127.0.0.1","start-time":207517464010833,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb","content-length":"669","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"68939ac2-a15f-47e1-9607-a44e6e99afaf","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":669,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"newRequestPreselectionQuery","variables":{},"query":"query newRequestPreselectionQuery {\n  budget_periods {\n    id\n    name\n    inspection_start_date\n    end_date\n    __typename\n  }\n  main_categories {\n    id\n    name\n    image_url\n    categories {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  templates {\n    id\n    category {\n      id\n      __typename\n    }\n    is_archived\n    article_name\n    article_number\n    model {\n      id\n      product\n      version\n      __typename\n    }\n    price_cents\n    price_currency\n    supplier {\n      id\n      __typename\n    }\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id c1df486d-54a1-41b9-8f47-7e77955184cb] [:name BP-in-inspection-phase] [:inspection_start_date 2023-12-07 00:00:00.0] [:end_date 2024-01-08 00:00:00.0] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id d4a4f93c-8619-4044-a409-844fe98d78d1] [:name Geisha] [:image_url nil] [:categories [#ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:name Ennarea] [:__typename :Category])]] [:__typename :MainCategory])]] [:templates [#ordered/map ([:id e408a6f3-677b-4e85-82f1-524652d22b39] [:category #ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:__typename :Category])] [:is_archived true] [:article_name Galaxy S1] [:article_number Mate 9] [:model nil] [:price_cents 8] [:price_currency USD] [:supplier nil] [:__typename :Template]) #ordered/map ([:id 838ee787-7d62-4292-857c-79642b39f779] [:category #ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:__typename :Category])] [:is_archived true] [:article_name Galaxy S9] [:article_number OnePlus 5T] [:model nil] [:price_cents 83] [:price_currency PLN] [:supplier nil] [:__typename :Template]) #ordered/map ([:id 21930396-9db0-42aa-ad2b-b68bb9baca93] [:category #ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:__typename :Category])] [:is_archived false] [:article_name Mi 8] [:article_number iPhone 5S] [:model nil] [:price_cents 53] [:price_currency CAD] [:supplier nil] [:__typename :Template]) #ordered/map ([:id 7ee940d5-7234-4308-8c7f-722fee3718d3] [:category #ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:__typename :Category])] [:is_archived true] [:article_name Pocophone F1] [:article_number Galaxy S7] [:model nil] [:price_cents 80] [:price_currency INR] [:supplier nil] [:__typename :Template]) #ordered/map ([:id 5fb007e9-cb17-4f1f-ae91-6d9c5b0987e4] [:category #ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:__typename :Category])] [:is_archived true] [:article_name Redmi Note 6 Pro] [:article_number Galaxy S7 Edge] [:model nil] [:price_cents 9] [:price_currency TJS] [:supplier nil] [:__typename :Template]) #ordered/map ([:id 893c6e5a-4a7e-4ded-b55c-e134285b8377] [:category #ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:__typename :Category])] [:is_archived false] [:article_name fda] [:article_number fdsa] [:model nil] [:price_cents -500] [:price_currency CHF] [:supplier nil] [:__typename :Template])]])}
2023-12-09T05:33:44.865Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "c1df486d-54a1-41b9-8f47-7e77955184cb"] [:name "BP-in-inspection-phase"] [:inspection_start_date "2023-12-07 00:00:00.0"] [:end_date "2024-01-08 00:00:00.0"] [:__typename :BudgetPeriod])]] [:main_categories [#ordered/map ([:id "d4a4f93c-8619-4044-a409-844fe98d78d1"] [:name "Geisha"] [:image_url nil] [:categories [#ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:name "Ennarea"] [:__typename :Category])]] [:__typename :MainCategory])]] [:templates [#ordered/map ([:id "e408a6f3-677b-4e85-82f1-524652d22b39"] [:category #ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:__typename :Category])] [:is_archived true] [:article_name "Galaxy S1"] [:article_number "Mate 9"] [:model nil] [:price_cents 8] [:price_currency "USD"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "838ee787-7d62-4292-857c-79642b39f779"] [:category #ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:__typename :Category])] [:is_archived true] [:article_name "Galaxy S9"] [:article_number "OnePlus 5T"] [:model nil] [:price_cents 83] [:price_currency "PLN"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "21930396-9db0-42aa-ad2b-b68bb9baca93"] [:category #ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:__typename :Category])] [:is_archived false] [:article_name "Mi 8"] [:article_number "iPhone 5S"] [:model nil] [:price_cents 53] [:price_currency "CAD"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "7ee940d5-7234-4308-8c7f-722fee3718d3"] [:category #ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:__typename :Category])] [:is_archived true] [:article_name "Pocophone F1"] [:article_number "Galaxy S7"] [:model nil] [:price_cents 80] [:price_currency "INR"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "5fb007e9-cb17-4f1f-ae91-6d9c5b0987e4"] [:category #ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:__typename :Category])] [:is_archived true] [:article_name "Redmi Note 6 Pro"] [:article_number "Galaxy S7 Edge"] [:model nil] [:price_cents 9] [:price_currency "TJS"] [:supplier nil] [:__typename :Template]) #ordered/map ([:id "893c6e5a-4a7e-4ded-b55c-e134285b8377"] [:category #ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:__typename :Category])] [:is_archived false] [:article_name "fda"] [:article_number "fdsa"] [:model nil] [:price_cents -500] [:price_currency "CHF"] [:supplier nil] [:__typename :Template])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44753 0x6a9e3b1e leihs.core.locale$wrap$fn__44753@6a9e3b1e]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517556637833, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 5445, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7235fb1 /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 5445, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestQuery, :variables {:budgetPeriod c1df486d-54a1-41b9-8f47-7e77955184cb, :template 21930396-9db0-42aa-ad2b-b68bb9baca93}, :query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.926Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.927Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>myprint>  inspector true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.928Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.929Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.929Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.930Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.931Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.931Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  68939ac2-a15f-47e1-9607-a44e6e99afaf

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T05:33:44.949Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
 with variables {:budgetPeriod "c1df486d-54a1-41b9-8f47-7e77955184cb", :template "21930396-9db0-42aa-ad2b-b68bb9baca93"}
>oo> vars from graphQL-Requst nil nil nil {:budgetPeriod c1df486d-54a1-41b9-8f47-7e77955184cb, :template 21930396-9db0-42aa-ad2b-b68bb9baca93}
>debug> 27 get-new
>debug> 3
>o> request-fields::get-for-user-and-request, new-request?= true
>o> tocheck ??? get-template-by-id 21930396-9db0-42aa-ad2b-b68bb9baca93
2023-12-09T05:33:44.978Z NX-41294 DEBUG [leihs.procurement.resources.template:55] - (-> templates-base-query (sql/where [:= :procurement_templates.id [:cast id :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:article_number "iPhone 5S", :price_cents 53, :article_name "Mi 8", :is_archived false, :supplier_name "Polaroid", :model_id nil, :supplier_id nil, :id #uuid "21930396-9db0-42aa-ad2b-b68bb9baca93", :price_currency "CAD", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:44.979Z NX-41294 DEBUG [leihs.procurement.resources.user:80] - id => #uuid "770acc88-a672-45da-bfd6-13ab78c28714"
>o> >tocheck>
2023-12-09T05:33:44.980Z NX-41294 DEBUG [leihs.procurement.resources.user:?] - (sql-format (sql/where user-base-query [:= :id [:cast id :uuid]])) => ["SELECT id, firstname, lastname FROM users WHERE id = CAST(? AS UUID)" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.980Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.981Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:44.981Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "c1df486d-54a1-41b9-8f47-7e77955184cb", :name BP-in-inspection-phase, :inspection_start_date #inst "2023-12-06T23:00:00.000000000-00:00", :end_date #inst "2024-01-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T18:54:07.389889000-00:00", :updated_at #inst "2023-12-08T18:54:07.389889000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-01-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2023-12-07]
>oo> start/end [:cast 2023-12-07 :date] [:cast 2024-01-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
2023-12-09T05:33:44.988Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
2023-12-09T05:33:44.989Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
>o> viewer? {:result false}
2023-12-09T05:33:44.991Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:385] - (or (and requester own-request) category-viewer inspector admin) => true
2023-12-09T05:33:44.992Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:386] - (and (not template) (not past-phase) (or (and new-request requester (or (and requesting-phase (or own-request inspector)) (and inspection-phase category-inspector) admin)) (and existing-request (or admin category-inspector (and requesting-phase requester own-request))))) => false
2023-12-09T05:33:44.996Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - requester => true
2023-12-09T05:33:44.996Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - own-request => true
2023-12-09T05:33:44.996Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - past-phase => false
2023-12-09T05:33:44.996Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:83] - inspector => true
2023-12-09T05:33:44.996Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => true
>oo> can-write-any-field?
>oo> can-write-any-field/attr to remove [#{:state :id :total_price_cents :short_id} #{:DELETE} [:budget_period :category :created_at :organization :updated_at]]
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26
>debug> 26

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517556637833, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 5445, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7235fb1 /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 5445, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName newRequestQuery, :variables {:budgetPeriod c1df486d-54a1-41b9-8f47-7e77955184cb, :template 21930396-9db0-42aa-ad2b-b68bb9baca93}, :query query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {
  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {
    ...RequestFieldsForEdit
    __typename
  }
}

fragment RequestFieldsForEdit on Request {
  ...RequestFieldsForIndex
  template {
    value {
      id
      article_name
      __typename
    }
    __typename
  }
  user {
    read
    write
    required
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  article_name {
    ...RequestFieldString
    __typename
  }
  model {
    read
    write
    required
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  supplier_name {
    ...RequestFieldString
    __typename
  }
  supplier {
    read
    write
    required
    value {
      id
      name
      __typename
    }
    __typename
  }
  receiver {
    ...RequestFieldString
    __typename
  }
  price_cents {
    ...RequestFieldInt
    __typename
  }
  price_currency {
    ...RequestFieldString
    __typename
  }
  requested_quantity {
    ...RequestFieldInt
    __typename
  }
  approved_quantity {
    ...RequestFieldInt
    __typename
  }
  order_quantity {
    ...RequestFieldInt
    __typename
  }
  order_status {
    read
    write
    required
    value
    __typename
  }
  order_comment {
    ...RequestFieldString
    __typename
  }
  priority {
    read
    write
    required
    value
    __typename
  }
  inspector_priority {
    read
    write
    required
    value
    __typename
  }
  state
  article_number {
    ...RequestFieldString
    __typename
  }
  motivation {
    ...RequestFieldString
    __typename
  }
  replacement {
    ...RequestFieldBoolean
    __typename
  }
  room {
    read
    write
    required
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  inspection_comment {
    ...RequestFieldString
    __typename
  }
  attachments {
    read
    write
    required
    value {
      id
      filename
      url
      __typename
    }
    __typename
  }
  accounting_type {
    ...RequestFieldString
    __typename
  }
  cost_center {
    read
    write
    required
    value
    __typename
  }
  procurement_account {
    read
    write
    value
    __typename
  }
  general_ledger_account {
    read
    value
    __typename
  }
  internal_order_number {
    ...RequestFieldString
    __typename
  }
  __typename
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}

fragment RequestFieldString on RequestFieldString {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldInt on RequestFieldInt {
  value
  read
  write
  required
  __typename
}

fragment RequestFieldBoolean on RequestFieldBoolean {
  value
  read
  write
  required
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-09T02:57:13.819479Z","id":"770acc88-a672-45da-bfd6-13ab78c28714","user_session_id":"62f56d2a-3b3d-443a-9e2b-4e0026e0aac1","scope_system_admin_read":false,"access-rights":[],"user_id":"770acc88-a672-45da-bfd6-13ab78c28714","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"68939ac2-a15f-47e1-9607-a44e6e99afaf"},"leihs-user-session":{"value":"19ea7ed7-0ca3-4a69-b588-2303ecf67edb"}},"remote-addr":"127.0.0.1","start-time":207517556637833,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb","content-length":"5445","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"68939ac2-a15f-47e1-9607-a44e6e99afaf","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":5445,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"newRequestQuery","variables":{"budgetPeriod":"c1df486d-54a1-41b9-8f47-7e77955184cb","template":"21930396-9db0-42aa-ad2b-b68bb9baca93"},"query":"query newRequestQuery($budgetPeriod: ID!, $category: ID, $template: ID) {\n  new_request(budget_period: $budgetPeriod, category: $category, template: $template) {\n    ...RequestFieldsForEdit\n    __typename\n  }\n}\n\nfragment RequestFieldsForEdit on Request {\n  ...RequestFieldsForIndex\n  template {\n    value {\n      id\n      article_name\n      __typename\n    }\n    __typename\n  }\n  user {\n    read\n    write\n    required\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    ...RequestFieldString\n    __typename\n  }\n  model {\n    read\n    write\n    required\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    ...RequestFieldString\n    __typename\n  }\n  supplier {\n    read\n    write\n    required\n    value {\n      id\n      name\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    ...RequestFieldString\n    __typename\n  }\n  price_cents {\n    ...RequestFieldInt\n    __typename\n  }\n  price_currency {\n    ...RequestFieldString\n    __typename\n  }\n  requested_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  approved_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_quantity {\n    ...RequestFieldInt\n    __typename\n  }\n  order_status {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  order_comment {\n    ...RequestFieldString\n    __typename\n  }\n  priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  inspector_priority {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  state\n  article_number {\n    ...RequestFieldString\n    __typename\n  }\n  motivation {\n    ...RequestFieldString\n    __typename\n  }\n  replacement {\n    ...RequestFieldBoolean\n    __typename\n  }\n  room {\n    read\n    write\n    required\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  inspection_comment {\n    ...RequestFieldString\n    __typename\n  }\n  attachments {\n    read\n    write\n    required\n    value {\n      id\n      filename\n      url\n      __typename\n    }\n    __typename\n  }\n  accounting_type {\n    ...RequestFieldString\n    __typename\n  }\n  cost_center {\n    read\n    write\n    required\n    value\n    __typename\n  }\n  procurement_account {\n    read\n    write\n    value\n    __typename\n  }\n  general_ledger_account {\n    read\n    value\n    __typename\n  }\n  internal_order_number {\n    ...RequestFieldString\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldsForIndex on Request {\n  id\n  short_id\n  user {\n    value {\n      id\n      firstname\n      lastname\n      __typename\n    }\n    __typename\n  }\n  category {\n    read\n    write\n    required\n    value {\n      id\n      name\n      main_category {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  budget_period {\n    read\n    write\n    required\n    value {\n      name\n      id\n      __typename\n    }\n    __typename\n  }\n  article_name {\n    value\n    __typename\n  }\n  model {\n    value {\n      id\n      product\n      version\n      __typename\n    }\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  organization {\n    value {\n      id\n      name\n      shortname\n      department {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  price_cents {\n    value\n    __typename\n  }\n  price_currency {\n    value\n    __typename\n  }\n  requested_quantity {\n    read\n    value\n    __typename\n  }\n  approved_quantity {\n    read\n    value\n    __typename\n  }\n  order_quantity {\n    read\n    value\n    __typename\n  }\n  replacement {\n    value\n    __typename\n  }\n  priority {\n    value\n    __typename\n  }\n  state\n  article_number {\n    value\n    __typename\n  }\n  supplier {\n    value {\n      name\n      __typename\n    }\n    __typename\n  }\n  supplier_name {\n    value\n    __typename\n  }\n  receiver {\n    value\n    __typename\n  }\n  room {\n    value {\n      id\n      name\n      building {\n        id\n        name\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  motivation {\n    value\n    __typename\n  }\n  inspection_comment {\n    value\n    __typename\n  }\n  inspector_priority {\n    value\n    __typename\n  }\n  accounting_type {\n    value\n    __typename\n  }\n  cost_center {\n    value\n    __typename\n  }\n  general_ledger_account {\n    value\n    __typename\n  }\n  procurement_account {\n    value\n    __typename\n  }\n  internal_order_number {\n    value\n    __typename\n  }\n  order_status {\n    value\n    __typename\n  }\n  order_comment {\n    value\n    __typename\n  }\n  __typename\n}\n\nfragment RequestFieldString on RequestFieldString {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldInt on RequestFieldInt {\n  value\n  read\n  write\n  required\n  __typename\n}\n\nfragment RequestFieldBoolean on RequestFieldBoolean {\n  value\n  read\n  write\n  required\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:new_request #ordered/map ([:id nil] [:short_id nil] [:user #ordered/map ([:value #ordered/map ([:id 770acc88-a672-45da-bfd6-13ab78c28714] [:firstname Dawna] [:lastname Kemmer] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write true] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id 9b2cf022-e443-42b9-bf52-dabd4105ac65] [:name Ennarea] [:main_category nil] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name BP-in-inspection-phase] [:id c1df486d-54a1-41b9-8f47-7e77955184cb] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value Mi 8] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization nil] [:price_cents #ordered/map ([:value 53] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value CAD] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required false])] [:replacement #ordered/map ([:value nil] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value iPhone 5S] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value Polaroid] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id b8927fd2-014c-48c2-b095-fa1d5620debe] [:name general room] [:building #ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write true] [:required true])] [:accounting_type #ordered/map ([:value aquisition] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCURED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value #ordered/map ([:id 21930396-9db0-42aa-ad2b-b68bb9baca93] [:article_name Mi 8] [:__typename :Template])] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
2023-12-09T05:33:45.016Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:new_request #ordered/map ([:id nil] [:short_id nil] [:user #ordered/map ([:value #ordered/map ([:id "770acc88-a672-45da-bfd6-13ab78c28714"] [:firstname "Dawna"] [:lastname "Kemmer"] [:__typename :User])] [:__typename :RequestFieldUser] [:read true] [:write true] [:required true])] [:category #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:id "9b2cf022-e443-42b9-bf52-dabd4105ac65"] [:name "Ennarea"] [:main_category nil] [:__typename :Category])] [:__typename :RequestFieldCategory])] [:budget_period #ordered/map ([:read true] [:write true] [:required true] [:value #ordered/map ([:name "BP-in-inspection-phase"] [:id "c1df486d-54a1-41b9-8f47-7e77955184cb"] [:__typename :BudgetPeriod])] [:__typename :RequestFieldBudgetPeriod])] [:article_name #ordered/map ([:value "Mi 8"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:model #ordered/map ([:value nil] [:__typename :RequestFieldModel] [:read true] [:write false] [:required false])] [:receiver #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:organization nil] [:price_cents #ordered/map ([:value 53] [:__typename :RequestFieldInt] [:read true] [:write false] [:required true])] [:price_currency #ordered/map ([:value "CAD"] [:__typename :RequestFieldString] [:read true] [:write false] [:required true])] [:requested_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required true])] [:approved_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required false])] [:order_quantity #ordered/map ([:read true] [:value nil] [:__typename :RequestFieldInt] [:write true] [:required false])] [:replacement #ordered/map ([:value nil] [:__typename :RequestFieldBoolean] [:read true] [:write true] [:required true])] [:priority #ordered/map ([:value :NORMAL] [:__typename :RequestFieldPriority] [:read true] [:write true] [:required true])] [:state :NEW] [:article_number #ordered/map ([:value "iPhone 5S"] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:supplier #ordered/map ([:value nil] [:__typename :RequestFieldSupplier] [:read true] [:write false] [:required false])] [:supplier_name #ordered/map ([:value "Polaroid"] [:__typename :RequestFieldString] [:read true] [:write false] [:required false])] [:room #ordered/map ([:value #ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:building #ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building])] [:__typename :Room])] [:__typename :RequestFieldRoom] [:read true] [:write true] [:required true])] [:motivation #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:inspection_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:inspector_priority #ordered/map ([:value :MEDIUM] [:__typename :RequestFieldInspectorPriority] [:read true] [:write true] [:required true])] [:accounting_type #ordered/map ([:value "aquisition"] [:__typename :RequestFieldString] [:read true] [:write true] [:required true])] [:cost_center #ordered/map ([:value nil] [:__typename :RequestFieldCostCenter] [:read true] [:write false] [:required false])] [:general_ledger_account #ordered/map ([:value nil] [:__typename :RequestFieldGeneralLedgerAccount] [:read true])] [:procurement_account #ordered/map ([:value nil] [:__typename :RequestFieldProcurementAccount] [:read true] [:write false])] [:internal_order_number #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read true] [:write true] [:required false])] [:order_status #ordered/map ([:value :NOT_PROCURED] [:__typename :RequestFieldOrderStatus] [:read true] [:write true] [:required true])] [:order_comment #ordered/map ([:value nil] [:__typename :RequestFieldString] [:read false] [:write false] [:required false])] [:__typename :Request] [:template #ordered/map ([:value #ordered/map ([:id "21930396-9db0-42aa-ad2b-b68bb9baca93"] [:article_name "Mi 8"] [:__typename :Template])] [:__typename :RequestFieldTemplate])] [:attachments #ordered/map ([:read true] [:write true] [:required false] [:value []] [:__typename :RequestFieldAttachments])])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44753 0x6a9e3b1e leihs.core.locale$wrap$fn__44753@6a9e3b1e]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517709573416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 137, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6c4c7c0c /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.049Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.050Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>myprint>  inspector true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.051Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.053Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.054Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.055Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.055Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.056Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  68939ac2-a15f-47e1-9607-a44e6e99afaf

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T05:33:45.059Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517709573416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 137, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x6c4c7c0c /127.0.0.1:3230<->/127.0.0.1:49777], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 137, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getBuildings, :variables {}, :query query getBuildings {
  buildings {
    id
    name
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-09T02:57:13.819479Z","id":"770acc88-a672-45da-bfd6-13ab78c28714","user_session_id":"62f56d2a-3b3d-443a-9e2b-4e0026e0aac1","scope_system_admin_read":false,"access-rights":[],"user_id":"770acc88-a672-45da-bfd6-13ab78c28714","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"68939ac2-a15f-47e1-9607-a44e6e99afaf"},"leihs-user-session":{"value":"19ea7ed7-0ca3-4a69-b588-2303ecf67edb"}},"remote-addr":"127.0.0.1","start-time":207517709573416,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb","content-length":"137","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"68939ac2-a15f-47e1-9607-a44e6e99afaf","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":137,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getBuildings","variables":{},"query":"query getBuildings {\n  buildings {\n    id\n    name\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:buildings [#ordered/map ([:id e0695648-7ccd-4a0f-a115-0fe090d5f6fa] [:name 901 Dibbert Parkway] [:__typename :Building]) #ordered/map ([:id cc62194e-23f0-4577-b41a-5af1831ca978] [:name 59277 Roland Park] [:__typename :Building]) #ordered/map ([:id be1bc5e1-3b0d-4075-b09c-3e9da77c6f3d] [:name 83502 Gorczany Isle] [:__typename :Building]) #ordered/map ([:id bb6f6db5-aab6-4916-a1eb-1ece6d10e25d] [:name 46763 Hirthe Garden] [:__typename :Building]) #ordered/map ([:id abae04c5-d767-425e-acc2-7ce04df645d1] [:name general building] [:__typename :Building]) #ordered/map ([:id 8e16a31b-9f4d-4bc8-a75c-1c33f1784c12] [:name 32651 Malka Trail] [:__typename :Building])]])}
2023-12-09T05:33:45.064Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:buildings [#ordered/map ([:id "e0695648-7ccd-4a0f-a115-0fe090d5f6fa"] [:name "901 Dibbert Parkway"] [:__typename :Building]) #ordered/map ([:id "cc62194e-23f0-4577-b41a-5af1831ca978"] [:name "59277 Roland Park"] [:__typename :Building]) #ordered/map ([:id "be1bc5e1-3b0d-4075-b09c-3e9da77c6f3d"] [:name "83502 Gorczany Isle"] [:__typename :Building]) #ordered/map ([:id "bb6f6db5-aab6-4916-a1eb-1ece6d10e25d"] [:name "46763 Hirthe Garden"] [:__typename :Building]) #ordered/map ([:id "abae04c5-d767-425e-acc2-7ce04df645d1"] [:name "general building"] [:__typename :Building]) #ordered/map ([:id "8e16a31b-9f4d-4bc8-a75c-1c33f1784c12"] [:name "32651 Malka Trail"] [:__typename :Building])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44753 0x6a9e3b1e leihs.core.locale$wrap$fn__44753@6a9e3b1e]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517709668583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 257, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5890b1d2 /127.0.0.1:3230<->/127.0.0.1:49778], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId abae04c5-d767-425e-acc2-7ce04df645d1}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.071Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.072Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>myprint>  inspector true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.074Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.075Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.076Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.077Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.078Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:45.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  68939ac2-a15f-47e1-9607-a44e6e99afaf

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T05:33:45.082Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
 with variables {:buildingId "abae04c5-d767-425e-acc2-7ce04df645d1"}
>oo> vars from graphQL-Requst nil nil nil {:buildingId abae04c5-d767-425e-acc2-7ce04df645d1}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207517709668583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x2eb69035 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 257, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5890b1d2 /127.0.0.1:3230<->/127.0.0.1:49778], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)]}, :content-length 257, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName getRoomsByBuilding, :variables {:buildingId abae04c5-d767-425e-acc2-7ce04df645d1}, :query query getRoomsByBuilding($buildingId: ID!) {
  rooms(building_id: $buildingId) {
    id
    name
    description
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-09T02:57:13.819479Z","id":"770acc88-a672-45da-bfd6-13ab78c28714","user_session_id":"62f56d2a-3b3d-443a-9e2b-4e0026e0aac1","scope_system_admin_read":false,"access-rights":[],"user_id":"770acc88-a672-45da-bfd6-13ab78c28714","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"68939ac2-a15f-47e1-9607-a44e6e99afaf"},"leihs-user-session":{"value":"19ea7ed7-0ca3-4a69-b588-2303ecf67edb"}},"remote-addr":"127.0.0.1","start-time":207517709668583,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb","content-length":"257","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"68939ac2-a15f-47e1-9607-a44e6e99afaf","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":257,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"getRoomsByBuilding","variables":{"buildingId":"abae04c5-d767-425e-acc2-7ce04df645d1"},"query":"query getRoomsByBuilding($buildingId: ID!) {\n  rooms(building_id: $buildingId) {\n    id\n    name\n    description\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:rooms [#ordered/map ([:id b8927fd2-014c-48c2-b095-fa1d5620debe] [:name general room] [:description nil] [:__typename :Room])]])}
2023-12-09T05:33:45.086Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:rooms [#ordered/map ([:id "b8927fd2-014c-48c2-b095-fa1d5620debe"] [:name "general room"] [:description nil] [:__typename :Room])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44753 0x6a9e3b1e leihs.core.locale$wrap$fn__44753@6a9e3b1e]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207526076128708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x46db6ebe HikariProxyConnection@1188785854 wrapping org.postgresql.jdbc.PgConnection@1f69d6b1], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 718, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x560e9f54 /127.0.0.1:3230<->/127.0.0.1:49778], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1f69af4f HikariProxyConnection@527019855 wrapping org.postgresql.jdbc.PgConnection@551a8b2], :level 1, :rollback #object[clojure.lang.Atom 0x450e2697 {:status :ready, :val false}]}, :content-length 718, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName createRequest, :variables {:requestData {:motivation fda, :accounting_type aquisition, :inspector_priority MEDIUM, :budget_period c1df486d-54a1-41b9-8f47-7e77955184cb, :replacement true, :attachments [], :template 21930396-9db0-42aa-ad2b-b68bb9baca93, :order_status NOT_PROCURED, :requested_quantity 1, :priority NORMAL, :room b8927fd2-014c-48c2-b095-fa1d5620debe, :inspection_comment fda, :approved_quantity 1, :order_quantity 1, :user 770acc88-a672-45da-bfd6-13ab78c28714, :receiver fda, :internal_order_number nil}}, :query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x46db6ebe HikariProxyConnection@1188785854 wrapping org.postgresql.jdbc.PgConnection@1f69d6b1], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.447Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>myprint>  admin false
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.448Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>myprint>  inspector true
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.449Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.450Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>myprint>  requester true
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.451Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.451Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.452Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.452Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}

> 1 anti-csrf-token >  68939ac2-a15f-47e1-9607-a44e6e99afaf

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 1
2023-12-09T05:33:53.454Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}
 with variables {:requestData {:motivation "fda", :accounting_type "aquisition", :inspector_priority "MEDIUM", :budget_period "c1df486d-54a1-41b9-8f47-7e77955184cb", :replacement true, :attachments [], :template "21930396-9db0-42aa-ad2b-b68bb9baca93", :order_status "NOT_PROCURED", :requested_quantity "1", :priority "NORMAL", :room "b8927fd2-014c-48c2-b095-fa1d5620debe", :inspection_comment "fda", :approved_quantity "1", :order_quantity "1", :user "770acc88-a672-45da-bfd6-13ab78c28714", :receiver "fda", :internal_order_number nil}}
>oo> vars from graphQL-Requst nil nil nil {:requestData {:motivation fda, :accounting_type aquisition, :inspector_priority MEDIUM, :budget_period c1df486d-54a1-41b9-8f47-7e77955184cb, :replacement true, :attachments [], :template 21930396-9db0-42aa-ad2b-b68bb9baca93, :order_status NOT_PROCURED, :requested_quantity 1, :priority NORMAL, :room b8927fd2-014c-48c2-b095-fa1d5620debe, :inspection_comment fda, :approved_quantity 1, :order_quantity 1, :user 770acc88-a672-45da-bfd6-13ab78c28714, :receiver fda, :internal_order_number nil}}
>debug> 35
>o> tocheck ??? get-template-by-id 21930396-9db0-42aa-ad2b-b68bb9baca93
2023-12-09T05:33:53.460Z NX-41294 DEBUG [leihs.procurement.resources.template:55] - (-> templates-base-query (sql/where [:= :procurement_templates.id [:cast id :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:article_number "iPhone 5S", :price_cents 53, :article_name "Mi 8", :is_archived false, :supplier_name "Polaroid", :model_id nil, :supplier_id nil, :id #uuid "21930396-9db0-42aa-ad2b-b68bb9baca93", :price_currency "CAD", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
>debug> 10
>oo> >here> to-name-and-lower-case-enums {:motivation fda, :accounting_type aquisition, :inspector_priority :MEDIUM, :budget_period c1df486d-54a1-41b9-8f47-7e77955184cb, :replacement true, :template 21930396-9db0-42aa-ad2b-b68bb9baca93, :organization #uuid "3666a74a-3292-4126-a440-334673d7c9fc", :order_status :NOT_PROCURED, :requested_quantity 1, :priority :NORMAL, :room b8927fd2-014c-48c2-b095-fa1d5620debe, :inspection_comment fda, :approved_quantity 1, :order_quantity 1, :user 770acc88-a672-45da-bfd6-13ab78c28714, :receiver fda, :internal_order_number nil}
>debug> 1a
>debug> 1a
>debug> 1a
>debug> 3
>o> request-fields::get-for-user-and-request, new-request?= true
>o> tocheck ??? get-template-by-id 21930396-9db0-42aa-ad2b-b68bb9baca93
2023-12-09T05:33:53.464Z NX-41294 DEBUG [leihs.procurement.resources.template:55] - (-> templates-base-query (sql/where [:= :procurement_templates.id [:cast id :uuid]]) sql-format (->> (jdbc/execute-one! tx))) => {:article_number "iPhone 5S", :price_cents 53, :article_name "Mi 8", :is_archived false, :supplier_name "Polaroid", :model_id nil, :supplier_id nil, :id #uuid "21930396-9db0-42aa-ad2b-b68bb9baca93", :price_currency "CAD", :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:53.465Z NX-41294 DEBUG [leihs.procurement.resources.user:80] - id => 770acc88-a672-45da-bfd6-13ab78c28714
>o> >tocheck>
2023-12-09T05:33:53.465Z NX-41294 DEBUG [leihs.procurement.resources.user:?] - (sql-format (sql/where user-base-query [:= :id [:cast id :uuid]])) => ["SELECT id, firstname, lastname FROM users WHERE id = CAST(? AS UUID)" "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.466Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> requester?? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.466Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.467Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>oo> past? budget-period= {:id #uuid "c1df486d-54a1-41b9-8f47-7e77955184cb", :name BP-in-inspection-phase, :inspection_start_date #inst "2023-12-06T23:00:00.000000000-00:00", :end_date #inst "2024-01-07T23:00:00.000000000-00:00", :created_at #inst "2023-12-08T18:54:07.389889000-00:00", :updated_at #inst "2023-12-08T18:54:07.389889000-00:00"}
>o> past? query= [SELECT current_date > CAST(? AS DATE) AS result 2024-01-08]
>o> past? result= {:result false}
>o> past? result= false
>oo> in-requesting-phase? [SELECT current_date < CAST(? AS DATE) AS result 2023-12-07]
>oo> start/end [:cast 2023-12-07 :date] [:cast 2024-01-08 :date]
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
2023-12-09T05:33:53.469Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE (procurement_category_inspectors.user_id = CAST(? AS UUID)) AND (procurement_category_inspectors.category_id = CAST(? AS UUID))) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
>o> inspector? {:result true}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
2023-12-09T05:33:53.470Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE (procurement_category_viewers.user_id = CAST(? AS UUID)) AND (procurement_category_viewers.category_id = CAST(? AS UUID))) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
>o> viewer? {:result false}
2023-12-09T05:33:53.470Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:385] - (or (and requester own-request) category-viewer inspector admin) => true
2023-12-09T05:33:53.470Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:386] - (and (not template) (not past-phase) (or (and new-request requester (or (and requesting-phase (or own-request inspector)) (and inspection-phase category-inspector) admin)) (and existing-request (or admin category-inspector (and requesting-phase requester own-request))))) => false
2023-12-09T05:33:53.471Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - requester => true
2023-12-09T05:33:53.471Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - own-request => true
2023-12-09T05:33:53.471Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - past-phase => false
2023-12-09T05:33:53.471Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:83] - inspector => true
2023-12-09T05:33:53.471Z NX-41294 DEBUG [leihs.procurement.permissions.request-fields:82] - (or (and (spy requester) (spy own-request) (spy past-phase)) (spy inspector) (spy category-viewer) (spy admin)) => true
>debug> 5
>debug> 6
2023-12-09T05:33:53.477Z NX-41294 DEBUG [leihs.procurement.resources.request:42] - (exchange-attrs req attrs-mapping) => {:motivation "fda", :accounting_type "aquisition", :template_id "21930396-9db0-42aa-ad2b-b68bb9baca93", :article_number "iPhone 5S", :inspector_priority "medium", :price_cents 53, :article_name "Mi 8", :organization_id #uuid "3666a74a-3292-4126-a440-334673d7c9fc", :replacement true, :supplier_name "Polaroid", :order_status "not_procured", :requested_quantity 1, :model_id nil, :priority "normal", :supplier_id nil, :budget_period_id "c1df486d-54a1-41b9-8f47-7e77955184cb", :price_currency "CAD", :user_id "770acc88-a672-45da-bfd6-13ab78c28714", :inspection_comment "fda", :approved_quantity 1, :order_quantity 1, :room_id "b8927fd2-014c-48c2-b095-fa1d5620debe", :receiver "fda", :internal_order_number nil, :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
>debug> 29
>o> no / 22 / my-cast /debug  {:motivation fda, :accounting_type aquisition, :template_id 21930396-9db0-42aa-ad2b-b68bb9baca93, :article_number iPhone 5S, :inspector_priority medium, :price_cents 53, :article_name Mi 8, :organization_id #uuid "3666a74a-3292-4126-a440-334673d7c9fc", :replacement true, :supplier_name Polaroid, :order_status not_procured, :requested_quantity 1, :model_id nil, :priority normal, :supplier_id nil, :budget_period_id c1df486d-54a1-41b9-8f47-7e77955184cb, :price_currency CAD, :user_id 770acc88-a672-45da-bfd6-13ab78c28714, :inspection_comment fda, :approved_quantity 1, :order_quantity 1, :room_id b8927fd2-014c-48c2-b095-fa1d5620debe, :receiver fda, :internal_order_number nil, :category_id #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"}
2023-12-09T05:33:53.477Z NX-41294 DEBUG [leihs.procurement.resources.request:753] - data => {:motivation "fda", :accounting_type "aquisition", :template_id [[:cast "21930396-9db0-42aa-ad2b-b68bb9baca93" :uuid]], :article_number "iPhone 5S", :inspector_priority "medium", :price_cents 53, :article_name "Mi 8", :organization_id #uuid "3666a74a-3292-4126-a440-334673d7c9fc", :replacement true, :supplier_name "Polaroid", :order_status [[:cast "not_procured" :order_status_enum]], :requested_quantity 1, :model_id nil, :priority "normal", :supplier_id nil, :budget_period_id [[:cast "c1df486d-54a1-41b9-8f47-7e77955184cb" :uuid]], :price_currency "CAD", :user_id [[:cast "770acc88-a672-45da-bfd6-13ab78c28714" :uuid]], :inspection_comment "fda", :approved_quantity 1, :order_quantity 1, :room_id [[:cast "b8927fd2-014c-48c2-b095-fa1d5620debe" :uuid]], :receiver "fda", :internal_order_number nil, :category_id [[:cast #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65" :uuid]]}
2023-12-09T05:33:53.478Z NX-41294 DEBUG [leihs.procurement.resources.request:766] - (my-cast data) => {:motivation "fda", :accounting_type "aquisition", :template_id [[:cast "21930396-9db0-42aa-ad2b-b68bb9baca93" :uuid]], :article_number "iPhone 5S", :inspector_priority "medium", :price_cents 53, :article_name "Mi 8", :organization_id #uuid "3666a74a-3292-4126-a440-334673d7c9fc", :replacement true, :supplier_name "Polaroid", :order_status [[:cast "not_procured" :order_status_enum]], :requested_quantity 1, :model_id nil, :priority "normal", :supplier_id nil, :budget_period_id [[:cast "c1df486d-54a1-41b9-8f47-7e77955184cb" :uuid]], :price_currency "CAD", :user_id [[:cast "770acc88-a672-45da-bfd6-13ab78c28714" :uuid]], :inspection_comment "fda", :approved_quantity 1, :order_quantity 1, :room_id [[:cast "b8927fd2-014c-48c2-b095-fa1d5620debe" :uuid]], :receiver "fda", :internal_order_number nil, :category_id [[:cast #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65" :uuid]]}
2023-12-09T05:33:53.480Z NX-41294 DEBUG [leihs.procurement.resources.request:?] - (sql-format (sql/values (sql/insert-into :procurement_requests) [data])) => ["INSERT INTO procurement_requests (motivation, accounting_type, template_id, article_number, inspector_priority, price_cents, article_name, organization_id, replacement, supplier_name, order_status, requested_quantity, model_id, priority, supplier_id, budget_period_id, price_currency, user_id, inspection_comment, approved_quantity, order_quantity, room_id, receiver, internal_order_number, category_id) VALUES (?, ?, (CAST(? AS UUID)), ?, ?, ?, ?, ?, TRUE, ?, (CAST(? AS ORDER_STATUS_ENUM)), ?, NULL, ?, NULL, (CAST(? AS UUID)), ?, (CAST(? AS UUID)), ?, ?, ?, (CAST(? AS UUID)), ?, NULL, (CAST(? AS UUID)))" "fda" "aquisition" "21930396-9db0-42aa-ad2b-b68bb9baca93" "iPhone 5S" "medium" 53 "Mi 8" #uuid "3666a74a-3292-4126-a440-334673d7c9fc" "Polaroid" "not_procured" 1 "normal" "c1df486d-54a1-41b9-8f47-7e77955184cb" "CAD" "770acc88-a672-45da-bfd6-13ab78c28714" "fda" 1 1 "b8927fd2-014c-48c2-b095-fa1d5620debe" "fda" #uuid "9b2cf022-e443-42b9-bf52-dabd4105ac65"]
2023-12-09T05:33:53.519Z NX-41294 DEBUG [leihs.procurement.resources.request:776] - result => [{:next.jdbc/update-count 1}]
>debug> 28
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.520Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.521Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.521Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>debug> 9b
>o> requests-base-query-with-state
>debug> 8c
>o> state-sql true
>o> s-map  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>o>map-4 (>o> map NEW
>o> map [:= :procurement_requests.approved_quantity nil]
:case >o> map NEW
[:= :procurement_requests.approved_quantity nil] >o> map APPROVED
>o> map [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]
NEW >o> map APPROVED
[:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] >o> map DENIED
>o> map [:= :procurement_requests.approved_quantity 0]
PARTIALLY_APPROVED >o> map DENIED
[:= :procurement_requests.approved_quantity 0] DENIED)
>o>map-5 (:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)
2023-12-09T05:33:53.523Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED")]]
>debug> 8c
>o> state-sql true
>o> s-map  {:NEW [:= :procurement_requests.approved_quantity nil], :APPROVED [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity], :PARTIALLY_APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]], :DENIED [:= :procurement_requests.approved_quantity 0]}
>o>map-4 (>o> map NEW
>o> map [:= :procurement_requests.approved_quantity nil]
:case >o> map NEW
[:= :procurement_requests.approved_quantity nil] >o> map APPROVED
>o> map [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]
NEW >o> map APPROVED
[:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] >o> map DENIED
>o> map [:= :procurement_requests.approved_quantity 0]
PARTIALLY_APPROVED >o> map DENIED
[:= :procurement_requests.approved_quantity 0] DENIED)
>o>map-5 (:case [:= :procurement_requests.approved_quantity nil] NEW [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] APPROVED [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] PARTIALLY_APPROVED [:= :procurement_requests.approved_quantity 0] DENIED)
2023-12-09T05:33:53.524Z NX-41294 DEBUG [leihs.procurement.resources.request:184] - result => [[(:case [:= :procurement_requests.approved_quantity nil] "NEW" [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity] "APPROVED" [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]] "PARTIALLY_APPROVED" [:= :procurement_requests.approved_quantity 0] "DENIED")]]
2023-12-09T05:33:53.526Z NX-41294 DEBUG [leihs.procurement.resources.request:?] - (sql-format (sql/limit (sql/order-by (sql/select (requests-base-query-with-state advanced-user?) :procurement_requests.* [(state-sql advanced-user?) :state]) [:created_at :desc]) 1)) => ["SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id LEFT JOIN models ON models.id = procurement_requests.model_id ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC, created_at DESC LIMIT ?" "NEW" "APPROVED" 0 "PARTIALLY_APPROVED" 0 "DENIED" "NEW" "APPROVED" 0 "PARTIALLY_APPROVED" 0 "DENIED" 1]
>debug> 23d
>o> HERE query-requests, auth-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}
>o> query-requests, query [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state, procurement_requests.*, ((CASE WHEN procurement_requests.approved_quantity IS NULL THEN ? WHEN procurement_requests.approved_quantity >= procurement_requests.requested_quantity THEN ? WHEN (procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?) THEN ? WHEN procurement_requests.approved_quantity = ? THEN ? END)) AS state FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id LEFT JOIN models ON models.id = procurement_requests.model_id ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC, created_at DESC LIMIT ? NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED 1]
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.526Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> viewer? {:result false}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.527Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> inspector? {:result true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
2023-12-09T05:33:53.527Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "770acc88-a672-45da-bfd6-13ab78c28714"]
>o> admin? {:exists false}
>e> #error {
 :cause ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions
  Position: 21
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions
  Position: 21
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11828$fn__11836 invoke result_set.clj 897]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 251]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 545]
  [leihs.procurement.resources.request$query_requests invoke request.clj 532]
  [leihs.procurement.resources.request$get_last_created_request invokeStatic request.clj 705]
  [leihs.procurement.resources.request$get_last_created_request invoke request.clj 687]
  [leihs.procurement.resources.request$create_request_BANG_$fn__44402 invoke request.clj 949]
  [leihs.procurement.authorization$authorize_and_apply invokeStatic authorization.clj 63]
  [leihs.procurement.authorization$authorize_and_apply doInvoke authorization.clj 43]
  [clojure.lang.RestFn invoke RestFn.java 439]
  [leihs.procurement.resources.request$create_request_BANG_ invokeStatic request.clj 943]
  [leihs.procurement.resources.request$create_request_BANG_ invoke request.clj 921]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44939 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$combine_selection_results_sync$fn__17487 invoke executor.clj 212]
  [com.walmartlabs.lacinia.resolve.ResolverResultImpl on_deliver_BANG_ resolve.clj 135]
  [com.walmartlabs.lacinia.executor$combine_selection_results_sync invokeStatic executor.clj 208]
  [com.walmartlabs.lacinia.executor$combine_selection_results_sync invoke executor.clj 203]
  [com.walmartlabs.lacinia.executor$execute_nested_selections_sync$fn__17494 invoke executor.clj 230]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.executor$execute_nested_selections_sync invokeStatic executor.clj 230]
  [com.walmartlabs.lacinia.executor$execute_nested_selections_sync invoke executor.clj 221]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}
2023-12-09T05:33:53.572Z NX-41294 WARN [leihs.procurement.graphql.resolver:326] - ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions
  Position: 21
2023-12-09T05:33:53.573Z NX-41294 DEBUG [leihs.procurement.graphql.resolver:326] - #error {
 :cause ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions
  Position: 21
 :via
 [{:type org.postgresql.util.PSQLException
   :message ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions
  Position: 21
   :at [org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]}]
 :trace
 [[org.postgresql.core.v3.QueryExecutorImpl receiveErrorResponse QueryExecutorImpl.java 2533]
  [org.postgresql.core.v3.QueryExecutorImpl processResults QueryExecutorImpl.java 2268]
  [org.postgresql.core.v3.QueryExecutorImpl execute QueryExecutorImpl.java 313]
  [org.postgresql.jdbc.PgStatement executeInternal PgStatement.java 448]
  [org.postgresql.jdbc.PgStatement execute PgStatement.java 369]
  [org.postgresql.jdbc.PgPreparedStatement executeWithFlags PgPreparedStatement.java 159]
  [org.postgresql.jdbc.PgPreparedStatement execute PgPreparedStatement.java 148]
  [com.zaxxer.hikari.pool.ProxyPreparedStatement execute ProxyPreparedStatement.java 44]
  [com.zaxxer.hikari.pool.HikariProxyPreparedStatement execute HikariProxyPreparedStatement.java -1]
  [next.jdbc.result_set$stmt__GT_result_set invokeStatic result_set.clj 669]
  [next.jdbc.result_set$stmt__GT_result_set invoke result_set.clj 664]
  [next.jdbc.result_set$eval11828$fn__11836 invoke result_set.clj 897]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc.default_options$eval11019$fn__11024 invoke default_options.clj 31]
  [next.jdbc.protocols$eval10723$fn__10754$G__10714__10763 invoke protocols.clj 34]
  [next.jdbc$execute_BANG_ invokeStatic jdbc.clj 251]
  [next.jdbc$execute_BANG_ invoke jdbc.clj 238]
  [leihs.procurement.resources.request$query_requests invokeStatic request.clj 545]
  [leihs.procurement.resources.request$query_requests invoke request.clj 532]
  [leihs.procurement.resources.request$get_last_created_request invokeStatic request.clj 705]
  [leihs.procurement.resources.request$get_last_created_request invoke request.clj 687]
  [leihs.procurement.resources.request$create_request_BANG_$fn__44402 invoke request.clj 949]
  [leihs.procurement.authorization$authorize_and_apply invokeStatic authorization.clj 63]
  [leihs.procurement.authorization$authorize_and_apply doInvoke authorization.clj 43]
  [clojure.lang.RestFn invoke RestFn.java 439]
  [leihs.procurement.resources.request$create_request_BANG_ invokeStatic request.clj 943]
  [leihs.procurement.resources.request$create_request_BANG_ invoke request.clj 921]
  [leihs.procurement.graphql.resolver$wrap_resolver_with_error$fn__44939 invoke resolver.clj 16]
  [com.walmartlabs.lacinia.schema$wrap_resolver_to_ensure_resolver_result$fn__14023 invoke schema.clj 986]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invokeStatic executor.clj 86]
  [com.walmartlabs.lacinia.executor$invoke_resolver_for_field invoke executor.clj 68]
  [com.walmartlabs.lacinia.executor$resolve_and_select invokeStatic executor.clj 353]
  [com.walmartlabs.lacinia.executor$resolve_and_select invoke executor.clj 234]
  [com.walmartlabs.lacinia.executor$apply_field_selection invokeStatic executor.clj 140]
  [com.walmartlabs.lacinia.executor$apply_field_selection invoke executor.clj 135]
  [com.walmartlabs.lacinia.executor$apply_selection invokeStatic executor.clj 173]
  [com.walmartlabs.lacinia.executor$apply_selection invoke executor.clj 165]
  [com.walmartlabs.lacinia.executor$combine_selection_results_sync$fn__17487 invoke executor.clj 212]
  [com.walmartlabs.lacinia.resolve.ResolverResultImpl on_deliver_BANG_ resolve.clj 135]
  [com.walmartlabs.lacinia.executor$combine_selection_results_sync invokeStatic executor.clj 208]
  [com.walmartlabs.lacinia.executor$combine_selection_results_sync invoke executor.clj 203]
  [com.walmartlabs.lacinia.executor$execute_nested_selections_sync$fn__17494 invoke executor.clj 230]
  [clojure.lang.ArrayChunk reduce ArrayChunk.java 58]
  [clojure.core.protocols$fn__8176 invokeStatic protocols.clj 136]
  [clojure.core.protocols$fn__8176 invoke protocols.clj 124]
  [clojure.core.protocols$fn__8136$G__8131__8145 invoke protocols.clj 19]
  [clojure.core.protocols$seq_reduce invokeStatic protocols.clj 31]
  [clojure.core.protocols$fn__8168 invokeStatic protocols.clj 75]
  [clojure.core.protocols$fn__8168 invoke protocols.clj 75]
  [clojure.core.protocols$fn__8110$G__8105__8123 invoke protocols.clj 13]
  [clojure.core$reduce invokeStatic core.clj 6830]
  [clojure.core$reduce invoke core.clj 6812]
  [com.walmartlabs.lacinia.executor$execute_nested_selections_sync invokeStatic executor.clj 230]
  [com.walmartlabs.lacinia.executor$execute_nested_selections_sync invoke executor.clj 221]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17519 invoke executor.clj 400]
  [clojure.lang.AFn applyToHelper AFn.java 152]
  [clojure.lang.AFn applyTo AFn.java 144]
  [clojure.core$apply invokeStatic core.clj 667]
  [clojure.core$with_bindings_STAR_ invokeStatic core.clj 1977]
  [clojure.core$with_bindings_STAR_ doInvoke core.clj 1977]
  [clojure.lang.RestFn invoke RestFn.java 425]
  [clojure.lang.AFn applyToHelper AFn.java 156]
  [clojure.lang.RestFn applyTo RestFn.java 132]
  [clojure.core$apply invokeStatic core.clj 671]
  [clojure.core$bound_fn_STAR_$fn__5767 doInvoke core.clj 2007]
  [clojure.lang.RestFn invoke RestFn.java 397]
  [com.walmartlabs.lacinia.executor$execute_query$fn__17524 invoke executor.clj 421]
  [clojure.core$binding_conveyor_fn$fn__5772 invoke core.clj 2034]
  [clojure.lang.AFn call AFn.java 18]
  [java.util.concurrent.FutureTask run FutureTask.java 264]
  [java.util.concurrent.ThreadPoolExecutor runWorker ThreadPoolExecutor.java 1128]
  [java.util.concurrent.ThreadPoolExecutor$Worker run ThreadPoolExecutor.java 628]
  [java.lang.Thread run Thread.java 829]]}

>request-grapql _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-09T02:57:13.819479Z", :id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :user_session_id #uuid "62f56d2a-3b3d-443a-9e2b-4e0026e0aac1", :scope_system_admin_read false, :access-rights (), :user_id #uuid "770acc88-a672-45da-bfd6-13ab78c28714", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {leihs-anti-csrf-token {:value 68939ac2-a15f-47e1-9607-a44e6e99afaf}, leihs-user-session {:value 19ea7ed7-0ca3-4a69-b588-2303ecf67edb}}, :remote-addr 127.0.0.1, :start-time 207526076128708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x46db6ebe HikariProxyConnection@1188785854 wrapping org.postgresql.jdbc.PgConnection@1f69d6b1], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0xca1a4fb next.jdbc.result_set$as_unqualified_lower_maps@ca1a4fb]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb, content-length 718, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93, connection keep-alive, pragma no-cache, x-csrf-token 68939ac2-a15f-47e1-9607-a44e6e99afaf, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x560e9f54 /127.0.0.1:3230<->/127.0.0.1:49778], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x29e7f9d0 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1f69af4f HikariProxyConnection@527019855 wrapping org.postgresql.jdbc.PgConnection@551a8b2], :level 2, :rollback #object[clojure.lang.Atom 0x450e2697 {:status :ready, :val false}]}, :content-length 718, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName createRequest, :variables {:requestData {:motivation fda, :accounting_type aquisition, :inspector_priority MEDIUM, :budget_period c1df486d-54a1-41b9-8f47-7e77955184cb, :replacement true, :attachments [], :template 21930396-9db0-42aa-ad2b-b68bb9baca93, :order_status NOT_PROCURED, :requested_quantity 1, :priority NORMAL, :room b8927fd2-014c-48c2-b095-fa1d5620debe, :inspection_comment fda, :approved_quantity 1, :order_quantity 1, :user 770acc88-a672-45da-bfd6-13ab78c28714, :receiver fda, :internal_order_number nil}}, :query mutation createRequest($requestData: CreateRequestInput) {
  create_request(input_data: $requestData) {
    id
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x7d2a7243 leihs.procurement.graphql$handler@7d2a7243], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"English (UK)","locale":"en-GB","default":true,"active":true},"authenticated-entity":{"email":"amelia@rosenbaum.name","contracts_count":0,"lastname":"Kemmer","org_id":null,"scope_read":true,"is_admin":false,"authentication-method":"session","login":null,"scope_system_admin_write":false,"scope_write":true,"firstname":"Dawna","scope_admin_write":false,"user_session_created_at":"2023-12-09T02:57:13.819479Z","id":"770acc88-a672-45da-bfd6-13ab78c28714","user_session_id":"62f56d2a-3b3d-443a-9e2b-4e0026e0aac1","scope_system_admin_read":false,"access-rights":[],"user_id":"770acc88-a672-45da-bfd6-13ab78c28714","is_system_admin":false,"external_sign_out_url":null,"language_locale":null,"inventory_pool_roles_count":0,"scope_admin_read":false},"cookies":{"leihs-anti-csrf-token":{"value":"68939ac2-a15f-47e1-9607-a44e6e99afaf"},"leihs-user-session":{"value":"19ea7ed7-0ca3-4a69-b588-2303ecf67edb"}},"remote-addr":"127.0.0.1","start-time":207526076128708,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"your.lending.desk@example.com","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":null,"sessions_force_uniqueness":false,"email_signature":"Cheers,"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=68939ac2-a15f-47e1-9607-a44e6e99afaf; leihs-user-session=19ea7ed7-0ca3-4a69-b588-2303ecf67edb","content-length":"718","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/requests\/new?budgetPeriod=c1df486d-54a1-41b9-8f47-7e77955184cb&template=21930396-9db0-42aa-ad2b-b68bb9baca93","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"68939ac2-a15f-47e1-9607-a44e6e99afaf","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":718,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"createRequest","variables":{"requestData":{"motivation":"fda","accounting_type":"aquisition","inspector_priority":"MEDIUM","budget_period":"c1df486d-54a1-41b9-8f47-7e77955184cb","replacement":true,"attachments":[],"template":"21930396-9db0-42aa-ad2b-b68bb9baca93","order_status":"NOT_PROCURED","requested_quantity":"1","priority":"NORMAL","room":"b8927fd2-014c-48c2-b095-fa1d5620debe","inspection_comment":"fda","approved_quantity":"1","order_quantity":"1","user":"770acc88-a672-45da-bfd6-13ab78c28714","receiver":"fda","internal_order_number":null}},"query":"mutation createRequest($requestData: CreateRequestInput) {\n  create_request(input_data: $requestData) {\n    id\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:create_request nil]), :errors ({:message ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions
  Position: 21, :locations [{:line 2, :column 3}], :path [:create_request], :extensions {:exception PSQLException, :arguments {:input_data $requestData}}})}
2023-12-09T05:33:53.576Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:create_request nil]), :errors ({:message "ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions\n  Position: 21", :locations [{:line 2, :column 3}], :path [:create_request], :extensions {:exception "PSQLException", :arguments {:input_data $requestData}}})}
2023-12-09T05:33:53.576Z NX-41294 DEBUG [leihs.procurement.graphql:87] - {:data #ordered/map ([:create_request nil]), :errors ({:message "ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions\n  Position: 21", :locations [{:line 2, :column 3}], :path [:create_request], :extensions {:exception "PSQLException", :arguments {:input_data $requestData}}})}

>o> ERROR 4pure-handler, result=> {:data #ordered/map ([:create_request nil]), :errors ({:message ERROR: SELECT DISTINCT ON expressions must match initial ORDER BY expressions
  Position: 21, :locations [{:line 2, :column 3}], :path [:create_request], :extensions {:exception PSQLException, :arguments {:input_data $requestData}}})}
