# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
2023-12-01T08:51:19.406Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-01T08:51:19.973Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :debug] [#{"*"} :debug]], :log-level :debug}
2023-12-01T08:51:19.980Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :debug] [#{"*"} :debug]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x8134232 "taoensso.timbre$default_output_fn@8134232"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x82f5ce4 "taoensso.timbre.appenders.core$println_appender$fn__3459@82f5ce4"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level :debug}
2023-12-01T08:51:19.982Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run" "--db-port" "5415" "--db-name" "leihs_test")
2023-12-01T08:51:19.995Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 43882, :repl-port-file ".nrepl-port"}
2023-12-01T08:51:19.996Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  43882 localhost
2023-12-01T08:51:20.015Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-01T08:51:20.020Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 43882, :repl-port-file .nrepl-port}
2023-12-01T08:51:20.021Z NX-41294 INFO [leihs.core.shutdown:20] - PID 11318
2023-12-01T08:51:20.038Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-01T08:51:20.100Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-01T08:51:20.102Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-01T08:51:20.107Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1100] - db-pool - configuration:
2023-12-01T08:51:20.114Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - allowPoolSuspension.............false
2023-12-01T08:51:20.114Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - autoCommit......................true
2023-12-01T08:51:20.114Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - catalog.........................none
2023-12-01T08:51:20.115Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionInitSql...............none
2023-12-01T08:51:20.115Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionTestQuery.............none
2023-12-01T08:51:20.115Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionTimeout...............30000
2023-12-01T08:51:20.115Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSource......................none
2023-12-01T08:51:20.117Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceClassName............."org.postgresql.ds.PGSimpleDataSource"
2023-12-01T08:51:20.117Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceJNDI..................none
2023-12-01T08:51:20.118Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceProperties............{password=<masked>, databaseName=leihs_test, serverName=localhost, portNumber=5415}
2023-12-01T08:51:20.118Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - driverClassName.................none
2023-12-01T08:51:20.118Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - exceptionOverrideClassName......none
2023-12-01T08:51:20.118Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - healthCheckProperties...........{}
2023-12-01T08:51:20.119Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - healthCheckRegistry.............com.codahale.metrics.health.HealthCheckRegistry@498fd67e
2023-12-01T08:51:20.119Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - idleTimeout.....................60000
2023-12-01T08:51:20.119Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - initializationFailTimeout.......1
2023-12-01T08:51:20.119Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - isolateInternalQueries..........false
2023-12-01T08:51:20.119Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - jdbcUrl.........................none
2023-12-01T08:51:20.119Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - keepaliveTime...................0
2023-12-01T08:51:20.120Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - leakDetectionThreshold..........0
2023-12-01T08:51:20.120Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - maxLifetime.....................3600000
2023-12-01T08:51:20.120Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - maximumPoolSize.................16
2023-12-01T08:51:20.120Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - metricRegistry..................com.codahale.metrics.MetricRegistry@6984e354
2023-12-01T08:51:20.120Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - metricsTrackerFactory...........none
2023-12-01T08:51:20.120Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - minimumIdle.....................2
2023-12-01T08:51:20.121Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - password........................<masked>
2023-12-01T08:51:20.121Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - poolName........................"db-pool"
2023-12-01T08:51:20.121Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - readOnly........................false
2023-12-01T08:51:20.121Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - registerMbeans..................false
2023-12-01T08:51:20.121Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - scheduledExecutor...............none
2023-12-01T08:51:20.122Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - schema..........................none
2023-12-01T08:51:20.122Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - threadFactory...................internal
2023-12-01T08:51:20.122Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - transactionIsolation............default
2023-12-01T08:51:20.122Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - username........................"leihs"
2023-12-01T08:51:20.122Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - validationTimeout...............5000
2023-12-01T08:51:20.124Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-01T08:51:20.192Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@228f1ba7
2023-12-01T08:51:20.198Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-01T08:51:20.199Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 "HikariDataSource (db-pool)"]}
2023-12-01T08:51:20.199Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-01T08:51:20.211Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1100] - HikariPool-1 - configuration:
2023-12-01T08:51:20.212Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - allowPoolSuspension.............false
2023-12-01T08:51:20.212Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - autoCommit......................true
2023-12-01T08:51:20.212Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - catalog.........................none
2023-12-01T08:51:20.212Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionInitSql...............none
2023-12-01T08:51:20.212Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionTestQuery.............none
2023-12-01T08:51:20.213Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - connectionTimeout...............30000
2023-12-01T08:51:20.213Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSource......................none
2023-12-01T08:51:20.213Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceClassName.............none
2023-12-01T08:51:20.213Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceJNDI..................none
2023-12-01T08:51:20.213Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - dataSourceProperties............{password=<masked>}
2023-12-01T08:51:20.213Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - driverClassName.................none
2023-12-01T08:51:20.214Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - exceptionOverrideClassName......none
2023-12-01T08:51:20.214Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - healthCheckProperties...........{}
2023-12-01T08:51:20.214Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - healthCheckRegistry.............none
2023-12-01T08:51:20.214Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - idleTimeout.....................60000
2023-12-01T08:51:20.214Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - initializationFailTimeout.......1
2023-12-01T08:51:20.214Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - isolateInternalQueries..........false
2023-12-01T08:51:20.215Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - jdbcUrl.........................jdbc:postgresql://localhost:5415/leihs_test
2023-12-01T08:51:20.215Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - keepaliveTime...................0
2023-12-01T08:51:20.215Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - leakDetectionThreshold..........0
2023-12-01T08:51:20.215Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - maxLifetime.....................3600000
2023-12-01T08:51:20.215Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - maximumPoolSize.................16
2023-12-01T08:51:20.215Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - metricRegistry..................none
2023-12-01T08:51:20.215Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - metricsTrackerFactory...........none
2023-12-01T08:51:20.216Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - minimumIdle.....................2
2023-12-01T08:51:20.216Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - password........................<masked>
2023-12-01T08:51:20.216Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - poolName........................"HikariPool-1"
2023-12-01T08:51:20.217Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - readOnly........................false
2023-12-01T08:51:20.217Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - registerMbeans..................false
2023-12-01T08:51:20.217Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - scheduledExecutor...............none
2023-12-01T08:51:20.217Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - schema..........................none
2023-12-01T08:51:20.217Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - threadFactory...................internal
2023-12-01T08:51:20.217Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - transactionIsolation............default
2023-12-01T08:51:20.218Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - username........................"leihs"
2023-12-01T08:51:20.218Z NX-41294 DEBUG [com.zaxxer.hikari.HikariConfig:1132] - validationTimeout...............5000
2023-12-01T08:51:20.218Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-01T08:51:20.219Z NX-41294 DEBUG [com.zaxxer.hikari.util.DriverDataSource:107] - Loaded driver with class name org.postgresql.Driver for jdbcUrl=jdbc:postgresql://localhost:5415/leihs_test
2023-12-01T08:51:20.225Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@1b65dc97
2023-12-01T08:51:20.226Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-01T08:51:20.231Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 "next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7"]}}
2023-12-01T08:51:20.238Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x5277515c "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x322c6abc "java.util.concurrent.ThreadPoolExecutor@322c6abc[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-01T08:51:20.250Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
2023-12-01T08:51:20.303Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=1, active=0, idle=1, waiting=0)
2023-12-01T08:51:20.304Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=1, active=0, idle=1, waiting=0)
2023-12-01T08:51:20.313Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:738] - db-pool - Added connection org.postgresql.jdbc.PgConnection@40c5d068
2023-12-01T08:51:20.325Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After adding stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:51:20.329Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=1, active=0, idle=1, waiting=0)
2023-12-01T08:51:20.329Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=1, active=0, idle=1, waiting=0)
2023-12-01T08:51:20.335Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:738] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@6a242c58
2023-12-01T08:51:20.347Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After adding stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:51:30.666Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6fb0bbb1 HikariProxyPreparedStatement@1873853361 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:51:30.667Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:51:30.669Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6fb0bbb1 HikariProxyPreparedStatement@1873853361 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:51:30.669Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-12-01T08:51:30.671Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6fb0bbb1 HikariProxyPreparedStatement@1873853361 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:51:30.671Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:51:30.672Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6fb0bbb1 HikariProxyPreparedStatement@1873853361 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:51:30.672Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 183202714918666, :params {:user jimmie@goyette.com, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x1bb825cf HikariProxyConnection@465053135 wrapping org.postgresql.jdbc.PgConnection@1b65dc97], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/x-www-form-urlencoded, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 91, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x77c9d22f /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x6d1ad9ac HikariProxyConnection@1830476204 wrapping org.postgresql.jdbc.PgConnection@228f1ba7], :level 1, :rollback #object[clojure.lang.Atom 0x9f9a657 {:status :ready, :val false}]}, :content-length 91, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x1f3571ba BytesInputStream[len=91]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x35049c52 compojure.core$routes$fn__27950@35049c52], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:51:30.704Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:51:30.721Z NX-41294 DEBUG [leihs.core.sign-in.back:82] - sign-in-page-params {:navbar {:csrfToken {:value "65184e75-5146-4915-8494-09445d034d15", :name "csrf-token"}, :config {:appTitle "leihs", :appColor "gray", :me nil, :subApps {}, :locales ({:name "English (UK)", :locale "en-GB", :active true, :isDefault true, :isSelected true} {:name "English (US)", :locale "en-US", :active true, :isDefault false, :isSelected false} {:name "Deutsch", :locale "de-CH", :active true, :isDefault false, :isSelected false} {:name "Züritüütsch", :locale "gsw-CH", :active true, :isDefault false, :isSelected false})}}, :authFlow {:user "jimmie@goyette.com", :showPasswordSection false, :passwordButtonText "password_create_button_text", :passwordLink "/forgot-password"}, :csrfToken {:value "65184e75-5146-4915-8494-09445d034d15", :name "csrf-token"}, :flashMessages [{:messageID "sign_in_wrong_password_flash_message", :level "error"}]}
2023-12-01T08:51:30.723Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:51:30.724Z NX-41294 WARN [leihs.core.db:201] - Rolling back transaction because error status  401
2023-12-01T08:51:33.127Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7355203d HikariProxyPreparedStatement@1934958653 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:51:33.128Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:51:33.129Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7355203d HikariProxyPreparedStatement@1934958653 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:51:33.129Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-12-01T08:51:33.130Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7355203d HikariProxyPreparedStatement@1934958653 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:51:33.131Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:51:33.132Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7355203d HikariProxyPreparedStatement@1934958653 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:51:33.132Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 183205230234666, :params {:return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {:return-to /procure}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4530184a /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {:return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x35049c52 compojure.core$routes$fn__27950@35049c52], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:51:33.136Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:51:33.138Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text  #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7a4396ba HikariProxyPreparedStatement@2051249850 wrapping SELECT * FROM users  WHERE (users.org_id IS NULL OR users.login IS NULL OR lower(users.email) = ?)] 1]  type:  java.lang.String
2023-12-01T08:51:33.138Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  
2023-12-01T08:51:33.141Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x40441397 org.postgresql.jdbc.PgResultSetMetaData@40441397] 1]
2023-12-01T08:51:33.152Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:51:33.153Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:51:33.154Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x40441397 org.postgresql.jdbc.PgResultSetMetaData@40441397] 3]
2023-12-01T08:51:33.154Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:51:33.154Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:51:33.154Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x40441397 org.postgresql.jdbc.PgResultSetMetaData@40441397] 4]
2023-12-01T08:51:33.154Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:51:33.155Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:51:33.155Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x40441397 org.postgresql.jdbc.PgResultSetMetaData@40441397] 7]
2023-12-01T08:51:33.155Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:51:33.156Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:51:33.157Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T07:47:31.258507000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x40441397 org.postgresql.jdbc.PgResultSetMetaData@40441397] 15]
2023-12-01T08:51:33.157Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T07:47:31.258507000-00:00"]
2023-12-01T08:51:33.158Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T07:47:31.258507Z"
2023-12-01T08:51:33.158Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T07:47:31.258507000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x40441397 org.postgresql.jdbc.PgResultSetMetaData@40441397] 16]
2023-12-01T08:51:33.159Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T07:47:31.258507000-00:00"]
2023-12-01T08:51:33.159Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T07:47:31.258507Z"
2023-12-01T08:51:33.159Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna Kemmer amelia@rosenbaum.name    Kemmer Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x40441397 org.postgresql.jdbc.PgResultSetMetaData@40441397] 25]
2023-12-01T08:51:33.160Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna Kemmer amelia@rosenbaum.name    Kemmer Dawna]
2023-12-01T08:51:33.160Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna Kemmer amelia@rosenbaum.name    Kemmer Dawna
2023-12-01T08:51:33.160Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [local #object[org.postgresql.jdbc.PgResultSetMetaData 0x40441397 org.postgresql.jdbc.PgResultSetMetaData@40441397] 32]
2023-12-01T08:51:33.160Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text local]
2023-12-01T08:51:33.161Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  local
2023-12-01T08:51:33.167Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text password #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6b396e0e HikariProxyPreparedStatement@1798925838 wrapping SELECT authentication_systems.id, authentication_systems.type, authentication_systems.name, authentication_systems.description, authentication_systems.external_sign_in_url FROM authentication_systems, users  WHERE ((EXISTS (SELECT TRUE FROM authentication_systems_users WHERE (authentication_systems_users.user_id = users.id AND authentication_systems.id = authentication_systems_users.authentication_system_id AND (authentication_systems.type <> ? OR users.password_sign_in_enabled = TRUE) AND users.account_enabled = TRUE)) OR EXISTS (SELECT TRUE FROM authentication_systems asxs INNER JOIN authentication_systems_groups ON (asxs.id = authentication_systems_groups.authentication_system_id) INNER JOIN groups_users ON (authentication_systems_groups.group_id = groups_users.group_id AND authentication_systems_groups.group_id = groups_users.group_id AND groups_users.user_id = users.id) WHERE (asxs.id = authentication_systems.id AND users.account_enabled = TRUE))) AND authentication_systems.enabled = TRUE AND users.id = ?) ORDER BY authentication_systems.priority DESC, authentication_systems.id] 1]  type:  java.lang.String
2023-12-01T08:51:33.167Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  password
2023-12-01T08:51:33.168Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6b396e0e HikariProxyPreparedStatement@1798925838 wrapping SELECT authentication_systems.id, authentication_systems.type, authentication_systems.name, authentication_systems.description, authentication_systems.external_sign_in_url FROM authentication_systems, users  WHERE ((EXISTS (SELECT TRUE FROM authentication_systems_users WHERE (authentication_systems_users.user_id = users.id AND authentication_systems.id = authentication_systems_users.authentication_system_id AND (authentication_systems.type <> 'password' OR users.password_sign_in_enabled = TRUE) AND users.account_enabled = TRUE)) OR EXISTS (SELECT TRUE FROM authentication_systems asxs INNER JOIN authentication_systems_groups ON (asxs.id = authentication_systems_groups.authentication_system_id) INNER JOIN groups_users ON (authentication_systems_groups.group_id = groups_users.group_id AND authentication_systems_groups.group_id = groups_users.group_id AND groups_users.user_id = users.id) WHERE (asxs.id = authentication_systems.id AND users.account_enabled = TRUE))) AND authentication_systems.enabled = TRUE AND users.id = ?) ORDER BY authentication_systems.priority DESC, authentication_systems.id] 2]  type:  java.util.UUID
2023-12-01T08:51:33.168Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:51:33.173Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [password #object[org.postgresql.jdbc.PgResultSetMetaData 0x21f49838 org.postgresql.jdbc.PgResultSetMetaData@21f49838] 1]
2023-12-01T08:51:33.177Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar password]
2023-12-01T08:51:33.177Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  password
2023-12-01T08:51:33.178Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [password #object[org.postgresql.jdbc.PgResultSetMetaData 0x21f49838 org.postgresql.jdbc.PgResultSetMetaData@21f49838] 2]
2023-12-01T08:51:33.178Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar password]
2023-12-01T08:51:33.179Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  password
2023-12-01T08:51:33.179Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [leihs password #object[org.postgresql.jdbc.PgResultSetMetaData 0x21f49838 org.postgresql.jdbc.PgResultSetMetaData@21f49838] 3]
2023-12-01T08:51:33.180Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar leihs password]
2023-12-01T08:51:33.180Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  leihs password
2023-12-01T08:51:33.182Z NX-41294 DEBUG [leihs.core.sign-in.back:153] - user {:system_admin_protected false, :address nil, :email "amelia@rosenbaum.name", :pool_protected false, :last_sign_in_at nil, :img32_url nil, :account_enabled true, :lastname "Kemmer", :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization "local", :login nil, :searchable "Dawna Kemmer amelia@rosenbaum.name    Kemmer Dawna", :updated_at #time/instant "2023-12-01T07:47:31.258507Z", :firstname "Dawna", :zip nil, :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at #time/instant "2023-12-01T07:47:31.258507Z", :admin_protected false} user-auth-systems ({:id "password", :type "password", :name "leihs password", :description nil, :external_sign_in_url nil}) sign-up-auth-systems ()
2023-12-01T08:51:33.187Z NX-41294 DEBUG [leihs.core.sign-in.back:82] - sign-in-page-params {:navbar {:csrfToken {:value "65184e75-5146-4915-8494-09445d034d15", :name "csrf-token"}, :config {:appTitle "leihs", :appColor "gray", :me nil, :subApps {}, :locales ({:name "English (UK)", :locale "en-GB", :active true, :isDefault true, :isSelected true} {:name "English (US)", :locale "en-US", :active true, :isDefault false, :isSelected false} {:name "Deutsch", :locale "de-CH", :active true, :isDefault false, :isSelected false} {:name "Züritüütsch", :locale "gsw-CH", :active true, :isDefault false, :isSelected false})}}, :authFlow {:user nil, :showPasswordSection false, :passwordButtonText "password_create_button_text", :passwordLink "/forgot-password", :returnTo "/procure"}, :csrfToken {:value "65184e75-5146-4915-8494-09445d034d15", :name "csrf-token"}}
2023-12-01T08:51:33.187Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:51:41.498Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xef8c44c HikariProxyPreparedStatement@251184204 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:51:41.498Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:51:41.499Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xef8c44c HikariProxyPreparedStatement@251184204 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:51:41.499Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-12-01T08:51:41.500Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xef8c44c HikariProxyPreparedStatement@251184204 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:51:41.500Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:51:41.501Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0xef8c44c HikariProxyPreparedStatement@251184204 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:51:41.501Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 183213607494333, :params {:user jimmie@goyette.com, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15, :return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x98c7cd7 HikariProxyConnection@160201943 wrapping org.postgresql.jdbc.PgConnection@1b65dc97], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/x-www-form-urlencoded, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 112, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x46e08e54 /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {:user jimmie@goyette.com, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15, :return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2f8d2466 HikariProxyConnection@797779046 wrapping org.postgresql.jdbc.PgConnection@228f1ba7], :level 1, :rollback #object[clojure.lang.Atom 0x6917d687 {:status :ready, :val false}]}, :content-length 112, :form-params {:user jimmie@goyette.com, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15, :return-to /procure}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user jimmie@goyette.com, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15, :return-to /procure}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x39775b6 BytesInputStream[len=112]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x35049c52 compojure.core$routes$fn__27950@35049c52], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:51:41.506Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:51:41.510Z NX-41294 DEBUG [leihs.core.sign-in.back:82] - sign-in-page-params {:navbar {:csrfToken {:value "65184e75-5146-4915-8494-09445d034d15", :name "csrf-token"}, :config {:appTitle "leihs", :appColor "gray", :me nil, :subApps {}, :locales ({:name "English (UK)", :locale "en-GB", :active true, :isDefault true, :isSelected true} {:name "English (US)", :locale "en-US", :active true, :isDefault false, :isSelected false} {:name "Deutsch", :locale "de-CH", :active true, :isDefault false, :isSelected false} {:name "Züritüütsch", :locale "gsw-CH", :active true, :isDefault false, :isSelected false})}}, :authFlow {:user "jimmie@goyette.com", :showPasswordSection false, :passwordButtonText "password_create_button_text", :passwordLink "/forgot-password"}, :csrfToken {:value "65184e75-5146-4915-8494-09445d034d15", :name "csrf-token"}, :flashMessages [{:messageID "sign_in_wrong_password_flash_message", :level "error"}]}
2023-12-01T08:51:41.511Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:51:41.511Z NX-41294 WARN [leihs.core.db:201] - Rolling back transaction because error status  401
2023-12-01T08:51:50.312Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:51:50.314Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:51:50.314Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - db-pool - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:51:50.335Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:51:50.336Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:51:50.336Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:52:20.319Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:52:20.328Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:52:20.328Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - db-pool - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:52:20.341Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:52:20.341Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:52:20.341Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:52:50.331Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:52:50.335Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:52:50.336Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - db-pool - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:52:50.351Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:52:50.351Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:52:50.352Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:52:51.119Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6b63eaca HikariProxyPreparedStatement@1801710282 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:52:51.120Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:52:51.122Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6b63eaca HikariProxyPreparedStatement@1801710282 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:52:51.122Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-12-01T08:52:51.128Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6b63eaca HikariProxyPreparedStatement@1801710282 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:52:51.129Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:52:51.130Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6b63eaca HikariProxyPreparedStatement@1801710282 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:52:51.131Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 183283226265458, :params {:return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {:return-to /procure}, :route-params nil, :headers {sec-fetch-site none, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2f25d326 /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {:return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {:return-to /procure}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string return-to=%2Fprocure, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x35049c52 compojure.core$routes$fn__27950@35049c52], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:52:51.137Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:52:51.138Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text  #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5cdf9a99 HikariProxyPreparedStatement@1558157977 wrapping SELECT * FROM users  WHERE (users.org_id IS NULL OR users.login IS NULL OR lower(users.email) = ?)] 1]  type:  java.lang.String
2023-12-01T08:52:51.138Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  
2023-12-01T08:52:51.139Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6492dd9 org.postgresql.jdbc.PgResultSetMetaData@6492dd9] 1]
2023-12-01T08:52:51.139Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:51.139Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:51.140Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x6492dd9 org.postgresql.jdbc.PgResultSetMetaData@6492dd9] 3]
2023-12-01T08:52:51.140Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:52:51.140Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:52:51.140Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x6492dd9 org.postgresql.jdbc.PgResultSetMetaData@6492dd9] 4]
2023-12-01T08:52:51.140Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:52:51.140Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:52:51.140Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x6492dd9 org.postgresql.jdbc.PgResultSetMetaData@6492dd9] 7]
2023-12-01T08:52:51.140Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:52:51.141Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:52:51.141Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T07:47:31.258507000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6492dd9 org.postgresql.jdbc.PgResultSetMetaData@6492dd9] 15]
2023-12-01T08:52:51.142Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T07:47:31.258507000-00:00"]
2023-12-01T08:52:51.142Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T07:47:31.258507Z"
2023-12-01T08:52:51.142Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T07:47:31.258507000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6492dd9 org.postgresql.jdbc.PgResultSetMetaData@6492dd9] 16]
2023-12-01T08:52:51.143Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T07:47:31.258507000-00:00"]
2023-12-01T08:52:51.143Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T07:47:31.258507Z"
2023-12-01T08:52:51.143Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna Kemmer amelia@rosenbaum.name    Kemmer Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x6492dd9 org.postgresql.jdbc.PgResultSetMetaData@6492dd9] 25]
2023-12-01T08:52:51.143Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna Kemmer amelia@rosenbaum.name    Kemmer Dawna]
2023-12-01T08:52:51.143Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna Kemmer amelia@rosenbaum.name    Kemmer Dawna
2023-12-01T08:52:51.144Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [local #object[org.postgresql.jdbc.PgResultSetMetaData 0x6492dd9 org.postgresql.jdbc.PgResultSetMetaData@6492dd9] 32]
2023-12-01T08:52:51.144Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text local]
2023-12-01T08:52:51.144Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  local
2023-12-01T08:52:51.145Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text password #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2f76cb9e HikariProxyPreparedStatement@796314526 wrapping SELECT authentication_systems.id, authentication_systems.type, authentication_systems.name, authentication_systems.description, authentication_systems.external_sign_in_url FROM authentication_systems, users  WHERE ((EXISTS (SELECT TRUE FROM authentication_systems_users WHERE (authentication_systems_users.user_id = users.id AND authentication_systems.id = authentication_systems_users.authentication_system_id AND (authentication_systems.type <> ? OR users.password_sign_in_enabled = TRUE) AND users.account_enabled = TRUE)) OR EXISTS (SELECT TRUE FROM authentication_systems asxs INNER JOIN authentication_systems_groups ON (asxs.id = authentication_systems_groups.authentication_system_id) INNER JOIN groups_users ON (authentication_systems_groups.group_id = groups_users.group_id AND authentication_systems_groups.group_id = groups_users.group_id AND groups_users.user_id = users.id) WHERE (asxs.id = authentication_systems.id AND users.account_enabled = TRUE))) AND authentication_systems.enabled = TRUE AND users.id = ?) ORDER BY authentication_systems.priority DESC, authentication_systems.id] 1]  type:  java.lang.String
2023-12-01T08:52:51.146Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  password
2023-12-01T08:52:51.147Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2f76cb9e HikariProxyPreparedStatement@796314526 wrapping SELECT authentication_systems.id, authentication_systems.type, authentication_systems.name, authentication_systems.description, authentication_systems.external_sign_in_url FROM authentication_systems, users  WHERE ((EXISTS (SELECT TRUE FROM authentication_systems_users WHERE (authentication_systems_users.user_id = users.id AND authentication_systems.id = authentication_systems_users.authentication_system_id AND (authentication_systems.type <> 'password' OR users.password_sign_in_enabled = TRUE) AND users.account_enabled = TRUE)) OR EXISTS (SELECT TRUE FROM authentication_systems asxs INNER JOIN authentication_systems_groups ON (asxs.id = authentication_systems_groups.authentication_system_id) INNER JOIN groups_users ON (authentication_systems_groups.group_id = groups_users.group_id AND authentication_systems_groups.group_id = groups_users.group_id AND groups_users.user_id = users.id) WHERE (asxs.id = authentication_systems.id AND users.account_enabled = TRUE))) AND authentication_systems.enabled = TRUE AND users.id = ?) ORDER BY authentication_systems.priority DESC, authentication_systems.id] 2]  type:  java.util.UUID
2023-12-01T08:52:51.147Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:51.148Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [password #object[org.postgresql.jdbc.PgResultSetMetaData 0x6d00a150 org.postgresql.jdbc.PgResultSetMetaData@6d00a150] 1]
2023-12-01T08:52:51.149Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar password]
2023-12-01T08:52:51.149Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  password
2023-12-01T08:52:51.149Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [password #object[org.postgresql.jdbc.PgResultSetMetaData 0x6d00a150 org.postgresql.jdbc.PgResultSetMetaData@6d00a150] 2]
2023-12-01T08:52:51.149Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar password]
2023-12-01T08:52:51.149Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  password
2023-12-01T08:52:51.149Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [leihs password #object[org.postgresql.jdbc.PgResultSetMetaData 0x6d00a150 org.postgresql.jdbc.PgResultSetMetaData@6d00a150] 3]
2023-12-01T08:52:51.149Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar leihs password]
2023-12-01T08:52:51.149Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  leihs password
2023-12-01T08:52:51.150Z NX-41294 DEBUG [leihs.core.sign-in.back:153] - user {:system_admin_protected false, :address nil, :email "amelia@rosenbaum.name", :pool_protected false, :last_sign_in_at nil, :img32_url nil, :account_enabled true, :lastname "Kemmer", :phone nil, :img_digest nil, :org_id nil, :extended_info nil, :secondary_email nil, :city nil, :settings nil, :is_admin false, :organization "local", :login nil, :searchable "Dawna Kemmer amelia@rosenbaum.name    Kemmer Dawna", :updated_at #time/instant "2023-12-01T07:47:31.258507Z", :firstname "Dawna", :zip nil, :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :url nil, :password_sign_in_enabled true, :account_disabled_at nil, :is_system_admin false, :badge_id nil, :language_locale nil, :img256_url nil, :country nil, :delegator_user_id nil, :created_at #time/instant "2023-12-01T07:47:31.258507Z", :admin_protected false} user-auth-systems ({:id "password", :type "password", :name "leihs password", :description nil, :external_sign_in_url nil}) sign-up-auth-systems ()
2023-12-01T08:52:51.153Z NX-41294 DEBUG [leihs.core.sign-in.back:82] - sign-in-page-params {:navbar {:csrfToken {:value "65184e75-5146-4915-8494-09445d034d15", :name "csrf-token"}, :config {:appTitle "leihs", :appColor "gray", :me nil, :subApps {}, :locales ({:name "English (UK)", :locale "en-GB", :active true, :isDefault true, :isSelected true} {:name "English (US)", :locale "en-US", :active true, :isDefault false, :isSelected false} {:name "Deutsch", :locale "de-CH", :active true, :isDefault false, :isSelected false} {:name "Züritüütsch", :locale "gsw-CH", :active true, :isDefault false, :isSelected false})}}, :authFlow {:user nil, :showPasswordSection false, :passwordButtonText "password_create_button_text", :passwordLink "/forgot-password", :returnTo "/procure"}, :csrfToken {:value "65184e75-5146-4915-8494-09445d034d15", :name "csrf-token"}}
2023-12-01T08:52:51.154Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:52:56.935Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x37188596 HikariProxyPreparedStatement@924353942 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:52:56.936Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:52:56.938Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5f135ec7-f555-4255-80a4-6dc08b1a591c #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x37188596 HikariProxyPreparedStatement@924353942 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:52:56.939Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5f135ec7-f555-4255-80a4-6dc08b1a591c
2023-12-01T08:52:56.946Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x37188596 HikariProxyPreparedStatement@924353942 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:52:56.946Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:52:56.947Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x37188596 HikariProxyPreparedStatement@924353942 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5f135ec7-f555-4255-80a4-6dc08b1a591c', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:52:56.948Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
>>> authenticate::skip= true  handler-key= :sign-in
>>> authenticate::authenticated-entity nil

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5f135ec7-f555-4255-80a4-6dc08b1a591c}}, :remote-addr 127.0.0.1, :start-time 183289047064416, :params {:user amelia@rosenbaum.name, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15, :return-to /procure}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x2882bc04 HikariProxyConnection@679656452 wrapping org.postgresql.jdbc.PgConnection@1b65dc97], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/x-www-form-urlencoded, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5f135ec7-f555-4255-80a4-6dc08b1a591c, content-length 115, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x42768c9c /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {:user amelia@rosenbaum.name, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15, :return-to /procure}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x9f166a1 HikariProxyConnection@166815393 wrapping org.postgresql.jdbc.PgConnection@228f1ba7], :level 1, :rollback #object[clojure.lang.Atom 0x5b2b70f8 {:status :ready, :val false}]}, :content-length 115, :form-params {:user amelia@rosenbaum.name, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15, :return-to /procure}, :websocket? false, :query-params {}, :content-type application/x-www-form-urlencoded, :form-params-raw {:user amelia@rosenbaum.name, :password password, :csrf-token 65184e75-5146-4915-8494-09445d034d15, :return-to /procure}, :character-encoding utf8, :uri /sign-in, :server-name localhost, :handler-key :sign-in, :query-string nil, :body #object[org.httpkit.BytesInputStream 0x66749505 BytesInputStream[len=115]], :graphql-schema #CompiledSchema<>, :handler #object[compojure.core$routes$fn__27950 0x35049c52 compojure.core$routes$fn__27950@35049c52], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :sign-in

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:52:56.956Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:52:56.974Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7c18b760 HikariProxyPreparedStatement@2081994592 wrapping INSERT INTO user_sessions ( user_id, token_hash, authentication_system_id, meta_data ) VALUES ( ?, ?, ?, ? )
RETURNING *] 1]  type:  java.util.UUID
2023-12-01T08:52:56.974Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:56.975Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 6c691d536faf984860efc4defb9a3d3979706971e3dc9d6b8d60d28c24ad1aa3 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7c18b760 HikariProxyPreparedStatement@2081994592 wrapping INSERT INTO user_sessions ( user_id, token_hash, authentication_system_id, meta_data ) VALUES ( 'c00b7951-23c9-426e-b467-e44bca1f26e3'::uuid, ?, ?, ? )
RETURNING *] 2]  type:  java.lang.String
2023-12-01T08:52:56.975Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  6c691d536faf984860efc4defb9a3d3979706971e3dc9d6b8d60d28c24ad1aa3
2023-12-01T08:52:56.975Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text password #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7c18b760 HikariProxyPreparedStatement@2081994592 wrapping INSERT INTO user_sessions ( user_id, token_hash, authentication_system_id, meta_data ) VALUES ( 'c00b7951-23c9-426e-b467-e44bca1f26e3'::uuid, '6c691d536faf984860efc4defb9a3d3979706971e3dc9d6b8d60d28c24ad1aa3', ?, ? )
RETURNING *] 3]  type:  java.lang.String
2023-12-01T08:52:56.976Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  password
2023-12-01T08:52:56.977Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:jsonb {:user_agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, :remote_addr 127.0.0.1} #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7c18b760 HikariProxyPreparedStatement@2081994592 wrapping INSERT INTO user_sessions ( user_id, token_hash, authentication_system_id, meta_data ) VALUES ( 'c00b7951-23c9-426e-b467-e44bca1f26e3'::uuid, '6c691d536faf984860efc4defb9a3d3979706971e3dc9d6b8d60d28c24ad1aa3', 'password', ? )
RETURNING *] 4]  type:  clojure.lang.PersistentArrayMap
2023-12-01T08:52:56.978Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #object[org.postgresql.util.PGobject 0xf8576a4 {"user_agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","remote_addr":"127.0.0.1"}]
2023-12-01T08:52:57.046Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2e9b596b org.postgresql.jdbc.PgResultSetMetaData@2e9b596b] 1]
2023-12-01T08:52:57.050Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:52:57.050Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:52:57.050Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [6c691d536faf984860efc4defb9a3d3979706971e3dc9d6b8d60d28c24ad1aa3 #object[org.postgresql.jdbc.PgResultSetMetaData 0x2e9b596b org.postgresql.jdbc.PgResultSetMetaData@2e9b596b] 2]
2023-12-01T08:52:57.051Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text 6c691d536faf984860efc4defb9a3d3979706971e3dc9d6b8d60d28c24ad1aa3]
2023-12-01T08:52:57.051Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  6c691d536faf984860efc4defb9a3d3979706971e3dc9d6b8d60d28c24ad1aa3
2023-12-01T08:52:57.051Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2e9b596b org.postgresql.jdbc.PgResultSetMetaData@2e9b596b] 3]
2023-12-01T08:52:57.051Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.052Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.052Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2e9b596b org.postgresql.jdbc.PgResultSetMetaData@2e9b596b] 5]
2023-12-01T08:52:57.052Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:52:57.052Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:52:57.054Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#object[org.postgresql.util.PGobject 0x802a32b {"user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "remote_addr": "127.0.0.1"}] #object[org.postgresql.jdbc.PgResultSetMetaData 0x2e9b596b org.postgresql.jdbc.PgResultSetMetaData@2e9b596b] 6]
2023-12-01T08:52:57.054Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:jsonb #object[org.postgresql.util.PGobject 0x802a32b {"user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36", "remote_addr": "127.0.0.1"}]]
2023-12-01T08:52:57.055Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  {:user_agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, :remote_addr 127.0.0.1}
2023-12-01T08:52:57.055Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [password #object[org.postgresql.jdbc.PgResultSetMetaData 0x2e9b596b org.postgresql.jdbc.PgResultSetMetaData@2e9b596b] 7]
2023-12-01T08:52:57.055Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text password]
2023-12-01T08:52:57.056Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  password
2023-12-01T08:52:57.058Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:52:57.117Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1421ba3a HikariProxyPreparedStatement@337754682 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:52:57.117Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:52:57.118Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1421ba3a HikariProxyPreparedStatement@337754682 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:52:57.118Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:52:57.119Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1421ba3a HikariProxyPreparedStatement@337754682 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:52:57.119Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:52:57.120Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1421ba3a HikariProxyPreparedStatement@337754682 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:52:57.120Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:52:57.124Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 1]
2023-12-01T08:52:57.125Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:52:57.125Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:52:57.126Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 2]
2023-12-01T08:52:57.126Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:52:57.126Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:52:57.126Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 3]
2023-12-01T08:52:57.126Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.126Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.127Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 6]
2023-12-01T08:52:57.127Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:52:57.127Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:52:57.127Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 10]
2023-12-01T08:52:57.127Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.127Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.128Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 11]
2023-12-01T08:52:57.128Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.128Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.128Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 12]
2023-12-01T08:52:57.128Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.128Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.129Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 13]
2023-12-01T08:52:57.129Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:52:57.129Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:52:57.129Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6aa9133a org.postgresql.jdbc.PgResultSetMetaData@6aa9133a] 14]
2023-12-01T08:52:57.129Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:52:57.129Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:52:57.130Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x28a67e54 HikariProxyPreparedStatement@681999956 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:52:57.130Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>> authenticate::skip= nil  handler-key= :procurement
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289233925250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x34da8f12 /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure, :server-name localhost, :handler-key :procurement, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x2f51f004 leihs.procurement.backend.html$not_found_handler@2f51f004], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :procurement
2023-12-01T08:52:57.135Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.145Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:52:57.165Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:52:57.179Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:52:57.198Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:52:57.201Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:52:57.619Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x394ded7b HikariProxyPreparedStatement@961408379 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:52:57.620Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:52:57.621Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x394ded7b HikariProxyPreparedStatement@961408379 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:52:57.621Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:52:57.622Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x394ded7b HikariProxyPreparedStatement@961408379 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:52:57.622Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:52:57.624Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x394ded7b HikariProxyPreparedStatement@961408379 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:52:57.624Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:52:57.627Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 1]
2023-12-01T08:52:57.627Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:52:57.627Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 2]
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 3]
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 6]
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:52:57.628Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 10]
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 11]
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 12]
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.629Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.630Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 13]
2023-12-01T08:52:57.630Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:52:57.630Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:52:57.630Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x53fb3a26 org.postgresql.jdbc.PgResultSetMetaData@53fb3a26] 14]
2023-12-01T08:52:57.630Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:52:57.630Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:52:57.632Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x30ccb8c HikariProxyPreparedStatement@51170188 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:52:57.632Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289683351708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5d59f08d /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-12-01T08:52:57.635Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.636Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:52:57.637Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:52:57.637Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:52:57.640Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
pure-handler >> 2
2023-12-01T08:52:57.645Z NX-41294 DEBUG [leihs.procurement.graphql:71] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.655Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>>2 {:id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :firstname Dawna, :lastname Kemmer}
>>oida>> #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.659Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
>>>3 nil
2023-12-01T08:52:57.697Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.699Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

>oo>1pure-handler _> request, can contains invalid value in -> priority inspector_priority order_status

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289683351708, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5d59f08d /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-01T08:52:57.734Z NX-41294 DEBUG [leihs.procurement.graphql:108] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"65184e75-5146-4915-8494-09445d034d15\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"c00b7951-23c9-426e-b467-e44bca1f26e3\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "c00b7951-23c9-426e-b467-e44bca1f26e3"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "375e80d9-f6bf-4335-9268-9b21dca9b82e"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}

>o>3apure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"65184e75-5146-4915-8494-09445d034d15","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"c00b7951-23c9-426e-b467-e44bca1f26e3","firstname":"Dawna","lastname":"Kemmer","login":null,"email":"amelia@rosenbaum.name"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id c00b7951-23c9-426e-b467-e44bca1f26e3] [:firstname Dawna] [:lastname Kemmer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id 375e80d9-f6bf-4335-9268-9b21dca9b82e] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-01T08:52:57.737Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:52:57.775Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x617627c7 HikariProxyPreparedStatement@1635133383 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:52:57.775Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:52:57.776Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x617627c7 HikariProxyPreparedStatement@1635133383 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:52:57.776Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:52:57.777Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x617627c7 HikariProxyPreparedStatement@1635133383 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:52:57.777Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:52:57.779Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x617627c7 HikariProxyPreparedStatement@1635133383 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:52:57.779Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:52:57.782Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7fabdafb HikariProxyPreparedStatement@2141969147 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:52:57.782Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:52:57.782Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 1]
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 2]
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 3]
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.783Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 6]
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 10]
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 11]
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7fabdafb HikariProxyPreparedStatement@2141969147 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 12]
2023-12-01T08:52:57.784Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.785Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.785Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 13]
2023-12-01T08:52:57.785Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:52:57.785Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:52:57.785Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7fabdafb HikariProxyPreparedStatement@2141969147 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:52:57.785Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:52:57.785Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x2411ec36 org.postgresql.jdbc.PgResultSetMetaData@2411ec36] 14]
2023-12-01T08:52:57.786Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:52:57.786Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:52:57.786Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x7fabdafb HikariProxyPreparedStatement@2141969147 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:52:57.787Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:52:57.787Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x78d3bb0f HikariProxyPreparedStatement@2027141903 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:52:57.787Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289887358583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5e28dcff /127.0.0.1:3230<->/127.0.0.1:64260], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-12-01T08:52:57.789Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.790Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:52:57.792Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:52:57.793Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:52:57.795Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
pure-handler >> 2
2023-12-01T08:52:57.798Z NX-41294 DEBUG [leihs.procurement.graphql:71] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.800Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>>2 {:id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :firstname Dawna, :lastname Kemmer}
>>oida>> #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.802Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.802Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5c8b4dab HikariProxyPreparedStatement@1552633259 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:52:57.803Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
>>>3 nil
2023-12-01T08:52:57.804Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5c8b4dab HikariProxyPreparedStatement@1552633259 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:52:57.805Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:52:57.806Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5c8b4dab HikariProxyPreparedStatement@1552633259 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:52:57.806Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:52:57.807Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5c8b4dab HikariProxyPreparedStatement@1552633259 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:52:57.807Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:52:57.810Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 1]
2023-12-01T08:52:57.810Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:52:57.810Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:52:57.810Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 2]
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 3]
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 6]
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:52:57.811Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 10]
2023-12-01T08:52:57.812Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.815Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.815Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 11]
2023-12-01T08:52:57.815Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.815Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.815Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 12]
2023-12-01T08:52:57.815Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.816Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.816Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 13]
2023-12-01T08:52:57.816Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:52:57.816Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:52:57.816Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x6b4a3e8a org.postgresql.jdbc.PgResultSetMetaData@6b4a3e8a] 14]
2023-12-01T08:52:57.816Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:52:57.816Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:52:57.818Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1d1a5dd2 HikariProxyPreparedStatement@488267218 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:52:57.818Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289887117791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 4019, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0xec1e211 /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 4019, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-12-01T08:52:57.820Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.821Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:52:57.822Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:52:57.822Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:52:57.826Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:52:57.826Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.827Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

>oo>1pure-handler _> request, can contains invalid value in -> priority inspector_priority order_status

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289887358583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5e28dcff /127.0.0.1:3230<->/127.0.0.1:64260], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-01T08:52:57.830Z NX-41294 DEBUG [leihs.procurement.graphql:108] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"65184e75-5146-4915-8494-09445d034d15\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"c00b7951-23c9-426e-b467-e44bca1f26e3\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "c00b7951-23c9-426e-b467-e44bca1f26e3"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "375e80d9-f6bf-4335-9268-9b21dca9b82e"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}

>o>3apure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"65184e75-5146-4915-8494-09445d034d15","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"c00b7951-23c9-426e-b467-e44bca1f26e3","firstname":"Dawna","lastname":"Kemmer","login":null,"email":"amelia@rosenbaum.name"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id c00b7951-23c9-426e-b467-e44bca1f26e3] [:firstname Dawna] [:lastname Kemmer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id 375e80d9-f6bf-4335-9268-9b21dca9b82e] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-01T08:52:57.831Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
pure-handler >> 2
2023-12-01T08:52:57.836Z NX-41294 DEBUG [leihs.procurement.graphql:71] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["fb664326-a8ef-4556-af02-07d3127cd9ec"], :categories ["7d5ba731-edd9-41ba-8773-7337d24c2327"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MEDIUM HIGH MANDATORY] {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}
2023-12-01T08:52:57.839Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 1]
2023-12-01T08:52:57.846Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:52:57.847Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:52:57.847Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 2]
2023-12-01T08:52:57.847Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:52:57.847Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:52:57.850Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 3]
2023-12-01T08:52:57.851Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.851Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.851Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 6]
2023-12-01T08:52:57.851Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:52:57.851Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:52:57.851Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 10]
2023-12-01T08:52:57.852Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.852Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.852Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 11]
2023-12-01T08:52:57.852Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.852Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.852Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 12]
2023-12-01T08:52:57.852Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:52:57.852Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:52:57.853Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 13]
2023-12-01T08:52:57.853Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:52:57.853Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:52:57.854Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x47612ec7 org.postgresql.jdbc.PgResultSetMetaData@47612ec7] 14]
2023-12-01T08:52:57.855Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:52:57.855Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:52:57.857Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x38f89209 HikariProxyPreparedStatement@955814409 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:52:57.857Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289887229583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x26f57887 /127.0.0.1:3230<->/127.0.0.1:64227], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-12-01T08:52:57.862Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.862Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:52:57.863Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:52:57.864Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:52:57.865Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [fb664326-a8ef-4556-af02-07d3127cd9ec], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [8b8fe440-cae5-4bf9-8048-d0ec2399faa1], :category_id [7d5ba731-edd9-41ba-8773-7337d24c2327]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
pure-handler >> 2
2023-12-01T08:52:57.870Z NX-41294 DEBUG [leihs.procurement.graphql:71] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>mainCats [{:id #uuid "0426b147-9cd8-43b2-b59e-a84fa7bf8d7e", :name Geisha}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]
>>resultA1 []
>>resultA1-2 []
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [fb664326-a8ef-4556-af02-07d3127cd9ec], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [8b8fe440-cae5-4bf9-8048-d0ec2399faa1], :category_id [7d5ba731-edd9-41ba-8773-7337d24c2327]} nil
>o> helper1
>o> helper2 [7d5ba731-edd9-41ba-8773-7337d24c2327] [8b8fe440-cae5-4bf9-8048-d0ec2399faa1] [fb664326-a8ef-4556-af02-07d3127cd9ec]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>oo> >>1 :NORMAL
>oo> >>1 :HIGH
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>oo> >>1 :LOW
>oo> >>1 :MEDIUM
>oo> >>1 :HIGH
>oo> >>1 :MANDATORY
low medium high mandatory)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>oo> >>1 :NOT_PROCESSED
>oo> >>1 :IN_PROGRESS
>oo> >>1 :PROCURED
>oo> >>1 :ALTERNATIVE_PROCURED
>oo> >>1 :NOT_PROCURED
not_processed in_progress procured alternative_procured not_procured)
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
2023-12-01T08:52:57.897Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:52:57.898Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:52:57.899Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.902Z NX-41294 DEBUG [leihs.procurement.permissions.user:103] - (->> [viewer? inspector? admin?] (map (fn* [p1__39297#] (p1__39297# tx auth-entity))) (some true?)) => nil
>o> helper7 nil
>o> requests-base-query-with-state
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-01T08:52:57.904Z NX-41294 DEBUG [leihs.procurement.resources.request:171] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers
>o> nest-key :supplier
>o> join-and-nest-users
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]] [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low medium high mandatory) (normal high)
>oo> enum (not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:52:57.908Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.910Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:52:57.910Z NX-41294 DEBUG [leihs.procurement.permissions.requests:26] - (-> sqlmap (sql/left-join :procurement_category_viewers [:= :procurement_category_viewers.category_id :procurement_requests.category_id]) (sql/where [:or [:= :procurement_category_viewers.user_id user-id] [:= :procurement_requests.user_id user-id]])) => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category"]] [[[:row_to_json :models]] :model] [[:raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization"]] [[[:row_to_json :procurement_templates]] :template] [[:raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room"]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id] :procurement_category_viewers [:= :procurement_category_viewers.category_id :procurement_requests.category_id]], :order-by [[[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:and [:in :procurement_requests.category_id ([:cast "7d5ba731-edd9-41ba-8773-7337d24c2327" :uuid])] [:in :procurement_requests.budget_period_id ([:cast "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" :uuid])] [:in :procurement_requests.organization_id ([:cast "fb664326-a8ef-4556-af02-07d3127cd9ec" :uuid])] [:in :procurement_requests.priority ("normal" "high")] [:in :procurement_requests.inspector_priority ("low" "medium" "high" "mandatory")] [:or [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]] [:in :procurement_requests.order_status ([[:cast "not_processed" :order_status_enum]] [[:cast "in_progress" :order_status_enum]] [[:cast "procured" :order_status_enum]] [[:cast "alternative_procured" :order_status_enum]] [[:cast "not_procured" :order_status_enum]])] [:or [:= :procurement_category_viewers.user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"] [:= :procurement_requests.user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]]]}
>o> abc [SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((procurement_category_viewers.user_id = ?) OR (procurement_requests.user_id = ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC NEW APPROVED 0 PARTIALLY_APPROVED 0 DENIED IN_APPROVAL 7d5ba731-edd9-41ba-8773-7337d24c2327 8b8fe440-cae5-4bf9-8048-d0ec2399faa1 fb664326-a8ef-4556-af02-07d3127cd9ec normal high low medium high mandatory 0 0 not_processed in_progress procured alternative_procured not_procured #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.913Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:52:57.914Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:52:57.914Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:52:57.915Z NX-41294 DEBUG [leihs.procurement.permissions.user:103] - (->> [viewer? inspector? admin?] (map (fn* [p1__39297#] (p1__39297# tx auth-entity))) (some true?)) => nil

>oo>1pure-handler _> request, can contains invalid value in -> priority inspector_priority order_status

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289887229583, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x26f57887 /127.0.0.1:3230<->/127.0.0.1:64227], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-01T08:52:57.951Z NX-41294 DEBUG [leihs.procurement.graphql:108] - result => {:data #ordered/map ([:budget_periods [nil]] [:main_categories [nil]] [:organizations [nil nil nil nil nil nil]]), :errors ({:message "Non-nullable field was null.", :locations [{:line 3, :column 5}], :path [:budget_periods 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 4, :column 5}], :path [:budget_periods 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 5, :column 5}], :path [:budget_periods 0 :inspection_start_date]} {:message "Non-nullable field was null.", :locations [{:line 6, :column 5}], :path [:budget_periods 0 :end_date]} {:message "Non-nullable field was null.", :locations [{:line 10, :column 5}], :path [:main_categories 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 11, :column 5}], :path [:main_categories 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 11 :name]})}
2023-12-01T08:52:57.953Z NX-41294 DEBUG [leihs.procurement.graphql:109] - {:data #ordered/map ([:budget_periods [nil]] [:main_categories [nil]] [:organizations [nil nil nil nil nil nil]]), :errors ({:message "Non-nullable field was null.", :locations [{:line 3, :column 5}], :path [:budget_periods 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 4, :column 5}], :path [:budget_periods 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 5, :column 5}], :path [:budget_periods 0 :inspection_start_date]} {:message "Non-nullable field was null.", :locations [{:line 6, :column 5}], :path [:budget_periods 0 :end_date]} {:message "Non-nullable field was null.", :locations [{:line 10, :column 5}], :path [:main_categories 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 11, :column 5}], :path [:main_categories 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 11 :name]})}

>o> ERROR 4pure-handler, result=> {:data #ordered/map ([:budget_periods [nil]] [:main_categories [nil]] [:organizations [nil nil nil nil nil nil]]), :errors ({:message Non-nullable field was null., :locations [{:line 3, :column 5}], :path [:budget_periods 0 :id]} {:message Non-nullable field was null., :locations [{:line 4, :column 5}], :path [:budget_periods 0 :name]} {:message Non-nullable field was null., :locations [{:line 5, :column 5}], :path [:budget_periods 0 :inspection_start_date]} {:message Non-nullable field was null., :locations [{:line 6, :column 5}], :path [:budget_periods 0 :end_date]} {:message Non-nullable field was null., :locations [{:line 10, :column 5}], :path [:main_categories 0 :id]} {:message Non-nullable field was null., :locations [{:line 11, :column 5}], :path [:main_categories 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 11 :name]})}
2023-12-01T08:52:57.958Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
>o>requestsB2 ()
>o>dashboard-cache-keyB2 {:id 1608672852}
2023-12-01T08:52:57.971Z NX-41294 DEBUG [leihs.procurement.dashboard:265] - (count requests) => 0
>o> cache-key ({:id 1608672852})
2023-12-01T08:52:57.972Z NX-41294 DEBUG [leihs.procurement.dashboard:266] - (cache-key dashboard-cache-key) => 1608672852

>o> final-result () 


>o> final-result (json) [] 

2023-12-01T08:52:57.973Z NX-41294 DEBUG [leihs.procurement.dashboard:267] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ()

>oo>1pure-handler _> request, can contains invalid value in -> priority inspector_priority order_status

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183289887117791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 4019, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0xec1e211 /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 4019, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-01T08:52:57.975Z NX-41294 DEBUG [leihs.procurement.graphql:108] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1608672852"] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}

>o>3apure-handler, result=> {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey 1608672852] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}
2023-12-01T08:52:57.976Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:53:13.891Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x18794ca2 HikariProxyPreparedStatement@410602658 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:53:13.891Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:53:13.892Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x18794ca2 HikariProxyPreparedStatement@410602658 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:53:13.892Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:53:13.893Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x18794ca2 HikariProxyPreparedStatement@410602658 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:53:13.893Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:53:13.894Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x18794ca2 HikariProxyPreparedStatement@410602658 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:53:13.894Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:53:13.896Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 1]
2023-12-01T08:53:13.897Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:53:13.897Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:53:13.897Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 2]
2023-12-01T08:53:13.897Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:53:13.897Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:53:13.897Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 3]
2023-12-01T08:53:13.897Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:13.897Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 6]
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 10]
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 11]
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 12]
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:53:13.898Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:53:13.899Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 13]
2023-12-01T08:53:13.899Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:53:13.899Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:53:13.899Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x9363bcf org.postgresql.jdbc.PgResultSetMetaData@9363bcf] 14]
2023-12-01T08:53:13.899Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:53:13.899Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:53:13.900Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2a639143 HikariProxyPreparedStatement@711168323 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:53:13.901Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183305999854875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/sign-in?return-to=%2Fprocure, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x1c222dc2 /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/requests, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x2f51f004 leihs.procurement.backend.html$not_found_handler@2f51f004], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
2023-12-01T08:53:13.903Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:13.903Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:53:13.904Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:53:13.905Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:53:13.906Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:53:13.906Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:53:14.113Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x675e6c6a HikariProxyPreparedStatement@1734241386 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:53:14.114Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:53:14.116Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x675e6c6a HikariProxyPreparedStatement@1734241386 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:53:14.117Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:53:14.119Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x675e6c6a HikariProxyPreparedStatement@1734241386 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:53:14.119Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:53:14.120Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x675e6c6a HikariProxyPreparedStatement@1734241386 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:53:14.120Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:53:14.123Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 1]
2023-12-01T08:53:14.124Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:53:14.124Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:53:14.124Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 2]
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 3]
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 6]
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:53:14.125Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 10]
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 11]
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 12]
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 13]
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:53:14.126Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:53:14.127Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x5592c919 org.postgresql.jdbc.PgResultSetMetaData@5592c919] 14]
2023-12-01T08:53:14.127Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:53:14.127Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:53:14.128Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x19c33968 HikariProxyPreparedStatement@432224616 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:53:14.128Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183306222126416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5eda11cf /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-12-01T08:53:14.131Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.132Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:53:14.133Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:53:14.134Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:53:14.137Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
pure-handler >> 2
2023-12-01T08:53:14.139Z NX-41294 DEBUG [leihs.procurement.graphql:71] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.141Z NX-41294 DEBUG [leihs.procurement.resources.user:75] - id => #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
>>>2 {:id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :firstname Dawna, :lastname Kemmer}
>>oida>> #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.143Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
>>>3 nil
2023-12-01T08:53:14.155Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.156Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

>oo>1pure-handler _> request, can contains invalid value in -> priority inspector_priority order_status

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183306222126416, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x5eda11cf /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-01T08:53:14.160Z NX-41294 DEBUG [leihs.procurement.graphql:108] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"65184e75-5146-4915-8494-09445d034d15\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"c00b7951-23c9-426e-b467-e44bca1f26e3\",\"firstname\":\"Dawna\",\"lastname\":\"Kemmer\",\"login\":null,\"email\":\"amelia@rosenbaum.name\"}},\"subApps\":{\"borrow\":false,\"admin\":false,\"procure\":false,\"manage\":[]},\"locales\":[{\"name\":\"English (UK)\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English (US)\",\"locale\":\"en-US\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "c00b7951-23c9-426e-b467-e44bca1f26e3"] [:firstname "Dawna"] [:lastname "Kemmer"] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id "375e80d9-f6bf-4335-9268-9b21dca9b82e"] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}

>o>3apure-handler, result=> {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"65184e75-5146-4915-8494-09445d034d15","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"c00b7951-23c9-426e-b467-e44bca1f26e3","firstname":"Dawna","lastname":"Kemmer","login":null,"email":"amelia@rosenbaum.name"}},"subApps":{"borrow":false,"admin":false,"procure":false,"manage":[]},"locales":[{"name":"English (UK)","locale":"en-GB","active":true,"isDefault":true,"isSelected":true},{"name":"English (US)","locale":"en-US","active":true,"isDefault":false,"isSelected":false},{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id c00b7951-23c9-426e-b467-e44bca1f26e3] [:firstname Dawna] [:lastname Kemmer] [:permissions #ordered/map ([:isAdmin false] [:isRequester true] [:isInspectorForCategories [#ordered/map ([:id 375e80d9-f6bf-4335-9268-9b21dca9b82e] [:__typename :Category])]] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings nil])}
2023-12-01T08:53:14.160Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:53:14.193Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1707f1a4 HikariProxyPreparedStatement@386396580 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:53:14.193Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:53:14.194Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1707f1a4 HikariProxyPreparedStatement@386396580 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:53:14.194Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:53:14.195Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1707f1a4 HikariProxyPreparedStatement@386396580 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:53:14.195Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:53:14.197Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x1707f1a4 HikariProxyPreparedStatement@386396580 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:53:14.197Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:53:14.199Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:int4 0 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6433b08d HikariProxyPreparedStatement@1681109133 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = ? WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 1]  type:  java.lang.Long
2023-12-01T08:53:14.199Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  0
2023-12-01T08:53:14.199Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 1]
2023-12-01T08:53:14.199Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:53:14.200Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:53:14.200Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 2]
2023-12-01T08:53:14.200Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:53:14.200Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text 5314d6a9-919b-4a06-82a6-8eba2b35b592 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6433b08d HikariProxyPreparedStatement@1681109133 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest(?, ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 2]  type:  java.lang.String
2023-12-01T08:53:14.200Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  5314d6a9-919b-4a06-82a6-8eba2b35b592
2023-12-01T08:53:14.200Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:53:14.200Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 3]
2023-12-01T08:53:14.201Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.201Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.201Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text sha256 #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6433b08d HikariProxyPreparedStatement@1681109133 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', ?), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 3]  type:  java.lang.String
2023-12-01T08:53:14.201Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  sha256
2023-12-01T08:53:14.202Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 6]
2023-12-01T08:53:14.202Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:text hex #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x6433b08d HikariProxyPreparedStatement@1681109133 wrapping SELECT users.email, users.firstname, users.id, users.is_admin, users.language_locale, users.lastname, users.login, users.org_id, users.is_system_admin, users.id AS user_id, (SELECT count(*) FROM contracts WHERE contracts.user_id = users.id) AS contracts_count, (SELECT count(*) FROM access_rights WHERE access_rights.user_id = users.id) AS inventory_pool_roles_count, user_sessions.id AS user_session_id, user_sessions.created_at AS user_session_created_at, authentication_systems.external_sign_out_url AS external_sign_out_url FROM users INNER JOIN user_sessions ON users.id = user_id INNER JOIN authentication_systems ON authentication_systems.id = user_sessions.authentication_system_id INNER JOIN system_and_security_settings ON system_and_security_settings.id = 0 WHERE (user_sessions.token_hash = encode(digest('5314d6a9-919b-4a06-82a6-8eba2b35b592', 'sha256'), ?) AND now() < user_sessions.created_at + system_and_security_settings.sessions_max_lifetime_secs * interval '1 second' AND account_enabled = TRUE)] 4]  type:  java.lang.String
2023-12-01T08:53:14.202Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:53:14.202Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  hex
2023-12-01T08:53:14.202Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:53:14.202Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 10]
2023-12-01T08:53:14.203Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.203Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.203Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 11]
2023-12-01T08:53:14.203Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:53:14.204Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:53:14.204Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 12]
2023-12-01T08:53:14.204Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [amelia@rosenbaum.name #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 1]
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar amelia@rosenbaum.name]
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 13]
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  amelia@rosenbaum.name
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Dawna #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 2]
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:text Dawna]
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Dawna
2023-12-01T08:53:14.205Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x7d2d4523 org.postgresql.jdbc.PgResultSetMetaData@7d2d4523] 14]
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 3]
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [Kemmer #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 6]
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:varchar Kemmer]
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  Kemmer
2023-12-01T08:53:14.206Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 10]
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 11]
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [0 #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 12]
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x2a4f4353 HikariProxyPreparedStatement@709837651 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:int8 0]
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  0
2023-12-01T08:53:14.207Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#uuid "c76911ad-5eff-4240-aafe-20154ffb8566" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 13]
2023-12-01T08:53:14.208Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:uuid #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"]
2023-12-01T08:53:14.208Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #uuid "c76911ad-5eff-4240-aafe-20154ffb8566"
2023-12-01T08:53:14.208Z NX-41294 DEBUG [pg-types.read-column:326] - dispatch-to-convert-column [#inst "2023-12-01T08:52:56.948602000-00:00" #object[org.postgresql.jdbc.PgResultSetMetaData 0x4659ec3e org.postgresql.jdbc.PgResultSetMetaData@4659ec3e] 14]
2023-12-01T08:53:14.208Z NX-41294 DEBUG [pg-types.read-column:326] - calling convert-column with:  [:timestamptz #inst "2023-12-01T08:52:56.948602000-00:00"]
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {2023-12-01T08:53:14.208Z NX-41294 DEBUG [pg-types.read-column:326] - converted-column:  #time/instant "2023-12-01T08:52:56.948602Z"
:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183306307089208, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2398ca9f /127.0.0.1:3230<->/127.0.0.1:64227], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-12-01T08:53:14.209Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.209Z NX-41294 DEBUG [pg-types.sql-parameter:326] - calling convert-parameter with:  [:uuid #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" #object[com.zaxxer.hikari.pool.HikariProxyPreparedStatement 0x5b7b710f HikariProxyPreparedStatement@1534816527 wrapping SELECT role, inventory_pool_id FROM access_rights  WHERE user_id = ?] 1]  type:  java.util.UUID
2023-12-01T08:53:14.209Z NX-41294 DEBUG [pg-types.sql-parameter:326] - converted-parameter:  #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
2023-12-01T08:53:14.209Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:53:14.210Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:53:14.210Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44342 0x54ed1e67 leihs.core.locale$wrap$fn__44342@54ed1e67]

>> authorize::request > {:authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183306306934500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 4019, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4c2cca3a /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 4019, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
2023-12-01T08:53:14.210Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.211Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  2023-12-01T08:53:14.211Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:53:14.211Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
2023-12-01T08:53:14.212Z NX-41294 DEBUG [leihs.procurement.permissions.user:83] - (-> (sql/select [true :has_entry]) (sql/from :procurement_requesters_organizations) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_requesters_organizations WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]

> 1 anti-csrf-token >  65184e75-5146-4915-8494-09445d034d15

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
2023-12-01T08:53:14.213Z NX-41294 DEBUG [leihs.core.anti-csrf.back:92] - anti-csrf-token-new => nil
pure-handler >> 2
2023-12-01T08:53:14.215Z NX-41294 DEBUG [leihs.procurement.graphql:71] - graphql query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
pure-handler >> 2
2023-12-01T08:53:14.219Z NX-41294 DEBUG [leihs.procurement.graphql:71] - graphql query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
 with variables {:inspector_priority ["LOW" "MEDIUM" "HIGH" "MANDATORY"], :onlyOwnRequests false, :state ["NEW" "APPROVED" "PARTIALLY_APPROVED" "DENIED"], :order_status ["NOT_PROCESSED" "IN_PROGRESS" "PROCURED" "ALTERNATIVE_PROCURED" "NOT_PROCURED"], :search nil, :organizations ["fb664326-a8ef-4556-af02-07d3127cd9ec"], :categories ["7d5ba731-edd9-41ba-8773-7337d24c2327"], :priority ["NORMAL" "HIGH"], :budgetPeriods ["8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]}
>oo> vars from graphQL-Requst [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED] [NORMAL HIGH] [LOW MEDIUM HIGH MANDATORY] {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}
>>>get-dashboard
>>args {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [fb664326-a8ef-4556-af02-07d3127cd9ec], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [8b8fe440-cae5-4bf9-8048-d0ec2399faa1], :category_id [7d5ba731-edd9-41ba-8773-7337d24c2327]}
>>value nil
>>mainCatsSql [SELECT procurement_main_categories.* FROM procurement_main_categories ORDER BY procurement_main_categories.name ASC]
>>mainCats [{:id #uuid "0426b147-9cd8-43b2-b59e-a84fa7bf8d7e", :name Geisha}]
>>queryA1 [SELECT * FROM procurement_budget_periods WHERE procurement_budget_periods.id IN (?) ORDER BY end_date DESC #uuid "8b8fe440-cae5-4bf9-8048-d0ec2399faa1"]
>>resultA1 []
>>resultA1-2 []
>>requestsB2-triggerError {:inspector_priority [:LOW :MEDIUM :HIGH :MANDATORY], :organization_id [fb664326-a8ef-4556-af02-07d3127cd9ec], :requested_by_auth_user false, :state [:NEW :APPROVED :PARTIALLY_APPROVED :DENIED], :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED], :search nil, :priority [:NORMAL :HIGH], :budget_period_id [8b8fe440-cae5-4bf9-8048-d0ec2399faa1], :category_id [7d5ba731-edd9-41ba-8773-7337d24c2327]} nil
>o> helper1
>o> helper2 [7d5ba731-edd9-41ba-8773-7337d24c2327] [8b8fe440-cae5-4bf9-8048-d0ec2399faa1] [fb664326-a8ef-4556-af02-07d3127cd9ec]
>oo> helper3a priority [:NORMAL :HIGH]
>oo> helper3b priority (>oo> >>1 :NORMAL
>oo> >>1 :HIGH
normal high)
>oo> helper4a inspector-priority nil
>oo> helper4b inspector-priority (>oo> >>1 :LOW
>oo> >>1 :MEDIUM
>oo> >>1 :HIGH
>oo> >>1 :MANDATORY
low medium high mandatory)
>o> helper5
>oo> helper5a :order_status [:NOT_PROCESSED :IN_PROGRESS :PROCURED :ALTERNATIVE_PROCURED :NOT_PROCURED]
>oo> helper5b :order_status (>oo> >>1 :NOT_PROCESSED
>oo> >>1 :IN_PROGRESS
>oo> >>1 :PROCURED
>oo> >>1 :ALTERNATIVE_PROCURED
>oo> >>1 :NOT_PROCURED
not_processed in_progress procured alternative_procured not_procured)
>oo> order-status (not_processed in_progress procured alternative_procured not_procured)
>o> helper6
2023-12-01T08:53:14.234Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
2023-12-01T08:53:14.234Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:53:14.235Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.235Z NX-41294 DEBUG [leihs.procurement.permissions.user:103] - (->> [viewer? inspector? admin?] (map (fn* [p1__39297#] (p1__39297# tx auth-entity))) (some true?)) => nil
>o> helper7 nil
>o> requests-base-query-with-state
>o> state-sql nil
>o> s-map  {:NEW [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]], :APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]], :PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]], :DENIED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]], :IN_APPROVAL [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]}
>o>map-4 (>o> map NEW
>o> map [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]]
:case >o> map NEW
[:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] >o> map APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]]
NEW >o> map APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] >o> map PARTIALLY_APPROVED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]]
APPROVED >o> map PARTIALLY_APPROVED
[:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] >o> map DENIED
>o> map [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]
PARTIALLY_APPROVED >o> map DENIED
[:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] >o> map IN_APPROVAL
>o> map [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]]
DENIED >o> map IN_APPROVAL
[:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
>o>map-5 (:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)
2023-12-01T08:53:14.236Z NX-41294 DEBUG [leihs.procurement.resources.request:171] - result => [[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]]
>o> join-and-nest-budget-periods
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id]]}
>o> tbl :procurement_budget_periods_2
>o> nest-key :budget_period
>o> join-and-nest-categories
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id]]}
>o> tbl :models
>o> nest-key :model
>o> join-and-nest-templates
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id]]}
>o> tbl :procurement_templates
>o> nest-key :template
>o> sqlmap {:select [[[:raw DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] NEW [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [
>oo>1pure-handler _> request, can contains invalid value in -> priority inspector_priority order_status[
[:row_to_json :procurement_templates]] :template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]], :from 
>oo>1pure-handler _> request {[:leihs-user-language :procurement_requests]{, :name English (UK), :left-join :locale en-GB, :default true, :active true}, (:authenticated-entity {:email amelia@rosenbaum.name, :models :contracts_count 0, :lastname [Kemmer, :org_id := :models.id :procurement_requests.model_id] nil, :procurement_templates :scope_read true, [:=:is_admin :procurement_templates.id :procurement_requests.template_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [ false, :procurement_budget_periods :authentication-method [:session, := :login nil, :procurement_budget_periods.id :scope_system_admin_write false, :procurement_requests.budget_period_id] :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :suppliers#time/instant "2023-12-01T08:52:56.948602Z"
, :id >o> nest-key :supplier
#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session >o> {join-and-nest-users:value 
5314d6a9-919b-4a06-82a6-8eba2b35b592}}>o> sqlmap {:select , [[:remote-addr [127.0.0.1:raw,  DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*]:start-time ] 183306307089208, [:params [[{}, :settings {:email_sending_enabled (false, :case [:or :sessions_max_lifetime_secs [:and [:< :procurement_budget_periods.end_date432000,  :current_date] :smtp_default_from_address your.lending.desk@example.com[, := :public_image_caching_enabled :procurement_requests.approved_quantitytrue,  :sessions_force_secure nilfalse, ]] :deliver_received_order_notifications [false, :< :external_base_url :current_date nil, :procurement_budget_periods.inspection_start_date]] :sessions_force_uniqueness false, NEW :email_signature Cheers,}, [:and :tx-next [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] APPROVED #[:and [:< next.jdbc.default_options.DefaultOptions:procurement_budget_periods.end_date :current_date] {[:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] :connectable [:> :procurement_requests.approved_quantity 0]]] PARTIALLY_APPROVED [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] DENIED [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] IN_APPROVAL)]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category]] [[[:row_to_json :models]] :model] [[:raw row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization]] [[[:row_to_json :procurement_templates]] #object[:template] [[:raw row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room]]com.zaxxer.hikari.HikariDataSource  [[[:row_to_json :suppliers]] :supplier]], :from [:procurement_requests], :left-join (:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id]), :order-by [[[:raw concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]]}
>o> tbl :users
>o> nest-key :user
>o> helper8
>oo> helper8 (not_processed in_progress procured alternative_procured not_procured) (low medium high mandatory) (normal high)
0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 534, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, >oo> enumsec-fetch-mode  cors, cache-control no-cache}, (:async-channel not_processed in_progress procured alternative_procured not_procured)
>o> apply-scope #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"
#object[org.httpkit.server.AsyncChannel 0x2398ca9f /127.0.0.1:3230<->/127.0.0.1:64227], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 534, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestFilters, :variables {}, :query query RequestFilters {
  budget_periods {
    id
    name
    inspection_start_date
    end_date
    __typename
  }
  main_categories {
    id
    name
    categories {
      id
      name
      __typename
    }
    __typename
  }
  organizations(root_only: true) {
    ...OrgProps
    organizations {
      ...OrgProps
      __typename
    }
    __typename
  }
}

fragment OrgProps on Organization {
  id
  name
  shortname
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-01T08:53:14.237Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.237Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
2023-12-01T08:53:14.237Z NX-41294 DEBUG [leihs.procurement.graphql:108] - result => {:data #ordered/map ([:budget_periods [nil]] [:main_categories [nil]] [:organizations [nil nil nil nil nil nil]]), :errors ({:message "Non-nullable field was null.", :locations [{:line 3, :column 5}], :path [:budget_periods 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 4, :column 5}], :path [:budget_periods 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 5, :column 5}], :path [:budget_periods 0 :inspection_start_date]} {:message "Non-nullable field was null.", :locations [{:line 6, :column 5}], :path [:budget_periods 0 :end_date]} {:message "Non-nullable field was null.", :locations [{:line 10, :column 5}], :path [:main_categories 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 11, :column 5}], :path [:main_categories 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 11 :name]})}
2023-12-01T08:53:14.238Z NX-41294 DEBUG [leihs.procurement.permissions.requests:26] - (-> sqlmap (sql/left-join :procurement_category_viewers [:= :procurement_category_viewers.category_id :procurement_requests.category_id]) (sql/where [:or [:= :procurement_category_viewers.user_id user-id] [:= :procurement_requests.user_id user-id]])) => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]] [[[(:case [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] "NEW" [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] "APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] "PARTIALLY_APPROVED" [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]] "DENIED" [:and [:>= :current_date :procurement_budget_periods.inspection_start_date] [:< :current_date :procurement_budget_periods.end_date]] "IN_APPROVAL")]] :state] [[[:row_to_json :procurement_budget_periods_2]] :budget_period] [[:raw "row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category"]] [[[:row_to_json :models]] :model] [[:raw "row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization"]] [[[:row_to_json :procurement_templates]] :template] [[:raw "row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room"]] [[[:row_to_json :suppliers]] :supplier] [[[:row_to_json :users]] :user]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id] :procurement_templates [:= :procurement_templates.id :procurement_requests.template_id] :suppliers [:= :suppliers.id :procurement_requests.supplier_id] :users [:= :users.id :procurement_requests.user_id] :procurement_category_viewers [:= :procurement_category_viewers.category_id :procurement_requests.category_id]], :order-by [[[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]], :join [:procurement_budget_periods [:= :procurement_budget_periods.id :procurement_requests.budget_period_id] [{:select [:* [[:> :current_date :end_date] :is_past]], :from [:procurement_budget_periods]} :procurement_budget_periods_2] [:= :procurement_budget_periods_2.id :procurement_requests.budget_period_id] :procurement_categories [:= :procurement_categories.id :procurement_requests.category_id] :procurement_main_categories [:= :procurement_main_categories.id :procurement_categories.main_category_id] :procurement_organizations [:= :procurement_organizations.id :procurement_requests.organization_id] [:procurement_organizations :procurement_departments] [:= :procurement_departments.id :procurement_organizations.parent_id] :rooms [:= :rooms.id :procurement_requests.room_id] :buildings [:= :buildings.id :rooms.building_id]], :where [:and [:in :procurement_requests.category_id ([:cast "7d5ba731-edd9-41ba-8773-7337d24c2327" :uuid])] [:in :procurement_requests.budget_period_id ([:cast "8b8fe440-cae5-4bf9-8048-d0ec2399faa1" :uuid])] [:in :procurement_requests.organization_id ([:cast "fb664326-a8ef-4556-af02-07d3127cd9ec" :uuid])] [:in :procurement_requests.priority ("normal" "high")] [:in :procurement_requests.inspector_priority ("low" "medium" "high" "mandatory")] [:or [:or [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity nil]] [:< :current_date :procurement_budget_periods.inspection_start_date]] [:and [:< :procurement_budget_periods.end_date :current_date] [:>= :procurement_requests.approved_quantity :procurement_requests.requested_quantity]] [:and [:< :procurement_budget_periods.end_date :current_date] [:and [:< :procurement_requests.approved_quantity :procurement_requests.requested_quantity] [:> :procurement_requests.approved_quantity 0]]] [:and [:< :procurement_budget_periods.end_date :current_date] [:= :procurement_requests.approved_quantity 0]]] [:in :procurement_requests.order_status ([[:cast "not_processed" :order_status_enum]] [[:cast "in_progress" :order_status_enum]] [[:cast "procured" :order_status_enum]] [[:cast "alternative_procured" :order_status_enum]] [[:cast "not_procured" :order_status_enum]])] [:or [:= :procurement_category_viewers.user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"] [:= :procurement_requests.user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]]]}
2023-12-01T08:53:14.238Z NX-41294 DEBUG [leihs.procurement.graphql:109] - {:data #ordered/map ([:budget_periods [nil]] [:main_categories [nil]] [:organizations [nil nil nil nil nil nil]]), :errors ({:message "Non-nullable field was null.", :locations [{:line 3, :column 5}], :path [:budget_periods 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 4, :column 5}], :path [:budget_periods 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 5, :column 5}], :path [:budget_periods 0 :inspection_start_date]} {:message "Non-nullable field was null.", :locations [{:line 6, :column 5}], :path [:budget_periods 0 :end_date]} {:message "Non-nullable field was null.", :locations [{:line 10, :column 5}], :path [:main_categories 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 11, :column 5}], :path [:main_categories 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 11 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 0 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 0 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 1 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 1 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 2 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 2 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 3 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 3 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 4 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 4 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 5 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 5 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 6 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 6 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 7 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 7 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 8 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 8 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 9 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 9 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 10 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 10 :name]} {:message "Non-nullable field was null.", :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 11 :id]} {:message "Non-nullable field was null.", :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 11 :name]})}

>o> ERROR 4pure-handler, result=> {:data #ordered/map ([:budget_periods [nil]] [:main_categories [nil]] [:organizations [nil nil nil nil nil nil]]), :errors ({:message Non-nullable field was null., :locations [{:line 3, :column 5}], :path [:budget_periods 0 :id]} {:message Non-nullable field was null., :locations [{:line 4, :column 5}], :path [:budget_periods 0 :name]} {:message Non-nullable field was null., :locations [{:line 5, :column 5}], :path [:budget_periods 0 :inspection_start_date]} {:message Non-nullable field was null., :locations [{:line 6, :column 5}], :path [:budget_periods 0 :end_date]} {:message Non-nullable field was null., :locations [{:line 10, :column 5}], :path [:main_categories 0 :id]} {:message Non-nullable field was null., :locations [{:line 11, :column 5}], :path [:main_categories 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 1 :name]} {:message Non-nullable field was null., :locations [>o> abc {:line 30, :column 3}], :path [:organizations 0 :organizations 2 :id]} {:message Non-nullable field was null., :locations [[{SELECT DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*, ((CASE WHEN ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?)) THEN ? WHEN (procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?) THEN ? WHEN (current_date >= procurement_budget_periods.inspection_start_date) AND (current_date < procurement_budget_periods.end_date) THEN ? END)) AS state, (ROW_TO_JSON(procurement_budget_periods_2)) AS budget_period, row_to_json(procurement_categories)::jsonb || jsonb_build_object('main_category', row_to_json(procurement_main_categories)) AS category, (ROW_TO_JSON(models)) AS model, row_to_json(procurement_organizations)::jsonb || jsonb_build_object('department', row_to_json(procurement_departments)) AS organization, (ROW_TO_JSON(procurement_templates)) AS template, row_to_json(rooms)::jsonb || jsonb_build_object('building', row_to_json(buildings)) AS room, (ROW_TO_JSON(suppliers)) AS supplier, (ROW_TO_JSON(users)) AS user FROM procurement_requests INNER JOIN procurement_budget_periods ON procurement_budget_periods.id = procurement_requests.budget_period_id INNER JOIN (SELECT *, current_date > end_date AS is_past FROM procurement_budget_periods) AS procurement_budget_periods_2 ON procurement_budget_periods_2.id = procurement_requests.budget_period_id INNER JOIN procurement_categories ON procurement_categories.id = procurement_requests.category_id INNER JOIN procurement_main_categories ON procurement_main_categories.id = procurement_categories.main_category_id INNER JOIN procurement_organizations ON procurement_organizations.id = procurement_requests.organization_id INNER JOIN procurement_organizations AS procurement_departments ON procurement_departments.id = procurement_organizations.parent_id INNER JOIN rooms ON rooms.id = procurement_requests.room_id INNER JOIN buildings ON buildings.id = rooms.building_id LEFT JOIN models ON models.id = procurement_requests.model_id LEFT JOIN procurement_templates ON procurement_templates.id = procurement_requests.template_id LEFT JOIN suppliers ON suppliers.id = procurement_requests.supplier_id LEFT JOIN users ON users.id = procurement_requests.user_id LEFT JOIN procurement_category_viewers ON procurement_category_viewers.category_id = procurement_requests.category_id WHERE (procurement_requests.category_id IN (CAST(? AS UUID))) AND (procurement_requests.budget_period_id IN (CAST(? AS UUID))) AND (procurement_requests.organization_id IN (CAST(? AS UUID))) AND (procurement_requests.priority IN (?, ?)) AND (procurement_requests.inspector_priority IN (?, ?, ?, ?)) AND ((((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity IS NULL)) OR (current_date < procurement_budget_periods.inspection_start_date)) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity >= procurement_requests.requested_quantity)) OR ((procurement_budget_periods.end_date < current_date) AND ((procurement_requests.approved_quantity < procurement_requests.requested_quantity) AND (procurement_requests.approved_quantity > ?))) OR ((procurement_budget_periods.end_date < current_date) AND (procurement_requests.approved_quantity = ?))) AND (procurement_requests.order_status IN ((CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)), (CAST(? AS ORDER_STATUS_ENUM)))) AND ((procurement_category_viewers.user_id = ?) OR (procurement_requests.user_id = ?)) ORDER BY concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, ''))) ASC :line 31NEW , :column 3}], :path [:organizations 0 :organizations APPROVED2 :name]}  {:message 0 Non-nullable field was null., PARTIALLY_APPROVED :locations 0 [DENIED IN_APPROVAL 7d5ba731-edd9-41ba-8773-7337d24c2327 8b8fe440-cae5-4bf9-8048-d0ec2399faa1 fb664326-a8ef-4556-af02-07d3127cd9ec {normal:line  30, high low medium:column  high mandatory3}],  :path 0 [:organizations 0 not_processed in_progress procured alternative_procured not_procured 0 :organizations 3 :id]} #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3" {#uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]:message Non-nullable field was null.
, :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 0 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 0 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [2023-12-01T08:53:14.239Z NX-41294 DEBUG [leihs.procurement.permissions.user:75] - query => ["SELECT TRUE AS has_entry FROM procurement_category_viewers WHERE user_id IS NULL"]
:organizations 1 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 1 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 1 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 2 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 2 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 9 :id]} {:message Non-nullable field was null., :locations2023-12-01T08:53:14.240Z NX-41294 DEBUG [leihs.procurement.permissions.user:56] - query => ["SELECT TRUE AS has_entry FROM procurement_category_inspectors WHERE user_id IS NULL"]
 [{:line 31, :column 3}], :path [:organizations 3 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 3 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 3 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 4 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 4 :organizations 11 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 0 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 0 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 1 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 1 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 2 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 2 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 3 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 3 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 4 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 4 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 5 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 5 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 6 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 6 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 7 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 7 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 8 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 8 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 9 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 9 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 10 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 10 :name]} {:message Non-nullable field was null., :locations [{:line 30, :column 3}], :path [:organizations 5 :organizations 11 :id]} {:message Non-nullable field was null., :locations [{:line 31, :column 3}], :path [:organizations 5 :organizations 11 :name]})}
2023-12-01T08:53:14.248Z NX-41294 DEBUG [leihs.procurement.permissions.user:24] - (-> (sql/select [true :has_entry]) (sql/from :procurement_admins) (sql/where [:= :user_id [:cast (:user_id auth-entity) :uuid]]) sql-format) => ["SELECT TRUE AS has_entry FROM procurement_admins WHERE user_id = CAST(? AS UUID)" #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3"]
2023-12-01T08:53:14.254Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:53:14.255Z NX-41294 DEBUG [leihs.procurement.permissions.user:103] - (->> [viewer? inspector? admin?] (map (fn* [p1__39297#] (p1__39297# tx auth-entity))) (some true?)) => nil
>o>requestsB2 ()
>o>dashboard-cache-keyB2 {:id 1608672852}
2023-12-01T08:53:14.264Z NX-41294 DEBUG [leihs.procurement.dashboard:265] - (count requests) => 0
>o> cache-key ({:id 1608672852})
2023-12-01T08:53:14.264Z NX-41294 DEBUG [leihs.procurement.dashboard:266] - (cache-key dashboard-cache-key) => 1608672852

>o> final-result () 


>o> final-result (json) [] 

2023-12-01T08:53:14.264Z NX-41294 DEBUG [leihs.procurement.dashboard:267] - (determine-budget-periods requests tx dashboard-cache-key main-cats bps) => ()

>oo>1pure-handler _> request, can contains invalid value in -> priority inspector_priority order_status

>oo>1pure-handler _> request {:leihs-user-language {:name English (UK), :locale en-GB, :default true, :active true}, :authenticated-entity {:email amelia@rosenbaum.name, :contracts_count 0, :lastname Kemmer, :org_id nil, :scope_read true, :is_admin false, :authentication-method :session, :login nil, :scope_system_admin_write false, :scope_write true, :firstname Dawna, :scope_admin_write false, :user_session_created_at #time/instant "2023-12-01T08:52:56.948602Z", :id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :user_session_id #uuid "c76911ad-5eff-4240-aafe-20154ffb8566", :scope_system_admin_read false, :access-rights (), :user_id #uuid "c00b7951-23c9-426e-b467-e44bca1f26e3", :is_system_admin false, :external_sign_out_url nil, :language_locale nil, :inventory_pool_roles_count 0, :scope_admin_read false}, :cookies {Idea-d8c89f6f {:value 5d06a449-7aaa-4285-b65a-53c2ae3cb299}, leihs-anti-csrf-token {:value 65184e75-5146-4915-8494-09445d034d15}, leihs-user-session {:value 5314d6a9-919b-4a06-82a6-8eba2b35b592}}, :remote-addr 127.0.0.1, :start-time 183306306934500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address your.lending.desk@example.com, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url nil, :sessions_force_uniqueness false, :email_signature Cheers,}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x15a94830 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x4370b2f7 next.jdbc.result_set$as_unqualified_lower_maps@4370b2f7]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie Idea-d8c89f6f=5d06a449-7aaa-4285-b65a-53c2ae3cb299; leihs-anti-csrf-token=65184e75-5146-4915-8494-09445d034d15; leihs-user-session=5314d6a9-919b-4a06-82a6-8eba2b35b592, content-length 4019, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, pragma no-cache, x-csrf-token 65184e75-5146-4915-8494-09445d034d15, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4c2cca3a /127.0.0.1:3230<->/127.0.0.1:63881], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0x3fa45ca5 HikariDataSource (db-pool)]}, :content-length 4019, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName RequestsIndexFiltered, :variables {:inspector_priority [LOW MEDIUM HIGH MANDATORY], :onlyOwnRequests false, :state [NEW APPROVED PARTIALLY_APPROVED DENIED], :order_status [NOT_PROCESSED IN_PROGRESS PROCURED ALTERNATIVE_PROCURED NOT_PROCURED], :search nil, :organizations [fb664326-a8ef-4556-af02-07d3127cd9ec], :categories [7d5ba731-edd9-41ba-8773-7337d24c2327], :priority [NORMAL HIGH], :budgetPeriods [8b8fe440-cae5-4bf9-8048-d0ec2399faa1]}, :query query RequestsIndexFiltered($budgetPeriods: [ID!], $categories: [ID!], $search: String, $state: [State!], $order_status: [OrderStatus], $organizations: [ID!], $priority: [Priority!], $inspector_priority: [InspectorPriority!], $onlyOwnRequests: Boolean) {
  dashboard(budget_period_id: $budgetPeriods, category_id: $categories, search: $search, state: $state, order_status: $order_status, organization_id: $organizations, priority: $priority, inspector_priority: $inspector_priority, requested_by_auth_user: $onlyOwnRequests) {
    cacheKey
    total_count
    budget_periods {
      id
      cacheKey
      name
      inspection_start_date
      end_date
      total_price_cents
      main_categories {
        id
        cacheKey
        name
        image_url
        total_price_cents
        categories {
          id
          cacheKey
          name
          total_price_cents
          requests {
            ...RequestFieldsForIndex
            total_price_cents
            actionPermissions {
              edit
              __typename
            }
            __typename
          }
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
}

fragment RequestFieldsForIndex on Request {
  id
  short_id
  user {
    value {
      id
      firstname
      lastname
      __typename
    }
    __typename
  }
  category {
    read
    write
    required
    value {
      id
      name
      main_category {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  budget_period {
    read
    write
    required
    value {
      name
      id
      __typename
    }
    __typename
  }
  article_name {
    value
    __typename
  }
  model {
    value {
      id
      product
      version
      __typename
    }
    __typename
  }
  receiver {
    value
    __typename
  }
  organization {
    value {
      id
      name
      shortname
      department {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  price_cents {
    value
    __typename
  }
  price_currency {
    value
    __typename
  }
  requested_quantity {
    read
    value
    __typename
  }
  approved_quantity {
    read
    value
    __typename
  }
  order_quantity {
    read
    value
    __typename
  }
  replacement {
    value
    __typename
  }
  priority {
    value
    __typename
  }
  state
  article_number {
    value
    __typename
  }
  supplier {
    value {
      name
      __typename
    }
    __typename
  }
  supplier_name {
    value
    __typename
  }
  receiver {
    value
    __typename
  }
  room {
    value {
      id
      name
      building {
        id
        name
        __typename
      }
      __typename
    }
    __typename
  }
  motivation {
    value
    __typename
  }
  inspection_comment {
    value
    __typename
  }
  inspector_priority {
    value
    __typename
  }
  accounting_type {
    value
    __typename
  }
  cost_center {
    value
    __typename
  }
  general_ledger_account {
    value
    __typename
  }
  procurement_account {
    value
    __typename
  }
  internal_order_number {
    value
    __typename
  }
  order_status {
    value
    __typename
  }
  order_comment {
    value
    __typename
  }
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x416b6015 leihs.procurement.graphql$handler@416b6015], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}
2023-12-01T08:53:14.267Z NX-41294 DEBUG [leihs.procurement.graphql:108] - result => {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey "1608672852"] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}

>o>3apure-handler, result=> {:data #ordered/map ([:dashboard #ordered/map ([:cacheKey 1608672852] [:total_count 0] [:budget_periods []] [:__typename :Dashboard])])}
2023-12-01T08:53:14.267Z NX-41294 DEBUG [leihs.core.anti-csrf.back:95] - anti-csrf-token-new => nil
2023-12-01T08:53:20.341Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:53:20.350Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:53:20.350Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - db-pool - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:53:20.359Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:53:20.359Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:53:20.360Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:53:50.355Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:53:50.356Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - db-pool - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:53:50.357Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - db-pool - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
2023-12-01T08:53:50.363Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - Before cleanup stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:53:50.364Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:414] - HikariPool-1 - After cleanup  stats (total=2, active=0, idle=2, waiting=0)
2023-12-01T08:53:50.364Z NX-41294 DEBUG [com.zaxxer.hikari.pool.HikariPool:521] - HikariPool-1 - Fill pool skipped, pool has sufficient level or currently being filled (queueDepth=0).
