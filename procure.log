# java_leihs-procure-server env check via asdf v0.13.1
# java_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_java_leihs-procure-server to force update
# clojure_leihs-procure-server env check via asdf v0.13.1
# clojure_leihs-procure-server env skipped update; touch .tool-versions or remove /var/folders/jl/49spzkdd2v3cdz37fgmp0ddr6cj76v/T/asdf_cache_clojure_leihs-procure-server to force update
Warning: environ value /Users/mradl/.asdf/installs/java/zulu-11.60.19 for key :java-home has been overwritten with /Users/mradl/.asdf/installs/java/zulu-11.60.19/zulu-11.jdk/Contents/Home
>o> conc concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))
2023-12-09T18:42:05.778Z NX-41294 DEBUG [leihs.procurement.resources.request:209] - (-> (sql/select [[:raw (str "DISTINCT ON (procurement_requests.id, " conc ") procurement_requests.*")]]) (sql/from :procurement_requests) (sql/left-join :models [:= :models.id :procurement_requests.model_id]) (sql/order-by :procurement_requests.id [[:raw conc]])) => {:select [[[:raw "DISTINCT ON (procurement_requests.id, concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))) procurement_requests.*"]]], :from [:procurement_requests], :left-join [:models [:= :models.id :procurement_requests.model_id]], :order-by [:procurement_requests.id [[:raw "concat(lower(coalesce(procurement_requests.article_name, '')), lower(coalesce(models.product, '')), lower(coalesce(models.version, '')))"]]]}
>o> templates::templates-base-query ERROR?
2023-12-09T18:42:05.838Z NX-41294 DEBUG [leihs.procurement.resources.templates:27] - (-> (sql/select :procurement_templates.*) (sql/from :procurement_templates) (sql/left-join :models [:= :models.id :procurement_templates.model_id]) (sql/order-by [[:concat (->> [:procurement_templates.article_name :models.product :models.version] (map (fn* [p1__44550#] (->> [:lower [:coalesce p1__44550# ""]]))))]])) => {:select [:procurement_templates.*], :from [:procurement_templates], :left-join [:models [:= :models.id :procurement_templates.model_id]], :order-by [[[:concat ([:lower [:coalesce :procurement_templates.article_name ""]] [:lower [:coalesce :models.product ""]] [:lower [:coalesce :models.version ""]])]]]}
2023-12-09T18:42:06.083Z NX-41294 WARN [leihs.core.release:13] - Failed to read releases.yml, returning bogus value 
2023-12-09T18:42:06.640Z NX-41294 INFO [leihs.core.logging:37] - initializing logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :log-level nil}
2023-12-09T18:42:06.643Z NX-41294 INFO [leihs.core.logging:39] - initialized logging  {:min-level [[#{"leihs.procurement" "leihs.procurement.resources.*" "leihs.procurement.permissions.*" "leihs.procurement.authorization" "leihs.procurement.*"} :debug] [#{"com.zaxxer.hikari.*" "leihs.*"} :info] [#{"*"} :warn]], :ns-filter #{"*"}, :middleware [], :timestamp-opts {:pattern :iso8601, :locale :jvm-default, :timezone :utc}, :output-fn #object[taoensso.timbre$default_output_fn 0x180b0347 "taoensso.timbre$default_output_fn@180b0347"], :appenders {:println {:enabled? true, :fn #object[taoensso.timbre.appenders.core$println_appender$fn__3459 0x3addfeec "taoensso.timbre.appenders.core$println_appender$fn__3459@3addfeec"]}}, :_init-config {:loaded-from-source :default, :compile-time-config {:min-level nil, :ns-pattern "*"}}, :log-level nil}
2023-12-09T18:42:06.645Z NX-41294 INFO [leihs.procurement.main:50] - main ("--dev-mode" "true" "--repl" "true" "run")
2023-12-09T18:42:06.656Z NX-41294 INFO [leihs.core.repl:62] - init {:dev-mode true, :repl true, :repl-bind "localhost", :repl-port 34930, :repl-port-file ".nrepl-port"}
2023-12-09T18:42:06.658Z NX-41294 INFO [leihs.core.repl:70] - starting nREPL server  34930 localhost
2023-12-09T18:42:06.679Z NX-41294 INFO [leihs.core.repl:75] - started nREPL server 
2023-12-09T18:42:06.682Z NX-41294 INFO [leihs.procurement.run:326] - Invoking run with options:  {:db-host localhost, :db-max-pool-size 16, :db-min-pool-size 2, :db-name leihs_test, :db-password leihs, :db-port 5415, :db-user leihs, :dev-mode true, :http-host localhost, :http-max-threads 8, :http-min-threads 1, :http-port 3230, :http-queue-capacity 640, :http-thread-keep-alive-seconds 10, :http-worker-prefix leihs-service-http-worker-, :pid-file nil, :repl true, :repl-bind localhost, :repl-port 34930, :repl-port-file .nrepl-port}
2023-12-09T18:42:06.682Z NX-41294 INFO [leihs.core.shutdown:20] - PID 9716
2023-12-09T18:42:06.695Z NX-41294 INFO [leihs.core.shutdown:29] - Registering SIGTERM handler for shutdown.
2023-12-09T18:42:06.759Z NX-41294 INFO [leihs.core.graphql:17] - Initialized graphQL schema.
2023-12-09T18:42:06.761Z NX-41294 INFO [leihs.core.db:220] - Initializing db  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-09T18:42:06.767Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:80] - db-pool - Starting...
2023-12-09T18:42:06.833Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - db-pool - Added connection org.postgresql.jdbc.PgConnection@70ac3c44
2023-12-09T18:42:06.839Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:82] - db-pool - Start completed.
2023-12-09T18:42:06.839Z NX-41294 INFO [leihs.core.db:222] - Initialized db  {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b "HikariDataSource (db-pool)"]}
2023-12-09T18:42:06.840Z NX-41294 INFO [leihs.core.db:223] - Initializing ds-next  {:db-name "leihs_test", :db-port 5415, :db-host "localhost", :db-user "leihs", :db-password "leihs", :db-min-pool-size 2, :db-max-pool-size 16}
2023-12-09T18:42:06.853Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:110] - HikariPool-1 - Starting...
2023-12-09T18:42:06.868Z NX-41294 INFO [com.zaxxer.hikari.pool.HikariPool:565] - HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@752fa174
2023-12-09T18:42:06.869Z NX-41294 INFO [com.zaxxer.hikari.HikariDataSource:123] - HikariPool-1 - Start completed.
2023-12-09T18:42:06.874Z NX-41294 INFO [leihs.core.db:225] - Initialized ds-next  #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 "HikariDataSource (HikariPool-1)"], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 "next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15"]}}
2023-12-09T18:42:06.882Z NX-41294 INFO [leihs.core.http-server:101] - starting http-server  {:port 3230, :ip "localhost", :pool {:queue #object[java.util.concurrent.ArrayBlockingQueue 0x4cf6f7d8 "[]"], :pool #object[java.util.concurrent.ThreadPoolExecutor 0x1aab9199 "java.util.concurrent.ThreadPoolExecutor@1aab9199[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]"]}}
2023-12-09T18:42:06.896Z NX-41294 INFO [leihs.core.http-server:104] - started http-server 
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224262124631541, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/requests, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x48781282 /127.0.0.1:3230<->/127.0.0.1:55197], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/admin/budget-periods, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x47d80331 leihs.procurement.backend.html$not_found_handler@47d80331], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.569Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.573Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.576Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.578Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.580Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.581Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.581Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.582Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224262452544500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x39b79d54 /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.844Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.845Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.846Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.847Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.848Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.849Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.850Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.851Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T18:42:13.857Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
2023-12-09T18:42:13.867Z NX-41294 DEBUG [leihs.procurement.resources.user:80] - id => #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
>o> >tocheck>
2023-12-09T18:42:13.868Z NX-41294 DEBUG [leihs.procurement.resources.user:?] - (sql-format (sql/where user-base-query [:= :id [:cast id :uuid]])) => ["SELECT id, firstname, lastname FROM users WHERE id = CAST(? AS UUID)" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>>>2 {:id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :firstname Manuel, :lastname Radl}
>>oida>> #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
2023-12-09T18:42:13.870Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.897Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.898Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

>request-grapql _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224262452544500, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x39b79d54 /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"Deutsch","locale":"de-CH","default":true,"active":true},"authenticated-entity":{"email":"manuel.radl@zhdk.ch","contracts_count":1,"lastname":"Radl","org_id":"271682","scope_read":true,"is_admin":true,"authentication-method":"session","login":"mradl","scope_system_admin_write":true,"scope_write":true,"firstname":"Manuel","scope_admin_write":true,"user_session_created_at":"2023-12-09T07:09:54.188679Z","id":"a786135f-c159-4618-9dd3-0012ebb3d500","user_session_id":"4d6070c4-5989-45bb-a1dc-1ee5409551ae","scope_system_admin_read":true,"access-rights":[{"role":"customer","inventory_pool_id":"3977012c-ce0e-501f-889b-8715fdb5d83b"},{"role":"customer","inventory_pool_id":"5863967f-9804-4909-a9b7-92254616d6b2"},{"role":"customer","inventory_pool_id":"5dd25b58-fa56-5095-bd97-2696d92c2fb1"},{"role":"customer","inventory_pool_id":"77e88ec8-9ff6-5435-818e-dc902fc631a6"},{"role":"inventory_manager","inventory_pool_id":"8bd16d45-056d-5590-bc7f-12849f034351"},{"role":"inventory_manager","inventory_pool_id":"a02b8163-9a16-5066-b48e-9eb74cf8b791"},{"role":"inventory_manager","inventory_pool_id":"b534b07c-d9bf-4572-840c-0a630b8cd8ed"},{"role":"customer","inventory_pool_id":"fc5a841e-36c6-5dc3-8207-1306c1fb89bf"},{"role":"customer","inventory_pool_id":"ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}],"user_id":"a786135f-c159-4618-9dd3-0012ebb3d500","is_system_admin":true,"external_sign_out_url":null,"language_locale":"de-CH","inventory_pool_roles_count":9,"scope_admin_read":true},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"9c7d0f0a-d4f8-419f-843b-2642a9e25659"}},"remote-addr":"127.0.0.1","start-time":224262452544500,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"noreply@zhdk.ch","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":"http:\/\/localhost:3200","sessions_force_uniqueness":false,"email_signature":"Das ZHdK-Ausleihe-Team"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659","content-length":"502","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/admin\/budget-periods","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"a786135f-c159-4618-9dd3-0012ebb3d500","firstname":"Manuel","lastname":"Radl","login":"mradl","email":"manuel.radl@zhdk.ch"}},"subApps":{"borrow":true,"admin":true,"procure":false,"manage":[{"name":"Ausleihe Toni-Areal","href":"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily"},{"name":"AVS-Museum/Ausstellungen","href":"/manage/b534b07c-d9bf-4572-840c-0a630b8cd8ed/daily"},{"name":"Kostüm- und Kleinrequisitenfundus DDK","href":"/manage/a02b8163-9a16-5066-b48e-9eb74cf8b791/daily"}]},"locales":[{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":true,"isSelected":true},{"name":"English","locale":"en-GB","active":true,"isDefault":false,"isSelected":false},{"name":"Castellano","locale":"es","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id a786135f-c159-4618-9dd3-0012ebb3d500] [:firstname Manuel] [:lastname Radl] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung] [:__typename :ProcurementSettings])])}
2023-12-09T18:42:13.912Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"a786135f-c159-4618-9dd3-0012ebb3d500\",\"firstname\":\"Manuel\",\"lastname\":\"Radl\",\"login\":\"mradl\",\"email\":\"manuel.radl@zhdk.ch\"}},\"subApps\":{\"borrow\":true,\"admin\":true,\"procure\":false,\"manage\":[{\"name\":\"Ausleihe Toni-Areal\",\"href\":\"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily\"},{\"name\":\"AVS-Museum/Ausstellungen\",\"href\":\"/manage/b534b07c-d9bf-4572-840c-0a630b8cd8ed/daily\"},{\"name\":\"Kostüm- und Kleinrequisitenfundus DDK\",\"href\":\"/manage/a02b8163-9a16-5066-b48e-9eb74cf8b791/daily\"}]},\"locales\":[{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Castellano\",\"locale\":\"es\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "a786135f-c159-4618-9dd3-0012ebb3d500"] [:firstname "Manuel"] [:lastname "Radl"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224262591313916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 376, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7516902d /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 376, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName AdminBudgetPeriods, :variables {}, :query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.945Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.946Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.947Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.948Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.949Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.949Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.949Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.950Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T18:42:13.953Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.965Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:13.968Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1a1dab20-c661-4204-a913-28065d570f7c" #uuid "1a1dab20-c661-4204-a913-28065d570f7c"]
2023-12-09T18:42:13.972Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.973Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:13.975Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:13.976Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:13.979Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.980Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> bp-id #uuid "1a1dab20-c661-4204-a913-28065d570f7c"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:13.981Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:13.981Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:13.983Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.984Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:13.985Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"]
2023-12-09T18:42:13.986Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.987Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:13.987Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:13.987Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:13.989Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.990Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> bp-id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:13.990Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:13.990Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:13.992Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.994Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:13.995Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"]
2023-12-09T18:42:13.996Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:13.997Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:13.997Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:13.997Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:13.999Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 70543100M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.000Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> bp-id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.000Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.000Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.002Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.003Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.003Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
2023-12-09T18:42:14.004Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.005Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.006Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.006Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.007Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 75250000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.009Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> bp-id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.009Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.009Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.011Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.011Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.012Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"]
2023-12-09T18:42:14.012Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.013Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.013Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.013Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.017Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.019Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> bp-id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.021Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.021Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.024Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 560501800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.025Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.025Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"]
2023-12-09T18:42:14.026Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.027Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.027Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.027Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.029Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.029Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> bp-id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.030Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.030Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.031Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.032Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.032Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"]
2023-12-09T18:42:14.033Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.034Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.034Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.034Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.036Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.036Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> bp-id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.037Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.037Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.038Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.038Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.039Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"]
2023-12-09T18:42:14.040Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.041Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.041Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.041Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.042Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.043Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> bp-id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.043Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.044Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.045Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.045Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.046Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"]
2023-12-09T18:42:14.047Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.047Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.047Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.047Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.049Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 0M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.049Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> bp-id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.050Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.050Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.052Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 680423900M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.052Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.053Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"]
2023-12-09T18:42:14.053Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.053Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.054Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.054Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.055Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.056Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> bp-id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.056Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.056Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.057Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.058Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.059Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "24171a61-aec6-428e-b7ed-7461b3795454" #uuid "24171a61-aec6-428e-b7ed-7461b3795454"]
2023-12-09T18:42:14.059Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.060Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.060Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.060Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.061Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.062Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> bp-id #uuid "24171a61-aec6-428e-b7ed-7461b3795454"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.062Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.062Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.064Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.064Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.065Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"]
2023-12-09T18:42:14.065Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.065Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.066Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.066Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.068Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.069Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> bp-id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.069Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.069Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.071Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 529743800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.072Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.072Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"]
2023-12-09T18:42:14.073Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.073Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.074Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.074Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.076Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 1000000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.076Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> bp-id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.077Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.077Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.079Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 612864300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.079Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.080Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"]
2023-12-09T18:42:14.081Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.081Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.081Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.082Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.083Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 2443000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.083Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> bp-id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.083Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.083Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.085Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 437361300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.085Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.086Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"]
2023-12-09T18:42:14.086Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.086Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.087Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.087Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.088Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 3658000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.089Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> bp-id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.089Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.089Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.090Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 17990000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.091Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.091Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"]
2023-12-09T18:42:14.092Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.093Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.094Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.094Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.095Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.095Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> bp-id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.095Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.096Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.097Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.097Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.098Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"]
2023-12-09T18:42:14.098Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.099Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.099Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.099Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.100Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.101Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> bp-id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.101Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.101Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.102Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.103Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.103Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"]
2023-12-09T18:42:14.104Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.104Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.105Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.105Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.106Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.106Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> bp-id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.106Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.106Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.108Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.108Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.109Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"]
2023-12-09T18:42:14.109Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.110Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.111Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.111Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.112Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.112Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> bp-id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.112Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.112Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.113Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.114Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.114Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"]
2023-12-09T18:42:14.115Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.115Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.116Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.116Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.117Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.118Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> bp-id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.118Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.118Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.121Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.122Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.122Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"]
2023-12-09T18:42:14.123Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.123Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.123Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.123Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.125Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 140000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.125Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> bp-id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.126Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.126Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.128Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 492786800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.128Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:14.129Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"]
2023-12-09T18:42:14.130Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.130Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:14.131Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:14.131Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.132Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:14.133Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> bp-id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:14.134Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:14.134Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:14.135Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil

>request-grapql _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224262591313916, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 376, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7516902d /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 376, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName AdminBudgetPeriods, :variables {}, :query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"Deutsch","locale":"de-CH","default":true,"active":true},"authenticated-entity":{"email":"manuel.radl@zhdk.ch","contracts_count":1,"lastname":"Radl","org_id":"271682","scope_read":true,"is_admin":true,"authentication-method":"session","login":"mradl","scope_system_admin_write":true,"scope_write":true,"firstname":"Manuel","scope_admin_write":true,"user_session_created_at":"2023-12-09T07:09:54.188679Z","id":"a786135f-c159-4618-9dd3-0012ebb3d500","user_session_id":"4d6070c4-5989-45bb-a1dc-1ee5409551ae","scope_system_admin_read":true,"access-rights":[{"role":"customer","inventory_pool_id":"3977012c-ce0e-501f-889b-8715fdb5d83b"},{"role":"customer","inventory_pool_id":"5863967f-9804-4909-a9b7-92254616d6b2"},{"role":"customer","inventory_pool_id":"5dd25b58-fa56-5095-bd97-2696d92c2fb1"},{"role":"customer","inventory_pool_id":"77e88ec8-9ff6-5435-818e-dc902fc631a6"},{"role":"inventory_manager","inventory_pool_id":"8bd16d45-056d-5590-bc7f-12849f034351"},{"role":"inventory_manager","inventory_pool_id":"a02b8163-9a16-5066-b48e-9eb74cf8b791"},{"role":"inventory_manager","inventory_pool_id":"b534b07c-d9bf-4572-840c-0a630b8cd8ed"},{"role":"customer","inventory_pool_id":"fc5a841e-36c6-5dc3-8207-1306c1fb89bf"},{"role":"customer","inventory_pool_id":"ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}],"user_id":"a786135f-c159-4618-9dd3-0012ebb3d500","is_system_admin":true,"external_sign_out_url":null,"language_locale":"de-CH","inventory_pool_roles_count":9,"scope_admin_read":true},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"9c7d0f0a-d4f8-419f-843b-2642a9e25659"}},"remote-addr":"127.0.0.1","start-time":224262591313916,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"noreply@zhdk.ch","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":"http:\/\/localhost:3200","sessions_force_uniqueness":false,"email_signature":"Das ZHdK-Ausleihe-Team"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659","content-length":"376","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/admin\/budget-periods","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":376,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"AdminBudgetPeriods","variables":{},"query":"query AdminBudgetPeriods {\n  budget_periods {\n    ...AdminBudgetPeriodProps\n    __typename\n  }\n}\n\nfragment AdminBudgetPeriodProps on BudgetPeriod {\n  id\n  name\n  inspection_start_date\n  end_date\n  can_delete\n  total_price_cents_new_requests\n  total_price_cents_inspected_requests\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 1a1dab20-c661-4204-a913-28065d570f7c] [:name 2028] [:inspection_start_date 2027-11-01 01:00:00.0] [:end_date 2027-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id dfdd0798-6462-46fc-995f-a7d7233f30fd] [:name 2027] [:inspection_start_date 2026-11-02 01:00:00.0] [:end_date 2026-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 6b689ed8-8148-485a-b1ca-86c1c739503e] [:name 2026] [:inspection_start_date 2025-11-03 01:00:00.0] [:end_date 2025-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 70543100] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b] [:name 2025] [:inspection_start_date 2024-11-04 01:00:00.0] [:end_date 2024-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 75250000] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f] [:name 2024] [:inspection_start_date 2023-10-01 12:00:00.0] [:end_date 2023-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 560501800] [:__typename :BudgetPeriod]) #ordered/map ([:id 3d4925fd-10ab-42b4-b1df-658ce998235f] [:name gggg] [:inspection_start_date 2023-12-09 18:19:22.335] [:end_date 2023-12-09 18:19:22.335] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3] [:name fffff] [:inspection_start_date 2023-12-09 18:18:03.611] [:end_date 2023-12-09 18:18:03.611] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 51c8704c-752c-4c61-bb6b-ae222344b98d] [:name eeee] [:inspection_start_date 2023-12-09 18:17:40.013] [:end_date 2023-12-09 18:17:40.013] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5] [:name 2023] [:inspection_start_date 2022-11-01 01:00:00.0] [:end_date 2022-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 680423900] [:__typename :BudgetPeriod]) #ordered/map ([:id 76b66d78-bfe0-4c54-8c92-edbf467af784] [:name 2022] [:inspection_start_date 2021-10-29 12:00:00.0] [:end_date 2021-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 24171a61-aec6-428e-b7ed-7461b3795454] [:name 2021] [:inspection_start_date 2020-10-26 12:00:00.0] [:end_date 2020-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 3b7eab1e-c8b5-512b-9146-91cc295be955] [:name 2020] [:inspection_start_date 2019-11-09 12:00:00.0] [:end_date 2019-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 529743800] [:__typename :BudgetPeriod]) #ordered/map ([:id 9fb023db-725d-5881-8838-bae3e970ffd0] [:name 2019] [:inspection_start_date 2018-11-10 01:00:00.0] [:end_date 2018-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 1000000] [:total_price_cents_inspected_requests 612864300] [:__typename :BudgetPeriod]) #ordered/map ([:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d] [:name 2018] [:inspection_start_date 2017-11-04 01:00:00.0] [:end_date 2017-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 2443000] [:total_price_cents_inspected_requests 437361300] [:__typename :BudgetPeriod]) #ordered/map ([:id 4f367b79-76cf-5f12-ab7b-535a7430e6da] [:name 2016] [:inspection_start_date 2016-11-01 01:00:00.0] [:end_date 2017-01-30 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 3658000] [:total_price_cents_inspected_requests 17990000] [:__typename :BudgetPeriod]) #ordered/map ([:id a8e5eb47-28e3-41d4-b896-e7d2719aad77] [:name abc] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id b6360017-2ed0-48f4-9659-5d8ef224dd31] [:name abc6] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3] [:name abc3] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 085bf144-7e53-48ef-beb4-ca2d0945e732] [:name abc2] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02] [:name abc4] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1] [:name 2017] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 140000] [:total_price_cents_inspected_requests 492786800] [:__typename :BudgetPeriod]) #ordered/map ([:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3] [:name abc5] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod])]])}
2023-12-09T18:42:14.142Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "1a1dab20-c661-4204-a913-28065d570f7c"] [:name "2028"] [:inspection_start_date "2027-11-01 01:00:00.0"] [:end_date "2027-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "dfdd0798-6462-46fc-995f-a7d7233f30fd"] [:name "2027"] [:inspection_start_date "2026-11-02 01:00:00.0"] [:end_date "2026-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "6b689ed8-8148-485a-b1ca-86c1c739503e"] [:name "2026"] [:inspection_start_date "2025-11-03 01:00:00.0"] [:end_date "2025-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "70543100"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b"] [:name "2025"] [:inspection_start_date "2024-11-04 01:00:00.0"] [:end_date "2024-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "75250000"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"] [:name "2024"] [:inspection_start_date "2023-10-01 12:00:00.0"] [:end_date "2023-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "560501800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3d4925fd-10ab-42b4-b1df-658ce998235f"] [:name "gggg"] [:inspection_start_date "2023-12-09 18:19:22.335"] [:end_date "2023-12-09 18:19:22.335"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"] [:name "fffff"] [:inspection_start_date "2023-12-09 18:18:03.611"] [:end_date "2023-12-09 18:18:03.611"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "51c8704c-752c-4c61-bb6b-ae222344b98d"] [:name "eeee"] [:inspection_start_date "2023-12-09 18:17:40.013"] [:end_date "2023-12-09 18:17:40.013"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"] [:name "2023"] [:inspection_start_date "2022-11-01 01:00:00.0"] [:end_date "2022-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "680423900"] [:__typename :BudgetPeriod]) #ordered/map ([:id "76b66d78-bfe0-4c54-8c92-edbf467af784"] [:name "2022"] [:inspection_start_date "2021-10-29 12:00:00.0"] [:end_date "2021-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "24171a61-aec6-428e-b7ed-7461b3795454"] [:name "2021"] [:inspection_start_date "2020-10-26 12:00:00.0"] [:end_date "2020-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3b7eab1e-c8b5-512b-9146-91cc295be955"] [:name "2020"] [:inspection_start_date "2019-11-09 12:00:00.0"] [:end_date "2019-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "529743800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "9fb023db-725d-5881-8838-bae3e970ffd0"] [:name "2019"] [:inspection_start_date "2018-11-10 01:00:00.0"] [:end_date "2018-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "1000000"] [:total_price_cents_inspected_requests "612864300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"] [:name "2018"] [:inspection_start_date "2017-11-04 01:00:00.0"] [:end_date "2017-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "2443000"] [:total_price_cents_inspected_requests "437361300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "4f367b79-76cf-5f12-ab7b-535a7430e6da"] [:name "2016"] [:inspection_start_date "2016-11-01 01:00:00.0"] [:end_date "2017-01-30 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "3658000"] [:total_price_cents_inspected_requests "17990000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "a8e5eb47-28e3-41d4-b896-e7d2719aad77"] [:name "abc"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "b6360017-2ed0-48f4-9659-5d8ef224dd31"] [:name "abc6"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"] [:name "abc3"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "085bf144-7e53-48ef-beb4-ca2d0945e732"] [:name "abc2"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"] [:name "abc4"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"] [:name "2017"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "140000"] [:total_price_cents_inspected_requests "492786800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"] [:name "abc5"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224272945693166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 3725, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68874885 /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x51097c40 HikariProxyConnection@1359576128 wrapping org.postgresql.jdbc.PgConnection@70ac3c44], :level 1, :rollback #object[clojure.lang.Atom 0x479106ba {:status :ready, :val false}]}, :content-length 3725, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName updateBudgetPeriods, :variables {:budgetPeriods [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}, :query mutation updateBudgetPeriods($budgetPeriods: [BudgetPeriodInput]) {
  budget_periods(input_data: $budgetPeriods) {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.343Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.344Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.345Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.345Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.346Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.346Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.347Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.347Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 1
2023-12-09T18:42:24.358Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query mutation updateBudgetPeriods($budgetPeriods: [BudgetPeriodInput]) {
  budget_periods(input_data: $budgetPeriods) {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
 with variables {:budgetPeriods [{:id "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name "abc5", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name "2017", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name "abc4", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "085bf144-7e53-48ef-beb4-ca2d0945e732", :name "abc2", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name "abc3", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name "abc6", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name "abc", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name "2016", :inspection_start_date "2016-11-01 01:00:00.0", :end_date "2017-01-30 01:00:00.0"} {:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name "2018", :inspection_start_date "2017-11-04 01:00:00.0", :end_date "2017-12-31 01:00:00.0"} {:id "9fb023db-725d-5881-8838-bae3e970ffd0", :name "2019", :inspection_start_date "2018-11-10 01:00:00.0", :end_date "2018-12-31 01:00:00.0"} {:id "3b7eab1e-c8b5-512b-9146-91cc295be955", :name "2020", :inspection_start_date "2019-11-09 12:00:00.0", :end_date "2019-12-31 01:00:00.0"} {:id "24171a61-aec6-428e-b7ed-7461b3795454", :name "2021", :inspection_start_date "2020-10-26 12:00:00.0", :end_date "2020-12-31 12:00:00.0"} {:id "76b66d78-bfe0-4c54-8c92-edbf467af784", :name "2022", :inspection_start_date "2021-10-29 12:00:00.0", :end_date "2021-12-31 12:00:00.0"} {:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name "2023", :inspection_start_date "2022-11-01 01:00:00.0", :end_date "2022-12-31 12:00:00.0"} {:id "51c8704c-752c-4c61-bb6b-ae222344b98d", :name "eeee", :inspection_start_date "2023-12-09 18:17:40.013", :end_date "2023-12-09 18:17:40.013"} {:id "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name "fffff", :inspection_start_date "2023-12-09 18:18:03.611", :end_date "2023-12-09 18:18:03.611"} {:id "3d4925fd-10ab-42b4-b1df-658ce998235f", :name "gggg", :inspection_start_date "2023-12-09 18:19:22.335", :end_date "2023-12-09 18:19:22.335"} {:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name "2024", :inspection_start_date "2023-10-01 12:00:00.0", :end_date "2023-12-31 01:00:00.0"} {:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name "2025", :inspection_start_date "2024-11-04 01:00:00.0", :end_date "2024-12-31 01:00:00.0"} {:id "6b689ed8-8148-485a-b1ca-86c1c739503e", :name "2026", :inspection_start_date "2025-11-03 01:00:00.0", :end_date "2025-12-31 01:00:00.0"} {:id "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name "2027", :inspection_start_date "2026-11-02 01:00:00.0", :end_date "2026-12-31 01:00:00.0"} {:id "1a1dab20-c661-4204-a913-28065d570f7c", :name "2028", :inspection_start_date "2027-11-01 01:00:00.0", :end_date "2027-12-31 01:00:00.0"} {:name "kkk", :inspection_start_date "2023-12-09T18:42:17.588Z", :end_date "2023-12-09T18:42:17.588Z"}]}
>oo> vars from graphQL-Requst nil nil nil {:budgetPeriods [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.368Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> update-budget-periods!
>oo> before bp-with-dates= {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:42:24.369Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]], :name "abc5", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.372Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" "abc5" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:42:24.377Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]], :name "2017", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.377Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" "2017" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:42:24.378Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]], :name "abc4", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.378Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" "abc4" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:42:24.378Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]], :name "abc2", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.379Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "085bf144-7e53-48ef-beb4-ca2d0945e732" "abc2" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "085bf144-7e53-48ef-beb4-ca2d0945e732"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:42:24.379Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]], :name "abc3", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.380Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" "abc3" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:42:24.380Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]], :name "abc6", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.380Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "b6360017-2ed0-48f4-9659-5d8ef224dd31" "abc6" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "b6360017-2ed0-48f4-9659-5d8ef224dd31"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:42:24.381Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]], :name "abc", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.381Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "a8e5eb47-28e3-41d4-b896-e7d2719aad77" "abc" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "a8e5eb47-28e3-41d4-b896-e7d2719aad77"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0}
>oo> after bp-with-dates= {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0}
2023-12-09T18:42:24.382Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]], :name "2016", :inspection_start_date [[:cast "2016-11-01 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-30 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.382Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "4f367b79-76cf-5f12-ab7b-535a7430e6da" "2016" "2016-11-01 01:00:00.0" "2017-01-30 01:00:00.0" "4f367b79-76cf-5f12-ab7b-535a7430e6da"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0}
2023-12-09T18:42:24.382Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]], :name "2018", :inspection_start_date [[:cast "2017-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.382Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" "2018" "2017-11-04 01:00:00.0" "2017-12-31 01:00:00.0" "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0}
2023-12-09T18:42:24.383Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]], :name "2019", :inspection_start_date [[:cast "2018-11-10 01:00:00.0" :timestamp]], :end_date [[:cast "2018-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.383Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "9fb023db-725d-5881-8838-bae3e970ffd0" "2019" "2018-11-10 01:00:00.0" "2018-12-31 01:00:00.0" "9fb023db-725d-5881-8838-bae3e970ffd0"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0}
2023-12-09T18:42:24.384Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]], :name "2020", :inspection_start_date [[:cast "2019-11-09 12:00:00.0" :timestamp]], :end_date [[:cast "2019-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.384Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "3b7eab1e-c8b5-512b-9146-91cc295be955" "2020" "2019-11-09 12:00:00.0" "2019-12-31 01:00:00.0" "3b7eab1e-c8b5-512b-9146-91cc295be955"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0}
>oo> after bp-with-dates= {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0}
>o> no / 22 / my-cast /debug  {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0}
2023-12-09T18:42:24.384Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]], :name "2021", :inspection_start_date [[:cast "2020-10-26 12:00:00.0" :timestamp]], :end_date [[:cast "2020-12-31 12:00:00.0" :timestamp]]}
2023-12-09T18:42:24.385Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "24171a61-aec6-428e-b7ed-7461b3795454" "2021" "2020-10-26 12:00:00.0" "2020-12-31 12:00:00.0" "24171a61-aec6-428e-b7ed-7461b3795454"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0}
>oo> after bp-with-dates= {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0}
>o> no / 22 / my-cast /debug  {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0}
2023-12-09T18:42:24.385Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]], :name "2022", :inspection_start_date [[:cast "2021-10-29 12:00:00.0" :timestamp]], :end_date [[:cast "2021-12-31 12:00:00.0" :timestamp]]}
2023-12-09T18:42:24.385Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "76b66d78-bfe0-4c54-8c92-edbf467af784" "2022" "2021-10-29 12:00:00.0" "2021-12-31 12:00:00.0" "76b66d78-bfe0-4c54-8c92-edbf467af784"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0}
>oo> after bp-with-dates= {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0}
>o> no / 22 / my-cast /debug  {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0}
2023-12-09T18:42:24.393Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]], :name "2023", :inspection_start_date [[:cast "2022-11-01 01:00:00.0" :timestamp]], :end_date [[:cast "2022-12-31 12:00:00.0" :timestamp]]}
2023-12-09T18:42:24.393Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" "2023" "2022-11-01 01:00:00.0" "2022-12-31 12:00:00.0" "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013}
>oo> after bp-with-dates= {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013}
>o> no / 22 / my-cast /debug  {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013}
2023-12-09T18:42:24.394Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]], :name "eeee", :inspection_start_date [[:cast "2023-12-09 18:17:40.013" :timestamp]], :end_date [[:cast "2023-12-09 18:17:40.013" :timestamp]]}
2023-12-09T18:42:24.394Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "51c8704c-752c-4c61-bb6b-ae222344b98d" "eeee" "2023-12-09 18:17:40.013" "2023-12-09 18:17:40.013" "51c8704c-752c-4c61-bb6b-ae222344b98d"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611}
>oo> after bp-with-dates= {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611}
>o> no / 22 / my-cast /debug  {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611}
2023-12-09T18:42:24.405Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]], :name "fffff", :inspection_start_date [[:cast "2023-12-09 18:18:03.611" :timestamp]], :end_date [[:cast "2023-12-09 18:18:03.611" :timestamp]]}
2023-12-09T18:42:24.405Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" "fffff" "2023-12-09 18:18:03.611" "2023-12-09 18:18:03.611" "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335}
>oo> after bp-with-dates= {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335}
>o> no / 22 / my-cast /debug  {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335}
2023-12-09T18:42:24.406Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]], :name "gggg", :inspection_start_date [[:cast "2023-12-09 18:19:22.335" :timestamp]], :end_date [[:cast "2023-12-09 18:19:22.335" :timestamp]]}
2023-12-09T18:42:24.406Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "3d4925fd-10ab-42b4-b1df-658ce998235f" "gggg" "2023-12-09 18:19:22.335" "2023-12-09 18:19:22.335" "3d4925fd-10ab-42b4-b1df-658ce998235f"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0}
2023-12-09T18:42:24.412Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]], :name "2024", :inspection_start_date [[:cast "2023-10-01 12:00:00.0" :timestamp]], :end_date [[:cast "2023-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.413Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" "2024" "2023-10-01 12:00:00.0" "2023-12-31 01:00:00.0" "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0}
2023-12-09T18:42:24.413Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]], :name "2025", :inspection_start_date [[:cast "2024-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2024-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.413Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "1173b482-b9e6-46b4-a5e3-0b021c860e9b" "2025" "2024-11-04 01:00:00.0" "2024-12-31 01:00:00.0" "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0}
2023-12-09T18:42:24.422Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]], :name "2026", :inspection_start_date [[:cast "2025-11-03 01:00:00.0" :timestamp]], :end_date [[:cast "2025-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.423Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "6b689ed8-8148-485a-b1ca-86c1c739503e" "2026" "2025-11-03 01:00:00.0" "2025-12-31 01:00:00.0" "6b689ed8-8148-485a-b1ca-86c1c739503e"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0}
2023-12-09T18:42:24.424Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]], :name "2027", :inspection_start_date [[:cast "2026-11-02 01:00:00.0" :timestamp]], :end_date [[:cast "2026-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.424Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "dfdd0798-6462-46fc-995f-a7d7233f30fd" "2027" "2026-11-02 01:00:00.0" "2026-12-31 01:00:00.0" "dfdd0798-6462-46fc-995f-a7d7233f30fd"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}
2023-12-09T18:42:24.432Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]], :name "2028", :inspection_start_date [[:cast "2027-11-01 01:00:00.0" :timestamp]], :end_date [[:cast "2027-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:42:24.432Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "1a1dab20-c661-4204-a913-28065d570f7c" "2028" "2027-11-01 01:00:00.0" "2027-12-31 01:00:00.0" "1a1dab20-c661-4204-a913-28065d570f7c"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}
>oo> after bp-with-dates= {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}
>o> no / 22 / my-cast /debug  {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}
2023-12-09T18:42:24.433Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:name "kkk", :inspection_start_date [[:cast "2023-12-09T18:42:17.588Z" :timestamp]], :end_date [[:cast "2023-12-09T18:42:17.588Z" :timestamp]]}
2023-12-09T18:42:24.436Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/values (sql/insert-into :procurement_budget_periods) [bp])) => ["INSERT INTO procurement_budget_periods (name, inspection_start_date, end_date) VALUES (?, (CAST(? AS TIMESTAMP)), (CAST(? AS TIMESTAMP)))" "kkk" "2023-12-09T18:42:17.588Z" "2023-12-09T18:42:17.588Z"]
>oo> superorsch args= {:input_data [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}
>oo> superorsch value= nil
>o> no / 22 / my-cast /debug  {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}
2023-12-09T18:42:24.441Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:name "kkk", :inspection_start_date [[:cast "2023-12-09T18:42:17.588Z" :timestamp]], :end_date [[:cast "2023-12-09T18:42:17.588Z" :timestamp]]}
2023-12-09T18:42:24.442Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:78] - (my-cast bp-map) => {:name "kkk", :inspection_start_date [[:cast "2023-12-09T18:42:17.588Z" :timestamp]], :end_date [[:cast "2023-12-09T18:42:17.588Z" :timestamp]]}
2023-12-09T18:42:24.443Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where budget-period-base-query where-clause)) => ["SELECT procurement_budget_periods.* FROM procurement_budget_periods WHERE (procurement_budget_periods.name = ?) AND (procurement_budget_periods.inspection_start_date IN (CAST(? AS TIMESTAMP))) AND (procurement_budget_periods.end_date IN (CAST(? AS TIMESTAMP)))" "kkk" "2023-12-09T18:42:17.588Z" "2023-12-09T18:42:17.588Z"]
2023-12-09T18:42:24.445Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:79] - (jdbc/execute! tx (-> budget-period-base-query (sql/where where-clause) sql-format spy)) => [{:id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6", :name "kkk", :inspection_start_date #inst "2023-12-09T17:42:17.588000000-00:00", :end_date #inst "2023-12-09T17:42:17.588000000-00:00", :created_at #inst "2023-12-09T18:42:24.320309000-00:00", :updated_at #inst "2023-12-09T18:42:24.320309000-00:00"}]
>o> query= [{:id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6", :name kkk, :inspection_start_date #inst "2023-12-09T17:42:17.588000000-00:00", :end_date #inst "2023-12-09T17:42:17.588000000-00:00", :created_at #inst "2023-12-09T18:42:24.320309000-00:00", :updated_at #inst "2023-12-09T18:42:24.320309000-00:00"}]
>o> result= {:id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6", :name kkk, :inspection_start_date #inst "2023-12-09T17:42:17.588000000-00:00", :end_date #inst "2023-12-09T17:42:17.588000000-00:00", :created_at #inst "2023-12-09T18:42:24.320309000-00:00", :updated_at #inst "2023-12-09T18:42:24.320309000-00:00"}
2023-12-09T18:42:24.447Z NX-41294 DEBUG [leihs.procurement.resources.budget-periods:?] - (sql-format (sql/where (sql/delete-from :procurement_budget_periods :pbp) [:not-in :pbp.id (cast-uuids ids)])) => ["DELETE FROM procurement_budget_periods AS pbp WHERE pbp.id NOT IN (CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID))" "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" "085bf144-7e53-48ef-beb4-ca2d0945e732" "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" "b6360017-2ed0-48f4-9659-5d8ef224dd31" "a8e5eb47-28e3-41d4-b896-e7d2719aad77" "4f367b79-76cf-5f12-ab7b-535a7430e6da" "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" "9fb023db-725d-5881-8838-bae3e970ffd0" "3b7eab1e-c8b5-512b-9146-91cc295be955" "24171a61-aec6-428e-b7ed-7461b3795454" "76b66d78-bfe0-4c54-8c92-edbf467af784" "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" "51c8704c-752c-4c61-bb6b-ae222344b98d" "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" "3d4925fd-10ab-42b4-b1df-658ce998235f" "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" "1173b482-b9e6-46b4-a5e3-0b021c860e9b" "6b689ed8-8148-485a-b1ca-86c1c739503e" "dfdd0798-6462-46fc-995f-a7d7233f30fd" "1a1dab20-c661-4204-a913-28065d570f7c" #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6"]
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.453Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.454Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1a1dab20-c661-4204-a913-28065d570f7c" #uuid "1a1dab20-c661-4204-a913-28065d570f7c"]
2023-12-09T18:42:24.455Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.455Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.456Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.456Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.458Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.461Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> bp-id #uuid "1a1dab20-c661-4204-a913-28065d570f7c"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.462Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.462Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.463Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.464Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.464Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"]
2023-12-09T18:42:24.465Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.472Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.473Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.473Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.475Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.476Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> bp-id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.477Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.477Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.481Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.482Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.482Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"]
2023-12-09T18:42:24.483Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.484Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.484Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.484Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.489Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 70543100M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.492Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> bp-id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.493Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.493Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.499Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.499Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.500Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
2023-12-09T18:42:24.501Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.501Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.503Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.504Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.505Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 75250000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.505Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> bp-id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.506Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.506Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.507Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.513Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.514Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"]
2023-12-09T18:42:24.514Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.515Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.515Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.515Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.519Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.522Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> bp-id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.522Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.522Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.524Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 560501800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.525Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.528Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6"]
2023-12-09T18:42:24.529Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.530Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6", :name kkk, :inspection_start_date #inst "2023-12-09T17:42:17.588000000-00:00", :end_date #inst "2023-12-09T17:42:17.588000000-00:00", :created_at #inst "2023-12-09T18:42:24.320309000-00:00", :updated_at #inst "2023-12-09T18:42:24.320309000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.530Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.530Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.531Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.533Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6", :name kkk, :inspection_start_date #inst "2023-12-09T17:42:17.588000000-00:00", :end_date #inst "2023-12-09T17:42:17.588000000-00:00", :created_at #inst "2023-12-09T18:42:24.320309000-00:00", :updated_at #inst "2023-12-09T18:42:24.320309000-00:00"}
>oo> bp-id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.533Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.533Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.537Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.538Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.539Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"]
2023-12-09T18:42:24.540Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.540Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.540Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.540Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.547Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.547Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> bp-id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.548Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.548Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.553Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.554Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.554Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"]
2023-12-09T18:42:24.555Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.555Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.556Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.556Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.560Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.561Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> bp-id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.561Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.561Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.563Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.564Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.564Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"]
2023-12-09T18:42:24.565Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.565Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.568Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.568Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.570Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.570Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> bp-id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.570Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.571Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.572Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.572Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.573Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"]
2023-12-09T18:42:24.573Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.573Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.576Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.576Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.578Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 0M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.579Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> bp-id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.579Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.579Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.584Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 680423900M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.585Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.585Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"]
2023-12-09T18:42:24.585Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.586Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.586Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.586Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.588Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.588Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> bp-id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.588Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.589Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.594Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.594Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.595Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "24171a61-aec6-428e-b7ed-7461b3795454" #uuid "24171a61-aec6-428e-b7ed-7461b3795454"]
2023-12-09T18:42:24.595Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.596Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.596Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.596Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.601Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.601Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> bp-id #uuid "24171a61-aec6-428e-b7ed-7461b3795454"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.602Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.602Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.603Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.604Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.604Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"]
2023-12-09T18:42:24.605Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.605Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.607Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.607Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.612Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.612Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> bp-id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.613Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.613Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.615Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 529743800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.616Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.616Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"]
2023-12-09T18:42:24.617Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.617Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.618Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.618Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.619Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 1000000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.619Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> bp-id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.620Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.620Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.622Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 612864300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.623Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.624Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"]
2023-12-09T18:42:24.626Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.627Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.627Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.627Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.631Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 2443000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.632Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> bp-id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.632Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.632Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.634Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 437361300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.636Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.637Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"]
2023-12-09T18:42:24.638Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.638Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.640Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.640Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.641Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 3658000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.641Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> bp-id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.642Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.642Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.643Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 17990000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.644Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.647Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"]
2023-12-09T18:42:24.649Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.649Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.649Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.649Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.651Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.651Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> bp-id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.651Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.651Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.653Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.653Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.653Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"]
2023-12-09T18:42:24.654Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.655Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.655Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.655Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.657Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.657Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> bp-id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.658Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.658Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.659Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.660Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.660Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"]
2023-12-09T18:42:24.661Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.661Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.662Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.662Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.664Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.665Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> bp-id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.665Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.665Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.667Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.667Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.668Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"]
2023-12-09T18:42:24.670Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.671Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.671Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.671Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.672Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.672Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> bp-id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.673Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.673Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.674Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.674Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.674Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"]
2023-12-09T18:42:24.675Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.675Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.677Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.678Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.679Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.679Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> bp-id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.680Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.680Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.681Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.681Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.682Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"]
2023-12-09T18:42:24.682Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.682Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.682Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.682Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.684Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 140000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.684Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> bp-id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.685Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.685Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.689Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 492786800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.689Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:24.690Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"]
2023-12-09T18:42:24.690Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.691Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:24.691Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:24.691Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.693Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.693Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> bp-id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:24.695Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:24.695Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:24.697Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil

>request-grapql _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224272945693166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x5e61fa12 HikariProxyConnection@1583479314 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 3725, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68874885 /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x51097c40 HikariProxyConnection@1359576128 wrapping org.postgresql.jdbc.PgConnection@70ac3c44], :level 2, :rollback #object[clojure.lang.Atom 0x479106ba {:status :ready, :val false}]}, :content-length 3725, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName updateBudgetPeriods, :variables {:budgetPeriods [{:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0} {:name kkk, :inspection_start_date 2023-12-09T18:42:17.588Z, :end_date 2023-12-09T18:42:17.588Z}]}, :query mutation updateBudgetPeriods($budgetPeriods: [BudgetPeriodInput]) {
  budget_periods(input_data: $budgetPeriods) {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"Deutsch","locale":"de-CH","default":true,"active":true},"authenticated-entity":{"email":"manuel.radl@zhdk.ch","contracts_count":1,"lastname":"Radl","org_id":"271682","scope_read":true,"is_admin":true,"authentication-method":"session","login":"mradl","scope_system_admin_write":true,"scope_write":true,"firstname":"Manuel","scope_admin_write":true,"user_session_created_at":"2023-12-09T07:09:54.188679Z","id":"a786135f-c159-4618-9dd3-0012ebb3d500","user_session_id":"4d6070c4-5989-45bb-a1dc-1ee5409551ae","scope_system_admin_read":true,"access-rights":[{"role":"customer","inventory_pool_id":"3977012c-ce0e-501f-889b-8715fdb5d83b"},{"role":"customer","inventory_pool_id":"5863967f-9804-4909-a9b7-92254616d6b2"},{"role":"customer","inventory_pool_id":"5dd25b58-fa56-5095-bd97-2696d92c2fb1"},{"role":"customer","inventory_pool_id":"77e88ec8-9ff6-5435-818e-dc902fc631a6"},{"role":"inventory_manager","inventory_pool_id":"8bd16d45-056d-5590-bc7f-12849f034351"},{"role":"inventory_manager","inventory_pool_id":"a02b8163-9a16-5066-b48e-9eb74cf8b791"},{"role":"inventory_manager","inventory_pool_id":"b534b07c-d9bf-4572-840c-0a630b8cd8ed"},{"role":"customer","inventory_pool_id":"fc5a841e-36c6-5dc3-8207-1306c1fb89bf"},{"role":"customer","inventory_pool_id":"ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}],"user_id":"a786135f-c159-4618-9dd3-0012ebb3d500","is_system_admin":true,"external_sign_out_url":null,"language_locale":"de-CH","inventory_pool_roles_count":9,"scope_admin_read":true},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"9c7d0f0a-d4f8-419f-843b-2642a9e25659"}},"remote-addr":"127.0.0.1","start-time":224272945693166,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"noreply@zhdk.ch","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":"http:\/\/localhost:3200","sessions_force_uniqueness":false,"email_signature":"Das ZHdK-Ausleihe-Team"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659","content-length":"3725","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/admin\/budget-periods","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":3725,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"updateBudgetPeriods","variables":{"budgetPeriods":[{"id":"da8e123d-45d3-4cc0-9f2d-9fd11141b6f3","name":"abc5","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"aba0576e-d65f-5fe0-aa80-89ce226ec9b1","name":"2017","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"2d73b11a-45b0-4d78-8fb3-611ce94a4a02","name":"abc4","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"085bf144-7e53-48ef-beb4-ca2d0945e732","name":"abc2","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"38b1bbd2-5dc8-4733-8f2e-339d3ae752c3","name":"abc3","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"b6360017-2ed0-48f4-9659-5d8ef224dd31","name":"abc6","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"a8e5eb47-28e3-41d4-b896-e7d2719aad77","name":"abc","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"4f367b79-76cf-5f12-ab7b-535a7430e6da","name":"2016","inspection_start_date":"2016-11-01 01:00:00.0","end_date":"2017-01-30 01:00:00.0"},{"id":"c2c5f618-7e05-5e43-a2b1-ec7f9172335d","name":"2018","inspection_start_date":"2017-11-04 01:00:00.0","end_date":"2017-12-31 01:00:00.0"},{"id":"9fb023db-725d-5881-8838-bae3e970ffd0","name":"2019","inspection_start_date":"2018-11-10 01:00:00.0","end_date":"2018-12-31 01:00:00.0"},{"id":"3b7eab1e-c8b5-512b-9146-91cc295be955","name":"2020","inspection_start_date":"2019-11-09 12:00:00.0","end_date":"2019-12-31 01:00:00.0"},{"id":"24171a61-aec6-428e-b7ed-7461b3795454","name":"2021","inspection_start_date":"2020-10-26 12:00:00.0","end_date":"2020-12-31 12:00:00.0"},{"id":"76b66d78-bfe0-4c54-8c92-edbf467af784","name":"2022","inspection_start_date":"2021-10-29 12:00:00.0","end_date":"2021-12-31 12:00:00.0"},{"id":"951ac476-4f92-4ff9-9f64-26fc8f8b61c5","name":"2023","inspection_start_date":"2022-11-01 01:00:00.0","end_date":"2022-12-31 12:00:00.0"},{"id":"51c8704c-752c-4c61-bb6b-ae222344b98d","name":"eeee","inspection_start_date":"2023-12-09 18:17:40.013","end_date":"2023-12-09 18:17:40.013"},{"id":"1b523473-a2e9-44f4-8fe0-75473ca6e2c3","name":"fffff","inspection_start_date":"2023-12-09 18:18:03.611","end_date":"2023-12-09 18:18:03.611"},{"id":"3d4925fd-10ab-42b4-b1df-658ce998235f","name":"gggg","inspection_start_date":"2023-12-09 18:19:22.335","end_date":"2023-12-09 18:19:22.335"},{"id":"e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f","name":"2024","inspection_start_date":"2023-10-01 12:00:00.0","end_date":"2023-12-31 01:00:00.0"},{"id":"1173b482-b9e6-46b4-a5e3-0b021c860e9b","name":"2025","inspection_start_date":"2024-11-04 01:00:00.0","end_date":"2024-12-31 01:00:00.0"},{"id":"6b689ed8-8148-485a-b1ca-86c1c739503e","name":"2026","inspection_start_date":"2025-11-03 01:00:00.0","end_date":"2025-12-31 01:00:00.0"},{"id":"dfdd0798-6462-46fc-995f-a7d7233f30fd","name":"2027","inspection_start_date":"2026-11-02 01:00:00.0","end_date":"2026-12-31 01:00:00.0"},{"id":"1a1dab20-c661-4204-a913-28065d570f7c","name":"2028","inspection_start_date":"2027-11-01 01:00:00.0","end_date":"2027-12-31 01:00:00.0"},{"name":"kkk","inspection_start_date":"2023-12-09T18:42:17.588Z","end_date":"2023-12-09T18:42:17.588Z"}]},"query":"mutation updateBudgetPeriods($budgetPeriods: [BudgetPeriodInput]) {\n  budget_periods(input_data: $budgetPeriods) {\n    ...AdminBudgetPeriodProps\n    __typename\n  }\n}\n\nfragment AdminBudgetPeriodProps on BudgetPeriod {\n  id\n  name\n  inspection_start_date\n  end_date\n  can_delete\n  total_price_cents_new_requests\n  total_price_cents_inspected_requests\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 1a1dab20-c661-4204-a913-28065d570f7c] [:name 2028] [:inspection_start_date 2027-11-01 01:00:00.0] [:end_date 2027-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id dfdd0798-6462-46fc-995f-a7d7233f30fd] [:name 2027] [:inspection_start_date 2026-11-02 01:00:00.0] [:end_date 2026-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 6b689ed8-8148-485a-b1ca-86c1c739503e] [:name 2026] [:inspection_start_date 2025-11-03 01:00:00.0] [:end_date 2025-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 70543100] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b] [:name 2025] [:inspection_start_date 2024-11-04 01:00:00.0] [:end_date 2024-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 75250000] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f] [:name 2024] [:inspection_start_date 2023-10-01 12:00:00.0] [:end_date 2023-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 560501800] [:__typename :BudgetPeriod]) #ordered/map ([:id 3f336e6d-1980-48f1-88e2-83eaaf68cff6] [:name kkk] [:inspection_start_date 2023-12-09 18:42:17.588] [:end_date 2023-12-09 18:42:17.588] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 3d4925fd-10ab-42b4-b1df-658ce998235f] [:name gggg] [:inspection_start_date 2023-12-09 18:19:22.335] [:end_date 2023-12-09 18:19:22.335] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3] [:name fffff] [:inspection_start_date 2023-12-09 18:18:03.611] [:end_date 2023-12-09 18:18:03.611] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 51c8704c-752c-4c61-bb6b-ae222344b98d] [:name eeee] [:inspection_start_date 2023-12-09 18:17:40.013] [:end_date 2023-12-09 18:17:40.013] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5] [:name 2023] [:inspection_start_date 2022-11-01 01:00:00.0] [:end_date 2022-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 680423900] [:__typename :BudgetPeriod]) #ordered/map ([:id 76b66d78-bfe0-4c54-8c92-edbf467af784] [:name 2022] [:inspection_start_date 2021-10-29 12:00:00.0] [:end_date 2021-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 24171a61-aec6-428e-b7ed-7461b3795454] [:name 2021] [:inspection_start_date 2020-10-26 12:00:00.0] [:end_date 2020-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 3b7eab1e-c8b5-512b-9146-91cc295be955] [:name 2020] [:inspection_start_date 2019-11-09 12:00:00.0] [:end_date 2019-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 529743800] [:__typename :BudgetPeriod]) #ordered/map ([:id 9fb023db-725d-5881-8838-bae3e970ffd0] [:name 2019] [:inspection_start_date 2018-11-10 01:00:00.0] [:end_date 2018-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 1000000] [:total_price_cents_inspected_requests 612864300] [:__typename :BudgetPeriod]) #ordered/map ([:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d] [:name 2018] [:inspection_start_date 2017-11-04 01:00:00.0] [:end_date 2017-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 2443000] [:total_price_cents_inspected_requests 437361300] [:__typename :BudgetPeriod]) #ordered/map ([:id 4f367b79-76cf-5f12-ab7b-535a7430e6da] [:name 2016] [:inspection_start_date 2016-11-01 01:00:00.0] [:end_date 2017-01-30 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 3658000] [:total_price_cents_inspected_requests 17990000] [:__typename :BudgetPeriod]) #ordered/map ([:id b6360017-2ed0-48f4-9659-5d8ef224dd31] [:name abc6] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3] [:name abc3] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 085bf144-7e53-48ef-beb4-ca2d0945e732] [:name abc2] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02] [:name abc4] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3] [:name abc5] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1] [:name 2017] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 140000] [:total_price_cents_inspected_requests 492786800] [:__typename :BudgetPeriod]) #ordered/map ([:id a8e5eb47-28e3-41d4-b896-e7d2719aad77] [:name abc] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod])]])}
2023-12-09T18:42:24.703Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "1a1dab20-c661-4204-a913-28065d570f7c"] [:name "2028"] [:inspection_start_date "2027-11-01 01:00:00.0"] [:end_date "2027-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "dfdd0798-6462-46fc-995f-a7d7233f30fd"] [:name "2027"] [:inspection_start_date "2026-11-02 01:00:00.0"] [:end_date "2026-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "6b689ed8-8148-485a-b1ca-86c1c739503e"] [:name "2026"] [:inspection_start_date "2025-11-03 01:00:00.0"] [:end_date "2025-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "70543100"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b"] [:name "2025"] [:inspection_start_date "2024-11-04 01:00:00.0"] [:end_date "2024-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "75250000"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"] [:name "2024"] [:inspection_start_date "2023-10-01 12:00:00.0"] [:end_date "2023-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "560501800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3f336e6d-1980-48f1-88e2-83eaaf68cff6"] [:name "kkk"] [:inspection_start_date "2023-12-09 18:42:17.588"] [:end_date "2023-12-09 18:42:17.588"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3d4925fd-10ab-42b4-b1df-658ce998235f"] [:name "gggg"] [:inspection_start_date "2023-12-09 18:19:22.335"] [:end_date "2023-12-09 18:19:22.335"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"] [:name "fffff"] [:inspection_start_date "2023-12-09 18:18:03.611"] [:end_date "2023-12-09 18:18:03.611"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "51c8704c-752c-4c61-bb6b-ae222344b98d"] [:name "eeee"] [:inspection_start_date "2023-12-09 18:17:40.013"] [:end_date "2023-12-09 18:17:40.013"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"] [:name "2023"] [:inspection_start_date "2022-11-01 01:00:00.0"] [:end_date "2022-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "680423900"] [:__typename :BudgetPeriod]) #ordered/map ([:id "76b66d78-bfe0-4c54-8c92-edbf467af784"] [:name "2022"] [:inspection_start_date "2021-10-29 12:00:00.0"] [:end_date "2021-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "24171a61-aec6-428e-b7ed-7461b3795454"] [:name "2021"] [:inspection_start_date "2020-10-26 12:00:00.0"] [:end_date "2020-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3b7eab1e-c8b5-512b-9146-91cc295be955"] [:name "2020"] [:inspection_start_date "2019-11-09 12:00:00.0"] [:end_date "2019-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "529743800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "9fb023db-725d-5881-8838-bae3e970ffd0"] [:name "2019"] [:inspection_start_date "2018-11-10 01:00:00.0"] [:end_date "2018-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "1000000"] [:total_price_cents_inspected_requests "612864300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"] [:name "2018"] [:inspection_start_date "2017-11-04 01:00:00.0"] [:end_date "2017-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "2443000"] [:total_price_cents_inspected_requests "437361300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "4f367b79-76cf-5f12-ab7b-535a7430e6da"] [:name "2016"] [:inspection_start_date "2016-11-01 01:00:00.0"] [:end_date "2017-01-30 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "3658000"] [:total_price_cents_inspected_requests "17990000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "b6360017-2ed0-48f4-9659-5d8ef224dd31"] [:name "abc6"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"] [:name "abc3"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "085bf144-7e53-48ef-beb4-ca2d0945e732"] [:name "abc2"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"] [:name "abc4"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"] [:name "abc5"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"] [:name "2017"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "140000"] [:total_price_cents_inspected_requests "492786800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "a8e5eb47-28e3-41d4-b896-e7d2719aad77"] [:name "abc"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod])]])}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224273390883166, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2e09ab32 /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/admin/budget-periods, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x47d80331 leihs.procurement.backend.html$not_found_handler@47d80331], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.741Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.742Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.743Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.743Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.744Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.744Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.744Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.745Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224273593879958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3ff787ec /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.949Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.952Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.954Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.955Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.955Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.956Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.956Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.958Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T18:42:24.962Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
2023-12-09T18:42:24.964Z NX-41294 DEBUG [leihs.procurement.resources.user:80] - id => #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
>o> >tocheck>
2023-12-09T18:42:24.964Z NX-41294 DEBUG [leihs.procurement.resources.user:?] - (sql-format (sql/where user-base-query [:= :id [:cast id :uuid]])) => ["SELECT id, firstname, lastname FROM users WHERE id = CAST(? AS UUID)" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>>>2 {:id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :firstname Manuel, :lastname Radl}
>>oida>> #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
2023-12-09T18:42:24.965Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.981Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:24.982Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

>request-grapql _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224273593879958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x3ff787ec /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"Deutsch","locale":"de-CH","default":true,"active":true},"authenticated-entity":{"email":"manuel.radl@zhdk.ch","contracts_count":1,"lastname":"Radl","org_id":"271682","scope_read":true,"is_admin":true,"authentication-method":"session","login":"mradl","scope_system_admin_write":true,"scope_write":true,"firstname":"Manuel","scope_admin_write":true,"user_session_created_at":"2023-12-09T07:09:54.188679Z","id":"a786135f-c159-4618-9dd3-0012ebb3d500","user_session_id":"4d6070c4-5989-45bb-a1dc-1ee5409551ae","scope_system_admin_read":true,"access-rights":[{"role":"customer","inventory_pool_id":"3977012c-ce0e-501f-889b-8715fdb5d83b"},{"role":"customer","inventory_pool_id":"5863967f-9804-4909-a9b7-92254616d6b2"},{"role":"customer","inventory_pool_id":"5dd25b58-fa56-5095-bd97-2696d92c2fb1"},{"role":"customer","inventory_pool_id":"77e88ec8-9ff6-5435-818e-dc902fc631a6"},{"role":"inventory_manager","inventory_pool_id":"8bd16d45-056d-5590-bc7f-12849f034351"},{"role":"inventory_manager","inventory_pool_id":"a02b8163-9a16-5066-b48e-9eb74cf8b791"},{"role":"inventory_manager","inventory_pool_id":"b534b07c-d9bf-4572-840c-0a630b8cd8ed"},{"role":"customer","inventory_pool_id":"fc5a841e-36c6-5dc3-8207-1306c1fb89bf"},{"role":"customer","inventory_pool_id":"ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}],"user_id":"a786135f-c159-4618-9dd3-0012ebb3d500","is_system_admin":true,"external_sign_out_url":null,"language_locale":"de-CH","inventory_pool_roles_count":9,"scope_admin_read":true},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"9c7d0f0a-d4f8-419f-843b-2642a9e25659"}},"remote-addr":"127.0.0.1","start-time":224273593879958,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"noreply@zhdk.ch","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":"http:\/\/localhost:3200","sessions_force_uniqueness":false,"email_signature":"Das ZHdK-Ausleihe-Team"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659","content-length":"502","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/admin\/budget-periods","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"a786135f-c159-4618-9dd3-0012ebb3d500","firstname":"Manuel","lastname":"Radl","login":"mradl","email":"manuel.radl@zhdk.ch"}},"subApps":{"borrow":true,"admin":true,"procure":false,"manage":[{"name":"Ausleihe Toni-Areal","href":"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily"},{"name":"AVS-Museum/Ausstellungen","href":"/manage/b534b07c-d9bf-4572-840c-0a630b8cd8ed/daily"},{"name":"Kostüm- und Kleinrequisitenfundus DDK","href":"/manage/a02b8163-9a16-5066-b48e-9eb74cf8b791/daily"}]},"locales":[{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":true,"isSelected":true},{"name":"English","locale":"en-GB","active":true,"isDefault":false,"isSelected":false},{"name":"Castellano","locale":"es","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id a786135f-c159-4618-9dd3-0012ebb3d500] [:firstname Manuel] [:lastname Radl] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung] [:__typename :ProcurementSettings])])}
2023-12-09T18:42:24.985Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"a786135f-c159-4618-9dd3-0012ebb3d500\",\"firstname\":\"Manuel\",\"lastname\":\"Radl\",\"login\":\"mradl\",\"email\":\"manuel.radl@zhdk.ch\"}},\"subApps\":{\"borrow\":true,\"admin\":true,\"procure\":false,\"manage\":[{\"name\":\"Ausleihe Toni-Areal\",\"href\":\"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily\"},{\"name\":\"AVS-Museum/Ausstellungen\",\"href\":\"/manage/b534b07c-d9bf-4572-840c-0a630b8cd8ed/daily\"},{\"name\":\"Kostüm- und Kleinrequisitenfundus DDK\",\"href\":\"/manage/a02b8163-9a16-5066-b48e-9eb74cf8b791/daily\"}]},\"locales\":[{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Castellano\",\"locale\":\"es\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "a786135f-c159-4618-9dd3-0012ebb3d500"] [:firstname "Manuel"] [:lastname "Radl"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224273663445791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 376, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68e1d15f /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 376, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName AdminBudgetPeriods, :variables {}, :query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.012Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.013Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.014Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.015Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.015Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.016Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.016Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.016Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T18:42:25.019Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.022Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.023Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1a1dab20-c661-4204-a913-28065d570f7c" #uuid "1a1dab20-c661-4204-a913-28065d570f7c"]
2023-12-09T18:42:25.024Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.024Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.025Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.025Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.027Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.027Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> bp-id #uuid "1a1dab20-c661-4204-a913-28065d570f7c"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.028Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.028Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.030Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.031Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.031Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"]
2023-12-09T18:42:25.032Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.032Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.032Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.032Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.034Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.034Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> bp-id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.034Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.034Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.036Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.036Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.037Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"]
2023-12-09T18:42:25.038Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.038Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.039Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.039Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.040Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 70543100M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.040Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> bp-id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.041Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.041Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.042Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.043Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.043Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
2023-12-09T18:42:25.044Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.046Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.048Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.048Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.053Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 75250000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.054Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> bp-id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.055Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.056Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.057Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.062Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.063Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"]
2023-12-09T18:42:25.064Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.065Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.065Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.065Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.067Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.067Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> bp-id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.068Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.068Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.070Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 560501800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.070Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.071Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6"]
2023-12-09T18:42:25.072Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.072Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6", :name kkk, :inspection_start_date #inst "2023-12-09T17:42:17.588000000-00:00", :end_date #inst "2023-12-09T17:42:17.588000000-00:00", :created_at #inst "2023-12-09T18:42:24.320309000-00:00", :updated_at #inst "2023-12-09T18:42:24.320309000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.072Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.072Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.074Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.074Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6", :name kkk, :inspection_start_date #inst "2023-12-09T17:42:17.588000000-00:00", :end_date #inst "2023-12-09T17:42:17.588000000-00:00", :created_at #inst "2023-12-09T18:42:24.320309000-00:00", :updated_at #inst "2023-12-09T18:42:24.320309000-00:00"}
>oo> bp-id #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.074Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.074Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3f336e6d-1980-48f1-88e2-83eaaf68cff6" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.075Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.075Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.076Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"]
2023-12-09T18:42:25.077Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.077Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.078Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.078Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.079Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.080Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> bp-id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.080Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.080Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.081Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.082Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.082Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"]
2023-12-09T18:42:25.083Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.083Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.084Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.084Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.087Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.088Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> bp-id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.088Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.089Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.090Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.090Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.091Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"]
2023-12-09T18:42:25.093Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.093Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.094Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.094Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.095Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.096Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> bp-id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.096Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.096Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.097Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.097Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.098Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"]
2023-12-09T18:42:25.098Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.098Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.098Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.098Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.099Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 0M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.099Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> bp-id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.101Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.101Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.102Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 680423900M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.103Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.103Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"]
2023-12-09T18:42:25.104Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.104Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.104Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.104Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.106Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.106Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> bp-id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.106Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.106Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.108Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.109Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.110Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "24171a61-aec6-428e-b7ed-7461b3795454" #uuid "24171a61-aec6-428e-b7ed-7461b3795454"]
2023-12-09T18:42:25.110Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.110Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.111Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.112Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.113Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.114Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> bp-id #uuid "24171a61-aec6-428e-b7ed-7461b3795454"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.114Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.114Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.115Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.115Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.117Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"]
2023-12-09T18:42:25.118Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.118Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.118Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.118Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.120Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.120Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> bp-id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.121Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.121Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.122Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 529743800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.122Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.123Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"]
2023-12-09T18:42:25.123Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.123Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.123Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.123Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.125Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 1000000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.125Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> bp-id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.126Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.126Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.127Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 612864300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.127Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.128Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"]
2023-12-09T18:42:25.128Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.129Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.129Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.129Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.130Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 2443000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.130Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> bp-id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.131Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.131Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.135Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 437361300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.135Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.136Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"]
2023-12-09T18:42:25.136Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.137Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.137Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.137Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.138Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 3658000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.138Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> bp-id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.139Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.139Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.140Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 17990000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.140Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.140Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"]
2023-12-09T18:42:25.141Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.143Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.143Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.143Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.144Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.145Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> bp-id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.145Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.145Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.146Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.148Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.149Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"]
2023-12-09T18:42:25.149Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.149Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.150Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.150Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.151Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.155Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> bp-id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.156Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.156Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.157Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.158Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.158Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"]
2023-12-09T18:42:25.159Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.160Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.161Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.161Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.162Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.162Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> bp-id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.163Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.163Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.164Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.166Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.166Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"]
2023-12-09T18:42:25.167Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.167Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.168Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.168Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.169Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.173Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> bp-id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.173Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.173Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.174Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.174Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.175Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"]
2023-12-09T18:42:25.176Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.178Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.178Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.178Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.179Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.180Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> bp-id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.180Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.180Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.181Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.183Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.184Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"]
2023-12-09T18:42:25.184Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.184Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.184Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.184Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.186Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 140000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.190Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> bp-id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.191Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.191Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.193Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 492786800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.193Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:42:25.194Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"]
2023-12-09T18:42:25.195Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.197Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:42:25.198Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:42:25.198Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.199Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:42:25.199Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> bp-id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:42:25.200Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:42:25.200Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:42:25.201Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil

>request-grapql _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224273663445791, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 376, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x68e1d15f /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 376, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName AdminBudgetPeriods, :variables {}, :query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"Deutsch","locale":"de-CH","default":true,"active":true},"authenticated-entity":{"email":"manuel.radl@zhdk.ch","contracts_count":1,"lastname":"Radl","org_id":"271682","scope_read":true,"is_admin":true,"authentication-method":"session","login":"mradl","scope_system_admin_write":true,"scope_write":true,"firstname":"Manuel","scope_admin_write":true,"user_session_created_at":"2023-12-09T07:09:54.188679Z","id":"a786135f-c159-4618-9dd3-0012ebb3d500","user_session_id":"4d6070c4-5989-45bb-a1dc-1ee5409551ae","scope_system_admin_read":true,"access-rights":[{"role":"customer","inventory_pool_id":"3977012c-ce0e-501f-889b-8715fdb5d83b"},{"role":"customer","inventory_pool_id":"5863967f-9804-4909-a9b7-92254616d6b2"},{"role":"customer","inventory_pool_id":"5dd25b58-fa56-5095-bd97-2696d92c2fb1"},{"role":"customer","inventory_pool_id":"77e88ec8-9ff6-5435-818e-dc902fc631a6"},{"role":"inventory_manager","inventory_pool_id":"8bd16d45-056d-5590-bc7f-12849f034351"},{"role":"inventory_manager","inventory_pool_id":"a02b8163-9a16-5066-b48e-9eb74cf8b791"},{"role":"inventory_manager","inventory_pool_id":"b534b07c-d9bf-4572-840c-0a630b8cd8ed"},{"role":"customer","inventory_pool_id":"fc5a841e-36c6-5dc3-8207-1306c1fb89bf"},{"role":"customer","inventory_pool_id":"ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}],"user_id":"a786135f-c159-4618-9dd3-0012ebb3d500","is_system_admin":true,"external_sign_out_url":null,"language_locale":"de-CH","inventory_pool_roles_count":9,"scope_admin_read":true},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"9c7d0f0a-d4f8-419f-843b-2642a9e25659"}},"remote-addr":"127.0.0.1","start-time":224273663445791,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"noreply@zhdk.ch","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":"http:\/\/localhost:3200","sessions_force_uniqueness":false,"email_signature":"Das ZHdK-Ausleihe-Team"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659","content-length":"376","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/admin\/budget-periods","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":376,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"AdminBudgetPeriods","variables":{},"query":"query AdminBudgetPeriods {\n  budget_periods {\n    ...AdminBudgetPeriodProps\n    __typename\n  }\n}\n\nfragment AdminBudgetPeriodProps on BudgetPeriod {\n  id\n  name\n  inspection_start_date\n  end_date\n  can_delete\n  total_price_cents_new_requests\n  total_price_cents_inspected_requests\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 1a1dab20-c661-4204-a913-28065d570f7c] [:name 2028] [:inspection_start_date 2027-11-01 01:00:00.0] [:end_date 2027-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id dfdd0798-6462-46fc-995f-a7d7233f30fd] [:name 2027] [:inspection_start_date 2026-11-02 01:00:00.0] [:end_date 2026-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 6b689ed8-8148-485a-b1ca-86c1c739503e] [:name 2026] [:inspection_start_date 2025-11-03 01:00:00.0] [:end_date 2025-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 70543100] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b] [:name 2025] [:inspection_start_date 2024-11-04 01:00:00.0] [:end_date 2024-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 75250000] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f] [:name 2024] [:inspection_start_date 2023-10-01 12:00:00.0] [:end_date 2023-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 560501800] [:__typename :BudgetPeriod]) #ordered/map ([:id 3f336e6d-1980-48f1-88e2-83eaaf68cff6] [:name kkk] [:inspection_start_date 2023-12-09 18:42:17.588] [:end_date 2023-12-09 18:42:17.588] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 3d4925fd-10ab-42b4-b1df-658ce998235f] [:name gggg] [:inspection_start_date 2023-12-09 18:19:22.335] [:end_date 2023-12-09 18:19:22.335] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3] [:name fffff] [:inspection_start_date 2023-12-09 18:18:03.611] [:end_date 2023-12-09 18:18:03.611] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 51c8704c-752c-4c61-bb6b-ae222344b98d] [:name eeee] [:inspection_start_date 2023-12-09 18:17:40.013] [:end_date 2023-12-09 18:17:40.013] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5] [:name 2023] [:inspection_start_date 2022-11-01 01:00:00.0] [:end_date 2022-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 680423900] [:__typename :BudgetPeriod]) #ordered/map ([:id 76b66d78-bfe0-4c54-8c92-edbf467af784] [:name 2022] [:inspection_start_date 2021-10-29 12:00:00.0] [:end_date 2021-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 24171a61-aec6-428e-b7ed-7461b3795454] [:name 2021] [:inspection_start_date 2020-10-26 12:00:00.0] [:end_date 2020-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 3b7eab1e-c8b5-512b-9146-91cc295be955] [:name 2020] [:inspection_start_date 2019-11-09 12:00:00.0] [:end_date 2019-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 529743800] [:__typename :BudgetPeriod]) #ordered/map ([:id 9fb023db-725d-5881-8838-bae3e970ffd0] [:name 2019] [:inspection_start_date 2018-11-10 01:00:00.0] [:end_date 2018-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 1000000] [:total_price_cents_inspected_requests 612864300] [:__typename :BudgetPeriod]) #ordered/map ([:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d] [:name 2018] [:inspection_start_date 2017-11-04 01:00:00.0] [:end_date 2017-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 2443000] [:total_price_cents_inspected_requests 437361300] [:__typename :BudgetPeriod]) #ordered/map ([:id 4f367b79-76cf-5f12-ab7b-535a7430e6da] [:name 2016] [:inspection_start_date 2016-11-01 01:00:00.0] [:end_date 2017-01-30 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 3658000] [:total_price_cents_inspected_requests 17990000] [:__typename :BudgetPeriod]) #ordered/map ([:id b6360017-2ed0-48f4-9659-5d8ef224dd31] [:name abc6] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3] [:name abc3] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 085bf144-7e53-48ef-beb4-ca2d0945e732] [:name abc2] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02] [:name abc4] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3] [:name abc5] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1] [:name 2017] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 140000] [:total_price_cents_inspected_requests 492786800] [:__typename :BudgetPeriod]) #ordered/map ([:id a8e5eb47-28e3-41d4-b896-e7d2719aad77] [:name abc] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod])]])}
2023-12-09T18:42:25.208Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "1a1dab20-c661-4204-a913-28065d570f7c"] [:name "2028"] [:inspection_start_date "2027-11-01 01:00:00.0"] [:end_date "2027-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "dfdd0798-6462-46fc-995f-a7d7233f30fd"] [:name "2027"] [:inspection_start_date "2026-11-02 01:00:00.0"] [:end_date "2026-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "6b689ed8-8148-485a-b1ca-86c1c739503e"] [:name "2026"] [:inspection_start_date "2025-11-03 01:00:00.0"] [:end_date "2025-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "70543100"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b"] [:name "2025"] [:inspection_start_date "2024-11-04 01:00:00.0"] [:end_date "2024-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "75250000"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"] [:name "2024"] [:inspection_start_date "2023-10-01 12:00:00.0"] [:end_date "2023-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "560501800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3f336e6d-1980-48f1-88e2-83eaaf68cff6"] [:name "kkk"] [:inspection_start_date "2023-12-09 18:42:17.588"] [:end_date "2023-12-09 18:42:17.588"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3d4925fd-10ab-42b4-b1df-658ce998235f"] [:name "gggg"] [:inspection_start_date "2023-12-09 18:19:22.335"] [:end_date "2023-12-09 18:19:22.335"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"] [:name "fffff"] [:inspection_start_date "2023-12-09 18:18:03.611"] [:end_date "2023-12-09 18:18:03.611"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "51c8704c-752c-4c61-bb6b-ae222344b98d"] [:name "eeee"] [:inspection_start_date "2023-12-09 18:17:40.013"] [:end_date "2023-12-09 18:17:40.013"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"] [:name "2023"] [:inspection_start_date "2022-11-01 01:00:00.0"] [:end_date "2022-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "680423900"] [:__typename :BudgetPeriod]) #ordered/map ([:id "76b66d78-bfe0-4c54-8c92-edbf467af784"] [:name "2022"] [:inspection_start_date "2021-10-29 12:00:00.0"] [:end_date "2021-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "24171a61-aec6-428e-b7ed-7461b3795454"] [:name "2021"] [:inspection_start_date "2020-10-26 12:00:00.0"] [:end_date "2020-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3b7eab1e-c8b5-512b-9146-91cc295be955"] [:name "2020"] [:inspection_start_date "2019-11-09 12:00:00.0"] [:end_date "2019-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "529743800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "9fb023db-725d-5881-8838-bae3e970ffd0"] [:name "2019"] [:inspection_start_date "2018-11-10 01:00:00.0"] [:end_date "2018-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "1000000"] [:total_price_cents_inspected_requests "612864300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"] [:name "2018"] [:inspection_start_date "2017-11-04 01:00:00.0"] [:end_date "2017-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "2443000"] [:total_price_cents_inspected_requests "437361300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "4f367b79-76cf-5f12-ab7b-535a7430e6da"] [:name "2016"] [:inspection_start_date "2016-11-01 01:00:00.0"] [:end_date "2017-01-30 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "3658000"] [:total_price_cents_inspected_requests "17990000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "b6360017-2ed0-48f4-9659-5d8ef224dd31"] [:name "abc6"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"] [:name "abc3"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "085bf144-7e53-48ef-beb4-ca2d0945e732"] [:name "abc2"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"] [:name "abc4"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"] [:name "abc5"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"] [:name "2017"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "140000"] [:total_price_cents_inspected_requests "492786800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "a8e5eb47-28e3-41d4-b896-e7d2719aad77"] [:name "abc"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod])]])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224324679541333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 3621, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x230ef692 /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x333808d2 HikariProxyConnection@859310290 wrapping org.postgresql.jdbc.PgConnection@70ac3c44], :level 1, :rollback #object[clojure.lang.Atom 0x52b5ac94 {:status :ready, :val false}]}, :content-length 3621, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName updateBudgetPeriods, :variables {:budgetPeriods [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}, :query mutation updateBudgetPeriods($budgetPeriods: [BudgetPeriodInput]) {
  budget_periods(input_data: $budgetPeriods) {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.040Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.044Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.044Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.044Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.044Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.045Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.045Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.045Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 1
2023-12-09T18:43:16.048Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query mutation updateBudgetPeriods($budgetPeriods: [BudgetPeriodInput]) {
  budget_periods(input_data: $budgetPeriods) {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
 with variables {:budgetPeriods [{:id "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name "abc", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name "2017", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name "abc5", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name "abc4", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "085bf144-7e53-48ef-beb4-ca2d0945e732", :name "abc2", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name "abc3", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name "abc6", :inspection_start_date "2016-11-04 01:00:00.0", :end_date "2017-01-22 01:00:00.0"} {:id "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name "2016", :inspection_start_date "2016-11-01 01:00:00.0", :end_date "2017-01-30 01:00:00.0"} {:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name "2018", :inspection_start_date "2017-11-04 01:00:00.0", :end_date "2017-12-31 01:00:00.0"} {:id "9fb023db-725d-5881-8838-bae3e970ffd0", :name "2019", :inspection_start_date "2018-11-10 01:00:00.0", :end_date "2018-12-31 01:00:00.0"} {:id "3b7eab1e-c8b5-512b-9146-91cc295be955", :name "2020", :inspection_start_date "2019-11-09 12:00:00.0", :end_date "2019-12-31 01:00:00.0"} {:id "24171a61-aec6-428e-b7ed-7461b3795454", :name "2021", :inspection_start_date "2020-10-26 12:00:00.0", :end_date "2020-12-31 12:00:00.0"} {:id "76b66d78-bfe0-4c54-8c92-edbf467af784", :name "2022", :inspection_start_date "2021-10-29 12:00:00.0", :end_date "2021-12-31 12:00:00.0"} {:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name "2023", :inspection_start_date "2022-11-01 01:00:00.0", :end_date "2022-12-31 12:00:00.0"} {:id "51c8704c-752c-4c61-bb6b-ae222344b98d", :name "eeee", :inspection_start_date "2023-12-09 18:17:40.013", :end_date "2023-12-09 18:17:40.013"} {:id "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name "fffff", :inspection_start_date "2023-12-09 18:18:03.611", :end_date "2023-12-09 18:18:03.611"} {:id "3d4925fd-10ab-42b4-b1df-658ce998235f", :name "gggg", :inspection_start_date "2023-12-09 18:19:22.335", :end_date "2023-12-09 18:19:22.335"} {:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name "2024", :inspection_start_date "2023-10-01 12:00:00.0", :end_date "2023-12-31 01:00:00.0"} {:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name "2025", :inspection_start_date "2024-11-04 01:00:00.0", :end_date "2024-12-31 01:00:00.0"} {:id "6b689ed8-8148-485a-b1ca-86c1c739503e", :name "2026", :inspection_start_date "2025-11-03 01:00:00.0", :end_date "2025-12-31 01:00:00.0"} {:id "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name "2027", :inspection_start_date "2026-11-02 01:00:00.0", :end_date "2026-12-31 01:00:00.0"} {:id "1a1dab20-c661-4204-a913-28065d570f7c", :name "2028", :inspection_start_date "2027-11-01 01:00:00.0", :end_date "2027-12-31 01:00:00.0"}]}
>oo> vars from graphQL-Requst nil nil nil {:budgetPeriods [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.053Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> update-budget-periods!
>oo> before bp-with-dates= {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:43:16.054Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]], :name "abc", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.054Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "a8e5eb47-28e3-41d4-b896-e7d2719aad77" "abc" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "a8e5eb47-28e3-41d4-b896-e7d2719aad77"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:43:16.055Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]], :name "2017", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.055Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" "2017" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:43:16.055Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]], :name "abc5", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.056Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" "abc5" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:43:16.056Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]], :name "abc4", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.056Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" "abc4" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:43:16.056Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]], :name "abc2", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.056Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "085bf144-7e53-48ef-beb4-ca2d0945e732" "abc2" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "085bf144-7e53-48ef-beb4-ca2d0945e732"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:43:16.057Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]], :name "abc3", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.057Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" "abc3" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>oo> after bp-with-dates= {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0}
2023-12-09T18:43:16.057Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]], :name "abc6", :inspection_start_date [[:cast "2016-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-22 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.057Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "b6360017-2ed0-48f4-9659-5d8ef224dd31" "abc6" "2016-11-04 01:00:00.0" "2017-01-22 01:00:00.0" "b6360017-2ed0-48f4-9659-5d8ef224dd31"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0}
>oo> after bp-with-dates= {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0}
2023-12-09T18:43:16.058Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]], :name "2016", :inspection_start_date [[:cast "2016-11-01 01:00:00.0" :timestamp]], :end_date [[:cast "2017-01-30 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.058Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "4f367b79-76cf-5f12-ab7b-535a7430e6da" "2016" "2016-11-01 01:00:00.0" "2017-01-30 01:00:00.0" "4f367b79-76cf-5f12-ab7b-535a7430e6da"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0}
2023-12-09T18:43:16.058Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]], :name "2018", :inspection_start_date [[:cast "2017-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2017-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.058Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" "2018" "2017-11-04 01:00:00.0" "2017-12-31 01:00:00.0" "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0}
2023-12-09T18:43:16.058Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]], :name "2019", :inspection_start_date [[:cast "2018-11-10 01:00:00.0" :timestamp]], :end_date [[:cast "2018-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.058Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "9fb023db-725d-5881-8838-bae3e970ffd0" "2019" "2018-11-10 01:00:00.0" "2018-12-31 01:00:00.0" "9fb023db-725d-5881-8838-bae3e970ffd0"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0}
2023-12-09T18:43:16.059Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]], :name "2020", :inspection_start_date [[:cast "2019-11-09 12:00:00.0" :timestamp]], :end_date [[:cast "2019-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.059Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "3b7eab1e-c8b5-512b-9146-91cc295be955" "2020" "2019-11-09 12:00:00.0" "2019-12-31 01:00:00.0" "3b7eab1e-c8b5-512b-9146-91cc295be955"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0}
>oo> after bp-with-dates= {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0}
>o> no / 22 / my-cast /debug  {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0}
2023-12-09T18:43:16.059Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]], :name "2021", :inspection_start_date [[:cast "2020-10-26 12:00:00.0" :timestamp]], :end_date [[:cast "2020-12-31 12:00:00.0" :timestamp]]}
2023-12-09T18:43:16.059Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "24171a61-aec6-428e-b7ed-7461b3795454" "2021" "2020-10-26 12:00:00.0" "2020-12-31 12:00:00.0" "24171a61-aec6-428e-b7ed-7461b3795454"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0}
>oo> after bp-with-dates= {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0}
>o> no / 22 / my-cast /debug  {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0}
2023-12-09T18:43:16.076Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]], :name "2022", :inspection_start_date [[:cast "2021-10-29 12:00:00.0" :timestamp]], :end_date [[:cast "2021-12-31 12:00:00.0" :timestamp]]}
2023-12-09T18:43:16.076Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "76b66d78-bfe0-4c54-8c92-edbf467af784" "2022" "2021-10-29 12:00:00.0" "2021-12-31 12:00:00.0" "76b66d78-bfe0-4c54-8c92-edbf467af784"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0}
>oo> after bp-with-dates= {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0}
>o> no / 22 / my-cast /debug  {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0}
2023-12-09T18:43:16.077Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]], :name "2023", :inspection_start_date [[:cast "2022-11-01 01:00:00.0" :timestamp]], :end_date [[:cast "2022-12-31 12:00:00.0" :timestamp]]}
2023-12-09T18:43:16.077Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" "2023" "2022-11-01 01:00:00.0" "2022-12-31 12:00:00.0" "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013}
>oo> after bp-with-dates= {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013}
>o> no / 22 / my-cast /debug  {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013}
2023-12-09T18:43:16.090Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]], :name "eeee", :inspection_start_date [[:cast "2023-12-09 18:17:40.013" :timestamp]], :end_date [[:cast "2023-12-09 18:17:40.013" :timestamp]]}
2023-12-09T18:43:16.091Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "51c8704c-752c-4c61-bb6b-ae222344b98d" "eeee" "2023-12-09 18:17:40.013" "2023-12-09 18:17:40.013" "51c8704c-752c-4c61-bb6b-ae222344b98d"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611}
>oo> after bp-with-dates= {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611}
>o> no / 22 / my-cast /debug  {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611}
2023-12-09T18:43:16.091Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]], :name "fffff", :inspection_start_date [[:cast "2023-12-09 18:18:03.611" :timestamp]], :end_date [[:cast "2023-12-09 18:18:03.611" :timestamp]]}
2023-12-09T18:43:16.092Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" "fffff" "2023-12-09 18:18:03.611" "2023-12-09 18:18:03.611" "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335}
>oo> after bp-with-dates= {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335}
>o> no / 22 / my-cast /debug  {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335}
2023-12-09T18:43:16.102Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]], :name "gggg", :inspection_start_date [[:cast "2023-12-09 18:19:22.335" :timestamp]], :end_date [[:cast "2023-12-09 18:19:22.335" :timestamp]]}
2023-12-09T18:43:16.103Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "3d4925fd-10ab-42b4-b1df-658ce998235f" "gggg" "2023-12-09 18:19:22.335" "2023-12-09 18:19:22.335" "3d4925fd-10ab-42b4-b1df-658ce998235f"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0}
2023-12-09T18:43:16.103Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]], :name "2024", :inspection_start_date [[:cast "2023-10-01 12:00:00.0" :timestamp]], :end_date [[:cast "2023-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.103Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" "2024" "2023-10-01 12:00:00.0" "2023-12-31 01:00:00.0" "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0}
2023-12-09T18:43:16.111Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]], :name "2025", :inspection_start_date [[:cast "2024-11-04 01:00:00.0" :timestamp]], :end_date [[:cast "2024-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.111Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "1173b482-b9e6-46b4-a5e3-0b021c860e9b" "2025" "2024-11-04 01:00:00.0" "2024-12-31 01:00:00.0" "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0}
2023-12-09T18:43:16.112Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]], :name "2026", :inspection_start_date [[:cast "2025-11-03 01:00:00.0" :timestamp]], :end_date [[:cast "2025-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.119Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "6b689ed8-8148-485a-b1ca-86c1c739503e" "2026" "2025-11-03 01:00:00.0" "2025-12-31 01:00:00.0" "6b689ed8-8148-485a-b1ca-86c1c739503e"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0}
2023-12-09T18:43:16.119Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]], :name "2027", :inspection_start_date [[:cast "2026-11-02 01:00:00.0" :timestamp]], :end_date [[:cast "2026-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.120Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "dfdd0798-6462-46fc-995f-a7d7233f30fd" "2027" "2026-11-02 01:00:00.0" "2026-12-31 01:00:00.0" "dfdd0798-6462-46fc-995f-a7d7233f30fd"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
>oo> before bp-with-dates= {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}
>oo> after bp-with-dates= {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}
>o> no / 22 / my-cast /debug  {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}
2023-12-09T18:43:16.128Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:45] - data => {:id [[:cast "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]], :name "2028", :inspection_start_date [[:cast "2027-11-01 01:00:00.0" :timestamp]], :end_date [[:cast "2027-12-31 01:00:00.0" :timestamp]]}
2023-12-09T18:43:16.128Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/where (sql/set (sql/update :procurement_budget_periods) bp) [:= :procurement_budget_periods.id (:id bp)])) => ["UPDATE procurement_budget_periods SET id = (CAST(? AS UUID)), name = ?, inspection_start_date = (CAST(? AS TIMESTAMP)), end_date = (CAST(? AS TIMESTAMP)) WHERE procurement_budget_periods.id = (CAST(? AS UUID))" "1a1dab20-c661-4204-a913-28065d570f7c" "2028" "2027-11-01 01:00:00.0" "2027-12-31 01:00:00.0" "1a1dab20-c661-4204-a913-28065d570f7c"]
>oo> superorsch args= {:input_data [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}
>oo> superorsch value= nil
2023-12-09T18:43:16.129Z NX-41294 DEBUG [leihs.procurement.resources.budget-periods:?] - (sql-format (sql/where (sql/delete-from :procurement_budget_periods :pbp) [:not-in :pbp.id (cast-uuids ids)])) => ["DELETE FROM procurement_budget_periods AS pbp WHERE pbp.id NOT IN (CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID), CAST(? AS UUID))" "a8e5eb47-28e3-41d4-b896-e7d2719aad77" "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" "085bf144-7e53-48ef-beb4-ca2d0945e732" "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" "b6360017-2ed0-48f4-9659-5d8ef224dd31" "4f367b79-76cf-5f12-ab7b-535a7430e6da" "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" "9fb023db-725d-5881-8838-bae3e970ffd0" "3b7eab1e-c8b5-512b-9146-91cc295be955" "24171a61-aec6-428e-b7ed-7461b3795454" "76b66d78-bfe0-4c54-8c92-edbf467af784" "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" "51c8704c-752c-4c61-bb6b-ae222344b98d" "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" "3d4925fd-10ab-42b4-b1df-658ce998235f" "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" "1173b482-b9e6-46b4-a5e3-0b021c860e9b" "6b689ed8-8148-485a-b1ca-86c1c739503e" "dfdd0798-6462-46fc-995f-a7d7233f30fd" "1a1dab20-c661-4204-a913-28065d570f7c"]
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.133Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.133Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1a1dab20-c661-4204-a913-28065d570f7c" #uuid "1a1dab20-c661-4204-a913-28065d570f7c"]
2023-12-09T18:43:16.136Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.136Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.137Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.137Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.138Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.138Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> bp-id #uuid "1a1dab20-c661-4204-a913-28065d570f7c"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.144Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.144Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.145Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.145Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.146Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"]
2023-12-09T18:43:16.147Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.147Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.147Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.152Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.153Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.153Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> bp-id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.154Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.154Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.155Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.155Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.155Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"]
2023-12-09T18:43:16.162Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.162Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.163Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.163Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.164Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 70543100M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.164Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> bp-id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.169Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.170Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.171Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.172Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.172Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
2023-12-09T18:43:16.172Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.173Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.173Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.177Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.179Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 75250000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.179Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> bp-id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.179Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.179Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.180Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.181Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.186Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"]
2023-12-09T18:43:16.186Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.186Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.186Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.186Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.188Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.188Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> bp-id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.194Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.194Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.196Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 560501800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.196Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.197Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"]
2023-12-09T18:43:16.198Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.198Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.198Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.203Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.204Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.204Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> bp-id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.205Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.205Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.206Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.206Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.208Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"]
2023-12-09T18:43:16.209Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.210Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.210Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.210Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.212Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.212Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> bp-id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.214Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.214Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.216Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.217Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.217Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"]
2023-12-09T18:43:16.218Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.218Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.218Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.219Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.220Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.220Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> bp-id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.220Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.220Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.221Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.221Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.225Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"]
2023-12-09T18:43:16.225Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.225Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.226Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.226Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.227Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 0M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.227Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> bp-id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.230Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.230Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.235Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 680423900M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.235Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.236Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"]
2023-12-09T18:43:16.236Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.236Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.237Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.237Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.239Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.240Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> bp-id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.240Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.240Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.242Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.242Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.242Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "24171a61-aec6-428e-b7ed-7461b3795454" #uuid "24171a61-aec6-428e-b7ed-7461b3795454"]
2023-12-09T18:43:16.243Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.243Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.243Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.243Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.244Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.244Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> bp-id #uuid "24171a61-aec6-428e-b7ed-7461b3795454"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.246Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.247Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.250Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.251Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.251Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"]
2023-12-09T18:43:16.251Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.252Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.264Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.264Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.268Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.269Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> bp-id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.269Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.269Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.270Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 529743800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.282Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.283Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"]
2023-12-09T18:43:16.283Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.284Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.284Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.284Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.285Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 1000000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.285Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> bp-id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.288Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.288Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.290Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 612864300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.290Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.291Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"]
2023-12-09T18:43:16.291Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.291Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.293Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.293Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.294Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 2443000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.294Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> bp-id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.294Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.294Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.297Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 437361300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.299Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.299Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"]
2023-12-09T18:43:16.299Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.300Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.300Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.300Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.302Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 3658000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.302Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> bp-id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.306Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.306Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.307Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 17990000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.308Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.308Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"]
2023-12-09T18:43:16.309Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.309Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.309Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.310Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.310Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.311Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> bp-id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.312Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.312Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.313Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.315Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.315Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"]
2023-12-09T18:43:16.316Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.316Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.316Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.317Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.318Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.318Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> bp-id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.321Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.321Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.322Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.323Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.323Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"]
2023-12-09T18:43:16.324Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.324Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.326Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.326Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.329Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.330Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> bp-id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.330Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.330Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.331Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.331Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.331Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"]
2023-12-09T18:43:16.332Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.332Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.332Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.332Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.333Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 140000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.334Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> bp-id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.337Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.337Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.339Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 492786800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.339Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.340Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"]
2023-12-09T18:43:16.341Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.341Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.347Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.347Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.349Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.349Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> bp-id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.349Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.349Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.350Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.352Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.352Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"]
2023-12-09T18:43:16.353Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.353Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.354Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.354Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.355Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.355Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> bp-id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.358Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.358Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.360Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.361Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.361Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"]
2023-12-09T18:43:16.361Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.362Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.362Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.362Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.363Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.363Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> bp-id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.364Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.364Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.364Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil

>request-grapql _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224324679541333, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x165703ab HikariProxyConnection@374801323 wrapping org.postgresql.jdbc.PgConnection@752fa174], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 3621, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x230ef692 /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)], :connection #object[com.zaxxer.hikari.pool.HikariProxyConnection 0x333808d2 HikariProxyConnection@859310290 wrapping org.postgresql.jdbc.PgConnection@70ac3c44], :level 2, :rollback #object[clojure.lang.Atom 0x52b5ac94 {:status :ready, :val false}]}, :content-length 3621, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName updateBudgetPeriods, :variables {:budgetPeriods [{:id a8e5eb47-28e3-41d4-b896-e7d2719aad77, :name abc, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1, :name 2017, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3, :name abc5, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02, :name abc4, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 085bf144-7e53-48ef-beb4-ca2d0945e732, :name abc2, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3, :name abc3, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id b6360017-2ed0-48f4-9659-5d8ef224dd31, :name abc6, :inspection_start_date 2016-11-04 01:00:00.0, :end_date 2017-01-22 01:00:00.0} {:id 4f367b79-76cf-5f12-ab7b-535a7430e6da, :name 2016, :inspection_start_date 2016-11-01 01:00:00.0, :end_date 2017-01-30 01:00:00.0} {:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d, :name 2018, :inspection_start_date 2017-11-04 01:00:00.0, :end_date 2017-12-31 01:00:00.0} {:id 9fb023db-725d-5881-8838-bae3e970ffd0, :name 2019, :inspection_start_date 2018-11-10 01:00:00.0, :end_date 2018-12-31 01:00:00.0} {:id 3b7eab1e-c8b5-512b-9146-91cc295be955, :name 2020, :inspection_start_date 2019-11-09 12:00:00.0, :end_date 2019-12-31 01:00:00.0} {:id 24171a61-aec6-428e-b7ed-7461b3795454, :name 2021, :inspection_start_date 2020-10-26 12:00:00.0, :end_date 2020-12-31 12:00:00.0} {:id 76b66d78-bfe0-4c54-8c92-edbf467af784, :name 2022, :inspection_start_date 2021-10-29 12:00:00.0, :end_date 2021-12-31 12:00:00.0} {:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5, :name 2023, :inspection_start_date 2022-11-01 01:00:00.0, :end_date 2022-12-31 12:00:00.0} {:id 51c8704c-752c-4c61-bb6b-ae222344b98d, :name eeee, :inspection_start_date 2023-12-09 18:17:40.013, :end_date 2023-12-09 18:17:40.013} {:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3, :name fffff, :inspection_start_date 2023-12-09 18:18:03.611, :end_date 2023-12-09 18:18:03.611} {:id 3d4925fd-10ab-42b4-b1df-658ce998235f, :name gggg, :inspection_start_date 2023-12-09 18:19:22.335, :end_date 2023-12-09 18:19:22.335} {:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f, :name 2024, :inspection_start_date 2023-10-01 12:00:00.0, :end_date 2023-12-31 01:00:00.0} {:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b, :name 2025, :inspection_start_date 2024-11-04 01:00:00.0, :end_date 2024-12-31 01:00:00.0} {:id 6b689ed8-8148-485a-b1ca-86c1c739503e, :name 2026, :inspection_start_date 2025-11-03 01:00:00.0, :end_date 2025-12-31 01:00:00.0} {:id dfdd0798-6462-46fc-995f-a7d7233f30fd, :name 2027, :inspection_start_date 2026-11-02 01:00:00.0, :end_date 2026-12-31 01:00:00.0} {:id 1a1dab20-c661-4204-a913-28065d570f7c, :name 2028, :inspection_start_date 2027-11-01 01:00:00.0, :end_date 2027-12-31 01:00:00.0}]}, :query mutation updateBudgetPeriods($budgetPeriods: [BudgetPeriodInput]) {
  budget_periods(input_data: $budgetPeriods) {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"Deutsch","locale":"de-CH","default":true,"active":true},"authenticated-entity":{"email":"manuel.radl@zhdk.ch","contracts_count":1,"lastname":"Radl","org_id":"271682","scope_read":true,"is_admin":true,"authentication-method":"session","login":"mradl","scope_system_admin_write":true,"scope_write":true,"firstname":"Manuel","scope_admin_write":true,"user_session_created_at":"2023-12-09T07:09:54.188679Z","id":"a786135f-c159-4618-9dd3-0012ebb3d500","user_session_id":"4d6070c4-5989-45bb-a1dc-1ee5409551ae","scope_system_admin_read":true,"access-rights":[{"role":"customer","inventory_pool_id":"3977012c-ce0e-501f-889b-8715fdb5d83b"},{"role":"customer","inventory_pool_id":"5863967f-9804-4909-a9b7-92254616d6b2"},{"role":"customer","inventory_pool_id":"5dd25b58-fa56-5095-bd97-2696d92c2fb1"},{"role":"customer","inventory_pool_id":"77e88ec8-9ff6-5435-818e-dc902fc631a6"},{"role":"inventory_manager","inventory_pool_id":"8bd16d45-056d-5590-bc7f-12849f034351"},{"role":"inventory_manager","inventory_pool_id":"a02b8163-9a16-5066-b48e-9eb74cf8b791"},{"role":"inventory_manager","inventory_pool_id":"b534b07c-d9bf-4572-840c-0a630b8cd8ed"},{"role":"customer","inventory_pool_id":"fc5a841e-36c6-5dc3-8207-1306c1fb89bf"},{"role":"customer","inventory_pool_id":"ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}],"user_id":"a786135f-c159-4618-9dd3-0012ebb3d500","is_system_admin":true,"external_sign_out_url":null,"language_locale":"de-CH","inventory_pool_roles_count":9,"scope_admin_read":true},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"9c7d0f0a-d4f8-419f-843b-2642a9e25659"}},"remote-addr":"127.0.0.1","start-time":224324679541333,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"noreply@zhdk.ch","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":"http:\/\/localhost:3200","sessions_force_uniqueness":false,"email_signature":"Das ZHdK-Ausleihe-Team"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659","content-length":"3621","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/admin\/budget-periods","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":3621,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"updateBudgetPeriods","variables":{"budgetPeriods":[{"id":"a8e5eb47-28e3-41d4-b896-e7d2719aad77","name":"abc","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"aba0576e-d65f-5fe0-aa80-89ce226ec9b1","name":"2017","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"da8e123d-45d3-4cc0-9f2d-9fd11141b6f3","name":"abc5","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"2d73b11a-45b0-4d78-8fb3-611ce94a4a02","name":"abc4","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"085bf144-7e53-48ef-beb4-ca2d0945e732","name":"abc2","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"38b1bbd2-5dc8-4733-8f2e-339d3ae752c3","name":"abc3","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"b6360017-2ed0-48f4-9659-5d8ef224dd31","name":"abc6","inspection_start_date":"2016-11-04 01:00:00.0","end_date":"2017-01-22 01:00:00.0"},{"id":"4f367b79-76cf-5f12-ab7b-535a7430e6da","name":"2016","inspection_start_date":"2016-11-01 01:00:00.0","end_date":"2017-01-30 01:00:00.0"},{"id":"c2c5f618-7e05-5e43-a2b1-ec7f9172335d","name":"2018","inspection_start_date":"2017-11-04 01:00:00.0","end_date":"2017-12-31 01:00:00.0"},{"id":"9fb023db-725d-5881-8838-bae3e970ffd0","name":"2019","inspection_start_date":"2018-11-10 01:00:00.0","end_date":"2018-12-31 01:00:00.0"},{"id":"3b7eab1e-c8b5-512b-9146-91cc295be955","name":"2020","inspection_start_date":"2019-11-09 12:00:00.0","end_date":"2019-12-31 01:00:00.0"},{"id":"24171a61-aec6-428e-b7ed-7461b3795454","name":"2021","inspection_start_date":"2020-10-26 12:00:00.0","end_date":"2020-12-31 12:00:00.0"},{"id":"76b66d78-bfe0-4c54-8c92-edbf467af784","name":"2022","inspection_start_date":"2021-10-29 12:00:00.0","end_date":"2021-12-31 12:00:00.0"},{"id":"951ac476-4f92-4ff9-9f64-26fc8f8b61c5","name":"2023","inspection_start_date":"2022-11-01 01:00:00.0","end_date":"2022-12-31 12:00:00.0"},{"id":"51c8704c-752c-4c61-bb6b-ae222344b98d","name":"eeee","inspection_start_date":"2023-12-09 18:17:40.013","end_date":"2023-12-09 18:17:40.013"},{"id":"1b523473-a2e9-44f4-8fe0-75473ca6e2c3","name":"fffff","inspection_start_date":"2023-12-09 18:18:03.611","end_date":"2023-12-09 18:18:03.611"},{"id":"3d4925fd-10ab-42b4-b1df-658ce998235f","name":"gggg","inspection_start_date":"2023-12-09 18:19:22.335","end_date":"2023-12-09 18:19:22.335"},{"id":"e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f","name":"2024","inspection_start_date":"2023-10-01 12:00:00.0","end_date":"2023-12-31 01:00:00.0"},{"id":"1173b482-b9e6-46b4-a5e3-0b021c860e9b","name":"2025","inspection_start_date":"2024-11-04 01:00:00.0","end_date":"2024-12-31 01:00:00.0"},{"id":"6b689ed8-8148-485a-b1ca-86c1c739503e","name":"2026","inspection_start_date":"2025-11-03 01:00:00.0","end_date":"2025-12-31 01:00:00.0"},{"id":"dfdd0798-6462-46fc-995f-a7d7233f30fd","name":"2027","inspection_start_date":"2026-11-02 01:00:00.0","end_date":"2026-12-31 01:00:00.0"},{"id":"1a1dab20-c661-4204-a913-28065d570f7c","name":"2028","inspection_start_date":"2027-11-01 01:00:00.0","end_date":"2027-12-31 01:00:00.0"}]},"query":"mutation updateBudgetPeriods($budgetPeriods: [BudgetPeriodInput]) {\n  budget_periods(input_data: $budgetPeriods) {\n    ...AdminBudgetPeriodProps\n    __typename\n  }\n}\n\nfragment AdminBudgetPeriodProps on BudgetPeriod {\n  id\n  name\n  inspection_start_date\n  end_date\n  can_delete\n  total_price_cents_new_requests\n  total_price_cents_inspected_requests\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 1a1dab20-c661-4204-a913-28065d570f7c] [:name 2028] [:inspection_start_date 2027-11-01 01:00:00.0] [:end_date 2027-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id dfdd0798-6462-46fc-995f-a7d7233f30fd] [:name 2027] [:inspection_start_date 2026-11-02 01:00:00.0] [:end_date 2026-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 6b689ed8-8148-485a-b1ca-86c1c739503e] [:name 2026] [:inspection_start_date 2025-11-03 01:00:00.0] [:end_date 2025-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 70543100] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b] [:name 2025] [:inspection_start_date 2024-11-04 01:00:00.0] [:end_date 2024-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 75250000] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f] [:name 2024] [:inspection_start_date 2023-10-01 12:00:00.0] [:end_date 2023-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 560501800] [:__typename :BudgetPeriod]) #ordered/map ([:id 3d4925fd-10ab-42b4-b1df-658ce998235f] [:name gggg] [:inspection_start_date 2023-12-09 18:19:22.335] [:end_date 2023-12-09 18:19:22.335] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3] [:name fffff] [:inspection_start_date 2023-12-09 18:18:03.611] [:end_date 2023-12-09 18:18:03.611] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 51c8704c-752c-4c61-bb6b-ae222344b98d] [:name eeee] [:inspection_start_date 2023-12-09 18:17:40.013] [:end_date 2023-12-09 18:17:40.013] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5] [:name 2023] [:inspection_start_date 2022-11-01 01:00:00.0] [:end_date 2022-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 680423900] [:__typename :BudgetPeriod]) #ordered/map ([:id 76b66d78-bfe0-4c54-8c92-edbf467af784] [:name 2022] [:inspection_start_date 2021-10-29 12:00:00.0] [:end_date 2021-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 24171a61-aec6-428e-b7ed-7461b3795454] [:name 2021] [:inspection_start_date 2020-10-26 12:00:00.0] [:end_date 2020-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 3b7eab1e-c8b5-512b-9146-91cc295be955] [:name 2020] [:inspection_start_date 2019-11-09 12:00:00.0] [:end_date 2019-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 529743800] [:__typename :BudgetPeriod]) #ordered/map ([:id 9fb023db-725d-5881-8838-bae3e970ffd0] [:name 2019] [:inspection_start_date 2018-11-10 01:00:00.0] [:end_date 2018-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 1000000] [:total_price_cents_inspected_requests 612864300] [:__typename :BudgetPeriod]) #ordered/map ([:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d] [:name 2018] [:inspection_start_date 2017-11-04 01:00:00.0] [:end_date 2017-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 2443000] [:total_price_cents_inspected_requests 437361300] [:__typename :BudgetPeriod]) #ordered/map ([:id 4f367b79-76cf-5f12-ab7b-535a7430e6da] [:name 2016] [:inspection_start_date 2016-11-01 01:00:00.0] [:end_date 2017-01-30 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 3658000] [:total_price_cents_inspected_requests 17990000] [:__typename :BudgetPeriod]) #ordered/map ([:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02] [:name abc4] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3] [:name abc5] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id a8e5eb47-28e3-41d4-b896-e7d2719aad77] [:name abc] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1] [:name 2017] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 140000] [:total_price_cents_inspected_requests 492786800] [:__typename :BudgetPeriod]) #ordered/map ([:id b6360017-2ed0-48f4-9659-5d8ef224dd31] [:name abc6] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3] [:name abc3] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 085bf144-7e53-48ef-beb4-ca2d0945e732] [:name abc2] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod])]])}
2023-12-09T18:43:16.378Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "1a1dab20-c661-4204-a913-28065d570f7c"] [:name "2028"] [:inspection_start_date "2027-11-01 01:00:00.0"] [:end_date "2027-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "dfdd0798-6462-46fc-995f-a7d7233f30fd"] [:name "2027"] [:inspection_start_date "2026-11-02 01:00:00.0"] [:end_date "2026-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "6b689ed8-8148-485a-b1ca-86c1c739503e"] [:name "2026"] [:inspection_start_date "2025-11-03 01:00:00.0"] [:end_date "2025-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "70543100"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b"] [:name "2025"] [:inspection_start_date "2024-11-04 01:00:00.0"] [:end_date "2024-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "75250000"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"] [:name "2024"] [:inspection_start_date "2023-10-01 12:00:00.0"] [:end_date "2023-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "560501800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3d4925fd-10ab-42b4-b1df-658ce998235f"] [:name "gggg"] [:inspection_start_date "2023-12-09 18:19:22.335"] [:end_date "2023-12-09 18:19:22.335"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"] [:name "fffff"] [:inspection_start_date "2023-12-09 18:18:03.611"] [:end_date "2023-12-09 18:18:03.611"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "51c8704c-752c-4c61-bb6b-ae222344b98d"] [:name "eeee"] [:inspection_start_date "2023-12-09 18:17:40.013"] [:end_date "2023-12-09 18:17:40.013"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"] [:name "2023"] [:inspection_start_date "2022-11-01 01:00:00.0"] [:end_date "2022-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "680423900"] [:__typename :BudgetPeriod]) #ordered/map ([:id "76b66d78-bfe0-4c54-8c92-edbf467af784"] [:name "2022"] [:inspection_start_date "2021-10-29 12:00:00.0"] [:end_date "2021-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "24171a61-aec6-428e-b7ed-7461b3795454"] [:name "2021"] [:inspection_start_date "2020-10-26 12:00:00.0"] [:end_date "2020-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3b7eab1e-c8b5-512b-9146-91cc295be955"] [:name "2020"] [:inspection_start_date "2019-11-09 12:00:00.0"] [:end_date "2019-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "529743800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "9fb023db-725d-5881-8838-bae3e970ffd0"] [:name "2019"] [:inspection_start_date "2018-11-10 01:00:00.0"] [:end_date "2018-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "1000000"] [:total_price_cents_inspected_requests "612864300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"] [:name "2018"] [:inspection_start_date "2017-11-04 01:00:00.0"] [:end_date "2017-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "2443000"] [:total_price_cents_inspected_requests "437361300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "4f367b79-76cf-5f12-ab7b-535a7430e6da"] [:name "2016"] [:inspection_start_date "2016-11-01 01:00:00.0"] [:end_date "2017-01-30 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "3658000"] [:total_price_cents_inspected_requests "17990000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"] [:name "abc4"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"] [:name "abc5"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "a8e5eb47-28e3-41d4-b896-e7d2719aad77"] [:name "abc"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"] [:name "2017"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "140000"] [:total_price_cents_inspected_requests "492786800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "b6360017-2ed0-48f4-9659-5d8ef224dd31"] [:name "abc6"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"] [:name "abc3"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "085bf144-7e53-48ef-beb4-ca2d0945e732"] [:name "abc2"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod])]])}
>>> authenticate::skip= nil  handler-key= :not-found
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224325064324958, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, sec-fetch-user ?1, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, upgrade-insecure-requests 1, pragma no-cache, accept text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest document, accept-encoding gzip, deflate, br, sec-fetch-mode navigate, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x2839407f /127.0.0.1:3230<->/127.0.0.1:55198], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 0, :form-params {}, :websocket? false, :query-params {}, :content-type nil, :form-params-raw {}, :character-encoding utf8, :uri /procure/admin/budget-periods, :server-name localhost, :handler-key :not-found, :query-string nil, :body nil, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.backend.html$not_found_handler 0x47d80331 leihs.procurement.backend.html$not_found_handler@47d80331], :multipart-params {}, :scheme :http, :request-method :get, :accept {:mime :html, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :not-found
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.411Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.412Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.413Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.413Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.413Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.413Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.414Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.414Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224325286972250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7dd5bece /127.0.0.1:3230<->/127.0.0.1:55197], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.634Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.635Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.635Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.636Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.636Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.636Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.637Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.637Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T18:43:16.639Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>>1 #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
2023-12-09T18:43:16.642Z NX-41294 DEBUG [leihs.procurement.resources.user:80] - id => #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
>o> >tocheck>
2023-12-09T18:43:16.642Z NX-41294 DEBUG [leihs.procurement.resources.user:?] - (sql-format (sql/where user-base-query [:= :id [:cast id :uuid]])) => ["SELECT id, firstname, lastname FROM users WHERE id = CAST(? AS UUID)" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>>>2 {:id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :firstname Manuel, :lastname Radl}
>>oida>> #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"
2023-12-09T18:43:16.643Z NX-41294 DEBUG [leihs.procurement.resources.saved-filters:19] - (-> (sql/select :*) (sql/from :procurement_users_filters) (sql/where [:= :user_id [:cast user-id :uuid]]) sql-format) => ["SELECT * FROM procurement_users_filters WHERE user_id = CAST(? AS UUID)" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>>>3 nil
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.652Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.652Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

>request-grapql _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224325286972250, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 502, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x7dd5bece /127.0.0.1:3230<->/127.0.0.1:55197], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 502, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName me, :variables {}, :query query me {
  current_user {
    navbarProps
    user {
      id
      firstname
      lastname
      permissions {
        isAdmin
        isRequester
        isInspectorForCategories {
          id
          __typename
        }
        isViewerForCategories {
          id
          __typename
        }
        __typename
      }
      __typename
    }
    __typename
  }
  settings {
    contact_url
    __typename
  }
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"Deutsch","locale":"de-CH","default":true,"active":true},"authenticated-entity":{"email":"manuel.radl@zhdk.ch","contracts_count":1,"lastname":"Radl","org_id":"271682","scope_read":true,"is_admin":true,"authentication-method":"session","login":"mradl","scope_system_admin_write":true,"scope_write":true,"firstname":"Manuel","scope_admin_write":true,"user_session_created_at":"2023-12-09T07:09:54.188679Z","id":"a786135f-c159-4618-9dd3-0012ebb3d500","user_session_id":"4d6070c4-5989-45bb-a1dc-1ee5409551ae","scope_system_admin_read":true,"access-rights":[{"role":"customer","inventory_pool_id":"3977012c-ce0e-501f-889b-8715fdb5d83b"},{"role":"customer","inventory_pool_id":"5863967f-9804-4909-a9b7-92254616d6b2"},{"role":"customer","inventory_pool_id":"5dd25b58-fa56-5095-bd97-2696d92c2fb1"},{"role":"customer","inventory_pool_id":"77e88ec8-9ff6-5435-818e-dc902fc631a6"},{"role":"inventory_manager","inventory_pool_id":"8bd16d45-056d-5590-bc7f-12849f034351"},{"role":"inventory_manager","inventory_pool_id":"a02b8163-9a16-5066-b48e-9eb74cf8b791"},{"role":"inventory_manager","inventory_pool_id":"b534b07c-d9bf-4572-840c-0a630b8cd8ed"},{"role":"customer","inventory_pool_id":"fc5a841e-36c6-5dc3-8207-1306c1fb89bf"},{"role":"customer","inventory_pool_id":"ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}],"user_id":"a786135f-c159-4618-9dd3-0012ebb3d500","is_system_admin":true,"external_sign_out_url":null,"language_locale":"de-CH","inventory_pool_roles_count":9,"scope_admin_read":true},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"9c7d0f0a-d4f8-419f-843b-2642a9e25659"}},"remote-addr":"127.0.0.1","start-time":224325286972250,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"noreply@zhdk.ch","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":"http:\/\/localhost:3200","sessions_force_uniqueness":false,"email_signature":"Das ZHdK-Ausleihe-Team"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659","content-length":"502","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/admin\/budget-periods","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":502,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"me","variables":{},"query":"query me {\n  current_user {\n    navbarProps\n    user {\n      id\n      firstname\n      lastname\n      permissions {\n        isAdmin\n        isRequester\n        isInspectorForCategories {\n          id\n          __typename\n        }\n        isViewerForCategories {\n          id\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n    __typename\n  }\n  settings {\n    contact_url\n    __typename\n  }\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps {"csrfToken":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","name":"csrf-token"},"config":{"appTitle":"leihs","appColor":"gray","me":{"user":{"id":"a786135f-c159-4618-9dd3-0012ebb3d500","firstname":"Manuel","lastname":"Radl","login":"mradl","email":"manuel.radl@zhdk.ch"}},"subApps":{"borrow":true,"admin":true,"procure":false,"manage":[{"name":"Ausleihe Toni-Areal","href":"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily"},{"name":"AVS-Museum/Ausstellungen","href":"/manage/b534b07c-d9bf-4572-840c-0a630b8cd8ed/daily"},{"name":"Kostüm- und Kleinrequisitenfundus DDK","href":"/manage/a02b8163-9a16-5066-b48e-9eb74cf8b791/daily"}]},"locales":[{"name":"Deutsch","locale":"de-CH","active":true,"isDefault":true,"isSelected":true},{"name":"English","locale":"en-GB","active":true,"isDefault":false,"isSelected":false},{"name":"Castellano","locale":"es","active":true,"isDefault":false,"isSelected":false},{"name":"Züritüütsch","locale":"gsw-CH","active":true,"isDefault":false,"isSelected":false}]}}] [:user #ordered/map ([:id a786135f-c159-4618-9dd3-0012ebb3d500] [:firstname Manuel] [:lastname Radl] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung] [:__typename :ProcurementSettings])])}
2023-12-09T18:43:16.656Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:current_user #ordered/map ([:navbarProps "{\"csrfToken\":{\"value\":\"dc7e186c-6046-4dce-9a37-5d14ea14e0e1\",\"name\":\"csrf-token\"},\"config\":{\"appTitle\":\"leihs\",\"appColor\":\"gray\",\"me\":{\"user\":{\"id\":\"a786135f-c159-4618-9dd3-0012ebb3d500\",\"firstname\":\"Manuel\",\"lastname\":\"Radl\",\"login\":\"mradl\",\"email\":\"manuel.radl@zhdk.ch\"}},\"subApps\":{\"borrow\":true,\"admin\":true,\"procure\":false,\"manage\":[{\"name\":\"Ausleihe Toni-Areal\",\"href\":\"/manage/8bd16d45-056d-5590-bc7f-12849f034351/daily\"},{\"name\":\"AVS-Museum/Ausstellungen\",\"href\":\"/manage/b534b07c-d9bf-4572-840c-0a630b8cd8ed/daily\"},{\"name\":\"Kostüm- und Kleinrequisitenfundus DDK\",\"href\":\"/manage/a02b8163-9a16-5066-b48e-9eb74cf8b791/daily\"}]},\"locales\":[{\"name\":\"Deutsch\",\"locale\":\"de-CH\",\"active\":true,\"isDefault\":true,\"isSelected\":true},{\"name\":\"English\",\"locale\":\"en-GB\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Castellano\",\"locale\":\"es\",\"active\":true,\"isDefault\":false,\"isSelected\":false},{\"name\":\"Züritüütsch\",\"locale\":\"gsw-CH\",\"active\":true,\"isDefault\":false,\"isSelected\":false}]}}"] [:user #ordered/map ([:id "a786135f-c159-4618-9dd3-0012ebb3d500"] [:firstname "Manuel"] [:lastname "Radl"] [:permissions #ordered/map ([:isAdmin true] [:isRequester false] [:isInspectorForCategories []] [:isViewerForCategories []] [:__typename :UserPermissions])] [:__typename :User])] [:__typename :CurrentUser])] [:settings #ordered/map ([:contact_url "https://intern.zhdk.ch/index.php?id=leihs_bedarfsermittlung"] [:__typename :ProcurementSettings])])}
>>> authenticate::skip= nil  handler-key= :graphql
>>> authenticate::authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}

>> authorize >

>> authorize::handler > #object[leihs.core.locale$wrap$fn__44850 0x6cf553a1 leihs.core.locale$wrap$fn__44850@6cf553a1]

>> authorize::request > {:authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224325334452875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 376, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4ef8c888 /127.0.0.1:3230<->/127.0.0.1:55197], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 376, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName AdminBudgetPeriods, :variables {}, :query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>> authorize::handler-key >> :graphql
>myprint>  authEnt? {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>myprint>  txn #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.680Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>myprint>  admin true
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.680Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>myprint>  inspector false
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.681Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>myprint>  viewer false
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.681Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}
>myprint>  requester false
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.681Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>o> inspector? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.681Z NX-41294 DEBUG [leihs.procurement.permissions.user:57] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_inspectors WHERE procurement_category_inspectors.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> inspector? {:result false}
>o> viewer? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.682Z NX-41294 DEBUG [leihs.procurement.permissions.user:80] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_category_viewers WHERE procurement_category_viewers.user_id = CAST(? AS UUID)) AS result" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> viewer? {:result false}
>o> requester?? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.682Z NX-41294 DEBUG [leihs.procurement.permissions.user:164] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_requesters_organizations WHERE procurement_requesters_organizations.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> requester?? {:exists false}

> 1 anti-csrf-token >  dc7e186c-6046-4dce-9a37-5d14ea14e0e1

> 1 anti-csrf-token class >  java.lang.String

> 2 anti-csrf-token-new >  nil
pure-handler >> 2
2023-12-09T18:43:16.684Z NX-41294 DEBUG [leihs.procurement.graphql:46] - graphql query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
 with variables {}
>oo> vars from graphQL-Requst nil nil nil {}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.686Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.686Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1a1dab20-c661-4204-a913-28065d570f7c" #uuid "1a1dab20-c661-4204-a913-28065d570f7c"]
2023-12-09T18:43:16.687Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.688Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.688Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.688Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.690Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.690Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1a1dab20-c661-4204-a913-28065d570f7c", :name 2028, :inspection_start_date #inst "2027-11-01T00:00:00.000000000-00:00", :end_date #inst "2027-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.539768000-00:00", :updated_at #inst "2018-09-18T04:45:19.539768000-00:00"}
>oo> bp-id #uuid "1a1dab20-c661-4204-a913-28065d570f7c"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.691Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.691Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1a1dab20-c661-4204-a913-28065d570f7c" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.693Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.693Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.694Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"]
2023-12-09T18:43:16.698Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.701Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.716Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.717Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.719Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.720Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd", :name 2027, :inspection_start_date #inst "2026-11-02T00:00:00.000000000-00:00", :end_date #inst "2026-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.536865000-00:00", :updated_at #inst "2018-09-18T04:45:19.536865000-00:00"}
>oo> bp-id #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.720Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.720Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "dfdd0798-6462-46fc-995f-a7d7233f30fd" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.721Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.722Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.723Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"]
2023-12-09T18:43:16.725Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.726Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.726Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.726Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.728Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 70543100M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.728Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e", :name 2026, :inspection_start_date #inst "2025-11-03T00:00:00.000000000-00:00", :end_date #inst "2025-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.533886000-00:00", :updated_at #inst "2018-09-18T04:45:19.533886000-00:00"}
>oo> bp-id #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.728Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.729Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "6b689ed8-8148-485a-b1ca-86c1c739503e" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.730Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.730Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.731Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"]
2023-12-09T18:43:16.731Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.732Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.732Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.732Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.733Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 75250000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.733Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b", :name 2025, :inspection_start_date #inst "2024-11-04T00:00:00.000000000-00:00", :end_date #inst "2024-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.530961000-00:00", :updated_at #inst "2018-09-18T04:45:19.530961000-00:00"}
>oo> bp-id #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.734Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.734Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1173b482-b9e6-46b4-a5e3-0b021c860e9b" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.735Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.735Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.735Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"]
2023-12-09T18:43:16.735Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.736Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.736Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.736Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.737Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.737Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f", :name 2024, :inspection_start_date #inst "2023-10-01T10:00:00.000000000-00:00", :end_date #inst "2023-12-31T00:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.527129000-00:00", :updated_at #inst "2018-09-18T04:45:19.527129000-00:00"}
>oo> bp-id #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.737Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.737Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.738Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 560501800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.739Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.739Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"]
2023-12-09T18:43:16.739Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.740Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.740Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.740Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.741Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.741Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f", :name gggg, :inspection_start_date #inst "2023-12-09T17:19:22.335000000-00:00", :end_date #inst "2023-12-09T17:19:22.335000000-00:00", :created_at #inst "2023-12-09T18:19:25.905566000-00:00", :updated_at #inst "2023-12-09T18:19:25.905566000-00:00"}
>oo> bp-id #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.741Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.741Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3d4925fd-10ab-42b4-b1df-658ce998235f" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.742Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.743Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.743Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"]
2023-12-09T18:43:16.743Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.744Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.744Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.744Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.745Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.745Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3", :name fffff, :inspection_start_date #inst "2023-12-09T17:18:03.611000000-00:00", :end_date #inst "2023-12-09T17:18:03.611000000-00:00", :created_at #inst "2023-12-09T18:18:06.889348000-00:00", :updated_at #inst "2023-12-09T18:18:06.889348000-00:00"}
>oo> bp-id #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.746Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.746Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "1b523473-a2e9-44f4-8fe0-75473ca6e2c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.746Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.747Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.747Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"]
2023-12-09T18:43:16.748Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.751Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.751Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.751Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.752Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.752Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d", :name eeee, :inspection_start_date #inst "2023-12-09T17:17:40.013000000-00:00", :end_date #inst "2023-12-09T17:17:40.013000000-00:00", :created_at #inst "2023-12-09T18:17:44.765500000-00:00", :updated_at #inst "2023-12-09T18:17:44.765500000-00:00"}
>oo> bp-id #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.752Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.752Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "51c8704c-752c-4c61-bb6b-ae222344b98d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.753Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.761Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.762Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"]
2023-12-09T18:43:16.763Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.763Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.764Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.764Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.765Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 0M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.767Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5", :name 2023, :inspection_start_date #inst "2022-11-01T00:00:00.000000000-00:00", :end_date #inst "2022-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.520406000-00:00", :updated_at #inst "2018-09-18T04:45:19.520406000-00:00"}
>oo> bp-id #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.768Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.768Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "951ac476-4f92-4ff9-9f64-26fc8f8b61c5" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.769Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 680423900M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.769Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.770Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"]
2023-12-09T18:43:16.770Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.770Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.772Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.772Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.773Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.773Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784", :name 2022, :inspection_start_date #inst "2021-10-29T10:00:00.000000000-00:00", :end_date #inst "2021-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:45:19.514258000-00:00", :updated_at #inst "2018-09-18T04:45:19.514258000-00:00"}
>oo> bp-id #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.774Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.774Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "76b66d78-bfe0-4c54-8c92-edbf467af784" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.775Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.778Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.778Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "24171a61-aec6-428e-b7ed-7461b3795454" #uuid "24171a61-aec6-428e-b7ed-7461b3795454"]
2023-12-09T18:43:16.778Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.778Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.779Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.779Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.780Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.780Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "24171a61-aec6-428e-b7ed-7461b3795454", :name 2021, :inspection_start_date #inst "2020-10-26T11:00:00.000000000-00:00", :end_date #inst "2020-12-31T11:00:00.000000000-00:00", :created_at #inst "2018-09-18T04:41:49.945068000-00:00", :updated_at #inst "2018-09-18T04:41:49.945068000-00:00"}
>oo> bp-id #uuid "24171a61-aec6-428e-b7ed-7461b3795454"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.783Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.783Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "24171a61-aec6-428e-b7ed-7461b3795454" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.784Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 703900000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.785Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.785Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"]
2023-12-09T18:43:16.785Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.785Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.788Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.788Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.789Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.789Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955", :name 2020, :inspection_start_date #inst "2019-11-09T11:00:00.000000000-00:00", :end_date #inst "2019-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:19.000000000-00:00", :updated_at #inst "2018-09-18T04:41:49.937658000-00:00"}
>oo> bp-id #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.790Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.790Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "3b7eab1e-c8b5-512b-9146-91cc295be955" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.791Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 529743800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.794Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.794Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"]
2023-12-09T18:43:16.795Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.795Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.795Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.795Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.797Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 1000000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.797Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0", :name 2019, :inspection_start_date #inst "2018-11-10T00:00:00.000000000-00:00", :end_date #inst "2018-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:06:01.000000000-00:00", :updated_at #inst "2018-11-02T16:06:45.497590000-00:00"}
>oo> bp-id #uuid "9fb023db-725d-5881-8838-bae3e970ffd0"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.799Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.799Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "9fb023db-725d-5881-8838-bae3e970ffd0" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.800Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 612864300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.801Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.801Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"]
2023-12-09T18:43:16.802Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.802Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.804Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.804Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.806Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 2443000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.806Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d", :name 2018, :inspection_start_date #inst "2017-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-12-31T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:27.000000000-00:00", :updated_at #inst "2018-02-23T13:51:41.593810000-00:00"}
>oo> bp-id #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.806Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.806Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "c2c5f618-7e05-5e43-a2b1-ec7f9172335d" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.807Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 437361300M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.807Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.810Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"]
2023-12-09T18:43:16.810Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.810Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.811Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.811Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.812Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 3658000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.812Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da", :name 2016, :inspection_start_date #inst "2016-11-01T00:00:00.000000000-00:00", :end_date #inst "2017-01-30T00:00:00.000000000-00:00", :created_at #inst "2016-11-21T14:23:48.000000000-00:00", :updated_at #inst "2016-11-21T14:23:48.000000000-00:00"}
>oo> bp-id #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.815Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.815Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "4f367b79-76cf-5f12-ab7b-535a7430e6da" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.816Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 17990000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.817Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.817Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"]
2023-12-09T18:43:16.818Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.818Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.818Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.820Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.820Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.820Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02", :name abc4, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:49.177632000-00:00", :updated_at #inst "2023-12-09T17:06:49.177632000-00:00"}
>oo> bp-id #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.821Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.821Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "2d73b11a-45b0-4d78-8fb3-611ce94a4a02" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.822Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.822Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.822Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"]
2023-12-09T18:43:16.826Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.826Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.826Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.826Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.827Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.827Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3", :name abc5, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:10:35.815484000-00:00", :updated_at #inst "2023-12-09T17:10:35.815484000-00:00"}
>oo> bp-id #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.827Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.830Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.831Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.832Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.833Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"]
2023-12-09T18:43:16.833Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.833Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.833Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.834Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.836Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.836Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77", :name abc, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:02:43.438144000-00:00", :updated_at #inst "2023-12-09T17:02:43.438144000-00:00"}
>oo> bp-id #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.836Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.836Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "a8e5eb47-28e3-41d4-b896-e7d2719aad77" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.837Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.838Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.838Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"]
2023-12-09T18:43:16.841Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result false}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.841Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.841Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.841Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.842Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 140000M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.842Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1", :name 2017, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2016-03-30T09:05:04.000000000-00:00", :updated_at #inst "2016-03-30T09:05:04.000000000-00:00"}
>oo> bp-id #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.843Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.843Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "aba0576e-d65f-5fe0-aa80-89ce226ec9b1" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.847Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => 492786800M
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.848Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.848Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"]
2023-12-09T18:43:16.849Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.849Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.850Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.850Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.852Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.852Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31", :name abc6, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:11:48.521614000-00:00", :updated_at #inst "2023-12-09T17:11:48.521614000-00:00"}
>oo> bp-id #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.853Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.853Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "b6360017-2ed0-48f4-9659-5d8ef224dd31" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.854Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.855Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.855Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"]
2023-12-09T18:43:16.857Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.857Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.857Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.857Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.858Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.858Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3", :name abc3, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:06:19.150002000-00:00", :updated_at #inst "2023-12-09T17:06:19.150002000-00:00"}
>oo> bp-id #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.859Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.859Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.862Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.862Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>> can-delete2
>oo> hoi2
2023-12-09T18:43:16.863Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:?] - (sql-format (sql/select (vector [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] :result))) => ["SELECT NOT EXISTS (SELECT TRUE FROM procurement_requests AS pr WHERE pr.budget_period_id = CAST(? AS UUID)) AND NOT EXISTS (SELECT TRUE FROM procurement_budget_limits AS pbl WHERE pbl.budget_period_id = CAST(? AS UUID)) AS result" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"]
2023-12-09T18:43:16.864Z NX-41294 DEBUG [leihs.procurement.resources.budget-period:200] - (jdbc/execute-one! (-> context :request :tx-next) (-> [:and [:not [:exists (-> (sql/select true) (sql/from [:procurement_requests :pr]) (sql/where [:= :pr.budget_period_id [:cast (:id value) :uuid]]))]] [:not [:exists (-> (sql/select true) (sql/from [:procurement_budget_limits :pbl]) (sql/where [:= :pbl.budget_period_id [:cast (:id value) :uuid]]))]]] (vector :result) sql/select sql-format spy)) => {:result true}
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.864Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-new-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> total-price-sqlmap :requested_quantity
>oo> sql-sum :requested_quantity
2023-12-09T18:43:16.864Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]]
2023-12-09T18:43:16.864Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents :requested_quantity] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid] :uuid]] [:= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.868Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil
>>1x #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}
>>2x {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}
>o> admin? [SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID)) #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
2023-12-09T18:43:16.868Z NX-41294 DEBUG [leihs.procurement.permissions.user:33] - query => ["SELECT EXISTS (SELECT TRUE AS exists FROM procurement_admins WHERE procurement_admins.user_id = CAST(? AS UUID))" #uuid "a786135f-c159-4618-9dd3-0012ebb3d500"]
>o> admin? {:exists true}
>oo> total-price-cents-inspected-requests {:id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732", :name abc2, :inspection_start_date #inst "2016-11-04T00:00:00.000000000-00:00", :end_date #inst "2017-01-22T00:00:00.000000000-00:00", :created_at #inst "2023-12-09T17:03:39.156382000-00:00", :updated_at #inst "2023-12-09T17:03:39.156382000-00:00"}
>oo> bp-id #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732"
>oo> total-price-sqlmap [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
>oo> sql-sum [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]
2023-12-09T18:43:16.868Z NX-41294 DEBUG [leihs.procurement.resources.requests:432] - (as-> qty-type <> [:* :procurement_requests.price_cents <>] [:cast <> :bigint] [:sum <>]) => [:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]]
2023-12-09T18:43:16.868Z NX-41294 DEBUG [leihs.procurement.resources.requests:467] - (-> (sql/select :procurement_requests.budget_period_id [(sql-sum qty-type) :result]) (sql/from :procurement_requests) (sql/where [:= :procurement_requests.budget_period_id [:cast bp-id :uuid]]) (sql/group-by :procurement_requests.budget_period_id)) => {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]], :group-by [:procurement_requests.budget_period_id]}
>oo> get-total-price-cents {:select [:procurement_requests.budget_period_id [[:sum [:cast [:* :procurement_requests.price_cents [[:coalesce :procurement_requests.order_quantity :procurement_requests.approved_quantity]]] :bigint]] :result]], :from [:procurement_requests], :where [:and [:= :procurement_requests.budget_period_id [:cast #uuid "085bf144-7e53-48ef-beb4-ca2d0945e732" :uuid]] [:!= :procurement_requests.approved_quantity nil]], :group-by [:procurement_requests.budget_period_id]}
2023-12-09T18:43:16.869Z NX-41294 DEBUG [leihs.procurement.resources.requests:420] - (some->> sqlmap sql-format (jdbc/execute-one! tx) :result) => nil

>request-grapql _> request {:leihs-user-language {:name Deutsch, :locale de-CH, :default true, :active true}, :authenticated-entity {:email manuel.radl@zhdk.ch, :contracts_count 1, :lastname Radl, :org_id 271682, :scope_read true, :is_admin true, :authentication-method :session, :login mradl, :scope_system_admin_write true, :scope_write true, :firstname Manuel, :scope_admin_write true, :user_session_created_at #time/instant "2023-12-09T07:09:54.188679Z", :id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :user_session_id #uuid "4d6070c4-5989-45bb-a1dc-1ee5409551ae", :scope_system_admin_read true, :access-rights ({:role customer, :inventory_pool_id #uuid "3977012c-ce0e-501f-889b-8715fdb5d83b"} {:role customer, :inventory_pool_id #uuid "5863967f-9804-4909-a9b7-92254616d6b2"} {:role customer, :inventory_pool_id #uuid "5dd25b58-fa56-5095-bd97-2696d92c2fb1"} {:role customer, :inventory_pool_id #uuid "77e88ec8-9ff6-5435-818e-dc902fc631a6"} {:role inventory_manager, :inventory_pool_id #uuid "8bd16d45-056d-5590-bc7f-12849f034351"} {:role inventory_manager, :inventory_pool_id #uuid "a02b8163-9a16-5066-b48e-9eb74cf8b791"} {:role inventory_manager, :inventory_pool_id #uuid "b534b07c-d9bf-4572-840c-0a630b8cd8ed"} {:role customer, :inventory_pool_id #uuid "fc5a841e-36c6-5dc3-8207-1306c1fb89bf"} {:role customer, :inventory_pool_id #uuid "ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}), :user_id #uuid "a786135f-c159-4618-9dd3-0012ebb3d500", :is_system_admin true, :external_sign_out_url nil, :language_locale de-CH, :inventory_pool_roles_count 9, :scope_admin_read true}, :cookies {leihs-anti-csrf-token {:value dc7e186c-6046-4dce-9a37-5d14ea14e0e1}, leihs-user-session {:value 9c7d0f0a-d4f8-419f-843b-2642a9e25659}}, :remote-addr 127.0.0.1, :start-time 224325334452875, :params {}, :settings {:email_sending_enabled false, :sessions_max_lifetime_secs 432000, :smtp_default_from_address noreply@zhdk.ch, :public_image_caching_enabled true, :sessions_force_secure false, :deliver_received_order_notifications false, :external_base_url http://localhost:3200, :sessions_force_uniqueness false, :email_signature Das ZHdK-Ausleihe-Team}, :tx-next #next.jdbc.default_options.DefaultOptions{:connectable #object[com.zaxxer.hikari.HikariDataSource 0x62a50821 HikariDataSource (HikariPool-1)], :options {:builder-fn #object[next.jdbc.result_set$as_unqualified_lower_maps 0x1fab0c15 next.jdbc.result_set$as_unqualified_lower_maps@1fab0c15]}}, :query-params-raw {}, :route-params nil, :headers {origin http://localhost:3230, sec-fetch-site same-origin, sec-ch-ua-mobile ?0, host localhost:3230, user-agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36, content-type application/json, cookie leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659, content-length 376, sec-ch-ua "Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24", sec-ch-ua-platform "macOS", referer http://localhost:3230/procure/admin/budget-periods, connection keep-alive, pragma no-cache, x-csrf-token dc7e186c-6046-4dce-9a37-5d14ea14e0e1, accept application/json, accept-language de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7, sec-fetch-dest empty, accept-encoding gzip, deflate, br, sec-fetch-mode cors, cache-control no-cache}, :async-channel #object[org.httpkit.server.AsyncChannel 0x4ef8c888 /127.0.0.1:3230<->/127.0.0.1:55197], :server-port 3230, :params-raw {}, :tx {:datasource #object[com.zaxxer.hikari.HikariDataSource 0xac4d34b HikariDataSource (db-pool)]}, :content-length 376, :form-params {}, :websocket? false, :query-params {}, :content-type application/json, :form-params-raw {}, :character-encoding utf8, :uri /procure/graphql, :server-name localhost, :handler-key :graphql, :query-string nil, :body {:operationName AdminBudgetPeriods, :variables {}, :query query AdminBudgetPeriods {
  budget_periods {
    ...AdminBudgetPeriodProps
    __typename
  }
}

fragment AdminBudgetPeriodProps on BudgetPeriod {
  id
  name
  inspection_start_date
  end_date
  can_delete
  total_price_cents_new_requests
  total_price_cents_inspected_requests
  __typename
}
}, :graphql-schema #CompiledSchema<>, :handler #object[leihs.procurement.graphql$handler 0x1af475c leihs.procurement.graphql$handler@1af475c], :multipart-params {}, :scheme :http, :request-method :post, :accept {:mime :json, :charset nil, :encoding nil, :language nil}}

>request-c-grapql _> request (json) {"leihs-user-language":{"name":"Deutsch","locale":"de-CH","default":true,"active":true},"authenticated-entity":{"email":"manuel.radl@zhdk.ch","contracts_count":1,"lastname":"Radl","org_id":"271682","scope_read":true,"is_admin":true,"authentication-method":"session","login":"mradl","scope_system_admin_write":true,"scope_write":true,"firstname":"Manuel","scope_admin_write":true,"user_session_created_at":"2023-12-09T07:09:54.188679Z","id":"a786135f-c159-4618-9dd3-0012ebb3d500","user_session_id":"4d6070c4-5989-45bb-a1dc-1ee5409551ae","scope_system_admin_read":true,"access-rights":[{"role":"customer","inventory_pool_id":"3977012c-ce0e-501f-889b-8715fdb5d83b"},{"role":"customer","inventory_pool_id":"5863967f-9804-4909-a9b7-92254616d6b2"},{"role":"customer","inventory_pool_id":"5dd25b58-fa56-5095-bd97-2696d92c2fb1"},{"role":"customer","inventory_pool_id":"77e88ec8-9ff6-5435-818e-dc902fc631a6"},{"role":"inventory_manager","inventory_pool_id":"8bd16d45-056d-5590-bc7f-12849f034351"},{"role":"inventory_manager","inventory_pool_id":"a02b8163-9a16-5066-b48e-9eb74cf8b791"},{"role":"inventory_manager","inventory_pool_id":"b534b07c-d9bf-4572-840c-0a630b8cd8ed"},{"role":"customer","inventory_pool_id":"fc5a841e-36c6-5dc3-8207-1306c1fb89bf"},{"role":"customer","inventory_pool_id":"ffaa3aea-2a1f-4d6a-bdfc-f3be93699750"}],"user_id":"a786135f-c159-4618-9dd3-0012ebb3d500","is_system_admin":true,"external_sign_out_url":null,"language_locale":"de-CH","inventory_pool_roles_count":9,"scope_admin_read":true},"cookies":{"leihs-anti-csrf-token":{"value":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1"},"leihs-user-session":{"value":"9c7d0f0a-d4f8-419f-843b-2642a9e25659"}},"remote-addr":"127.0.0.1","start-time":224325334452875,"params":{},"settings":{"email_sending_enabled":false,"sessions_max_lifetime_secs":432000,"smtp_default_from_address":"noreply@zhdk.ch","public_image_caching_enabled":true,"sessions_force_secure":false,"deliver_received_order_notifications":false,"external_base_url":"http:\/\/localhost:3200","sessions_force_uniqueness":false,"email_signature":"Das ZHdK-Ausleihe-Team"},"query-params-raw":{},"route-params":null,"headers":{"origin":"http:\/\/localhost:3230","sec-fetch-site":"same-origin","sec-ch-ua-mobile":"?0","host":"localhost:3230","user-agent":"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/119.0.0.0 Safari\/537.36","content-type":"application\/json","cookie":"leihs-anti-csrf-token=dc7e186c-6046-4dce-9a37-5d14ea14e0e1; leihs-user-session=9c7d0f0a-d4f8-419f-843b-2642a9e25659","content-length":"376","sec-ch-ua":"\"Google Chrome\";v=\"119\", \"Chromium\";v=\"119\", \"Not?A_Brand\";v=\"24\"","sec-ch-ua-platform":"\"macOS\"","referer":"http:\/\/localhost:3230\/procure\/admin\/budget-periods","connection":"keep-alive","pragma":"no-cache","x-csrf-token":"dc7e186c-6046-4dce-9a37-5d14ea14e0e1","accept":"application\/json","accept-language":"de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7","sec-fetch-dest":"empty","accept-encoding":"gzip, deflate, br","sec-fetch-mode":"cors","cache-control":"no-cache"},"server-port":3230,"params-raw":{},"content-length":376,"form-params":{},"websocket?":false,"query-params":{},"content-type":"application\/json","form-params-raw":{},"character-encoding":"utf8","uri":"\/procure\/graphql","server-name":"localhost","handler-key":"graphql","query-string":null,"body":{"operationName":"AdminBudgetPeriods","variables":{},"query":"query AdminBudgetPeriods {\n  budget_periods {\n    ...AdminBudgetPeriodProps\n    __typename\n  }\n}\n\nfragment AdminBudgetPeriodProps on BudgetPeriod {\n  id\n  name\n  inspection_start_date\n  end_date\n  can_delete\n  total_price_cents_new_requests\n  total_price_cents_inspected_requests\n  __typename\n}\n"},"multipart-params":{},"scheme":"http","request-method":"post","accept":{"mime":"json","charset":null,"encoding":null,"language":null}}

>request-grapql _> result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id 1a1dab20-c661-4204-a913-28065d570f7c] [:name 2028] [:inspection_start_date 2027-11-01 01:00:00.0] [:end_date 2027-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id dfdd0798-6462-46fc-995f-a7d7233f30fd] [:name 2027] [:inspection_start_date 2026-11-02 01:00:00.0] [:end_date 2026-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 6b689ed8-8148-485a-b1ca-86c1c739503e] [:name 2026] [:inspection_start_date 2025-11-03 01:00:00.0] [:end_date 2025-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 70543100] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1173b482-b9e6-46b4-a5e3-0b021c860e9b] [:name 2025] [:inspection_start_date 2024-11-04 01:00:00.0] [:end_date 2024-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 75250000] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f] [:name 2024] [:inspection_start_date 2023-10-01 12:00:00.0] [:end_date 2023-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 560501800] [:__typename :BudgetPeriod]) #ordered/map ([:id 3d4925fd-10ab-42b4-b1df-658ce998235f] [:name gggg] [:inspection_start_date 2023-12-09 18:19:22.335] [:end_date 2023-12-09 18:19:22.335] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 1b523473-a2e9-44f4-8fe0-75473ca6e2c3] [:name fffff] [:inspection_start_date 2023-12-09 18:18:03.611] [:end_date 2023-12-09 18:18:03.611] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 51c8704c-752c-4c61-bb6b-ae222344b98d] [:name eeee] [:inspection_start_date 2023-12-09 18:17:40.013] [:end_date 2023-12-09 18:17:40.013] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 951ac476-4f92-4ff9-9f64-26fc8f8b61c5] [:name 2023] [:inspection_start_date 2022-11-01 01:00:00.0] [:end_date 2022-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 680423900] [:__typename :BudgetPeriod]) #ordered/map ([:id 76b66d78-bfe0-4c54-8c92-edbf467af784] [:name 2022] [:inspection_start_date 2021-10-29 12:00:00.0] [:end_date 2021-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 24171a61-aec6-428e-b7ed-7461b3795454] [:name 2021] [:inspection_start_date 2020-10-26 12:00:00.0] [:end_date 2020-12-31 12:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 703900000] [:__typename :BudgetPeriod]) #ordered/map ([:id 3b7eab1e-c8b5-512b-9146-91cc295be955] [:name 2020] [:inspection_start_date 2019-11-09 12:00:00.0] [:end_date 2019-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 529743800] [:__typename :BudgetPeriod]) #ordered/map ([:id 9fb023db-725d-5881-8838-bae3e970ffd0] [:name 2019] [:inspection_start_date 2018-11-10 01:00:00.0] [:end_date 2018-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 1000000] [:total_price_cents_inspected_requests 612864300] [:__typename :BudgetPeriod]) #ordered/map ([:id c2c5f618-7e05-5e43-a2b1-ec7f9172335d] [:name 2018] [:inspection_start_date 2017-11-04 01:00:00.0] [:end_date 2017-12-31 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 2443000] [:total_price_cents_inspected_requests 437361300] [:__typename :BudgetPeriod]) #ordered/map ([:id 4f367b79-76cf-5f12-ab7b-535a7430e6da] [:name 2016] [:inspection_start_date 2016-11-01 01:00:00.0] [:end_date 2017-01-30 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 3658000] [:total_price_cents_inspected_requests 17990000] [:__typename :BudgetPeriod]) #ordered/map ([:id 2d73b11a-45b0-4d78-8fb3-611ce94a4a02] [:name abc4] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id da8e123d-45d3-4cc0-9f2d-9fd11141b6f3] [:name abc5] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id a8e5eb47-28e3-41d4-b896-e7d2719aad77] [:name abc] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id aba0576e-d65f-5fe0-aa80-89ce226ec9b1] [:name 2017] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete false] [:total_price_cents_new_requests 140000] [:total_price_cents_inspected_requests 492786800] [:__typename :BudgetPeriod]) #ordered/map ([:id b6360017-2ed0-48f4-9659-5d8ef224dd31] [:name abc6] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 38b1bbd2-5dc8-4733-8f2e-339d3ae752c3] [:name abc3] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod]) #ordered/map ([:id 085bf144-7e53-48ef-beb4-ca2d0945e732] [:name abc2] [:inspection_start_date 2016-11-04 01:00:00.0] [:end_date 2017-01-22 01:00:00.0] [:can_delete true] [:total_price_cents_new_requests 0] [:total_price_cents_inspected_requests 0] [:__typename :BudgetPeriod])]])}
2023-12-09T18:43:16.877Z NX-41294 DEBUG [leihs.procurement.graphql:86] - result => {:data #ordered/map ([:budget_periods [#ordered/map ([:id "1a1dab20-c661-4204-a913-28065d570f7c"] [:name "2028"] [:inspection_start_date "2027-11-01 01:00:00.0"] [:end_date "2027-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "dfdd0798-6462-46fc-995f-a7d7233f30fd"] [:name "2027"] [:inspection_start_date "2026-11-02 01:00:00.0"] [:end_date "2026-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "6b689ed8-8148-485a-b1ca-86c1c739503e"] [:name "2026"] [:inspection_start_date "2025-11-03 01:00:00.0"] [:end_date "2025-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "70543100"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1173b482-b9e6-46b4-a5e3-0b021c860e9b"] [:name "2025"] [:inspection_start_date "2024-11-04 01:00:00.0"] [:end_date "2024-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "75250000"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "e5d2ae4b-566f-4d6d-aed9-d6a8353eda7f"] [:name "2024"] [:inspection_start_date "2023-10-01 12:00:00.0"] [:end_date "2023-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "560501800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3d4925fd-10ab-42b4-b1df-658ce998235f"] [:name "gggg"] [:inspection_start_date "2023-12-09 18:19:22.335"] [:end_date "2023-12-09 18:19:22.335"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "1b523473-a2e9-44f4-8fe0-75473ca6e2c3"] [:name "fffff"] [:inspection_start_date "2023-12-09 18:18:03.611"] [:end_date "2023-12-09 18:18:03.611"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "51c8704c-752c-4c61-bb6b-ae222344b98d"] [:name "eeee"] [:inspection_start_date "2023-12-09 18:17:40.013"] [:end_date "2023-12-09 18:17:40.013"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "951ac476-4f92-4ff9-9f64-26fc8f8b61c5"] [:name "2023"] [:inspection_start_date "2022-11-01 01:00:00.0"] [:end_date "2022-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "680423900"] [:__typename :BudgetPeriod]) #ordered/map ([:id "76b66d78-bfe0-4c54-8c92-edbf467af784"] [:name "2022"] [:inspection_start_date "2021-10-29 12:00:00.0"] [:end_date "2021-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "24171a61-aec6-428e-b7ed-7461b3795454"] [:name "2021"] [:inspection_start_date "2020-10-26 12:00:00.0"] [:end_date "2020-12-31 12:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "703900000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "3b7eab1e-c8b5-512b-9146-91cc295be955"] [:name "2020"] [:inspection_start_date "2019-11-09 12:00:00.0"] [:end_date "2019-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "529743800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "9fb023db-725d-5881-8838-bae3e970ffd0"] [:name "2019"] [:inspection_start_date "2018-11-10 01:00:00.0"] [:end_date "2018-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "1000000"] [:total_price_cents_inspected_requests "612864300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "c2c5f618-7e05-5e43-a2b1-ec7f9172335d"] [:name "2018"] [:inspection_start_date "2017-11-04 01:00:00.0"] [:end_date "2017-12-31 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "2443000"] [:total_price_cents_inspected_requests "437361300"] [:__typename :BudgetPeriod]) #ordered/map ([:id "4f367b79-76cf-5f12-ab7b-535a7430e6da"] [:name "2016"] [:inspection_start_date "2016-11-01 01:00:00.0"] [:end_date "2017-01-30 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "3658000"] [:total_price_cents_inspected_requests "17990000"] [:__typename :BudgetPeriod]) #ordered/map ([:id "2d73b11a-45b0-4d78-8fb3-611ce94a4a02"] [:name "abc4"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "da8e123d-45d3-4cc0-9f2d-9fd11141b6f3"] [:name "abc5"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "a8e5eb47-28e3-41d4-b896-e7d2719aad77"] [:name "abc"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "aba0576e-d65f-5fe0-aa80-89ce226ec9b1"] [:name "2017"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete false] [:total_price_cents_new_requests "140000"] [:total_price_cents_inspected_requests "492786800"] [:__typename :BudgetPeriod]) #ordered/map ([:id "b6360017-2ed0-48f4-9659-5d8ef224dd31"] [:name "abc6"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "38b1bbd2-5dc8-4733-8f2e-339d3ae752c3"] [:name "abc3"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod]) #ordered/map ([:id "085bf144-7e53-48ef-beb4-ca2d0945e732"] [:name "abc2"] [:inspection_start_date "2016-11-04 01:00:00.0"] [:end_date "2017-01-22 01:00:00.0"] [:can_delete true] [:total_price_cents_new_requests "0"] [:total_price_cents_inspected_requests "0"] [:__typename :BudgetPeriod])]])}
